import{c as Rr}from"./_commonjsHelpers.88e99c8f.js";function Wn($e,a){return a.forEach(function(S){S&&typeof S!="string"&&!Array.isArray(S)&&Object.keys(S).forEach(function(lt){if(lt!=="default"&&!(lt in $e)){var Y=Object.getOwnPropertyDescriptor(S,lt);Object.defineProperty($e,lt,Y.get?Y:{enumerable:!0,get:function(){return S[lt]}})}})}),Object.freeze(Object.defineProperty($e,Symbol.toStringTag,{value:"Module"}))}var Nr={},Oo={exports:{}};/**
 * Planck.js v1.0.4
 * @license The MIT license
 * @copyright Copyright (c) 2023 Erin Catto, Ali Shakiba
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */(function($e,a){(function(S,lt){lt(a)})(Rr,function(S){/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var lt=function(s,t){return(lt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])})(s,t)};function Y(s,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=s}lt(s,t),s.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var it=function(){return(it=Object.assign||function(s){for(var t,e=1,r=arguments.length;e<r;e++)for(var n in t=arguments[e])Object.prototype.hasOwnProperty.call(t,n)&&(s[n]=t[n]);return s}).apply(this,arguments)},xt=function(s,t){s==null&&(s={});var e=it({},s);for(var r in t)t.hasOwnProperty(r)&&s[r]===void 0&&(e[r]=t[r]);if(typeof Object.getOwnPropertySymbols=="function")for(var n=Object.getOwnPropertySymbols(t),m=0;m<n.length;m++){var l=n[m];t.propertyIsEnumerable(l)&&s[l]===void 0&&(e[l]=t[l])}return e},Ct=Math.random,nt=1e-9,Je=Number.isFinite;function Mt(s,t,e){return t===void 0?(e=1,t=0):e===void 0&&(e=t,t=0),e>t?(s=(s-t)%(e-t))+(s<0?e:t):(s=(s-e)%(t-e))+(s<=0?t:e)}function gt(s,t,e){return s<t?t:s>e?e:s}var ne=Object.create(Math);ne.EPSILON=nt,ne.isFinite=Je,ne.nextPowerOfTwo=function(s){return s|=s>>1,s|=s>>2,s|=s>>4,s|=s>>8,(s|=s>>16)+1},ne.isPowerOfTwo=function(s){return s>0&&(s&s-1)==0},ne.mod=Mt,ne.clamp=gt,ne.random=function(s,t){return s===void 0?(t=1,s=0):t===void 0&&(t=s,s=0),s===t?s:Ct()*(t-s)+s};var Ni=Math.abs,Ri=Math.sqrt,Ei=Math.max,ns=Math.min,c=function(){function s(t,e){if(!(this instanceof s))return new s(t,e);t===void 0?(this.x=0,this.y=0):typeof t=="object"?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e)}return s.prototype._serialize=function(){return{x:this.x,y:this.y}},s._deserialize=function(t){var e=Object.create(s.prototype);return e.x=t.x,e.y=t.y,e},s.zero=function(){var t=Object.create(s.prototype);return t.x=0,t.y=0,t},s.neo=function(t,e){var r=Object.create(s.prototype);return r.x=t,r.y=e,r},s.clone=function(t){return s.neo(t.x,t.y)},s.prototype.toString=function(){return JSON.stringify(this)},s.isValid=function(t){return t!=null&&Number.isFinite(t.x)&&Number.isFinite(t.y)},s.assert=function(t){},s.prototype.clone=function(){return s.clone(this)},s.prototype.setZero=function(){return this.x=0,this.y=0,this},s.prototype.set=function(t,e){return typeof t=="object"?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e),this},s.prototype.setNum=function(t,e){return this.x=t,this.y=e,this},s.prototype.setVec2=function(t){return this.x=t.x,this.y=t.y,this},s.prototype.wSet=function(t,e,r,n){return r!==void 0||n!==void 0?this.setCombine(t,e,r,n):this.setMul(t,e)},s.prototype.setCombine=function(t,e,r,n){var m=t*e.x+r*n.x,l=t*e.y+r*n.y;return this.x=m,this.y=l,this},s.prototype.setMul=function(t,e){var r=t*e.x,n=t*e.y;return this.x=r,this.y=n,this},s.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},s.prototype.wAdd=function(t,e,r,n){return r!==void 0||n!==void 0?this.addCombine(t,e,r,n):this.addMul(t,e)},s.prototype.addCombine=function(t,e,r,n){var m=t*e.x+r*n.x,l=t*e.y+r*n.y;return this.x+=m,this.y+=l,this},s.prototype.addMul=function(t,e){var r=t*e.x,n=t*e.y;return this.x+=r,this.y+=n,this},s.prototype.wSub=function(t,e,r,n){return r!==void 0||n!==void 0?this.subCombine(t,e,r,n):this.subMul(t,e)},s.prototype.subCombine=function(t,e,r,n){var m=t*e.x+r*n.x,l=t*e.y+r*n.y;return this.x-=m,this.y-=l,this},s.prototype.subMul=function(t,e){var r=t*e.x,n=t*e.y;return this.x-=r,this.y-=n,this},s.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this},s.prototype.mul=function(t){return this.x*=t,this.y*=t,this},s.prototype.length=function(){return s.lengthOf(this)},s.prototype.lengthSquared=function(){return s.lengthSquared(this)},s.prototype.normalize=function(){var t=this.length();if(t<nt)return 0;var e=1/t;return this.x*=e,this.y*=e,t},s.lengthOf=function(t){return Ri(t.x*t.x+t.y*t.y)},s.lengthSquared=function(t){return t.x*t.x+t.y*t.y},s.distance=function(t,e){var r=t.x-e.x,n=t.y-e.y;return Ri(r*r+n*n)},s.distanceSquared=function(t,e){var r=t.x-e.x,n=t.y-e.y;return r*r+n*n},s.areEqual=function(t,e){return t===e||typeof e=="object"&&e!==null&&t.x===e.x&&t.y===e.y},s.skew=function(t){return s.neo(-t.y,t.x)},s.dot=function(t,e){return t.x*e.x+t.y*e.y},s.cross=function(t,e){return typeof e=="number"?s.neo(e*t.y,-e*t.x):typeof t=="number"?s.neo(-t*e.y,t*e.x):t.x*e.y-t.y*e.x},s.crossVec2Vec2=function(t,e){return t.x*e.y-t.y*e.x},s.crossVec2Num=function(t,e){return s.neo(e*t.y,-e*t.x)},s.crossNumVec2=function(t,e){return s.neo(-t*e.y,t*e.x)},s.addCross=function(t,e,r){return typeof r=="number"?s.neo(r*e.y+t.x,-r*e.x+t.y):typeof e=="number"?s.neo(-e*r.y+t.x,e*r.x+t.y):void 0},s.addCrossVec2Num=function(t,e,r){return s.neo(r*e.y+t.x,-r*e.x+t.y)},s.addCrossNumVec2=function(t,e,r){return s.neo(-e*r.y+t.x,e*r.x+t.y)},s.add=function(t,e){return s.neo(t.x+e.x,t.y+e.y)},s.wAdd=function(t,e,r,n){return r!==void 0||n!==void 0?s.combine(t,e,r,n):s.mulNumVec2(t,e)},s.combine=function(t,e,r,n){return s.zero().setCombine(t,e,r,n)},s.sub=function(t,e){return s.neo(t.x-e.x,t.y-e.y)},s.mul=function(t,e){return typeof t=="object"?s.neo(t.x*e,t.y*e):typeof e=="object"?s.neo(t*e.x,t*e.y):void 0},s.mulVec2Num=function(t,e){return s.neo(t.x*e,t.y*e)},s.mulNumVec2=function(t,e){return s.neo(t*e.x,t*e.y)},s.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this},s.neg=function(t){return s.neo(-t.x,-t.y)},s.abs=function(t){return s.neo(Ni(t.x),Ni(t.y))},s.mid=function(t,e){return s.neo(.5*(t.x+e.x),.5*(t.y+e.y))},s.upper=function(t,e){return s.neo(Ei(t.x,e.x),Ei(t.y,e.y))},s.lower=function(t,e){return s.neo(ns(t.x,e.x),ns(t.y,e.y))},s.prototype.clamp=function(t){var e=this.x*this.x+this.y*this.y;if(e>t*t){var r=t/Ri(e);this.x*=r,this.y*=r}return this},s.clamp=function(t,e){var r=s.neo(t.x,t.y);return r.clamp(e),r},s.scaleFn=function(t,e){return function(r){return s.neo(r.x*t,r.y*e)}},s.translateFn=function(t,e){return function(r){return s.neo(r.x+t,r.y+e)}},s}(),Ut=Math.max,$t=Math.min,bt=function(){function s(t,e){if(!(this instanceof s))return new s(t,e);this.lowerBound=c.zero(),this.upperBound=c.zero(),typeof t=="object"&&this.lowerBound.setVec2(t),typeof e=="object"?this.upperBound.setVec2(e):typeof t=="object"&&this.upperBound.setVec2(t)}return s.prototype.isValid=function(){return s.isValid(this)},s.isValid=function(t){return t!=null&&c.isValid(t.lowerBound)&&c.isValid(t.upperBound)&&c.sub(t.upperBound,t.lowerBound).lengthSquared()>=0},s.assert=function(t){},s.prototype.getCenter=function(){return c.neo(.5*(this.lowerBound.x+this.upperBound.x),.5*(this.lowerBound.y+this.upperBound.y))},s.prototype.getExtents=function(){return c.neo(.5*(this.upperBound.x-this.lowerBound.x),.5*(this.upperBound.y-this.lowerBound.y))},s.prototype.getPerimeter=function(){return 2*(this.upperBound.x-this.lowerBound.x+this.upperBound.y-this.lowerBound.y)},s.prototype.combine=function(t,e){e=e||this;var r=t.lowerBound,n=t.upperBound,m=e.lowerBound,l=e.upperBound,_=$t(r.x,m.x),A=$t(r.y,m.y),v=Ut(l.x,n.x),d=Ut(l.y,n.y);this.lowerBound.setNum(_,A),this.upperBound.setNum(v,d)},s.prototype.combinePoints=function(t,e){this.lowerBound.setNum($t(t.x,e.x),$t(t.y,e.y)),this.upperBound.setNum(Ut(t.x,e.x),Ut(t.y,e.y))},s.prototype.set=function(t){this.lowerBound.setNum(t.lowerBound.x,t.lowerBound.y),this.upperBound.setNum(t.upperBound.x,t.upperBound.y)},s.prototype.contains=function(t){var e=!0;return e=(e=(e=(e=e&&this.lowerBound.x<=t.lowerBound.x)&&this.lowerBound.y<=t.lowerBound.y)&&t.upperBound.x<=this.upperBound.x)&&t.upperBound.y<=this.upperBound.y},s.prototype.extend=function(t){return s.extend(this,t),this},s.extend=function(t,e){return t.lowerBound.x-=e,t.lowerBound.y-=e,t.upperBound.x+=e,t.upperBound.y+=e,t},s.testOverlap=function(t,e){var r=e.lowerBound.x-t.upperBound.x,n=t.lowerBound.x-e.upperBound.x,m=e.lowerBound.y-t.upperBound.y,l=t.lowerBound.y-e.upperBound.y;return!(r>0||m>0||n>0||l>0)},s.areEqual=function(t,e){return c.areEqual(t.lowerBound,e.lowerBound)&&c.areEqual(t.upperBound,e.upperBound)},s.diff=function(t,e){var r=Ut(0,$t(t.upperBound.x,e.upperBound.x)-Ut(e.lowerBound.x,t.lowerBound.x)),n=Ut(0,$t(t.upperBound.y,e.upperBound.y)-Ut(e.lowerBound.y,t.lowerBound.y));return(t.upperBound.x-t.lowerBound.x)*(t.upperBound.y-t.lowerBound.y)+(e.upperBound.x-e.lowerBound.x)*(e.upperBound.y-e.lowerBound.y)-r*n},s.prototype.rayCast=function(t,e){for(var r=-1/0,n=1/0,m=e.p1,l=c.sub(e.p2,e.p1),_=c.abs(l),A=c.zero(),v="x";v!==null;v=v==="x"?"y":null)if(_.x<nt){if(m[v]<this.lowerBound[v]||this.upperBound[v]<m[v])return!1}else{var d=1/l[v],y=(this.lowerBound[v]-m[v])*d,b=(this.upperBound[v]-m[v])*d,x=-1;if(y>b){var B=y;y=b,b=B,x=1}if(y>r&&(A.setZero(),A[v]=x,r=y),r>(n=$t(n,b)))return!1}return!(r<0||e.maxFraction<r)&&(t.fraction=r,t.normal=A,!0)},s.prototype.toString=function(){return JSON.stringify(this)},s.combinePoints=function(t,e,r){return t.lowerBound.x=$t(e.x,r.x),t.lowerBound.y=$t(e.y,r.y),t.upperBound.x=Ut(e.x,r.x),t.upperBound.y=Ut(e.y,r.y),t},s.combinedPerimeter=function(t,e){var r=$t(t.lowerBound.x,e.lowerBound.x),n=$t(t.lowerBound.y,e.lowerBound.y);return 2*(Ut(t.upperBound.x,e.upperBound.x)-r+Ut(t.upperBound.y,e.upperBound.y)-n)},s}(),ti=Math.PI,X=function(){function s(){}return Object.defineProperty(s,"polygonRadius",{get:function(){return 2*s.linearSlop},enumerable:!1,configurable:!0}),s.lengthUnitsPerMeter=1,s.maxManifoldPoints=2,s.maxPolygonVertices=12,s.aabbExtension=.1,s.aabbMultiplier=2,s.linearSlop=.005,s.angularSlop=2/180*ti,s.maxSubSteps=8,s.maxTOIContacts=32,s.maxTOIIterations=20,s.maxDistanceIterations=20,s.velocityThreshold=1,s.maxLinearCorrection=.2,s.maxAngularCorrection=8/180*ti,s.maxTranslation=2,s.maxRotation=.5*ti,s.baumgarte=.2,s.toiBaugarte=.75,s.timeToSleep=.5,s.linearSleepTolerance=.01,s.angularSleepTolerance=2/180*ti,s}(),W=function(){function s(){}return Object.defineProperty(s,"maxManifoldPoints",{get:function(){return X.maxManifoldPoints},enumerable:!1,configurable:!0}),Object.defineProperty(s,"maxPolygonVertices",{get:function(){return X.maxPolygonVertices},enumerable:!1,configurable:!0}),Object.defineProperty(s,"aabbExtension",{get:function(){return X.aabbExtension*X.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(s,"aabbMultiplier",{get:function(){return X.aabbMultiplier},enumerable:!1,configurable:!0}),Object.defineProperty(s,"linearSlop",{get:function(){return X.linearSlop*X.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(s,"linearSlopSquared",{get:function(){return X.linearSlop*X.lengthUnitsPerMeter*X.linearSlop*X.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(s,"angularSlop",{get:function(){return X.angularSlop},enumerable:!1,configurable:!0}),Object.defineProperty(s,"polygonRadius",{get:function(){return 2*X.linearSlop},enumerable:!1,configurable:!0}),Object.defineProperty(s,"maxSubSteps",{get:function(){return X.maxSubSteps},enumerable:!1,configurable:!0}),Object.defineProperty(s,"maxTOIContacts",{get:function(){return X.maxTOIContacts},enumerable:!1,configurable:!0}),Object.defineProperty(s,"maxTOIIterations",{get:function(){return X.maxTOIIterations},enumerable:!1,configurable:!0}),Object.defineProperty(s,"maxDistanceIterations",{get:function(){return X.maxDistanceIterations},enumerable:!1,configurable:!0}),Object.defineProperty(s,"velocityThreshold",{get:function(){return X.velocityThreshold*X.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(s,"maxLinearCorrection",{get:function(){return X.maxLinearCorrection*X.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(s,"maxAngularCorrection",{get:function(){return X.maxAngularCorrection},enumerable:!1,configurable:!0}),Object.defineProperty(s,"maxTranslation",{get:function(){return X.maxTranslation*X.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(s,"maxTranslationSquared",{get:function(){return X.maxTranslation*X.lengthUnitsPerMeter*X.maxTranslation*X.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(s,"maxRotation",{get:function(){return X.maxRotation},enumerable:!1,configurable:!0}),Object.defineProperty(s,"maxRotationSquared",{get:function(){return X.maxRotation*X.maxRotation},enumerable:!1,configurable:!0}),Object.defineProperty(s,"baumgarte",{get:function(){return X.baumgarte},enumerable:!1,configurable:!0}),Object.defineProperty(s,"toiBaugarte",{get:function(){return X.toiBaugarte},enumerable:!1,configurable:!0}),Object.defineProperty(s,"timeToSleep",{get:function(){return X.timeToSleep},enumerable:!1,configurable:!0}),Object.defineProperty(s,"linearSleepTolerance",{get:function(){return X.linearSleepTolerance*X.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(s,"linearSleepToleranceSqr",{get:function(){return X.linearSleepTolerance*X.lengthUnitsPerMeter*X.linearSleepTolerance*X.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(s,"angularSleepTolerance",{get:function(){return X.angularSleepTolerance},enumerable:!1,configurable:!0}),Object.defineProperty(s,"angularSleepToleranceSqr",{get:function(){return X.angularSleepTolerance*X.angularSleepTolerance},enumerable:!1,configurable:!0}),s}(),ei=function(){function s(t){this._list=[],this._max=1/0,this._hasCreateFn=!1,this._createCount=0,this._hasAllocateFn=!1,this._allocateCount=0,this._hasReleaseFn=!1,this._releaseCount=0,this._hasDisposeFn=!1,this._disposeCount=0,this._list=[],this._max=t.max||this._max,this._createFn=t.create,this._hasCreateFn=typeof this._createFn=="function",this._allocateFn=t.allocate,this._hasAllocateFn=typeof this._allocateFn=="function",this._releaseFn=t.release,this._hasReleaseFn=typeof this._releaseFn=="function",this._disposeFn=t.dispose,this._hasDisposeFn=typeof this._disposeFn=="function"}return s.prototype.max=function(t){return typeof t=="number"?(this._max=t,this):this._max},s.prototype.size=function(){return this._list.length},s.prototype.allocate=function(){var t;return this._list.length>0?t=this._list.shift():(this._createCount++,t=this._hasCreateFn?this._createFn():{}),this._allocateCount++,this._hasAllocateFn&&this._allocateFn(t),t},s.prototype.release=function(t){this._list.length<this._max?(this._releaseCount++,this._hasReleaseFn&&this._releaseFn(t),this._list.push(t)):(this._disposeCount++,this._hasDisposeFn&&(t=this._disposeFn(t)))},s.prototype.toString=function(){return" +"+this._createCount+" >"+this._allocateCount+" <"+this._releaseCount+" -"+this._disposeCount+" ="+this._list.length+"/"+this._max},s}(),as=Math.abs,Et=Math.max,Ht=function(){function s(t){this.aabb=new bt,this.userData=null,this.parent=null,this.child1=null,this.child2=null,this.height=-1,this.id=t}return s.prototype.toString=function(){return this.id+": "+this.userData},s.prototype.isLeaf=function(){return this.child1==null},s}(),ut=new ei({create:function(){return new Ht},release:function(s){s.userData=null,s.parent=null,s.child1=null,s.child2=null,s.height=-1,s.id=void 0}}),Ai=function(){function s(){this.inputPool=new ei({create:function(){return{}},release:function(t){}}),this.stackPool=new ei({create:function(){return[]},release:function(t){t.length=0}}),this.iteratorPool=new ei({create:function(){return new lo},release:function(t){t.close()}}),this.m_root=null,this.m_nodes={},this.m_lastProxyId=0}return s.prototype.getUserData=function(t){return this.m_nodes[t].userData},s.prototype.getFatAABB=function(t){return this.m_nodes[t].aabb},s.prototype.allocateNode=function(){var t=ut.allocate();return t.id=++this.m_lastProxyId,this.m_nodes[t.id]=t,t},s.prototype.freeNode=function(t){delete this.m_nodes[t.id],ut.release(t)},s.prototype.createProxy=function(t,e){var r=this.allocateNode();return r.aabb.set(t),bt.extend(r.aabb,W.aabbExtension),r.userData=e,r.height=0,this.insertLeaf(r),r.id},s.prototype.destroyProxy=function(t){var e=this.m_nodes[t];this.removeLeaf(e),this.freeNode(e)},s.prototype.moveProxy=function(t,e,r){var n=this.m_nodes[t];return!n.aabb.contains(e)&&(this.removeLeaf(n),n.aabb.set(e),e=n.aabb,bt.extend(e,W.aabbExtension),r.x<0?e.lowerBound.x+=r.x*W.aabbMultiplier:e.upperBound.x+=r.x*W.aabbMultiplier,r.y<0?e.lowerBound.y+=r.y*W.aabbMultiplier:e.upperBound.y+=r.y*W.aabbMultiplier,this.insertLeaf(n),!0)},s.prototype.insertLeaf=function(t){if(this.m_root==null)return this.m_root=t,void(this.m_root.parent=null);for(var e=t.aabb,r=this.m_root;!r.isLeaf();){var n=r.child1,m=r.child2,l=r.aabb.getPerimeter(),_=bt.combinedPerimeter(r.aabb,e),A=2*_,v=2*(_-l),d=bt.combinedPerimeter(e,n.aabb)+v;n.isLeaf()||(d-=n.aabb.getPerimeter());var y=bt.combinedPerimeter(e,m.aabb)+v;if(m.isLeaf()||(y-=m.aabb.getPerimeter()),A<d&&A<y)break;r=d<y?n:m}var b=r,x=b.parent,B=this.allocateNode();for(B.parent=x,B.userData=null,B.aabb.combine(e,b.aabb),B.height=b.height+1,x!=null?(x.child1===b?x.child1=B:x.child2=B,B.child1=b,B.child2=t,b.parent=B,t.parent=B):(B.child1=b,B.child2=t,b.parent=B,t.parent=B,this.m_root=B),r=t.parent;r!=null;)n=(r=this.balance(r)).child1,m=r.child2,r.height=1+Et(n.height,m.height),r.aabb.combine(n.aabb,m.aabb),r=r.parent},s.prototype.removeLeaf=function(t){if(t!==this.m_root){var e,r=t.parent,n=r.parent;if(e=r.child1===t?r.child2:r.child1,n!=null){n.child1===r?n.child1=e:n.child2=e,e.parent=n,this.freeNode(r);for(var m=n;m!=null;){var l=(m=this.balance(m)).child1,_=m.child2;m.aabb.combine(l.aabb,_.aabb),m.height=1+Et(l.height,_.height),m=m.parent}}else this.m_root=e,e.parent=null,this.freeNode(r)}else this.m_root=null},s.prototype.balance=function(t){var e=t;if(e.isLeaf()||e.height<2)return t;var r=e.child1,n=e.child2,m=n.height-r.height;if(m>1){var l=n.child1,_=n.child2;return n.child1=e,n.parent=e.parent,e.parent=n,n.parent!=null?n.parent.child1===t?n.parent.child1=n:n.parent.child2=n:this.m_root=n,l.height>_.height?(n.child2=l,e.child2=_,_.parent=e,e.aabb.combine(r.aabb,_.aabb),n.aabb.combine(e.aabb,l.aabb),e.height=1+Et(r.height,_.height),n.height=1+Et(e.height,l.height)):(n.child2=_,e.child2=l,l.parent=e,e.aabb.combine(r.aabb,l.aabb),n.aabb.combine(e.aabb,_.aabb),e.height=1+Et(r.height,l.height),n.height=1+Et(e.height,_.height)),n}if(m<-1){var A=r.child1,v=r.child2;return r.child1=e,r.parent=e.parent,e.parent=r,r.parent!=null?r.parent.child1===e?r.parent.child1=r:r.parent.child2=r:this.m_root=r,A.height>v.height?(r.child2=A,e.child1=v,v.parent=e,e.aabb.combine(n.aabb,v.aabb),r.aabb.combine(e.aabb,A.aabb),e.height=1+Et(n.height,v.height),r.height=1+Et(e.height,A.height)):(r.child2=v,e.child1=A,A.parent=e,e.aabb.combine(n.aabb,A.aabb),r.aabb.combine(e.aabb,v.aabb),e.height=1+Et(n.height,A.height),r.height=1+Et(e.height,v.height)),r}return e},s.prototype.getHeight=function(){return this.m_root==null?0:this.m_root.height},s.prototype.getAreaRatio=function(){if(this.m_root==null)return 0;for(var t,e=this.m_root.aabb.getPerimeter(),r=0,n=this.iteratorPool.allocate().preorder(this.m_root);t=n.next();)t.height<0||(r+=t.aabb.getPerimeter());return this.iteratorPool.release(n),r/e},s.prototype.computeHeight=function(t){var e;if((e=t!==void 0?this.m_nodes[t]:this.m_root).isLeaf())return 0;var r=this.computeHeight(e.child1.id),n=this.computeHeight(e.child2.id);return 1+Et(r,n)},s.prototype.validateStructure=function(t){if(t!=null){this.m_root;var e=t.child1,r=t.child2;t.isLeaf()||(this.validateStructure(e),this.validateStructure(r))}},s.prototype.validateMetrics=function(t){if(t!=null){var e=t.child1,r=t.child2;t.isLeaf()||(e.height,r.height,new bt().combine(e.aabb,r.aabb),this.validateMetrics(e),this.validateMetrics(r))}},s.prototype.validate=function(){},s.prototype.getMaxBalance=function(){for(var t,e=0,r=this.iteratorPool.allocate().preorder(this.m_root);t=r.next();)if(!(t.height<=1)){var n=as(t.child2.height-t.child1.height);e=Et(e,n)}return this.iteratorPool.release(r),e},s.prototype.rebuildBottomUp=function(){for(var t,e=[],r=0,n=this.iteratorPool.allocate().preorder(this.m_root);t=n.next();)t.height<0||(t.isLeaf()?(t.parent=null,e[r]=t,++r):this.freeNode(t));for(this.iteratorPool.release(n);r>1;){for(var m=1/0,l=-1,_=-1,A=0;A<r;++A)for(var v=e[A].aabb,d=A+1;d<r;++d){var y=e[d].aabb,b=bt.combinedPerimeter(v,y);b<m&&(l=A,_=d,m=b)}var x=e[l],B=e[_],w=this.allocateNode();w.child1=x,w.child2=B,w.height=1+Et(x.height,B.height),w.aabb.combine(x.aabb,B.aabb),w.parent=null,x.parent=w,B.parent=w,e[_]=e[r-1],e[l]=w,--r}this.m_root=e[0]},s.prototype.shiftOrigin=function(t){for(var e,r=this.iteratorPool.allocate().preorder(this.m_root);e=r.next();){var n=e.aabb;n.lowerBound.x-=t.x,n.lowerBound.y-=t.y,n.upperBound.x-=t.x,n.upperBound.y-=t.y}this.iteratorPool.release(r)},s.prototype.query=function(t,e){var r=this.stackPool.allocate();for(r.push(this.m_root);r.length>0;){var n=r.pop();if(n!=null&&bt.testOverlap(n.aabb,t))if(n.isLeaf()){if(e(n.id)===!1)return}else r.push(n.child1),r.push(n.child2)}this.stackPool.release(r)},s.prototype.rayCast=function(t,e){var r=t.p1,n=t.p2,m=c.sub(n,r);m.normalize();var l=c.crossNumVec2(1,m),_=c.abs(l),A=t.maxFraction,v=new bt,d=c.combine(1-A,r,A,n);v.combinePoints(r,d);var y=this.stackPool.allocate(),b=this.inputPool.allocate();for(y.push(this.m_root);y.length>0;){var x=y.pop();if(x!=null&&bt.testOverlap(x.aabb,v)!==!1){var B=x.aabb.getCenter(),w=x.aabb.getExtents();if(!(as(c.dot(l,c.sub(r,B)))-c.dot(_,w)>0))if(x.isLeaf()){b.p1=c.clone(t.p1),b.p2=c.clone(t.p2),b.maxFraction=A;var M=e(b,x.id);if(M===0)break;M>0&&(A=M,d=c.combine(1-A,r,A,n),v.combinePoints(r,d))}else y.push(x.child1),y.push(x.child2)}}this.stackPool.release(y),this.inputPool.release(b)},s}(),lo=function(){function s(){this.parents=[],this.states=[]}return s.prototype.preorder=function(t){return this.parents.length=0,this.parents.push(t),this.states.length=0,this.states.push(0),this},s.prototype.next=function(){for(;this.parents.length>0;){var t=this.parents.length-1,e=this.parents[t];if(this.states[t]===0)return this.states[t]=1,e;if(this.states[t]===1&&(this.states[t]=2,e.child1))return this.parents.push(e.child1),this.states.push(1),e.child1;if(this.states[t]===2&&(this.states[t]=3,e.child2))return this.parents.push(e.child2),this.states.push(1),e.child2;this.parents.pop(),this.states.pop()}},s.prototype.close=function(){this.parents.length=0},s}(),mo=Math.max,co=Math.min,uo=function(){function s(){var t=this;this.m_tree=new Ai,this.m_moveBuffer=[],this.query=function(e,r){t.m_tree.query(e,r)},this.queryCallback=function(e){if(e===t.m_queryProxyId)return!0;var r=co(e,t.m_queryProxyId),n=mo(e,t.m_queryProxyId),m=t.m_tree.getUserData(r),l=t.m_tree.getUserData(n);return t.m_callback(m,l),!0}}return s.prototype.getUserData=function(t){return this.m_tree.getUserData(t)},s.prototype.testOverlap=function(t,e){var r=this.m_tree.getFatAABB(t),n=this.m_tree.getFatAABB(e);return bt.testOverlap(r,n)},s.prototype.getFatAABB=function(t){return this.m_tree.getFatAABB(t)},s.prototype.getProxyCount=function(){return this.m_moveBuffer.length},s.prototype.getTreeHeight=function(){return this.m_tree.getHeight()},s.prototype.getTreeBalance=function(){return this.m_tree.getMaxBalance()},s.prototype.getTreeQuality=function(){return this.m_tree.getAreaRatio()},s.prototype.rayCast=function(t,e){this.m_tree.rayCast(t,e)},s.prototype.shiftOrigin=function(t){this.m_tree.shiftOrigin(t)},s.prototype.createProxy=function(t,e){var r=this.m_tree.createProxy(t,e);return this.bufferMove(r),r},s.prototype.destroyProxy=function(t){this.unbufferMove(t),this.m_tree.destroyProxy(t)},s.prototype.moveProxy=function(t,e,r){this.m_tree.moveProxy(t,e,r)&&this.bufferMove(t)},s.prototype.touchProxy=function(t){this.bufferMove(t)},s.prototype.bufferMove=function(t){this.m_moveBuffer.push(t)},s.prototype.unbufferMove=function(t){for(var e=0;e<this.m_moveBuffer.length;++e)this.m_moveBuffer[e]===t&&(this.m_moveBuffer[e]=null)},s.prototype.updatePairs=function(t){for(this.m_callback=t;this.m_moveBuffer.length>0;)if(this.m_queryProxyId=this.m_moveBuffer.pop(),this.m_queryProxyId!==null){var e=this.m_tree.getFatAABB(this.m_queryProxyId);this.m_tree.query(e,this.queryCallback)}},s}(),hs=Math.sin,Wi=Math.cos,Ji=Math.sqrt;function P(s,t){return{x:s,y:t}}function i(s,t,e){return s.x=t,s.y=e,s}function o(s,t){return s.x=t.x,s.y=t.y,s}function h(s){return s.x=0,s.y=0,s}function u(s){return s.x=-s.x,s.y=-s.y,s}function p(s,t){return s.x+=t.x,s.y+=t.y,s}function f(s,t){return s.x-=t.x,s.y-=t.y,s}function g(s,t,e){return s.x=t.x-e.x,s.y=t.y-e.y,s}function I(s,t){return s.x*=t,s.y*=t,s}function C(s,t,e){return s.x=t*e.x,s.y=t*e.y,s}function T(s,t,e){return s.x+=t*e.x,s.y+=t*e.y,s}function q(s,t,e){return s.x-=t*e.x,s.y-=t*e.y,s}function E(s,t,e,r,n){return s.x=t*e.x+r*n.x,s.y=t*e.y+r*n.y,s}function H(s,t,e,r,n,m,l){return s.x=t*e.x+r*n.x+m*l.x,s.y=t*e.y+r*n.y+m*l.y,s}function F(s){var t=Ji(s.x*s.x+s.y*s.y);if(t>0){var e=1/t;s.x*=e,s.y*=e}return s}function U(s,t,e){var r=e*t.y,n=-e*t.x;return s.x=r,s.y=n,s}function $(s,t,e){var r=-t*e.y,n=t*e.x;return s.x=r,s.y=n,s}function G(s,t){return s.x*t.y-s.y*t.x}function j(s,t){return s.x*t.x+s.y*t.y}function tt(s){return s.x*s.x+s.y*s.y}function Vt(s,t){var e=s.x-t.x,r=s.y-t.y;return Ji(e*e+r*r)}function At(s,t){var e=s.x-t.x,r=s.y-t.y;return e*e+r*r}function St(s,t,e){return s.x=t.c*e.x-t.s*e.y,s.y=t.s*e.x+t.c*e.y,s}function Lt(s,t,e){var r=t.c*e.x+t.s*e.y,n=-t.s*e.x+t.c*e.y;return s.x=r,s.y=n,s}function _t(s,t,e){return{p:P(s,t),q:(r=e,{s:hs(r),c:Wi(r)})};var r}function te(s,t){return s.p.x=t.p.x,s.p.y=t.p.y,s.q.s=t.q.s,s.q.c=t.q.c,s}function K(s,t,e){var r=t.q.c*e.x-t.q.s*e.y+t.p.x,n=t.q.s*e.x+t.q.c*e.y+t.p.y;return s.x=r,s.y=n,s}function ii(s,t,e){var r=e.x-t.p.x,n=e.y-t.p.y,m=t.q.c*r+t.q.s*n,l=-t.q.s*r+t.q.c*n;return s.x=m,s.y=l,s}function Do(s,t,e,r){var n=t.q.c*r.x-t.q.s*r.y+t.p.x,m=t.q.s*r.x+t.q.c*r.y+t.p.y,l=n-e.p.x,_=m-e.p.y,A=e.q.c*l+e.q.s*_,v=-e.q.s*l+e.q.c*_;return s.x=A,s.y=v,s}function No(s,t,e){var r=t.q.c*e.q.c+t.q.s*e.q.s,n=t.q.c*e.q.s-t.q.s*e.q.c,m=t.q.c*(e.p.x-t.p.x)+t.q.s*(e.p.y-t.p.y),l=-t.q.s*(e.p.x-t.p.x)+t.q.c*(e.p.y-t.p.y);return s.q.c=r,s.q.s=n,s.p.x=m,s.p.y=l,s}var Ro=Math.sin,Eo=Math.cos,Er=Math.atan2,L=function(){function s(t){if(!(this instanceof s))return new s(t);typeof t=="number"?this.setAngle(t):typeof t=="object"?this.setRot(t):this.setIdentity()}return s.neo=function(t){var e=Object.create(s.prototype);return e.setAngle(t),e},s.clone=function(t){var e=Object.create(s.prototype);return e.s=t.s,e.c=t.c,e},s.identity=function(){var t=Object.create(s.prototype);return t.s=0,t.c=1,t},s.isValid=function(t){return t!=null&&Number.isFinite(t.s)&&Number.isFinite(t.c)},s.assert=function(t){},s.prototype.setIdentity=function(){this.s=0,this.c=1},s.prototype.set=function(t){typeof t=="object"?(this.s=t.s,this.c=t.c):(this.s=Ro(t),this.c=Eo(t))},s.prototype.setRot=function(t){this.s=t.s,this.c=t.c},s.prototype.setAngle=function(t){this.s=Ro(t),this.c=Eo(t)},s.prototype.getAngle=function(){return Er(this.s,this.c)},s.prototype.getXAxis=function(){return c.neo(this.c,this.s)},s.prototype.getYAxis=function(){return c.neo(-this.s,this.c)},s.mul=function(t,e){if("c"in e&&"s"in e){var r=s.identity();return r.s=t.s*e.c+t.c*e.s,r.c=t.c*e.c-t.s*e.s,r}if("x"in e&&"y"in e)return c.neo(t.c*e.x-t.s*e.y,t.s*e.x+t.c*e.y)},s.mulRot=function(t,e){var r=s.identity();return r.s=t.s*e.c+t.c*e.s,r.c=t.c*e.c-t.s*e.s,r},s.mulVec2=function(t,e){return c.neo(t.c*e.x-t.s*e.y,t.s*e.x+t.c*e.y)},s.mulSub=function(t,e,r){var n=t.c*(e.x-r.x)-t.s*(e.y-r.y),m=t.s*(e.x-r.x)+t.c*(e.y-r.y);return c.neo(n,m)},s.mulT=function(t,e){if("c"in e&&"s"in e){var r=s.identity();return r.s=t.c*e.s-t.s*e.c,r.c=t.c*e.c+t.s*e.s,r}if("x"in e&&"y"in e)return c.neo(t.c*e.x+t.s*e.y,-t.s*e.x+t.c*e.y)},s.mulTRot=function(t,e){var r=s.identity();return r.s=t.c*e.s-t.s*e.c,r.c=t.c*e.c+t.s*e.s,r},s.mulTVec2=function(t,e){return c.neo(t.c*e.x+t.s*e.y,-t.s*e.x+t.c*e.y)},s}(),Wr=Math.atan2,Wo=Math.PI,si=P(0,0),Fe=function(){function s(){this.localCenter=c.zero(),this.c=c.zero(),this.a=0,this.alpha0=0,this.c0=c.zero(),this.a0=0}return s.prototype.recycle=function(){h(this.localCenter),h(this.c),this.a=0,this.alpha0=0,h(this.c0),this.a0=0},s.prototype.setTransform=function(t){K(si,t,this.localCenter),o(this.c,si),o(this.c0,si),this.a=this.a0=Wr(t.q.s,t.q.c)},s.prototype.setLocalCenter=function(t,e){o(this.localCenter,t),K(si,e,this.localCenter),o(this.c,si),o(this.c0,si)},s.prototype.getTransform=function(t,e){e===void 0&&(e=0),function(r,n){r.c=Wi(n),r.s=hs(n)}(t.q,(1-e)*this.a0+e*this.a),E(t.p,1-e,this.c0,e,this.c),f(t.p,St(si,t.q,this.localCenter))},s.prototype.advance=function(t){var e=(t-this.alpha0)/(1-this.alpha0);E(this.c0,e,this.c,1-e,this.c0),this.a0=e*this.a+(1-e)*this.a0,this.alpha0=t},s.prototype.forward=function(){this.a0=this.a,o(this.c0,this.c)},s.prototype.normalize=function(){var t=Mt(this.a0,-Wo,+Wo);this.a-=this.a0-t,this.a0=t},s.prototype.set=function(t){o(this.localCenter,t.localCenter),o(this.c,t.c),this.a=t.a,this.alpha0=t.alpha0,o(this.c0,t.c0),this.a0=t.a0},s}(),Nt=function(){function s(t,e){if(!(this instanceof s))return new s(t,e);this.p=c.zero(),this.q=L.identity(),t!==void 0&&this.p.setVec2(t),e!==void 0&&this.q.setAngle(e)}return s.clone=function(t){var e=Object.create(s.prototype);return e.p=c.clone(t.p),e.q=L.clone(t.q),e},s.neo=function(t,e){var r=Object.create(s.prototype);return r.p=c.clone(t),r.q=L.clone(e),r},s.identity=function(){var t=Object.create(s.prototype);return t.p=c.zero(),t.q=L.identity(),t},s.prototype.setIdentity=function(){this.p.setZero(),this.q.setIdentity()},s.prototype.set=function(t,e){e===void 0?(this.p.set(t.p),this.q.set(t.q)):(this.p.set(t),this.q.set(e))},s.prototype.setNum=function(t,e){this.p.setVec2(t),this.q.setAngle(e)},s.prototype.setTransform=function(t){this.p.setVec2(t.p),this.q.setRot(t.q)},s.isValid=function(t){return t!=null&&c.isValid(t.p)&&L.isValid(t.q)},s.assert=function(t){},s.mul=function(t,e){if(Array.isArray(e)){for(var r=[],n=0;n<e.length;n++)r[n]=s.mul(t,e[n]);return r}return"x"in e&&"y"in e?s.mulVec2(t,e):"p"in e&&"q"in e?s.mulXf(t,e):void 0},s.mulAll=function(t,e){for(var r=[],n=0;n<e.length;n++)r[n]=s.mul(t,e[n]);return r},s.mulFn=function(t){return function(e){return s.mul(t,e)}},s.mulVec2=function(t,e){var r=t.q.c*e.x-t.q.s*e.y+t.p.x,n=t.q.s*e.x+t.q.c*e.y+t.p.y;return c.neo(r,n)},s.mulXf=function(t,e){var r=s.identity();return r.q=L.mulRot(t.q,e.q),r.p=c.add(L.mulVec2(t.q,e.p),t.p),r},s.mulT=function(t,e){return"x"in e&&"y"in e?s.mulTVec2(t,e):"p"in e&&"q"in e?s.mulTXf(t,e):void 0},s.mulTVec2=function(t,e){var r=e.x-t.p.x,n=e.y-t.p.y,m=t.q.c*r+t.q.s*n,l=-t.q.s*r+t.q.c*n;return c.neo(m,l)},s.mulTXf=function(t,e){var r=s.identity();return r.q.setRot(L.mulTRot(t.q,e.q)),r.p.setVec2(L.mulTVec2(t.q,c.sub(e.p,t.p))),r},s}(),Jr=function(){this.v=c.zero(),this.w=0},Jo=Math.sin,Yo=Math.cos,Yr=function(){function s(){this.c=c.zero(),this.a=0}return s.prototype.getTransform=function(t,e){return t.q.c=Yo(this.a),t.q.s=Jo(this.a),t.p.x=this.c.x-(t.q.c*e.x-t.q.s*e.y),t.p.y=this.c.y-(t.q.s*e.x+t.q.c*e.y),t},s}();function ls(s,t,e,r){return s.q.c=Yo(r),s.q.s=Jo(r),s.p.x=e.x-(s.q.c*t.x-s.q.s*t.y),s.p.y=e.y-(s.q.s*t.x+s.q.c*t.y),s}var Le=function(){function s(){this.style={},this.appData={}}return s.isValid=function(t){return t!=null&&typeof t.m_type=="string"&&typeof t.m_radius=="number"},s}(),Go=new bt,Uo=new bt,Ho=P(0,0),Gr={userData:null,friction:.2,restitution:0,density:0,isSensor:!1,filterGroupIndex:0,filterCategoryBits:1,filterMaskBits:65535},cs=function(s,t){this.aabb=new bt,this.fixture=s,this.childIndex=t,this.proxyId},wi=function(){function s(t,e,r){this.style={},this.appData={},e.shape?(r=e,e=e.shape):typeof r=="number"&&(r={density:r}),r=xt(r,Gr),this.m_body=t,this.m_friction=r.friction,this.m_restitution=r.restitution,this.m_density=r.density,this.m_isSensor=r.isSensor,this.m_filterGroupIndex=r.filterGroupIndex,this.m_filterCategoryBits=r.filterCategoryBits,this.m_filterMaskBits=r.filterMaskBits,this.m_shape=e,this.m_next=null,this.m_proxies=[],this.m_proxyCount=0;for(var n=this.m_shape.getChildCount(),m=0;m<n;++m)this.m_proxies[m]=new cs(this,m);this.m_userData=r.userData}return s.prototype._reset=function(){var t=this.getBody(),e=t.m_world.m_broadPhase;this.destroyProxies(e),this.m_shape._reset&&this.m_shape._reset();for(var r=this.m_shape.getChildCount(),n=0;n<r;++n)this.m_proxies[n]=new cs(this,n);this.createProxies(e,t.m_xf),t.resetMassData()},s.prototype._serialize=function(){return{friction:this.m_friction,restitution:this.m_restitution,density:this.m_density,isSensor:this.m_isSensor,filterGroupIndex:this.m_filterGroupIndex,filterCategoryBits:this.m_filterCategoryBits,filterMaskBits:this.m_filterMaskBits,shape:this.m_shape}},s._deserialize=function(t,e,r){var n=r(Le,t.shape);return n&&new s(e,n,t)},s.prototype.getType=function(){return this.m_shape.m_type},s.prototype.getShape=function(){return this.m_shape},s.prototype.isSensor=function(){return this.m_isSensor},s.prototype.setSensor=function(t){t!=this.m_isSensor&&(this.m_body.setAwake(!0),this.m_isSensor=t)},s.prototype.getUserData=function(){return this.m_userData},s.prototype.setUserData=function(t){this.m_userData=t},s.prototype.getBody=function(){return this.m_body},s.prototype.getNext=function(){return this.m_next},s.prototype.getDensity=function(){return this.m_density},s.prototype.setDensity=function(t){this.m_density=t},s.prototype.getFriction=function(){return this.m_friction},s.prototype.setFriction=function(t){this.m_friction=t},s.prototype.getRestitution=function(){return this.m_restitution},s.prototype.setRestitution=function(t){this.m_restitution=t},s.prototype.testPoint=function(t){return this.m_shape.testPoint(this.m_body.getTransform(),t)},s.prototype.rayCast=function(t,e,r){return this.m_shape.rayCast(t,e,this.m_body.getTransform(),r)},s.prototype.getMassData=function(t){this.m_shape.computeMass(t,this.m_density)},s.prototype.getAABB=function(t){return this.m_proxies[t].aabb},s.prototype.createProxies=function(t,e){this.m_proxyCount=this.m_shape.getChildCount();for(var r=0;r<this.m_proxyCount;++r){var n=this.m_proxies[r];this.m_shape.computeAABB(n.aabb,e,r),n.proxyId=t.createProxy(n.aabb,n)}},s.prototype.destroyProxies=function(t){for(var e=0;e<this.m_proxyCount;++e){var r=this.m_proxies[e];t.destroyProxy(r.proxyId),r.proxyId=null}this.m_proxyCount=0},s.prototype.synchronize=function(t,e,r){for(var n=0;n<this.m_proxyCount;++n){var m=this.m_proxies[n];this.m_shape.computeAABB(Go,e,m.childIndex),this.m_shape.computeAABB(Uo,r,m.childIndex),m.aabb.combine(Go,Uo),g(Ho,r.p,e.p),t.moveProxy(m.proxyId,m.aabb,Ho)}},s.prototype.setFilterData=function(t){this.m_filterGroupIndex=t.groupIndex,this.m_filterCategoryBits=t.categoryBits,this.m_filterMaskBits=t.maskBits,this.refilter()},s.prototype.getFilterGroupIndex=function(){return this.m_filterGroupIndex},s.prototype.setFilterGroupIndex=function(t){this.m_filterGroupIndex=t,this.refilter()},s.prototype.getFilterCategoryBits=function(){return this.m_filterCategoryBits},s.prototype.setFilterCategoryBits=function(t){this.m_filterCategoryBits=t,this.refilter()},s.prototype.getFilterMaskBits=function(){return this.m_filterMaskBits},s.prototype.setFilterMaskBits=function(t){this.m_filterMaskBits=t,this.refilter()},s.prototype.refilter=function(){if(this.m_body!=null){for(var t=this.m_body.getContactList();t;){var e=t.contact,r=e.getFixtureA(),n=e.getFixtureB();r!=this&&n!=this||e.flagForFiltering(),t=t.next}var m=this.m_body.getWorld();if(m!=null)for(var l=m.m_broadPhase,_=0;_<this.m_proxyCount;++_)l.touchProxy(this.m_proxies[_].proxyId)}},s.prototype.shouldCollide=function(t){if(t.m_filterGroupIndex===this.m_filterGroupIndex&&t.m_filterGroupIndex!==0)return t.m_filterGroupIndex>0;var e=(t.m_filterMaskBits&this.m_filterCategoryBits)!=0,r=(t.m_filterCategoryBits&this.m_filterMaskBits)!=0;return e&&r},s}(),Bi="static",Ko="kinematic",_e="dynamic",us=P(0,0),oi=P(0,0),_s=P(0,0),ps=P(0,0),Xo=_t(0,0,0),Ur={type:Bi,position:c.zero(),angle:0,linearVelocity:c.zero(),angularVelocity:0,linearDamping:0,angularDamping:0,fixedRotation:!1,bullet:!1,gravityScale:1,allowSleep:!0,awake:!0,active:!0,userData:null},ht=function(){function s(t,e){this.style={},this.appData={},e=xt(e,Ur),this.m_world=t,this.m_awakeFlag=e.awake,this.m_autoSleepFlag=e.allowSleep,this.m_bulletFlag=e.bullet,this.m_fixedRotationFlag=e.fixedRotation,this.m_activeFlag=e.active,this.m_islandFlag=!1,this.m_toiFlag=!1,this.m_userData=e.userData,this.m_type=e.type,this.m_type==_e?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_xf=Nt.identity(),this.m_xf.p.setVec2(e.position),this.m_xf.q.setAngle(e.angle),this.m_sweep=new Fe,this.m_sweep.setTransform(this.m_xf),this.c_velocity=new Jr,this.c_position=new Yr,this.m_force=c.zero(),this.m_torque=0,this.m_linearVelocity=c.clone(e.linearVelocity),this.m_angularVelocity=e.angularVelocity,this.m_linearDamping=e.linearDamping,this.m_angularDamping=e.angularDamping,this.m_gravityScale=e.gravityScale,this.m_sleepTime=0,this.m_jointList=null,this.m_contactList=null,this.m_fixtureList=null,this.m_prev=null,this.m_next=null,this.m_destroyed=!1}return s.prototype._serialize=function(){for(var t=[],e=this.m_fixtureList;e;e=e.m_next)t.push(e);return{type:this.m_type,bullet:this.m_bulletFlag,position:this.m_xf.p,angle:this.m_xf.q.getAngle(),linearVelocity:this.m_linearVelocity,angularVelocity:this.m_angularVelocity,fixtures:t}},s._deserialize=function(t,e,r){var n=new s(e,t);if(t.fixtures)for(var m=t.fixtures.length-1;m>=0;m--){var l=r(wi,t.fixtures[m],n);n._addFixture(l)}return n},s.prototype.isWorldLocked=function(){return!(!this.m_world||!this.m_world.isLocked())},s.prototype.getWorld=function(){return this.m_world},s.prototype.getNext=function(){return this.m_next},s.prototype.setUserData=function(t){this.m_userData=t},s.prototype.getUserData=function(){return this.m_userData},s.prototype.getFixtureList=function(){return this.m_fixtureList},s.prototype.getJointList=function(){return this.m_jointList},s.prototype.getContactList=function(){return this.m_contactList},s.prototype.isStatic=function(){return this.m_type==Bi},s.prototype.isDynamic=function(){return this.m_type==_e},s.prototype.isKinematic=function(){return this.m_type==Ko},s.prototype.setStatic=function(){return this.setType(Bi),this},s.prototype.setDynamic=function(){return this.setType(_e),this},s.prototype.setKinematic=function(){return this.setType(Ko),this},s.prototype.getType=function(){return this.m_type},s.prototype.setType=function(t){if(this.isWorldLocked()!=1&&this.m_type!=t){this.m_type=t,this.resetMassData(),this.m_type==Bi&&(this.m_linearVelocity.setZero(),this.m_angularVelocity=0,this.m_sweep.forward(),this.synchronizeFixtures()),this.setAwake(!0),this.m_force.setZero(),this.m_torque=0;for(var e=this.m_contactList;e;){var r=e;e=e.next,this.m_world.destroyContact(r.contact)}this.m_contactList=null;for(var n=this.m_world.m_broadPhase,m=this.m_fixtureList;m;m=m.m_next)for(var l=0;l<m.m_proxyCount;++l)n.touchProxy(m.m_proxies[l].proxyId)}},s.prototype.isBullet=function(){return this.m_bulletFlag},s.prototype.setBullet=function(t){this.m_bulletFlag=!!t},s.prototype.isSleepingAllowed=function(){return this.m_autoSleepFlag},s.prototype.setSleepingAllowed=function(t){this.m_autoSleepFlag=!!t,this.m_autoSleepFlag==0&&this.setAwake(!0)},s.prototype.isAwake=function(){return this.m_awakeFlag},s.prototype.setAwake=function(t){t?(this.m_awakeFlag=!0,this.m_sleepTime=0):(this.m_awakeFlag=!1,this.m_sleepTime=0,this.m_linearVelocity.setZero(),this.m_angularVelocity=0,this.m_force.setZero(),this.m_torque=0)},s.prototype.isActive=function(){return this.m_activeFlag},s.prototype.setActive=function(t){if(t!=this.m_activeFlag)if(this.m_activeFlag=!!t,this.m_activeFlag){for(var e=this.m_world.m_broadPhase,r=this.m_fixtureList;r;r=r.m_next)r.createProxies(e,this.m_xf);this.m_world.m_newFixture=!0}else{for(e=this.m_world.m_broadPhase,r=this.m_fixtureList;r;r=r.m_next)r.destroyProxies(e);for(var n=this.m_contactList;n;){var m=n;n=n.next,this.m_world.destroyContact(m.contact)}this.m_contactList=null}},s.prototype.isFixedRotation=function(){return this.m_fixedRotationFlag},s.prototype.setFixedRotation=function(t){this.m_fixedRotationFlag!=t&&(this.m_fixedRotationFlag=!!t,this.m_angularVelocity=0,this.resetMassData())},s.prototype.getTransform=function(){return this.m_xf},s.prototype.setTransform=function(t,e){if(this.isWorldLocked()!=1){this.m_xf.setNum(t,e),this.m_sweep.setTransform(this.m_xf);for(var r=this.m_world.m_broadPhase,n=this.m_fixtureList;n;n=n.m_next)n.synchronize(r,this.m_xf,this.m_xf);this.setAwake(!0)}},s.prototype.synchronizeTransform=function(){this.m_sweep.getTransform(this.m_xf,1)},s.prototype.synchronizeFixtures=function(){this.m_sweep.getTransform(Xo,0);for(var t=this.m_world.m_broadPhase,e=this.m_fixtureList;e;e=e.m_next)e.synchronize(t,Xo,this.m_xf)},s.prototype.advance=function(t){this.m_sweep.advance(t),o(this.m_sweep.c,this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.m_sweep.getTransform(this.m_xf,1)},s.prototype.getPosition=function(){return this.m_xf.p},s.prototype.setPosition=function(t){this.setTransform(t,this.m_sweep.a)},s.prototype.getAngle=function(){return this.m_sweep.a},s.prototype.setAngle=function(t){this.setTransform(this.m_xf.p,t)},s.prototype.getWorldCenter=function(){return this.m_sweep.c},s.prototype.getLocalCenter=function(){return this.m_sweep.localCenter},s.prototype.getLinearVelocity=function(){return this.m_linearVelocity},s.prototype.getLinearVelocityFromWorldPoint=function(t){var e=c.sub(t,this.m_sweep.c);return c.add(this.m_linearVelocity,c.crossNumVec2(this.m_angularVelocity,e))},s.prototype.getLinearVelocityFromLocalPoint=function(t){return this.getLinearVelocityFromWorldPoint(this.getWorldPoint(t))},s.prototype.setLinearVelocity=function(t){this.m_type!=Bi&&(c.dot(t,t)>0&&this.setAwake(!0),this.m_linearVelocity.setVec2(t))},s.prototype.getAngularVelocity=function(){return this.m_angularVelocity},s.prototype.setAngularVelocity=function(t){this.m_type!=Bi&&(t*t>0&&this.setAwake(!0),this.m_angularVelocity=t)},s.prototype.getLinearDamping=function(){return this.m_linearDamping},s.prototype.setLinearDamping=function(t){this.m_linearDamping=t},s.prototype.getAngularDamping=function(){return this.m_angularDamping},s.prototype.setAngularDamping=function(t){this.m_angularDamping=t},s.prototype.getGravityScale=function(){return this.m_gravityScale},s.prototype.setGravityScale=function(t){this.m_gravityScale=t},s.prototype.getMass=function(){return this.m_mass},s.prototype.getInertia=function(){return this.m_I+this.m_mass*c.dot(this.m_sweep.localCenter,this.m_sweep.localCenter)},s.prototype.getMassData=function(t){t.mass=this.m_mass,t.I=this.getInertia(),o(t.center,this.m_sweep.localCenter)},s.prototype.resetMassData=function(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,h(this.m_sweep.localCenter),this.isStatic()||this.isKinematic())return o(this.m_sweep.c0,this.m_xf.p),o(this.m_sweep.c,this.m_xf.p),void(this.m_sweep.a0=this.m_sweep.a);h(oi);for(var t=this.m_fixtureList;t;t=t.m_next)if(t.m_density!=0){var e={mass:0,center:P(0,0),I:0};t.getMassData(e),this.m_mass+=e.mass,T(oi,e.mass,e.center),this.m_I+=e.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,C(oi,this.m_invMass,oi)):(this.m_mass=1,this.m_invMass=1),this.m_I>0&&this.m_fixedRotationFlag==0?(this.m_I-=this.m_mass*j(oi,oi),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0),o(us,this.m_sweep.c),this.m_sweep.setLocalCenter(oi,this.m_xf),g(_s,this.m_sweep.c,us),$(ps,this.m_angularVelocity,_s),p(this.m_linearVelocity,ps)},s.prototype.setMassData=function(t){this.isWorldLocked()!=1&&this.m_type==_e&&(this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=t.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,t.I>0&&this.m_fixedRotationFlag==0&&(this.m_I=t.I-this.m_mass*j(t.center,t.center),this.m_invI=1/this.m_I),o(us,this.m_sweep.c),this.m_sweep.setLocalCenter(t.center,this.m_xf),g(_s,this.m_sweep.c,us),$(ps,this.m_angularVelocity,_s),p(this.m_linearVelocity,ps))},s.prototype.applyForce=function(t,e,r){r===void 0&&(r=!0),this.m_type==_e&&(r&&this.m_awakeFlag==0&&this.setAwake(!0),this.m_awakeFlag&&(this.m_force.add(t),this.m_torque+=c.crossVec2Vec2(c.sub(e,this.m_sweep.c),t)))},s.prototype.applyForceToCenter=function(t,e){e===void 0&&(e=!0),this.m_type==_e&&(e&&this.m_awakeFlag==0&&this.setAwake(!0),this.m_awakeFlag&&this.m_force.add(t))},s.prototype.applyTorque=function(t,e){e===void 0&&(e=!0),this.m_type==_e&&(e&&this.m_awakeFlag==0&&this.setAwake(!0),this.m_awakeFlag&&(this.m_torque+=t))},s.prototype.applyLinearImpulse=function(t,e,r){r===void 0&&(r=!0),this.m_type==_e&&(r&&this.m_awakeFlag==0&&this.setAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.addMul(this.m_invMass,t),this.m_angularVelocity+=this.m_invI*c.crossVec2Vec2(c.sub(e,this.m_sweep.c),t)))},s.prototype.applyAngularImpulse=function(t,e){e===void 0&&(e=!0),this.m_type==_e&&(e&&this.m_awakeFlag==0&&this.setAwake(!0),this.m_awakeFlag&&(this.m_angularVelocity+=this.m_invI*t))},s.prototype.shouldCollide=function(t){if(this.m_type!=_e&&t.m_type!=_e)return!1;for(var e=this.m_jointList;e;e=e.next)if(e.other==t&&e.joint.m_collideConnected==0)return!1;return!0},s.prototype._addFixture=function(t){if(this.isWorldLocked()==1)return null;if(this.m_activeFlag){var e=this.m_world.m_broadPhase;t.createProxies(e,this.m_xf)}return t.m_next=this.m_fixtureList,this.m_fixtureList=t,t.m_density>0&&this.resetMassData(),this.m_world.m_newFixture=!0,t},s.prototype.createFixture=function(t,e){if(this.isWorldLocked()==1)return null;var r=new wi(this,t,e);return this._addFixture(r),r},s.prototype.destroyFixture=function(t){if(this.isWorldLocked()!=1){if(this.m_fixtureList===t)this.m_fixtureList=t.m_next;else for(var e=this.m_fixtureList;e!=null;){if(e.m_next===t){e.m_next=t.m_next;break}e=e.m_next}for(var r=this.m_contactList;r;){var n=r.contact;r=r.next;var m=n.getFixtureA(),l=n.getFixtureB();t!=m&&t!=l||this.m_world.destroyContact(n)}if(this.m_activeFlag){var _=this.m_world.m_broadPhase;t.destroyProxies(_)}t.m_body=null,t.m_next=null,this.m_world.publish("remove-fixture",t),this.resetMassData()}},s.prototype.getWorldPoint=function(t){return Nt.mulVec2(this.m_xf,t)},s.prototype.getWorldVector=function(t){return L.mulVec2(this.m_xf.q,t)},s.prototype.getLocalPoint=function(t){return Nt.mulTVec2(this.m_xf,t)},s.prototype.getLocalVector=function(t){return L.mulTVec2(this.m_xf.q,t)},s.STATIC="static",s.KINEMATIC="kinematic",s.DYNAMIC="dynamic",s}(),ds=function(){this.other=null,this.joint=null,this.prev=null,this.next=null},Ot=function(){function s(t,e,r){this.m_type="unknown-joint",this.m_prev=null,this.m_next=null,this.m_edgeA=new ds,this.m_edgeB=new ds,this.m_islandFlag=!1,this.style={},this.appData={},e="bodyA"in t?t.bodyA:e,r="bodyB"in t?t.bodyB:r,this.m_bodyA=e,this.m_bodyB=r,this.m_collideConnected=!!t.collideConnected,this.m_userData=t.userData}return s.prototype.isActive=function(){return this.m_bodyA.isActive()&&this.m_bodyB.isActive()},s.prototype.getType=function(){return this.m_type},s.prototype.getBodyA=function(){return this.m_bodyA},s.prototype.getBodyB=function(){return this.m_bodyB},s.prototype.getNext=function(){return this.m_next},s.prototype.getUserData=function(){return this.m_userData},s.prototype.setUserData=function(t){this.m_userData=t},s.prototype.getCollideConnected=function(){return this.m_collideConnected},s.prototype.shiftOrigin=function(t){},s.prototype._resetAnchors=function(t){return this._reset(t)},s}(),ft={gjkCalls:0,gjkIters:0,gjkMaxIters:0,toiTime:0,toiMaxTime:0,toiCalls:0,toiIters:0,toiMaxIters:0,toiRootIters:0,toiMaxRootIters:0,toString:function(s){s=typeof s=="string"?s:`
`;var t="";for(var e in this)typeof this[e]!="function"&&typeof this[e]!="object"&&(t+=e+": "+this[e]+s);return t}},Hr=function(){return Date.now()},Kr=function(s){return Date.now()-s},fs=Math.max,ys=P(0,0),gs=P(0,0),ee=P(0,0),vs=P(0,0),_o=P(0,0),Xr=P(0,0),Zr=P(0,0);ft.gjkCalls=0,ft.gjkIters=0,ft.gjkMaxIters=0;var Yi=function(){function s(){this.proxyA=new ke,this.proxyB=new ke,this.transformA=Nt.identity(),this.transformB=Nt.identity(),this.useRadii=!1}return s.prototype.recycle=function(){this.proxyA.recycle(),this.proxyB.recycle(),this.transformA.setIdentity(),this.transformB.setIdentity(),this.useRadii=!1},s}(),Gi=function(){function s(){this.pointA=P(0,0),this.pointB=P(0,0),this.distance=0,this.iterations=0}return s.prototype.recycle=function(){h(this.pointA),h(this.pointB),this.distance=0,this.iterations=0},s}(),Ui=function(){function s(){this.metric=0,this.indexA=[],this.indexB=[],this.count=0}return s.prototype.recycle=function(){this.metric=0,this.indexA.length=0,this.indexB.length=0,this.count=0},s}(),xe=function(s,t,e){++ft.gjkCalls;var r=e.proxyA,n=e.proxyB,m=e.transformA,l=e.transformB;pe.recycle(),pe.readCache(t,r,m,n,l);for(var _=pe.m_v,A=W.maxDistanceIterations,v=[],d=[],y=0,b=0;b<A;){y=pe.m_count;for(var x=0;x<y;++x)v[x]=_[x].indexA,d[x]=_[x].indexB;if(pe.solve(),pe.m_count===3)break;var B=pe.getSearchDirection();if(tt(B)<1e-18)break;var w=_[pe.m_count];w.indexA=r.getSupport(Lt(ys,m.q,C(ys,-1,B))),K(w.wA,m,r.getVertex(w.indexA)),w.indexB=n.getSupport(Lt(ys,l.q,B)),K(w.wB,l,n.getVertex(w.indexB)),g(w.w,w.wB,w.wA),++b,++ft.gjkIters;var M=!1;for(x=0;x<y;++x)if(w.indexA===v[x]&&w.indexB===d[x]){M=!0;break}if(M)break;++pe.m_count}if(ft.gjkMaxIters=fs(ft.gjkMaxIters,b),pe.getWitnessPoints(s.pointA,s.pointB),s.distance=Vt(s.pointA,s.pointB),s.iterations=b,pe.writeCache(t),e.useRadii){var V=r.m_radius,z=n.m_radius;if(s.distance>V+z&&s.distance>nt)s.distance-=V+z,g(gs,s.pointB,s.pointA),F(gs),T(s.pointA,V,gs),q(s.pointB,z,gs);else{var k=g(ys,s.pointA,s.pointB);o(s.pointA,k),o(s.pointB,k),s.distance=0}}},ke=function(){function s(){this.m_vertices=[],this.m_count=0,this.m_radius=0}return s.prototype.recycle=function(){this.m_vertices.length=0,this.m_count=0,this.m_radius=0},s.prototype.getVertexCount=function(){return this.m_count},s.prototype.getVertex=function(t){return this.m_vertices[t]},s.prototype.getSupport=function(t){for(var e=-1,r=-1/0,n=0;n<this.m_count;++n){var m=j(this.m_vertices[n],t);m>r&&(e=n,r=m)}return e},s.prototype.getSupportVertex=function(t){return this.m_vertices[this.getSupport(t)]},s.prototype.set=function(t,e){t.computeDistanceProxy(this,e)},s.prototype.setVertices=function(t,e,r){this.m_vertices=t,this.m_count=e,this.m_radius=r},s}(),po=function(){function s(){this.wA=P(0,0),this.indexA=0,this.wB=P(0,0),this.indexB=0,this.w=P(0,0),this.a=0}return s.prototype.recycle=function(){this.indexA=0,this.indexB=0,h(this.wA),h(this.wB),h(this.w),this.a=0},s.prototype.set=function(t){this.indexA=t.indexA,this.indexB=t.indexB,o(this.wA,t.wA),o(this.wB,t.wB),o(this.w,t.w),this.a=t.a},s}(),xs=P(0,0),bs=P(0,0),Zo=function(){function s(){this.m_v1=new po,this.m_v2=new po,this.m_v3=new po,this.m_v=[this.m_v1,this.m_v2,this.m_v3]}return s.prototype.recycle=function(){this.m_v1.recycle(),this.m_v2.recycle(),this.m_v3.recycle(),this.m_count=0},s.prototype.toString=function(){return this.m_count===3?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y,this.m_v2.a,this.m_v2.wA.x,this.m_v2.wA.y,this.m_v2.wB.x,this.m_v2.wB.y,this.m_v3.a,this.m_v3.wA.x,this.m_v3.wA.y,this.m_v3.wB.x,this.m_v3.wB.y].toString():this.m_count===2?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y,this.m_v2.a,this.m_v2.wA.x,this.m_v2.wA.y,this.m_v2.wB.x,this.m_v2.wB.y].toString():this.m_count===1?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y].toString():"+"+this.m_count},s.prototype.readCache=function(t,e,r,n,m){this.m_count=t.count;for(var l=0;l<this.m_count;++l){(y=this.m_v[l]).indexA=t.indexA[l],y.indexB=t.indexB[l];var _=e.getVertex(y.indexA),A=n.getVertex(y.indexB);K(y.wA,r,_),K(y.wB,m,A),g(y.w,y.wB,y.wA),y.a=0}if(this.m_count>1){var v=t.metric,d=this.getMetric();(d<.5*v||2*v<d||d<nt)&&(this.m_count=0)}if(this.m_count===0){var y;(y=this.m_v[0]).indexA=0,y.indexB=0,_=e.getVertex(0),A=n.getVertex(0),K(y.wA,r,_),K(y.wB,m,A),g(y.w,y.wB,y.wA),y.a=1,this.m_count=1}},s.prototype.writeCache=function(t){t.metric=this.getMetric(),t.count=this.m_count;for(var e=0;e<this.m_count;++e)t.indexA[e]=this.m_v[e].indexA,t.indexB[e]=this.m_v[e].indexB},s.prototype.getSearchDirection=function(){var t=this.m_v1,e=this.m_v2;switch(this.m_v3,this.m_count){case 1:return i(xs,-t.w.x,-t.w.y);case 2:return g(ee,e.w,t.w),-G(ee,t.w)>0?i(xs,-ee.y,ee.x):i(xs,ee.y,-ee.x);default:return h(xs)}},s.prototype.getClosestPoint=function(){var t=this.m_v1,e=this.m_v2;switch(this.m_v3,this.m_count){case 0:return h(bs);case 1:return o(bs,t.w);case 2:return E(bs,t.a,t.w,e.a,e.w);case 3:default:return h(bs)}},s.prototype.getWitnessPoints=function(t,e){var r=this.m_v1,n=this.m_v2,m=this.m_v3;switch(this.m_count){case 0:break;case 1:o(t,r.wA),o(e,r.wB);break;case 2:E(t,r.a,r.wA,n.a,n.wA),E(e,r.a,r.wB,n.a,n.wB);break;case 3:H(t,r.a,r.wA,n.a,n.wA,m.a,m.wA),o(e,t)}},s.prototype.getMetric=function(){switch(this.m_count){case 0:case 1:return 0;case 2:return Vt(this.m_v1.w,this.m_v2.w);case 3:return G(g(Xr,this.m_v2.w,this.m_v1.w),g(Zr,this.m_v3.w,this.m_v1.w));default:return 0}},s.prototype.solve=function(){switch(this.m_count){case 1:break;case 2:this.solve2();break;case 3:this.solve3()}},s.prototype.solve2=function(){var t=this.m_v1.w,e=this.m_v2.w;g(ee,e,t);var r=-j(t,ee);if(r<=0)return this.m_v1.a=1,void(this.m_count=1);var n=j(e,ee);if(n<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.set(this.m_v2);var m=1/(n+r);this.m_v1.a=n*m,this.m_v2.a=r*m,this.m_count=2},s.prototype.solve3=function(){var t=this.m_v1.w,e=this.m_v2.w,r=this.m_v3.w;g(ee,e,t);var n=j(t,ee),m=j(e,ee),l=-n;g(vs,r,t);var _=j(t,vs),A=j(r,vs),v=-_;g(_o,r,e);var d=j(e,_o),y=j(r,_o),b=-d,x=G(ee,vs),B=x*G(e,r),w=x*G(r,t),M=x*G(t,e);if(l<=0&&v<=0)return this.m_v1.a=1,void(this.m_count=1);if(m>0&&l>0&&M<=0){var V=1/(m+l);return this.m_v1.a=m*V,this.m_v2.a=l*V,void(this.m_count=2)}if(A>0&&v>0&&w<=0){var z=1/(A+v);return this.m_v1.a=A*z,this.m_v3.a=v*z,this.m_count=2,void this.m_v2.set(this.m_v3)}if(m<=0&&b<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.set(this.m_v2);if(A<=0&&y<=0)return this.m_v3.a=1,this.m_count=1,void this.m_v1.set(this.m_v3);if(y>0&&b>0&&B<=0){var k=1/(y+b);return this.m_v2.a=y*k,this.m_v3.a=b*k,this.m_count=2,void this.m_v1.set(this.m_v3)}var D=1/(B+w+M);this.m_v1.a=B*D,this.m_v2.a=w*D,this.m_v3.a=M*D,this.m_count=3},s}(),pe=new Zo,ri=new Yi,Qo=new Ui,fo=new Gi,As=function(s,t,e,r,n,m){return ri.recycle(),ri.proxyA.set(s,t),ri.proxyB.set(e,r),te(ri.transformA,n),te(ri.transformB,m),ri.useRadii=!0,fo.recycle(),Qo.recycle(),xe(fo,Qo,ri),fo.distance<1e-8};xe.testOverlap=As,xe.Input=Yi,xe.Output=Gi,xe.Proxy=ke,xe.Cache=Ui;var ae,$o=function(){function s(){this.proxyA=new ke,this.proxyB=new ke,this.transformA=Nt.identity(),this.transformB=Nt.identity(),this.translationB=c.zero()}return s.prototype.recycle=function(){this.proxyA.recycle(),this.proxyB.recycle(),this.transformA.setIdentity(),this.transformB.setIdentity(),h(this.translationB)},s}(),tr=function(){this.point=c.zero(),this.normal=c.zero(),this.lambda=1,this.iterations=0},er=function(s,t){s.iterations=0,s.lambda=1,s.normal.setZero(),s.point.setZero();var e=t.proxyA,r=t.proxyB,n=fs(e.m_radius,W.polygonRadius),m=n+fs(r.m_radius,W.polygonRadius),l=t.transformA,_=t.transformB,A=t.translationB,v=c.zero(),d=0,y=new Zo;y.m_count=0;for(var b=y.m_v,x=e.getSupport(L.mulTVec2(l.q,c.neg(A))),B=Nt.mulVec2(l,e.getVertex(x)),w=r.getSupport(L.mulTVec2(_.q,A)),M=Nt.mulVec2(_,r.getVertex(w)),V=c.sub(B,M),z=fs(W.polygonRadius,m-W.polygonRadius),k=.5*W.linearSlop,D=0;D<20&&V.length()-z>k;){s.iterations+=1,x=e.getSupport(L.mulTVec2(l.q,c.neg(V))),B=Nt.mulVec2(l,e.getVertex(x)),w=r.getSupport(L.mulTVec2(_.q,V)),M=Nt.mulVec2(_,r.getVertex(w));var R=c.sub(B,M);V.normalize();var J=c.dot(V,R),O=c.dot(V,A);if(J-z>d*O){if(O<=0||(d=(J-z)/O)>1)return!1;v.setMul(-1,V),y.m_count=0}var N=b[y.m_count];switch(N.indexA=w,N.wA=c.combine(1,M,d,A),N.indexB=x,N.wB=B,N.w=c.sub(N.wB,N.wA),N.a=1,y.m_count+=1,y.m_count){case 1:break;case 2:y.solve2();break;case 3:y.solve3()}if(y.m_count==3)return!1;V.setVec2(y.getClosestPoint()),++D}if(D==0)return!1;var rt=c.zero(),et=c.zero();return y.getWitnessPoints(et,rt),V.lengthSquared()>0&&(v.setMul(-1,V),v.normalize()),s.point=c.combine(1,rt,n,v),s.normal=v,s.lambda=d,s.iterations=D,!0},Qr=Math.abs,ws=Math.max,Bs=function(){function s(){this.proxyA=new ke,this.proxyB=new ke,this.sweepA=new Fe,this.sweepB=new Fe}return s.prototype.recycle=function(){this.proxyA.recycle(),this.proxyB.recycle(),this.sweepA.recycle(),this.sweepB.recycle(),this.tMax=-1},s}();S.TOIOutputState=void 0,(ae=S.TOIOutputState||(S.TOIOutputState={}))[ae.e_unset=-1]="e_unset",ae[ae.e_unknown=0]="e_unknown",ae[ae.e_failed=1]="e_failed",ae[ae.e_overlapped=2]="e_overlapped",ae[ae.e_touching=3]="e_touching",ae[ae.e_separated=4]="e_separated";var Ss=function(){function s(){this.state=S.TOIOutputState.e_unset,this.t=-1}return s.prototype.recycle=function(){this.state=S.TOIOutputState.e_unset,this.t=-1},s}();ft.toiTime=0,ft.toiMaxTime=0,ft.toiCalls=0,ft.toiIters=0,ft.toiMaxIters=0,ft.toiRootIters=0,ft.toiMaxRootIters=0;var be,Si=new Yi,yo=new Gi,go=new Ui,Kt=_t(0,0,0),Xt=_t(0,0,0),Hi=P(0,0),Ae=P(0,0),he=P(0,0),Zt=P(0,0),Cs=P(0,0),Ms=P(0,0),Vs=P(0,0),Is=P(0,0),Ci=function(s,t){var e=Hr();++ft.toiCalls,s.state=S.TOIOutputState.e_unknown,s.t=t.tMax;var r=t.proxyA,n=t.proxyB,m=t.sweepA,l=t.sweepB;m.normalize(),l.normalize();var _=t.tMax,A=r.m_radius+n.m_radius,v=ws(W.linearSlop,A-3*W.linearSlop),d=.25*W.linearSlop,y=0,b=W.maxTOIIterations,x=0;for(go.recycle(),Si.proxyA.setVertices(r.m_vertices,r.m_count,r.m_radius),Si.proxyB.setVertices(n.m_vertices,n.m_count,n.m_radius),Si.useRadii=!1;;){if(m.getTransform(Kt,y),l.getTransform(Xt,y),te(Si.transformA,Kt),te(Si.transformB,Xt),xe(yo,go,Si),yo.distance<=0){s.state=S.TOIOutputState.e_overlapped,s.t=0;break}if(yo.distance<v+d){s.state=S.TOIOutputState.e_touching,s.t=y;break}Ki.initialize(go,r,m,n,l,y);for(var B=!1,w=_,M=0;;){var V=Ki.findMinSeparation(w);if(V>v+d){s.state=S.TOIOutputState.e_separated,s.t=_,B=!0;break}if(V>v-d){y=w;break}var z=Ki.evaluate(y);if(z<v-d){s.state=S.TOIOutputState.e_failed,s.t=y,B=!0;break}if(z<=v+d){s.state=S.TOIOutputState.e_touching,s.t=y,B=!0;break}for(var k=0,D=y,R=w;;){var J=void 0;J=1&k?D+(v-z)*(R-D)/(V-z):.5*(D+R),++k,++ft.toiRootIters;var O=Ki.evaluate(J);if(Qr(O-v)<d){w=J;break}if(O>v?(D=J,z=O):(R=J,V=O),k===50)break}if(ft.toiMaxRootIters=ws(ft.toiMaxRootIters,k),++M===W.maxPolygonVertices)break}if(++x,++ft.toiIters,B)break;if(x===b){s.state=S.TOIOutputState.e_failed,s.t=y;break}}ft.toiMaxIters=ws(ft.toiMaxIters,x);var N=Kr(e);ft.toiMaxTime=ws(ft.toiMaxTime,N),ft.toiTime+=N,Ki.recycle()};(function(s){s[s.e_unset=-1]="e_unset",s[s.e_points=1]="e_points",s[s.e_faceA=2]="e_faceA",s[s.e_faceB=3]="e_faceB"})(be||(be={}));var Ki=new(function(){function s(){this.m_proxyA=null,this.m_proxyB=null,this.m_sweepA=null,this.m_sweepB=null,this.m_type=be.e_unset,this.m_localPoint=P(0,0),this.m_axis=P(0,0),this.indexA=-1,this.indexB=-1}return s.prototype.recycle=function(){this.m_proxyA=null,this.m_proxyB=null,this.m_sweepA=null,this.m_sweepB=null,this.m_type=be.e_unset,h(this.m_localPoint),h(this.m_axis),this.indexA=-1,this.indexB=-1},s.prototype.initialize=function(t,e,r,n,m,l){var _=t.count;if(this.m_proxyA=e,this.m_proxyB=n,this.m_sweepA=r,this.m_sweepB=m,this.m_sweepA.getTransform(Kt,l),this.m_sweepB.getTransform(Xt,l),_===1){this.m_type=be.e_points;var A=this.m_proxyA.getVertex(t.indexA[0]),v=this.m_proxyB.getVertex(t.indexB[0]);return K(Ae,Kt,A),K(he,Xt,v),g(this.m_axis,he,Ae),w=function(V){var z=Ji(V.x*V.x+V.y*V.y);if(z!==0){var k=1/z;V.x*=k,V.y*=k}return z}(this.m_axis)}if(t.indexA[0]===t.indexA[1]){this.m_type=be.e_faceB;var d=n.getVertex(t.indexB[0]),y=n.getVertex(t.indexB[1]);U(this.m_axis,g(Hi,y,d),1),F(this.m_axis),St(Zt,Xt.q,this.m_axis),E(this.m_localPoint,.5,d,.5,y),K(he,Xt,this.m_localPoint);var b=e.getVertex(t.indexA[0]);return(w=j(Nt.mulVec2(Kt,b),Zt)-j(he,Zt))<0&&(u(this.m_axis),w=-w),w}this.m_type=be.e_faceA;var x=this.m_proxyA.getVertex(t.indexA[0]),B=this.m_proxyA.getVertex(t.indexA[1]);U(this.m_axis,g(Hi,B,x),1),F(this.m_axis),St(Zt,Kt.q,this.m_axis),E(this.m_localPoint,.5,x,.5,B),K(Ae,Kt,this.m_localPoint);var w,M=this.m_proxyB.getVertex(t.indexB[0]);return K(he,Xt,M),(w=j(he,Zt)-j(Ae,Zt))<0&&(u(this.m_axis),w=-w),w},s.prototype.compute=function(t,e){switch(this.m_sweepA.getTransform(Kt,e),this.m_sweepB.getTransform(Xt,e),this.m_type){case be.e_points:return t&&(Lt(Cs,Kt.q,this.m_axis),Lt(Ms,Xt.q,C(Hi,-1,this.m_axis)),this.indexA=this.m_proxyA.getSupport(Cs),this.indexB=this.m_proxyB.getSupport(Ms)),o(Vs,this.m_proxyA.getVertex(this.indexA)),o(Is,this.m_proxyB.getVertex(this.indexB)),K(Ae,Kt,Vs),K(he,Xt,Is),j(he,this.m_axis)-j(Ae,this.m_axis);case be.e_faceA:return St(Zt,Kt.q,this.m_axis),K(Ae,Kt,this.m_localPoint),t&&(Lt(Ms,Xt.q,C(Hi,-1,Zt)),this.indexA=-1,this.indexB=this.m_proxyB.getSupport(Ms)),o(Is,this.m_proxyB.getVertex(this.indexB)),K(he,Xt,Is),j(he,Zt)-j(Ae,Zt);case be.e_faceB:return St(Zt,Xt.q,this.m_axis),K(he,Xt,this.m_localPoint),t&&(Lt(Cs,Kt.q,C(Hi,-1,Zt)),this.indexB=-1,this.indexA=this.m_proxyA.getSupport(Cs)),o(Vs,this.m_proxyA.getVertex(this.indexA)),K(Ae,Kt,Vs),j(Ae,Zt)-j(he,Zt);default:return t&&(this.indexA=-1,this.indexB=-1),0}},s.prototype.findMinSeparation=function(t){return this.compute(!0,t)},s.prototype.evaluate=function(t){return this.compute(!1,t)},s}());Ci.Input=Bs,Ci.Output=Ss;var ir=Math.abs,sr=Math.sqrt,Ts=Math.min,vo=function(){function s(){this.dt=0,this.inv_dt=0,this.velocityIterations=0,this.positionIterations=0,this.warmStarting=!1,this.blockSolve=!0,this.inv_dt0=0,this.dtRatio=1}return s.prototype.reset=function(t){this.dt>0&&(this.inv_dt0=this.inv_dt),this.dt=t,this.inv_dt=t==0?0:1/t,this.dtRatio=t*this.inv_dt0},s}(),Mi=new vo,je=P(0,0),Rt=P(0,0),Ps=P(0,0),Vi=new Bs,xo=new Ss,or=new Fe,rr=new Fe,nr=new Fe,$r=function(){function s(t){this.contact=t,this.normals=[],this.tangents=[]}return s.prototype.recycle=function(){this.normals.length=0,this.tangents.length=0},Object.defineProperty(s.prototype,"normalImpulses",{get:function(){var t=this.contact,e=this.normals;e.length=0;for(var r=0;r<t.v_points.length;++r)e.push(t.v_points[r].normalImpulse);return e},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"tangentImpulses",{get:function(){var t=this.contact,e=this.tangents;e.length=0;for(var r=0;r<t.v_points.length;++r)e.push(t.v_points[r].tangentImpulse);return e},enumerable:!1,configurable:!0}),s}(),ar=function(){function s(t){this.m_world=t,this.m_stack=[],this.m_bodies=[],this.m_contacts=[],this.m_joints=[]}return s.prototype.clear=function(){this.m_stack.length=0,this.m_bodies.length=0,this.m_contacts.length=0,this.m_joints.length=0},s.prototype.addBody=function(t){this.m_bodies.push(t)},s.prototype.addContact=function(t){this.m_contacts.push(t)},s.prototype.addJoint=function(t){this.m_joints.push(t)},s.prototype.solveWorld=function(t){for(var e=this.m_world,r=e.m_bodyList;r;r=r.m_next)r.m_islandFlag=!1;for(var n=e.m_contactList;n;n=n.m_next)n.m_islandFlag=!1;for(var m=e.m_jointList;m;m=m.m_next)m.m_islandFlag=!1;for(var l=this.m_stack,_=e.m_bodyList;_;_=_.m_next)if(!_.m_islandFlag&&_.isAwake()!=0&&_.isActive()!=0&&!_.isStatic()){for(this.clear(),l.push(_),_.m_islandFlag=!0;l.length>0;)if(r=l.pop(),this.addBody(r),r.m_awakeFlag=!0,!r.isStatic()){for(var A=r.m_contactList;A;A=A.next){var v=A.contact;if(!v.m_islandFlag&&v.isEnabled()!=0&&v.isTouching()!=0){var d=v.m_fixtureA.m_isSensor,y=v.m_fixtureB.m_isSensor;!d&&!y&&(this.addContact(v),v.m_islandFlag=!0,(x=A.other).m_islandFlag||(l.push(x),x.m_islandFlag=!0))}}for(var b=r.m_jointList;b;b=b.next){var x;b.joint.m_islandFlag!=1&&(x=b.other).isActive()!=0&&(this.addJoint(b.joint),b.joint.m_islandFlag=!0,x.m_islandFlag||(l.push(x),x.m_islandFlag=!0))}}this.solveIsland(t);for(var B=0;B<this.m_bodies.length;++B)(r=this.m_bodies[B]).isStatic()&&(r.m_islandFlag=!1)}},s.prototype.solveIsland=function(t){for(var e=this.m_world,r=e.m_gravity,n=e.m_allowSleep,m=t.dt,l=0;l<this.m_bodies.length;++l){var _=this.m_bodies[l];o(je,_.m_sweep.c);var A=_.m_sweep.a;o(Rt,_.m_linearVelocity);var v=_.m_angularVelocity;o(_.m_sweep.c0,_.m_sweep.c),_.m_sweep.a0=_.m_sweep.a,_.isDynamic()&&(T(Rt,m*_.m_gravityScale,r),T(Rt,m*_.m_invMass,_.m_force),v+=m*_.m_invI*_.m_torque,C(Rt,1/(1+m*_.m_linearDamping),Rt),v*=1/(1+m*_.m_angularDamping)),o(_.c_position.c,je),_.c_position.a=A,o(_.c_velocity.v,Rt),_.c_velocity.w=v}for(l=0;l<this.m_contacts.length;++l)this.m_contacts[l].initConstraint(t);for(l=0;l<this.m_contacts.length;++l)this.m_contacts[l].initVelocityConstraint(t);if(t.warmStarting)for(l=0;l<this.m_contacts.length;++l)this.m_contacts[l].warmStartConstraint(t);for(l=0;l<this.m_joints.length;++l)this.m_joints[l].initVelocityConstraints(t);for(l=0;l<t.velocityIterations;++l){for(var d=0;d<this.m_joints.length;++d)this.m_joints[d].solveVelocityConstraints(t);for(d=0;d<this.m_contacts.length;++d)this.m_contacts[d].solveVelocityConstraint(t)}for(l=0;l<this.m_contacts.length;++l)this.m_contacts[l].storeConstraintImpulses(t);for(l=0;l<this.m_bodies.length;++l){_=this.m_bodies[l],o(je,_.c_position.c),A=_.c_position.a,o(Rt,_.c_velocity.v),v=_.c_velocity.w,C(Ps,m,Rt);var y=tt(Ps);if(y>W.maxTranslationSquared){var b=W.maxTranslation/sr(y);I(Rt,b)}var x=m*v;x*x>W.maxRotationSquared&&(v*=b=W.maxRotation/ir(x)),T(je,m,Rt),A+=m*v,o(_.c_position.c,je),_.c_position.a=A,o(_.c_velocity.v,Rt),_.c_velocity.w=v}var B=!1;for(l=0;l<t.positionIterations;++l){var w=0;for(d=0;d<this.m_contacts.length;++d){var M=this.m_contacts[d].solvePositionConstraint(t);w=Ts(w,M)}var V=w>=-3*W.linearSlop,z=!0;for(d=0;d<this.m_joints.length;++d){var k=this.m_joints[d].solvePositionConstraints(t);z=z&&k}if(V&&z){B=!0;break}}for(l=0;l<this.m_bodies.length;++l)o((_=this.m_bodies[l]).m_sweep.c,_.c_position.c),_.m_sweep.a=_.c_position.a,o(_.m_linearVelocity,_.c_velocity.v),_.m_angularVelocity=_.c_velocity.w,_.synchronizeTransform();if(this.postSolveIsland(),n){var D=1/0,R=W.linearSleepToleranceSqr,J=W.angularSleepToleranceSqr;for(l=0;l<this.m_bodies.length;++l)(_=this.m_bodies[l]).isStatic()||(_.m_autoSleepFlag==0||_.m_angularVelocity*_.m_angularVelocity>J||tt(_.m_linearVelocity)>R?(_.m_sleepTime=0,D=0):(_.m_sleepTime+=m,D=Ts(D,_.m_sleepTime)));if(D>=W.timeToSleep&&B)for(l=0;l<this.m_bodies.length;++l)(_=this.m_bodies[l]).setAwake(!1)}},s.prototype.solveWorldTOI=function(t){var e=this.m_world;if(e.m_stepComplete){for(var r=e.m_bodyList;r;r=r.m_next)r.m_islandFlag=!1,r.m_sweep.alpha0=0;for(var n=e.m_contactList;n;n=n.m_next)n.m_toiFlag=!1,n.m_islandFlag=!1,n.m_toiCount=0,n.m_toi=1}for(;;){for(var m=null,l=1,_=e.m_contactList;_;_=_.m_next)if(_.isEnabled()!=0&&!(_.m_toiCount>W.maxSubSteps)){var A=1;if(_.m_toiFlag)A=_.m_toi;else{var v=_.getFixtureA(),d=_.getFixtureB();if(v.isSensor()||d.isSensor())continue;var y=v.getBody(),b=d.getBody(),x=y.isAwake()&&!y.isStatic(),B=b.isAwake()&&!b.isStatic();if(x==0&&B==0)continue;var w=y.isBullet()||!y.isDynamic(),M=b.isBullet()||!b.isDynamic();if(w==0&&M==0)continue;var V=y.m_sweep.alpha0;y.m_sweep.alpha0<b.m_sweep.alpha0?(V=b.m_sweep.alpha0,y.m_sweep.advance(V)):b.m_sweep.alpha0<y.m_sweep.alpha0&&(V=y.m_sweep.alpha0,b.m_sweep.advance(V));var z=_.getChildIndexA(),k=_.getChildIndexB();y.m_sweep,b.m_sweep,Vi.proxyA.set(v.getShape(),z),Vi.proxyB.set(d.getShape(),k),Vi.sweepA.set(y.m_sweep),Vi.sweepB.set(b.m_sweep),Vi.tMax=1,Ci(xo,Vi);var D=xo.t;A=xo.state==S.TOIOutputState.e_touching?Ts(V+(1-V)*D,1):1,_.m_toi=A,_.m_toiFlag=!0}A<l&&(m=_,l=A)}if(m==null||1-1e-8<l){e.m_stepComplete=!0;break}var R=m.getFixtureA(),J=m.getFixtureB(),O=R.getBody(),N=J.getBody();if(rr.set(O.m_sweep),nr.set(N.m_sweep),O.advance(l),N.advance(l),m.update(e),m.m_toiFlag=!1,++m.m_toiCount,m.isEnabled()!=0&&m.isTouching()!=0){O.setAwake(!0),N.setAwake(!0),this.clear(),this.addBody(O),this.addBody(N),this.addContact(m),O.m_islandFlag=!0,N.m_islandFlag=!0,m.m_islandFlag=!0;for(var rt=[O,N],et=0;et<rt.length;++et)if((vt=rt[et]).isDynamic())for(var st=vt.m_contactList;st;st=st.next){var ct=st.contact;if(!ct.m_islandFlag){var at=st.other;if(!at.isDynamic()||vt.isBullet()||at.isBullet()){var dt=ct.m_fixtureA.m_isSensor,Wt=ct.m_fixtureB.m_isSensor;dt||Wt||(or.set(at.m_sweep),at.m_islandFlag==0&&at.advance(l),ct.update(e),ct.isEnabled()!=0&&ct.isTouching()!=0?(ct.m_islandFlag=!0,this.addContact(ct),at.m_islandFlag||(at.m_islandFlag=!0,at.isStatic()||at.setAwake(!0),this.addBody(at))):(at.m_sweep.set(or),at.synchronizeTransform()))}}}for(Mi.reset((1-l)*t.dt),Mi.dtRatio=1,Mi.positionIterations=20,Mi.velocityIterations=t.velocityIterations,Mi.warmStarting=!1,this.solveIslandTOI(Mi,O,N),et=0;et<this.m_bodies.length;++et){var vt;if((vt=this.m_bodies[et]).m_islandFlag=!1,vt.isDynamic())for(vt.synchronizeFixtures(),st=vt.m_contactList;st;st=st.next)st.contact.m_toiFlag=!1,st.contact.m_islandFlag=!1}if(e.findNewContacts(),e.m_subStepping){e.m_stepComplete=!1;break}}else m.setEnabled(!1),O.m_sweep.set(rr),N.m_sweep.set(nr),O.synchronizeTransform(),N.synchronizeTransform()}},s.prototype.solveIslandTOI=function(t,e,r){for(var n=0;n<this.m_bodies.length;++n)o((v=this.m_bodies[n]).c_position.c,v.m_sweep.c),v.c_position.a=v.m_sweep.a,o(v.c_velocity.v,v.m_linearVelocity),v.c_velocity.w=v.m_angularVelocity;for(n=0;n<this.m_contacts.length;++n)this.m_contacts[n].initConstraint(t);for(n=0;n<t.positionIterations;++n){for(var m=0,l=0;l<this.m_contacts.length;++l){var _=this.m_contacts[l].solvePositionConstraintTOI(t,e,r);m=Ts(m,_)}if(m>=-1.5*W.linearSlop)break}for(o(e.m_sweep.c0,e.c_position.c),e.m_sweep.a0=e.c_position.a,o(r.m_sweep.c0,r.c_position.c),r.m_sweep.a0=r.c_position.a,n=0;n<this.m_contacts.length;++n)this.m_contacts[n].initVelocityConstraint(t);for(n=0;n<t.velocityIterations;++n)for(l=0;l<this.m_contacts.length;++l)this.m_contacts[l].solveVelocityConstraint(t);var A=t.dt;for(n=0;n<this.m_bodies.length;++n){var v=this.m_bodies[n];o(je,v.c_position.c);var d=v.c_position.a;o(Rt,v.c_velocity.v);var y=v.c_velocity.w;C(Ps,A,Rt);var b=tt(Ps);if(b>W.maxTranslationSquared){var x=W.maxTranslation/sr(b);I(Rt,x)}var B=A*y;B*B>W.maxRotationSquared&&(y*=x=W.maxRotation/ir(B)),T(je,A,Rt),d+=A*y,o(v.c_position.c,je),v.c_position.a=d,o(v.c_velocity.v,Rt),v.c_velocity.w=y,o(v.m_sweep.c,je),v.m_sweep.a=d,o(v.m_linearVelocity,Rt),v.m_angularVelocity=y,v.synchronizeTransform()}this.postSolveIsland()},s.prototype.postSolveIsland=function(){for(var t=0;t<this.m_contacts.length;++t){var e=this.m_contacts[t];this.m_world.postSolve(e,e.m_impulse)}},s}();ar.TimeStep=vo;var Ye,Ii,Ge,ie=function(){function s(t,e,r,n){typeof t=="object"&&t!==null?(this.ex=c.clone(t),this.ey=c.clone(e)):typeof t=="number"?(this.ex=c.neo(t,r),this.ey=c.neo(e,n)):(this.ex=c.zero(),this.ey=c.zero())}return s.prototype.toString=function(){return JSON.stringify(this)},s.isValid=function(t){return t!=null&&c.isValid(t.ex)&&c.isValid(t.ey)},s.assert=function(t){},s.prototype.set=function(t,e,r,n){typeof t=="number"&&typeof e=="number"&&typeof r=="number"&&typeof n=="number"?(this.ex.setNum(t,r),this.ey.setNum(e,n)):typeof t=="object"&&typeof e=="object"?(this.ex.setVec2(t),this.ey.setVec2(e)):typeof t=="object"&&(this.ex.setVec2(t.ex),this.ey.setVec2(t.ey))},s.prototype.setIdentity=function(){this.ex.x=1,this.ey.x=0,this.ex.y=0,this.ey.y=1},s.prototype.setZero=function(){this.ex.x=0,this.ey.x=0,this.ex.y=0,this.ey.y=0},s.prototype.getInverse=function(){var t=this.ex.x,e=this.ey.x,r=this.ex.y,n=this.ey.y,m=t*n-e*r;m!==0&&(m=1/m);var l=new s;return l.ex.x=m*n,l.ey.x=-m*e,l.ex.y=-m*r,l.ey.y=m*t,l},s.prototype.solve=function(t){var e=this.ex.x,r=this.ey.x,n=this.ex.y,m=this.ey.y,l=e*m-r*n;l!==0&&(l=1/l);var _=c.zero();return _.x=l*(m*t.x-r*t.y),_.y=l*(e*t.y-n*t.x),_},s.mul=function(t,e){if(e&&"x"in e&&"y"in e){var r=t.ex.x*e.x+t.ey.x*e.y,n=t.ex.y*e.x+t.ey.y*e.y;return c.neo(r,n)}if(e&&"ex"in e&&"ey"in e)return new s(t.ex.x*e.ex.x+t.ey.x*e.ex.y,t.ex.x*e.ey.x+t.ey.x*e.ey.y,t.ex.y*e.ex.x+t.ey.y*e.ex.y,t.ex.y*e.ey.x+t.ey.y*e.ey.y)},s.mulVec2=function(t,e){var r=t.ex.x*e.x+t.ey.x*e.y,n=t.ex.y*e.x+t.ey.y*e.y;return c.neo(r,n)},s.mulMat22=function(t,e){return new s(t.ex.x*e.ex.x+t.ey.x*e.ex.y,t.ex.x*e.ey.x+t.ey.x*e.ey.y,t.ex.y*e.ex.x+t.ey.y*e.ex.y,t.ex.y*e.ey.x+t.ey.y*e.ey.y)},s.mulT=function(t,e){return e&&"x"in e&&"y"in e?c.neo(c.dot(e,t.ex),c.dot(e,t.ey)):e&&"ex"in e&&"ey"in e?new s(c.neo(c.dot(t.ex,e.ex),c.dot(t.ey,e.ex)),c.neo(c.dot(t.ex,e.ey),c.dot(t.ey,e.ey))):void 0},s.mulTVec2=function(t,e){return c.neo(c.dot(e,t.ex),c.dot(e,t.ey))},s.mulTMat22=function(t,e){return new s(c.neo(c.dot(t.ex,e.ex),c.dot(t.ey,e.ex)),c.neo(c.dot(t.ex,e.ey),c.dot(t.ey,e.ey)))},s.abs=function(t){return new s(c.abs(t.ex),c.abs(t.ey))},s.add=function(t,e){return new s(c.add(t.ex,e.ex),c.add(t.ey,e.ey))},s}(),tn=Math.sqrt,bo=P(0,0),Ao=P(0,0),Xi=P(0,0),qe=P(0,0),Oe=P(0,0),wo=P(0,0),zs=P(0,0),Ue=P(0,0);S.ManifoldType=void 0,(Ye=S.ManifoldType||(S.ManifoldType={}))[Ye.e_unset=-1]="e_unset",Ye[Ye.e_circles=0]="e_circles",Ye[Ye.e_faceA=1]="e_faceA",Ye[Ye.e_faceB=2]="e_faceB",S.ContactFeatureType=void 0,(Ii=S.ContactFeatureType||(S.ContactFeatureType={}))[Ii.e_unset=-1]="e_unset",Ii[Ii.e_vertex=0]="e_vertex",Ii[Ii.e_face=1]="e_face",S.PointState=void 0,(Ge=S.PointState||(S.PointState={}))[Ge.nullState=0]="nullState",Ge[Ge.addState=1]="addState",Ge[Ge.persistState=2]="persistState",Ge[Ge.removeState=3]="removeState";var Yt=function(){function s(){this.v=P(0,0),this.id=new Ls}return s.prototype.set=function(t){o(this.v,t.v),this.id.set(t.id)},s.prototype.recycle=function(){h(this.v),this.id.recycle()},s}(),Zi=function(){function s(){this.localNormal=P(0,0),this.localPoint=P(0,0),this.points=[new Fs,new Fs],this.pointCount=0}return s.prototype.set=function(t){this.type=t.type,o(this.localNormal,t.localNormal),o(this.localPoint,t.localPoint),this.pointCount=t.pointCount,this.points[0].set(t.points[0]),this.points[1].set(t.points[1])},s.prototype.recycle=function(){this.type=S.ManifoldType.e_unset,h(this.localNormal),h(this.localPoint),this.pointCount=0,this.points[0].recycle(),this.points[1].recycle()},s.prototype.getWorldManifold=function(t,e,r,n,m){if(this.pointCount==0)return t;(t=t||new ks).pointCount=this.pointCount;var l=t.normal,_=t.points,A=t.separations;switch(this.type){case S.ManifoldType.e_circles:i(l,1,0);var v=this.points[0];K(bo,e,this.localPoint),K(Ao,n,v.localPoint),g(wo,Ao,bo);var d=tt(wo);d>1e-18&&C(l,1/tn(d),wo),E(qe,1,bo,r,l),E(Oe,1,Ao,-m,l),E(_[0],.5,qe,.5,Oe),A[0]=j(g(Xi,Oe,qe),l);break;case S.ManifoldType.e_faceA:St(l,e.q,this.localNormal),K(zs,e,this.localPoint);for(var y=0;y<this.pointCount;++y)v=this.points[y],K(Ue,n,v.localPoint),E(qe,1,Ue,r-j(g(Xi,Ue,zs),l),l),E(Oe,1,Ue,-m,l),E(_[y],.5,qe,.5,Oe),A[y]=j(g(Xi,Oe,qe),l);break;case S.ManifoldType.e_faceB:for(St(l,n.q,this.localNormal),K(zs,n,this.localPoint),y=0;y<this.pointCount;++y)v=this.points[y],K(Ue,e,v.localPoint),E(Oe,1,Ue,m-j(g(Xi,Ue,zs),l),l),E(qe,1,Ue,-r,l),E(_[y],.5,qe,.5,Oe),A[y]=j(g(Xi,qe,Oe),l);u(l)}return t},s.clipSegmentToLine=ni,s.ClipVertex=Yt,s.getPointStates=Bo,s.PointState=S.PointState,s}(),Fs=function(){function s(){this.localPoint=P(0,0),this.normalImpulse=0,this.tangentImpulse=0,this.id=new Ls}return s.prototype.set=function(t){o(this.localPoint,t.localPoint),this.normalImpulse=t.normalImpulse,this.tangentImpulse=t.tangentImpulse,this.id.set(t.id)},s.prototype.recycle=function(){h(this.localPoint),this.normalImpulse=0,this.tangentImpulse=0,this.id.recycle()},s}(),Ls=function(){function s(){this.key=-1,this.indexA=-1,this.indexB=-1,this.typeA=S.ContactFeatureType.e_unset,this.typeB=S.ContactFeatureType.e_unset}return s.prototype.setFeatures=function(t,e,r,n){this.indexA=t,this.indexB=r,this.typeA=e,this.typeB=n,this.key=this.indexA+4*this.indexB+16*this.typeA+64*this.typeB},s.prototype.set=function(t){this.indexA=t.indexA,this.indexB=t.indexB,this.typeA=t.typeA,this.typeB=t.typeB,this.key=this.indexA+4*this.indexB+16*this.typeA+64*this.typeB},s.prototype.swapFeatures=function(){var t=this.indexA,e=this.indexB,r=this.typeA,n=this.typeB;this.indexA=e,this.indexB=t,this.typeA=n,this.typeB=r,this.key=this.indexA+4*this.indexB+16*this.typeA+64*this.typeB},s.prototype.recycle=function(){this.indexA=0,this.indexB=0,this.typeA=S.ContactFeatureType.e_unset,this.typeB=S.ContactFeatureType.e_unset,this.key=-1},s}(),ks=function(){function s(){this.normal=P(0,0),this.points=[P(0,0),P(0,0)],this.separations=[0,0],this.pointCount=0}return s.prototype.recycle=function(){h(this.normal),h(this.points[0]),h(this.points[1]),this.separations[0]=0,this.separations[1]=0,this.pointCount=0},s}();function Bo(s,t,e,r){for(var n=0;n<e.pointCount;++n){var m=e.points[n].id;s[n]=S.PointState.removeState;for(var l=0;l<r.pointCount;++l)if(r.points[l].id.key===m.key){s[n]=S.PointState.persistState;break}}for(n=0;n<r.pointCount;++n)for(m=r.points[n].id,t[n]=S.PointState.addState,l=0;l<e.pointCount;++l)if(e.points[l].id.key===m.key){t[n]=S.PointState.persistState;break}}function ni(s,t,e,r,n){var m=0,l=j(e,t[0].v)-r,_=j(e,t[1].v)-r;if(l<=0&&s[m++].set(t[0]),_<=0&&s[m++].set(t[1]),l*_<0){var A=l/(l-_);E(s[m].v,1-A,t[0].v,A,t[1].v),s[m].id.setFeatures(n,S.ContactFeatureType.e_vertex,t[0].id.indexB,S.ContactFeatureType.e_face),++m}return m}var en=Math.sqrt,sn=Math.max,on=Math.min,hr=new ei({create:function(){return new ce},release:function(s){s.recycle()}}),Ti=new Zi,js=new ks,qs=function(){function s(t){this.prev=null,this.next=null,this.other=null,this.contact=t}return s.prototype.recycle=function(){this.prev=null,this.next=null,this.other=null},s}();function Os(s,t){return en(s*t)}function Ds(s,t){return s>t?s:t}var ai=[],Ns=function(){function s(){this.rA=P(0,0),this.rB=P(0,0),this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.velocityBias=0}return s.prototype.recycle=function(){h(this.rA),h(this.rB),this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.velocityBias=0},s}(),De=P(0,0),wt=P(0,0),Ne=P(0,0),Bt=P(0,0),He=P(0,0),hi=_t(0,0,0),li=_t(0,0,0),Rs=P(0,0),Es=P(0,0),Pi=P(0,0),Ws=P(0,0),So=P(0,0),Co=P(0,0),It=P(0,0),mt=P(0,0),Qi=P(0,0),le=P(0,0),zi=P(0,0),Fi=P(0,0),se=P(0,0),Re=P(0,0),yt=P(0,0),me=P(0,0),Tt=P(0,0),Pt=P(0,0),we=P(0,0),ce=function(){function s(){this.m_nodeA=new qs(this),this.m_nodeB=new qs(this),this.m_fixtureA=null,this.m_fixtureB=null,this.m_indexA=-1,this.m_indexB=-1,this.m_evaluateFcn=null,this.m_manifold=new Zi,this.m_prev=null,this.m_next=null,this.m_toi=1,this.m_toiCount=0,this.m_toiFlag=!1,this.m_friction=0,this.m_restitution=0,this.m_tangentSpeed=0,this.m_enabledFlag=!0,this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_impulse=new $r(this),this.v_points=[new Ns,new Ns],this.v_normal=P(0,0),this.v_normalMass=new ie,this.v_K=new ie,this.v_pointCount=0,this.v_tangentSpeed=0,this.v_friction=0,this.v_restitution=0,this.v_invMassA=0,this.v_invMassB=0,this.v_invIA=0,this.v_invIB=0,this.p_localPoints=[P(0,0),P(0,0)],this.p_localNormal=P(0,0),this.p_localPoint=P(0,0),this.p_localCenterA=P(0,0),this.p_localCenterB=P(0,0),this.p_type=S.ManifoldType.e_unset,this.p_radiusA=0,this.p_radiusB=0,this.p_pointCount=0,this.p_invMassA=0,this.p_invMassB=0,this.p_invIA=0,this.p_invIB=0}return s.prototype.initialize=function(t,e,r,n,m){this.m_fixtureA=t,this.m_fixtureB=r,this.m_indexA=e,this.m_indexB=n,this.m_evaluateFcn=m,this.m_friction=Os(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction),this.m_restitution=Ds(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)},s.prototype.recycle=function(){this.m_nodeA.recycle(),this.m_nodeB.recycle(),this.m_fixtureA=null,this.m_fixtureB=null,this.m_indexA=-1,this.m_indexB=-1,this.m_evaluateFcn=null,this.m_manifold.recycle(),this.m_prev=null,this.m_next=null,this.m_toi=1,this.m_toiCount=0,this.m_toiFlag=!1,this.m_friction=0,this.m_restitution=0,this.m_tangentSpeed=0,this.m_enabledFlag=!0,this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_impulse.recycle();for(var t=0,e=this.v_points;t<e.length;t++)e[t].recycle();h(this.v_normal),this.v_normalMass.setZero(),this.v_K.setZero(),this.v_pointCount=0,this.v_tangentSpeed=0,this.v_friction=0,this.v_restitution=0,this.v_invMassA=0,this.v_invMassB=0,this.v_invIA=0,this.v_invIB=0;for(var r=0,n=this.p_localPoints;r<n.length;r++)h(n[r]);h(this.p_localNormal),h(this.p_localPoint),h(this.p_localCenterA),h(this.p_localCenterB),this.p_type=S.ManifoldType.e_unset,this.p_radiusA=0,this.p_radiusB=0,this.p_pointCount=0,this.p_invMassA=0,this.p_invMassB=0,this.p_invIA=0,this.p_invIB=0},s.prototype.initConstraint=function(t){var e=this.m_fixtureA,r=this.m_fixtureB;if(e!==null&&r!==null){var n=e.m_body,m=r.m_body;if(n!==null&&m!==null){var l=e.m_shape,_=r.m_shape;if(l!==null&&_!==null){var A=this.m_manifold,v=A.pointCount;this.v_invMassA=n.m_invMass,this.v_invMassB=m.m_invMass,this.v_invIA=n.m_invI,this.v_invIB=m.m_invI,this.v_friction=this.m_friction,this.v_restitution=this.m_restitution,this.v_tangentSpeed=this.m_tangentSpeed,this.v_pointCount=v,this.v_K.setZero(),this.v_normalMass.setZero(),this.p_invMassA=n.m_invMass,this.p_invMassB=m.m_invMass,this.p_invIA=n.m_invI,this.p_invIB=m.m_invI,o(this.p_localCenterA,n.m_sweep.localCenter),o(this.p_localCenterB,m.m_sweep.localCenter),this.p_radiusA=l.m_radius,this.p_radiusB=_.m_radius,this.p_type=A.type,o(this.p_localNormal,A.localNormal),o(this.p_localPoint,A.localPoint),this.p_pointCount=v;for(var d=0;d<W.maxManifoldPoints;++d)this.v_points[d].recycle(),h(this.p_localPoints[d]);for(d=0;d<v;++d){var y=A.points[d],b=this.v_points[d];t.warmStarting&&(b.normalImpulse=t.dtRatio*y.normalImpulse,b.tangentImpulse=t.dtRatio*y.tangentImpulse),o(this.p_localPoints[d],y.localPoint)}}}}},s.prototype.getManifold=function(){return this.m_manifold},s.prototype.getWorldManifold=function(t){var e=this.m_fixtureA,r=this.m_fixtureB;if(e!==null&&r!==null){var n=e.m_body,m=r.m_body;if(n!==null&&m!==null){var l=e.m_shape,_=r.m_shape;if(l!==null&&_!==null)return this.m_manifold.getWorldManifold(t,n.getTransform(),l.m_radius,m.getTransform(),_.m_radius)}}},s.prototype.setEnabled=function(t){this.m_enabledFlag=!!t},s.prototype.isEnabled=function(){return this.m_enabledFlag},s.prototype.isTouching=function(){return this.m_touchingFlag},s.prototype.getNext=function(){return this.m_next},s.prototype.getFixtureA=function(){return this.m_fixtureA},s.prototype.getFixtureB=function(){return this.m_fixtureB},s.prototype.getChildIndexA=function(){return this.m_indexA},s.prototype.getChildIndexB=function(){return this.m_indexB},s.prototype.flagForFiltering=function(){this.m_filterFlag=!0},s.prototype.setFriction=function(t){this.m_friction=t},s.prototype.getFriction=function(){return this.m_friction},s.prototype.resetFriction=function(){var t=this.m_fixtureA,e=this.m_fixtureB;t!==null&&e!==null&&(this.m_friction=Os(t.m_friction,e.m_friction))},s.prototype.setRestitution=function(t){this.m_restitution=t},s.prototype.getRestitution=function(){return this.m_restitution},s.prototype.resetRestitution=function(){var t=this.m_fixtureA,e=this.m_fixtureB;t!==null&&e!==null&&(this.m_restitution=Ds(t.m_restitution,e.m_restitution))},s.prototype.setTangentSpeed=function(t){this.m_tangentSpeed=t},s.prototype.getTangentSpeed=function(){return this.m_tangentSpeed},s.prototype.evaluate=function(t,e,r){var n=this.m_fixtureA,m=this.m_fixtureB;n!==null&&m!==null&&this.m_evaluateFcn(t,e,n,this.m_indexA,r,m,this.m_indexB)},s.prototype.update=function(t){var e=this.m_fixtureA,r=this.m_fixtureB;if(e!==null&&r!==null){var n=e.m_body,m=r.m_body;if(n!==null&&m!==null){var l=e.m_shape,_=r.m_shape;if(l!==null&&_!==null){this.m_enabledFlag=!0;var A=!1,v=this.m_touchingFlag,d=e.m_isSensor,y=r.m_isSensor,b=d||y,x=n.m_xf,B=m.m_xf;if(b)A=As(l,this.m_indexA,_,this.m_indexB,x,B),this.m_manifold.pointCount=0;else{Ti.recycle(),Ti.set(this.m_manifold),this.m_manifold.recycle(),this.evaluate(this.m_manifold,x,B),A=this.m_manifold.pointCount>0;for(var w=0;w<this.m_manifold.pointCount;++w){var M=this.m_manifold.points[w];M.normalImpulse=0,M.tangentImpulse=0;for(var V=0;V<Ti.pointCount;++V){var z=Ti.points[V];if(z.id.key===M.id.key){M.normalImpulse=z.normalImpulse,M.tangentImpulse=z.tangentImpulse;break}}}A!==v&&(n.setAwake(!0),m.setAwake(!0))}this.m_touchingFlag=A;var k=typeof t=="object"&&t!==null;!v&&A&&k&&t.beginContact(this),v&&!A&&k&&t.endContact(this),!b&&A&&k&&Ti&&t.preSolve(this,Ti)}}}},s.prototype.solvePositionConstraint=function(t){return this._solvePositionConstraint(t,null,null)},s.prototype.solvePositionConstraintTOI=function(t,e,r){return this._solvePositionConstraint(t,e,r)},s.prototype._solvePositionConstraint=function(t,e,r){var n=e!==null&&r!==null,m=0,l=this.m_fixtureA,_=this.m_fixtureB;if(l===null||_===null)return m;var A=l.m_body,v=_.m_body;if(A===null||v===null)return m;A.c_velocity,v.c_velocity;var d=A.c_position,y=v.c_position,b=this.p_localCenterA,x=this.p_localCenterB,B=0,w=0;n&&A!==e&&A!==r||(B=this.p_invMassA,w=this.p_invIA);var M=0,V=0;n&&v!==e&&v!==r||(M=this.p_invMassB,V=this.p_invIB),o(De,d.c);var z=d.a;o(Ne,y.c);for(var k=y.a,D=0;D<this.p_pointCount;++D){ls(hi,b,De,z),ls(li,x,Ne,k);var R=void 0;switch(this.p_type){case S.ManifoldType.e_circles:K(Rs,hi,this.p_localPoint),K(Es,li,this.p_localPoints[0]),g(mt,Es,Rs),F(mt),E(Qi,.5,Rs,.5,Es),R=j(Es,mt)-j(Rs,mt)-this.p_radiusA-this.p_radiusB;break;case S.ManifoldType.e_faceA:St(mt,hi.q,this.p_localNormal),K(Ws,hi,this.p_localPoint),K(Pi,li,this.p_localPoints[D]),R=j(Pi,mt)-j(Ws,mt)-this.p_radiusA-this.p_radiusB,o(Qi,Pi);break;case S.ManifoldType.e_faceB:St(mt,li.q,this.p_localNormal),K(Ws,li,this.p_localPoint),K(Pi,hi,this.p_localPoints[D]),R=j(Pi,mt)-j(Ws,mt)-this.p_radiusA-this.p_radiusB,o(Qi,Pi),u(mt);break;default:return m}g(So,Qi,De),g(Co,Qi,Ne),m=on(m,R);var J=gt((n?W.toiBaugarte:W.baumgarte)*(R+W.linearSlop),-W.maxLinearCorrection,0),O=G(So,mt),N=G(Co,mt),rt=B+M+w*O*O+V*N*N;C(It,rt>0?-J/rt:0,mt),q(De,B,It),z-=w*G(So,It),T(Ne,M,It),k+=V*G(Co,It)}return o(d.c,De),d.a=z,o(y.c,Ne),y.a=k,m},s.prototype.initVelocityConstraint=function(t){var e=this.m_fixtureA,r=this.m_fixtureB;if(e!==null&&r!==null){var n=e.m_body,m=r.m_body;if(n!==null&&m!==null){var l=n.c_velocity,_=m.c_velocity,A=n.c_position,v=m.c_position,d=this.p_radiusA,y=this.p_radiusB,b=this.m_manifold,x=this.v_invMassA,B=this.v_invMassB,w=this.v_invIA,M=this.v_invIB,V=this.p_localCenterA,z=this.p_localCenterB;o(De,A.c);var k=A.a;o(wt,l.v);var D=l.w;o(Ne,v.c);var R=v.a;o(Bt,_.v);var J=_.w;ls(hi,V,De,k),ls(li,z,Ne,R),js.recycle(),b.getWorldManifold(js,hi,d,li,y),o(this.v_normal,js.normal);for(var O=0;O<this.v_pointCount;++O){var N=this.v_points[O],rt=js.points[O];g(N.rA,rt,De),g(N.rB,rt,Ne);var et=G(N.rA,this.v_normal),st=G(N.rB,this.v_normal),ct=x+B+w*et*et+M*st*st;N.normalMass=ct>0?1/ct:0,U(He,this.v_normal,1);var at=G(N.rA,He),dt=G(N.rB,He),Wt=x+B+w*at*at+M*dt*dt;N.tangentMass=Wt>0?1/Wt:0,N.velocityBias=0;var vt=0;vt+=j(this.v_normal,Bt),vt+=j(this.v_normal,$(we,J,N.rB)),vt-=j(this.v_normal,wt),(vt-=j(this.v_normal,$(we,D,N.rA)))<-W.velocityThreshold&&(N.velocityBias=-this.v_restitution*vt)}if(this.v_pointCount==2&&t.blockSolve){var oe=this.v_points[0],Dt=this.v_points[1],yi=G(oe.rA,this.v_normal),ve=G(oe.rB,this.v_normal),re=G(Dt.rA,this.v_normal),Jt=G(Dt.rB,this.v_normal),Te=x+B+w*yi*yi+M*ve*ve,Pe=x+B+w*re*re+M*Jt*Jt,We=x+B+w*yi*re+M*ve*Jt;if(Te*Te<1e3*(Te*Pe-We*We)){this.v_K.ex.setNum(Te,We),this.v_K.ey.setNum(We,Pe);var gi=this.v_K.ex.x,vi=this.v_K.ey.x,xi=this.v_K.ex.y,bi=this.v_K.ey.y,ze=gi*bi-vi*xi;ze!==0&&(ze=1/ze),this.v_normalMass.ex.x=ze*bi,this.v_normalMass.ey.x=-ze*vi,this.v_normalMass.ex.y=-ze*xi,this.v_normalMass.ey.y=ze*gi}else this.v_pointCount=1}o(A.c,De),A.a=k,o(l.v,wt),l.w=D,o(v.c,Ne),v.a=R,o(_.v,Bt),_.w=J}}},s.prototype.warmStartConstraint=function(t){var e=this.m_fixtureA,r=this.m_fixtureB;if(e!==null&&r!==null){var n=e.m_body,m=r.m_body;if(n!==null&&m!==null){var l=n.c_velocity,_=m.c_velocity;n.c_position,m.c_position;var A=this.v_invMassA,v=this.v_invIA,d=this.v_invMassB,y=this.v_invIB;o(wt,l.v);var b=l.w;o(Bt,_.v);var x=_.w;o(mt,this.v_normal),U(He,mt,1);for(var B=0;B<this.v_pointCount;++B){var w=this.v_points[B];E(It,w.normalImpulse,mt,w.tangentImpulse,He),b-=v*G(w.rA,It),q(wt,A,It),x+=y*G(w.rB,It),T(Bt,d,It)}o(l.v,wt),l.w=b,o(_.v,Bt),_.w=x}}},s.prototype.storeConstraintImpulses=function(t){for(var e=this.m_manifold,r=0;r<this.v_pointCount;++r)e.points[r].normalImpulse=this.v_points[r].normalImpulse,e.points[r].tangentImpulse=this.v_points[r].tangentImpulse},s.prototype.solveVelocityConstraint=function(t){var e=this.m_fixtureA,r=this.m_fixtureB;if(e!==null&&r!==null){var n=e.m_body,m=r.m_body;if(n!==null&&m!==null){var l=n.c_velocity;n.c_position;var _=m.c_velocity;m.c_position;var A=this.v_invMassA,v=this.v_invIA,d=this.v_invMassB,y=this.v_invIB;o(wt,l.v);var b=l.w;o(Bt,_.v);var x=_.w;o(mt,this.v_normal),U(He,mt,1);for(var B=this.v_friction,w=0;w<this.v_pointCount;++w){var M=this.v_points[w];h(le),p(le,Bt),p(le,$(we,x,M.rB)),f(le,wt),f(le,$(we,b,M.rA));var V=j(le,He)-this.v_tangentSpeed,z=M.tangentMass*-V,k=B*M.normalImpulse;z=(R=gt(M.tangentImpulse+z,-k,k))-M.tangentImpulse,M.tangentImpulse=R,C(It,z,He),q(wt,A,It),b-=v*G(M.rA,It),T(Bt,d,It),x+=y*G(M.rB,It)}if(this.v_pointCount==1||t.blockSolve==0)for(var D=0;D<this.v_pointCount;++D){M=this.v_points[D],h(le),p(le,Bt),p(le,$(we,x,M.rB)),f(le,wt),f(le,$(we,b,M.rA));var R,J=j(le,mt);z=-M.normalMass*(J-M.velocityBias),z=(R=sn(M.normalImpulse+z,0))-M.normalImpulse,M.normalImpulse=R,C(It,z,mt),q(wt,A,It),b-=v*G(M.rA,It),T(Bt,d,It),x+=y*G(M.rB,It)}else{var O=this.v_points[0],N=this.v_points[1];i(Re,O.normalImpulse,N.normalImpulse),h(zi),p(zi,Bt),p(zi,$(we,x,O.rB)),f(zi,wt),f(zi,$(we,b,O.rA)),h(Fi),p(Fi,Bt),p(Fi,$(we,x,N.rB)),f(Fi,wt),f(Fi,$(we,b,N.rA));var rt=j(zi,mt),et=j(Fi,mt);for(i(se,rt-O.velocityBias,et-N.velocityBias),se.x-=this.v_K.ex.x*Re.x+this.v_K.ey.x*Re.y,se.y-=this.v_K.ex.y*Re.x+this.v_K.ey.y*Re.y;;){if(h(yt),yt.x=-(this.v_normalMass.ex.x*se.x+this.v_normalMass.ey.x*se.y),yt.y=-(this.v_normalMass.ex.y*se.x+this.v_normalMass.ey.y*se.y),yt.x>=0&&yt.y>=0){g(me,yt,Re),C(Tt,me.x,mt),C(Pt,me.y,mt),H(wt,-A,Tt,-A,Pt,1,wt),b-=v*(G(O.rA,Tt)+G(N.rA,Pt)),H(Bt,d,Tt,d,Pt,1,Bt),x+=y*(G(O.rB,Tt)+G(N.rB,Pt)),O.normalImpulse=yt.x,N.normalImpulse=yt.y;break}if(yt.x=-O.normalMass*se.x,yt.y=0,rt=0,et=this.v_K.ex.y*yt.x+se.y,yt.x>=0&&et>=0){g(me,yt,Re),C(Tt,me.x,mt),C(Pt,me.y,mt),H(wt,-A,Tt,-A,Pt,1,wt),b-=v*(G(O.rA,Tt)+G(N.rA,Pt)),H(Bt,d,Tt,d,Pt,1,Bt),x+=y*(G(O.rB,Tt)+G(N.rB,Pt)),O.normalImpulse=yt.x,N.normalImpulse=yt.y;break}if(yt.x=0,yt.y=-N.normalMass*se.y,rt=this.v_K.ey.x*yt.y+se.x,et=0,yt.y>=0&&rt>=0){g(me,yt,Re),C(Tt,me.x,mt),C(Pt,me.y,mt),H(wt,-A,Tt,-A,Pt,1,wt),b-=v*(G(O.rA,Tt)+G(N.rA,Pt)),H(Bt,d,Tt,d,Pt,1,Bt),x+=y*(G(O.rB,Tt)+G(N.rB,Pt)),O.normalImpulse=yt.x,N.normalImpulse=yt.y;break}if(yt.x=0,yt.y=0,rt=se.x,et=se.y,rt>=0&&et>=0){g(me,yt,Re),C(Tt,me.x,mt),C(Pt,me.y,mt),H(wt,-A,Tt,-A,Pt,1,wt),b-=v*(G(O.rA,Tt)+G(N.rA,Pt)),H(Bt,d,Tt,d,Pt,1,Bt),x+=y*(G(O.rB,Tt)+G(N.rB,Pt)),O.normalImpulse=yt.x,N.normalImpulse=yt.y;break}break}}o(l.v,wt),l.w=b,o(_.v,Bt),_.w=x}}},s.addType=function(t,e,r){ai[t]=ai[t]||{},ai[t][e]=r},s.create=function(t,e,r,n){var m,l=t.m_shape.m_type,_=r.m_shape.m_type,A=hr.allocate();if(m=ai[l]&&ai[l][_])A.initialize(t,e,r,n,m);else{if(!(m=ai[_]&&ai[_][l]))return null;A.initialize(r,n,t,e,m)}t=A.m_fixtureA,r=A.m_fixtureB,e=A.getChildIndexA(),n=A.getChildIndexB();var v=t.m_body,d=r.m_body;return A.m_nodeA.contact=A,A.m_nodeA.other=d,A.m_nodeA.prev=null,A.m_nodeA.next=v.m_contactList,v.m_contactList!=null&&(v.m_contactList.prev=A.m_nodeA),v.m_contactList=A.m_nodeA,A.m_nodeB.contact=A,A.m_nodeB.other=v,A.m_nodeB.prev=null,A.m_nodeB.next=d.m_contactList,d.m_contactList!=null&&(d.m_contactList.prev=A.m_nodeB),d.m_contactList=A.m_nodeB,t.isSensor()==0&&r.isSensor()==0&&(v.setAwake(!0),d.setAwake(!0)),A},s.destroy=function(t,e){var r=t.m_fixtureA,n=t.m_fixtureB;if(r!==null&&n!==null){var m=r.m_body,l=n.m_body;m!==null&&l!==null&&(t.isTouching()&&e.endContact(t),t.m_nodeA.prev&&(t.m_nodeA.prev.next=t.m_nodeA.next),t.m_nodeA.next&&(t.m_nodeA.next.prev=t.m_nodeA.prev),t.m_nodeA==m.m_contactList&&(m.m_contactList=t.m_nodeA.next),t.m_nodeB.prev&&(t.m_nodeB.prev.next=t.m_nodeB.next),t.m_nodeB.next&&(t.m_nodeB.next.prev=t.m_nodeB.prev),t.m_nodeB==l.m_contactList&&(l.m_contactList=t.m_nodeB.next),t.m_manifold.pointCount>0&&!r.m_isSensor&&!n.m_isSensor&&(m.setAwake(!0),l.setAwake(!0)),hr.release(t))}},s}(),rn={gravity:c.zero(),allowSleep:!0,warmStarting:!0,continuousPhysics:!0,subStepping:!1,blockSolve:!0,velocityIterations:8,positionIterations:3},Li=function(){function s(t){if(!(this instanceof s))return new s(t);this.s_step=new vo,t?c.isValid(t)&&(t={gravity:t}):t={},t=xt(t,rn),this.m_solver=new ar(this),this.m_broadPhase=new uo,this.m_contactList=null,this.m_contactCount=0,this.m_bodyList=null,this.m_bodyCount=0,this.m_jointList=null,this.m_jointCount=0,this.m_stepComplete=!0,this.m_allowSleep=t.allowSleep,this.m_gravity=c.clone(t.gravity),this.m_clearForces=!0,this.m_newFixture=!1,this.m_locked=!1,this.m_warmStarting=t.warmStarting,this.m_continuousPhysics=t.continuousPhysics,this.m_subStepping=t.subStepping,this.m_blockSolve=t.blockSolve,this.m_velocityIterations=t.velocityIterations,this.m_positionIterations=t.positionIterations,this.m_t=0}return s.prototype._serialize=function(){for(var t=[],e=[],r=this.getBodyList();r;r=r.getNext())t.push(r);for(var n=this.getJointList();n;n=n.getNext())typeof n._serialize=="function"&&e.push(n);return{gravity:this.m_gravity,bodies:t,joints:e}},s._deserialize=function(t,e,r){if(!t)return new s;var n=new s(t.gravity);if(t.bodies)for(var m=t.bodies.length-1;m>=0;m-=1)n._addBody(r(ht,t.bodies[m],n));if(t.joints)for(m=t.joints.length-1;m>=0;m--)n.createJoint(r(Ot,t.joints[m],n));return n},s.prototype.getBodyList=function(){return this.m_bodyList},s.prototype.getJointList=function(){return this.m_jointList},s.prototype.getContactList=function(){return this.m_contactList},s.prototype.getBodyCount=function(){return this.m_bodyCount},s.prototype.getJointCount=function(){return this.m_jointCount},s.prototype.getContactCount=function(){return this.m_contactCount},s.prototype.setGravity=function(t){this.m_gravity.set(t)},s.prototype.getGravity=function(){return this.m_gravity},s.prototype.isLocked=function(){return this.m_locked},s.prototype.setAllowSleeping=function(t){if(t!=this.m_allowSleep&&(this.m_allowSleep=t,this.m_allowSleep==0))for(var e=this.m_bodyList;e;e=e.m_next)e.setAwake(!0)},s.prototype.getAllowSleeping=function(){return this.m_allowSleep},s.prototype.setWarmStarting=function(t){this.m_warmStarting=t},s.prototype.getWarmStarting=function(){return this.m_warmStarting},s.prototype.setContinuousPhysics=function(t){this.m_continuousPhysics=t},s.prototype.getContinuousPhysics=function(){return this.m_continuousPhysics},s.prototype.setSubStepping=function(t){this.m_subStepping=t},s.prototype.getSubStepping=function(){return this.m_subStepping},s.prototype.setAutoClearForces=function(t){this.m_clearForces=t},s.prototype.getAutoClearForces=function(){return this.m_clearForces},s.prototype.clearForces=function(){for(var t=this.m_bodyList;t;t=t.getNext())t.m_force.setZero(),t.m_torque=0},s.prototype.queryAABB=function(t,e){var r=this.m_broadPhase;this.m_broadPhase.query(t,function(n){var m=r.getUserData(n);return e(m.fixture)})},s.prototype.rayCast=function(t,e,r){var n=this.m_broadPhase;this.m_broadPhase.rayCast({maxFraction:1,p1:t,p2:e},function(m,l){var _=n.getUserData(l),A=_.fixture,v=_.childIndex,d={};if(A.rayCast(d,m,v)){var y=d.fraction,b=c.add(c.mulNumVec2(1-y,m.p1),c.mulNumVec2(y,m.p2));return r(A,b,d.normal,y)}return m.maxFraction})},s.prototype.getProxyCount=function(){return this.m_broadPhase.getProxyCount()},s.prototype.getTreeHeight=function(){return this.m_broadPhase.getTreeHeight()},s.prototype.getTreeBalance=function(){return this.m_broadPhase.getTreeBalance()},s.prototype.getTreeQuality=function(){return this.m_broadPhase.getTreeQuality()},s.prototype.shiftOrigin=function(t){if(!this.m_locked){for(var e=this.m_bodyList;e;e=e.m_next)e.m_xf.p.sub(t),e.m_sweep.c0.sub(t),e.m_sweep.c.sub(t);for(var r=this.m_jointList;r;r=r.m_next)r.shiftOrigin(t);this.m_broadPhase.shiftOrigin(t)}},s.prototype._addBody=function(t){this.isLocked()||(t.m_prev=null,t.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=t),this.m_bodyList=t,++this.m_bodyCount)},s.prototype.createBody=function(t,e){if(this.isLocked())return null;var r={};t&&(c.isValid(t)?r={position:t,angle:e}:typeof t=="object"&&(r=t));var n=new ht(this,r);return this._addBody(n),n},s.prototype.createDynamicBody=function(t,e){var r={};return t&&(c.isValid(t)?r={position:t,angle:e}:typeof t=="object"&&(r=t)),r.type="dynamic",this.createBody(r)},s.prototype.createKinematicBody=function(t,e){var r={};return t&&(c.isValid(t)?r={position:t,angle:e}:typeof t=="object"&&(r=t)),r.type="kinematic",this.createBody(r)},s.prototype.destroyBody=function(t){if(!this.isLocked()){if(t.m_destroyed)return!1;for(var e=t.m_jointList;e;){var r=e;e=e.next,this.publish("remove-joint",r.joint),this.destroyJoint(r.joint),t.m_jointList=e}t.m_jointList=null;for(var n=t.m_contactList;n;){var m=n;n=n.next,this.destroyContact(m.contact),t.m_contactList=n}t.m_contactList=null;for(var l=t.m_fixtureList;l;){var _=l;l=l.m_next,this.publish("remove-fixture",_),_.destroyProxies(this.m_broadPhase),t.m_fixtureList=l}return t.m_fixtureList=null,t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_bodyList&&(this.m_bodyList=t.m_next),t.m_destroyed=!0,--this.m_bodyCount,this.publish("remove-body",t),!0}},s.prototype.createJoint=function(t){if(this.isLocked())return null;if(t.m_prev=null,t.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=t),this.m_jointList=t,++this.m_jointCount,t.m_edgeA.joint=t,t.m_edgeA.other=t.m_bodyB,t.m_edgeA.prev=null,t.m_edgeA.next=t.m_bodyA.m_jointList,t.m_bodyA.m_jointList&&(t.m_bodyA.m_jointList.prev=t.m_edgeA),t.m_bodyA.m_jointList=t.m_edgeA,t.m_edgeB.joint=t,t.m_edgeB.other=t.m_bodyA,t.m_edgeB.prev=null,t.m_edgeB.next=t.m_bodyB.m_jointList,t.m_bodyB.m_jointList&&(t.m_bodyB.m_jointList.prev=t.m_edgeB),t.m_bodyB.m_jointList=t.m_edgeB,t.m_collideConnected==0)for(var e=t.m_bodyB.getContactList();e;e=e.next)e.other==t.m_bodyA&&e.contact.flagForFiltering();return t},s.prototype.destroyJoint=function(t){if(!this.isLocked()){t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_jointList&&(this.m_jointList=t.m_next);var e=t.m_bodyA,r=t.m_bodyB;if(e.setAwake(!0),r.setAwake(!0),t.m_edgeA.prev&&(t.m_edgeA.prev.next=t.m_edgeA.next),t.m_edgeA.next&&(t.m_edgeA.next.prev=t.m_edgeA.prev),t.m_edgeA==e.m_jointList&&(e.m_jointList=t.m_edgeA.next),t.m_edgeA.prev=null,t.m_edgeA.next=null,t.m_edgeB.prev&&(t.m_edgeB.prev.next=t.m_edgeB.next),t.m_edgeB.next&&(t.m_edgeB.next.prev=t.m_edgeB.prev),t.m_edgeB==r.m_jointList&&(r.m_jointList=t.m_edgeB.next),t.m_edgeB.prev=null,t.m_edgeB.next=null,--this.m_jointCount,t.m_collideConnected==0)for(var n=r.getContactList();n;)n.other==e&&n.contact.flagForFiltering(),n=n.next;this.publish("remove-joint",t)}},s.prototype.step=function(t,e,r){if(this.publish("pre-step",t),(0|e)!==e&&(e=0),e=e||this.m_velocityIterations,r=r||this.m_positionIterations,this.m_newFixture&&(this.findNewContacts(),this.m_newFixture=!1),this.m_locked=!0,this.s_step.reset(t),this.s_step.velocityIterations=e,this.s_step.positionIterations=r,this.s_step.warmStarting=this.m_warmStarting,this.s_step.blockSolve=this.m_blockSolve,this.updateContacts(),this.m_stepComplete&&t>0){this.m_solver.solveWorld(this.s_step);for(var n=this.m_bodyList;n;n=n.getNext())n.m_islandFlag!=0&&(n.isStatic()||n.synchronizeFixtures());this.findNewContacts()}this.m_continuousPhysics&&t>0&&this.m_solver.solveWorldTOI(this.s_step),this.m_clearForces&&this.clearForces(),this.m_locked=!1,this.publish("post-step",t)},s.prototype.findNewContacts=function(){var t=this;this.m_broadPhase.updatePairs(function(e,r){return t.createContact(e,r)})},s.prototype.createContact=function(t,e){var r=t.fixture,n=e.fixture,m=t.childIndex,l=e.childIndex,_=r.getBody(),A=n.getBody();if(_!=A){for(var v=A.getContactList();v;){if(v.other==_){var d=v.contact.getFixtureA(),y=v.contact.getFixtureB(),b=v.contact.getChildIndexA(),x=v.contact.getChildIndexB();if(d==r&&y==n&&b==m&&x==l||d==n&&y==r&&b==l&&x==m)return}v=v.next}if(A.shouldCollide(_)!=0&&n.shouldCollide(r)!=0){var B=ce.create(r,m,n,l);B!=null&&(B.m_prev=null,this.m_contactList!=null&&(B.m_next=this.m_contactList,this.m_contactList.m_prev=B),this.m_contactList=B,++this.m_contactCount)}}},s.prototype.updateContacts=function(){for(var t,e=this.m_contactList;t=e;){e=t.getNext();var r=t.getFixtureA(),n=t.getFixtureB(),m=t.getChildIndexA(),l=t.getChildIndexB(),_=r.getBody(),A=n.getBody();if(t.m_filterFlag){if(A.shouldCollide(_)==0){this.destroyContact(t);continue}if(n.shouldCollide(r)==0){this.destroyContact(t);continue}t.m_filterFlag=!1}var v=_.isAwake()&&!_.isStatic(),d=A.isAwake()&&!A.isStatic();if(v!=0||d!=0){var y=r.m_proxies[m].proxyId,b=n.m_proxies[l].proxyId;this.m_broadPhase.testOverlap(y,b)!=0?t.update(this):this.destroyContact(t)}}},s.prototype.destroyContact=function(t){t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_contactList&&(this.m_contactList=t.m_next),ce.destroy(t,this),--this.m_contactCount},s.prototype.on=function(t,e){return typeof t!="string"||typeof e!="function"||(this._listeners||(this._listeners={}),this._listeners[t]||(this._listeners[t]=[]),this._listeners[t].push(e)),this},s.prototype.off=function(t,e){if(typeof t!="string"||typeof e!="function")return this;var r=this._listeners&&this._listeners[t];if(!r||!r.length)return this;var n=r.indexOf(e);return n>=0&&r.splice(n,1),this},s.prototype.publish=function(t,e,r,n){var m=this._listeners&&this._listeners[t];if(!m||!m.length)return 0;for(var l=0;l<m.length;l++)m[l].call(this,e,r,n);return m.length},s.prototype.beginContact=function(t){this.publish("begin-contact",t)},s.prototype.endContact=function(t){this.publish("end-contact",t)},s.prototype.preSolve=function(t,e){this.publish("pre-solve",t,e)},s.prototype.postSolve=function(t,e){this.publish("post-solve",t,e)},s}(),ot=function(){function s(t,e,r){if(!(this instanceof s))return new s(t,e,r);t===void 0?(this.x=0,this.y=0,this.z=0):typeof t=="object"?(this.x=t.x,this.y=t.y,this.z=t.z):(this.x=t,this.y=e,this.z=r)}return s.prototype._serialize=function(){return{x:this.x,y:this.y,z:this.z}},s._deserialize=function(t){var e=Object.create(s.prototype);return e.x=t.x,e.y=t.y,e.z=t.z,e},s.neo=function(t,e,r){var n=Object.create(s.prototype);return n.x=t,n.y=e,n.z=r,n},s.zero=function(){var t=Object.create(s.prototype);return t.x=0,t.y=0,t.z=0,t},s.clone=function(t){return s.neo(t.x,t.y,t.z)},s.prototype.toString=function(){return JSON.stringify(this)},s.isValid=function(t){return t!=null&&Number.isFinite(t.x)&&Number.isFinite(t.y)&&Number.isFinite(t.z)},s.assert=function(t){},s.prototype.setZero=function(){return this.x=0,this.y=0,this.z=0,this},s.prototype.set=function(t,e,r){return this.x=t,this.y=e,this.z=r,this},s.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},s.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},s.prototype.mul=function(t){return this.x*=t,this.y*=t,this.z*=t,this},s.areEqual=function(t,e){return t===e||typeof t=="object"&&t!==null&&typeof e=="object"&&e!==null&&t.x===e.x&&t.y===e.y&&t.z===e.z},s.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},s.cross=function(t,e){return new s(t.y*e.z-t.z*e.y,t.z*e.x-t.x*e.z,t.x*e.y-t.y*e.x)},s.add=function(t,e){return new s(t.x+e.x,t.y+e.y,t.z+e.z)},s.sub=function(t,e){return new s(t.x-e.x,t.y-e.y,t.z-e.z)},s.mul=function(t,e){return new s(e*t.x,e*t.y,e*t.z)},s.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},s.neg=function(t){return new s(-t.x,-t.y,-t.z)},s}(),lr=P(0,0),mr=P(0,0),de=function(s){function t(e,r){var n=this;return n instanceof t?((n=s.call(this)||this).m_type=t.TYPE,n.m_radius=W.polygonRadius,n.m_vertex1=e?c.clone(e):c.zero(),n.m_vertex2=r?c.clone(r):c.zero(),n.m_vertex0=c.zero(),n.m_vertex3=c.zero(),n.m_hasVertex0=!1,n.m_hasVertex3=!1,n):new t(e,r)}return Y(t,s),t.prototype._serialize=function(){return{type:this.m_type,vertex1:this.m_vertex1,vertex2:this.m_vertex2,vertex0:this.m_vertex0,vertex3:this.m_vertex3,hasVertex0:this.m_hasVertex0,hasVertex3:this.m_hasVertex3}},t._deserialize=function(e){var r=new t(e.vertex1,e.vertex2);return r.m_hasVertex0&&r.setPrevVertex(e.vertex0),r.m_hasVertex3&&r.setNextVertex(e.vertex3),r},t.prototype._reset=function(){},t.prototype.getRadius=function(){return this.m_radius},t.prototype.getType=function(){return this.m_type},t.prototype.setNext=function(e){return this.setNextVertex(e)},t.prototype.setNextVertex=function(e){return e?(this.m_vertex3.setVec2(e),this.m_hasVertex3=!0):(this.m_vertex3.setZero(),this.m_hasVertex3=!1),this},t.prototype.getNextVertex=function(){return this.m_vertex3},t.prototype.setPrev=function(e){return this.setPrevVertex(e)},t.prototype.setPrevVertex=function(e){return e?(this.m_vertex0.setVec2(e),this.m_hasVertex0=!0):(this.m_vertex0.setZero(),this.m_hasVertex0=!1),this},t.prototype.getPrevVertex=function(){return this.m_vertex0},t.prototype._set=function(e,r){return this.m_vertex1.setVec2(e),this.m_vertex2.setVec2(r),this.m_hasVertex0=!1,this.m_hasVertex3=!1,this},t.prototype._clone=function(){var e=new t;return e.m_type=this.m_type,e.m_radius=this.m_radius,e.m_vertex1.setVec2(this.m_vertex1),e.m_vertex2.setVec2(this.m_vertex2),e.m_vertex0.setVec2(this.m_vertex0),e.m_vertex3.setVec2(this.m_vertex3),e.m_hasVertex0=this.m_hasVertex0,e.m_hasVertex3=this.m_hasVertex3,e},t.prototype.getChildCount=function(){return 1},t.prototype.testPoint=function(e,r){return!1},t.prototype.rayCast=function(e,r,n,m){var l=L.mulTVec2(n.q,c.sub(r.p1,n.p)),_=L.mulTVec2(n.q,c.sub(r.p2,n.p)),A=c.sub(_,l),v=this.m_vertex1,d=this.m_vertex2,y=c.sub(d,v),b=c.neo(y.y,-y.x);b.normalize();var x=c.dot(b,c.sub(v,l)),B=c.dot(b,A);if(B==0)return!1;var w=x/B;if(w<0||r.maxFraction<w)return!1;var M=c.add(l,c.mulNumVec2(w,A)),V=c.sub(d,v),z=c.dot(V,V);if(z==0)return!1;var k=c.dot(c.sub(M,v),V)/z;return!(k<0||1<k)&&(e.fraction=w,e.normal=x>0?L.mulVec2(n.q,b).neg():L.mulVec2(n.q,b),!0)},t.prototype.computeAABB=function(e,r,n){K(lr,r,this.m_vertex1),K(mr,r,this.m_vertex2),bt.combinePoints(e,lr,mr),bt.extend(e,this.m_radius)},t.prototype.computeMass=function(e,r){e.mass=0,E(e.center,.5,this.m_vertex1,.5,this.m_vertex2),e.I=0},t.prototype.computeDistanceProxy=function(e){e.m_vertices[0]=this.m_vertex1,e.m_vertices[1]=this.m_vertex2,e.m_vertices.length=2,e.m_count=2,e.m_radius=this.m_radius},t.TYPE="edge",t}(Le),cr=de,ur=P(0,0),_r=P(0,0),mi=function(s){function t(e,r){var n=this;return n instanceof t?((n=s.call(this)||this).m_type=t.TYPE,n.m_radius=W.polygonRadius,n.m_vertices=[],n.m_count=0,n.m_prevVertex=null,n.m_nextVertex=null,n.m_hasPrevVertex=!1,n.m_hasNextVertex=!1,n.m_isLoop=!!r,e&&e.length&&(r?n._createLoop(e):n._createChain(e)),n):new t(e,r)}return Y(t,s),t.prototype._serialize=function(){var e={type:this.m_type,vertices:this.m_vertices,isLoop:this.m_isLoop,hasPrevVertex:this.m_hasPrevVertex,hasNextVertex:this.m_hasNextVertex,prevVertex:null,nextVertex:null};return this.m_prevVertex&&(e.prevVertex=this.m_prevVertex),this.m_nextVertex&&(e.nextVertex=this.m_nextVertex),e},t._deserialize=function(e,r,n){var m=[];if(e.vertices)for(var l=0;l<e.vertices.length;l++)m.push(n(c,e.vertices[l]));var _=new t(m,e.isLoop);return e.prevVertex&&_.setPrevVertex(e.prevVertex),e.nextVertex&&_.setNextVertex(e.nextVertex),_},t.prototype.getType=function(){return this.m_type},t.prototype.getRadius=function(){return this.m_radius},t.prototype._createLoop=function(e){if(!(e.length<3)){for(var r=1;r<e.length;++r)e[r-1],e[r];for(this.m_vertices=[],this.m_count=e.length+1,r=0;r<e.length;++r)this.m_vertices[r]=c.clone(e[r]);return this.m_vertices[e.length]=c.clone(e[0]),this.m_prevVertex=this.m_vertices[this.m_count-2],this.m_nextVertex=this.m_vertices[1],this.m_hasPrevVertex=!0,this.m_hasNextVertex=!0,this}},t.prototype._createChain=function(e){for(var r=1;r<e.length;++r)e[r-1],e[r];for(this.m_count=e.length,r=0;r<e.length;++r)this.m_vertices[r]=c.clone(e[r]);return this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1,this.m_prevVertex=null,this.m_nextVertex=null,this},t.prototype._reset=function(){this.m_isLoop?this._createLoop(this.m_vertices):this._createChain(this.m_vertices)},t.prototype.setPrevVertex=function(e){this.m_prevVertex=e,this.m_hasPrevVertex=!0},t.prototype.getPrevVertex=function(){return this.m_prevVertex},t.prototype.setNextVertex=function(e){this.m_nextVertex=e,this.m_hasNextVertex=!0},t.prototype.getNextVertex=function(){return this.m_nextVertex},t.prototype._clone=function(){var e=new t;return e._createChain(this.m_vertices),e.m_type=this.m_type,e.m_radius=this.m_radius,e.m_prevVertex=this.m_prevVertex,e.m_nextVertex=this.m_nextVertex,e.m_hasPrevVertex=this.m_hasPrevVertex,e.m_hasNextVertex=this.m_hasNextVertex,e},t.prototype.getChildCount=function(){return this.m_count-1},t.prototype.getChildEdge=function(e,r){e.m_type=de.TYPE,e.m_radius=this.m_radius,e.m_vertex1=this.m_vertices[r],e.m_vertex2=this.m_vertices[r+1],r>0?(e.m_vertex0=this.m_vertices[r-1],e.m_hasVertex0=!0):(e.m_vertex0=this.m_prevVertex,e.m_hasVertex0=this.m_hasPrevVertex),r<this.m_count-2?(e.m_vertex3=this.m_vertices[r+2],e.m_hasVertex3=!0):(e.m_vertex3=this.m_nextVertex,e.m_hasVertex3=this.m_hasNextVertex)},t.prototype.getVertex=function(e){return e<this.m_count?this.m_vertices[e]:this.m_vertices[0]},t.prototype.isLoop=function(){return this.m_isLoop},t.prototype.testPoint=function(e,r){return!1},t.prototype.rayCast=function(e,r,n,m){return new de(this.getVertex(m),this.getVertex(m+1)).rayCast(e,r,n,0)},t.prototype.computeAABB=function(e,r,n){K(ur,r,this.getVertex(n)),K(_r,r,this.getVertex(n+1)),bt.combinePoints(e,ur,_r)},t.prototype.computeMass=function(e,r){e.mass=0,h(e.center),e.I=0},t.prototype.computeDistanceProxy=function(e,r){e.m_vertices[0]=this.getVertex(r),e.m_vertices[1]=this.getVertex(r+1),e.m_count=2,e.m_radius=this.m_radius},t.TYPE="chain",t}(Le),pr=mi,dr=Math.max,Mo=Math.min,ci=P(0,0),fr=P(0,0),$i=P(0,0),ki=P(0,0),ui=P(0,0),Ke=P(0,0),fe=function(s){function t(e){var r=this;return r instanceof t?((r=s.call(this)||this).m_type=t.TYPE,r.m_radius=W.polygonRadius,r.m_centroid=c.zero(),r.m_vertices=[],r.m_normals=[],r.m_count=0,e&&e.length&&r._set(e),r):new t(e)}return Y(t,s),t.prototype._serialize=function(){return{type:this.m_type,vertices:this.m_vertices}},t._deserialize=function(e,r,n){var m=[];if(e.vertices)for(var l=0;l<e.vertices.length;l++)m.push(n(c,e.vertices[l]));return new t(m)},t.prototype.getType=function(){return this.m_type},t.prototype.getRadius=function(){return this.m_radius},t.prototype._clone=function(){var e=new t;e.m_type=this.m_type,e.m_radius=this.m_radius,e.m_count=this.m_count,e.m_centroid.setVec2(this.m_centroid);for(var r=0;r<this.m_count;r++)e.m_vertices.push(this.m_vertices[r].clone());for(r=0;r<this.m_normals.length;r++)e.m_normals.push(this.m_normals[r].clone());return e},t.prototype.getChildCount=function(){return 1},t.prototype._reset=function(){this._set(this.m_vertices)},t.prototype._set=function(e){if(e.length<3)this._setAsBox(1,1);else{for(var r=Mo(e.length,W.maxPolygonVertices),n=[],m=0;m<r;++m){for(var l=e[m],_=!0,A=0;A<n.length;++A)if(c.distanceSquared(l,n[A])<.25*W.linearSlopSquared){_=!1;break}_&&n.push(c.clone(l))}if((r=n.length)<3)this._setAsBox(1,1);else{var v=0,d=n[0].x;for(m=1;m<r;++m){var y=n[m].x;(y>d||y===d&&n[m].y<n[v].y)&&(v=m,d=y)}for(var b=[],x=0,B=v;;){b[x]=B;var w=0;for(A=1;A<r;++A)if(w!==B){var M=c.sub(n[w],n[b[x]]),V=(l=c.sub(n[A],n[b[x]]),c.crossVec2Vec2(M,l));V<0&&(w=A),V===0&&l.lengthSquared()>M.lengthSquared()&&(w=A)}else w=A;if(++x,B=w,w===v)break}if(x<3)this._setAsBox(1,1);else{for(this.m_count=x,this.m_vertices=[],m=0;m<x;++m)this.m_vertices[m]=n[b[m]];for(m=0;m<x;++m){var z=m,k=m+1<x?m+1:0,D=c.sub(this.m_vertices[k],this.m_vertices[z]);this.m_normals[m]=c.crossVec2Num(D,1),this.m_normals[m].normalize()}this.m_centroid=function(R,J){for(var O=c.zero(),N=0,rt=c.zero(),et=1/3,st=0;st<J;++st){var ct=rt,at=R[st],dt=st+1<J?R[st+1]:R[0],Wt=c.sub(at,ct),vt=c.sub(dt,ct),oe=.5*c.crossVec2Vec2(Wt,vt);N+=oe,H(ci,1,ct,1,at,1,dt),T(O,oe*et,ci)}return O.mul(1/N),O}(this.m_vertices,x)}}}},t.prototype._setAsBox=function(e,r,n,m){if(this.m_vertices[0]=c.neo(e,-r),this.m_vertices[1]=c.neo(e,r),this.m_vertices[2]=c.neo(-e,r),this.m_vertices[3]=c.neo(-e,-r),this.m_normals[0]=c.neo(1,0),this.m_normals[1]=c.neo(0,1),this.m_normals[2]=c.neo(-1,0),this.m_normals[3]=c.neo(0,-1),this.m_count=4,n&&c.isValid(n)){m=m||0,o(this.m_centroid,n);var l=Nt.identity();l.p.setVec2(n),l.q.setAngle(m);for(var _=0;_<this.m_count;++_)this.m_vertices[_]=Nt.mulVec2(l,this.m_vertices[_]),this.m_normals[_]=L.mulVec2(l.q,this.m_normals[_])}},t.prototype.testPoint=function(e,r){for(var n=ii(ci,e,r),m=0;m<this.m_count;++m)if(j(this.m_normals[m],n)-j(this.m_normals[m],this.m_vertices[m])>0)return!1;return!0},t.prototype.rayCast=function(e,r,n,m){for(var l=L.mulTVec2(n.q,c.sub(r.p1,n.p)),_=L.mulTVec2(n.q,c.sub(r.p2,n.p)),A=c.sub(_,l),v=0,d=r.maxFraction,y=-1,b=0;b<this.m_count;++b){var x=c.dot(this.m_normals[b],c.sub(this.m_vertices[b],l)),B=c.dot(this.m_normals[b],A);if(B==0){if(x<0)return!1}else B<0&&x<v*B?(v=x/B,y=b):B>0&&x<d*B&&(d=x/B);if(d<v)return!1}return y>=0&&(e.fraction=v,e.normal=L.mulVec2(n.q,this.m_normals[y]),!0)},t.prototype.computeAABB=function(e,r,n){for(var m=1/0,l=1/0,_=-1/0,A=-1/0,v=0;v<this.m_count;++v){var d=K(ci,r,this.m_vertices[v]);m=Mo(m,d.x),_=dr(_,d.x),l=Mo(l,d.y),A=dr(A,d.y)}i(e.lowerBound,m-this.m_radius,l-this.m_radius),i(e.upperBound,_+this.m_radius,A+this.m_radius)},t.prototype.computeMass=function(e,r){h(ui);var n=0,m=0;h(Ke);for(var l=0;l<this.m_count;++l)p(Ke,this.m_vertices[l]);C(Ke,1/this.m_count,Ke);var _=1/3;for(l=0;l<this.m_count;++l){g($i,this.m_vertices[l],Ke),l+1<this.m_count?g(ki,this.m_vertices[l+1],Ke):g(ki,this.m_vertices[0],Ke);var A=G($i,ki),v=.5*A;n+=v,E(ci,v*_,$i,v*_,ki),p(ui,ci);var d=$i.x,y=$i.y,b=ki.x,x=ki.y;m+=.25*_*A*(d*d+b*d+b*b+(y*y+x*y+x*x))}e.mass=r*n,C(ui,1/n,ui),function(B,w,M){B.x=w.x+M.x,B.y=w.x+M.y}(e.center,ui,Ke),e.I=r*m,e.I+=e.mass*(j(e.center,e.center)-j(ui,ui))},t.prototype.validate=function(){for(var e=0;e<this.m_count;++e){var r=e,n=e<this.m_count-1?r+1:0,m=this.m_vertices[r];g(fr,this.m_vertices[n],m);for(var l=0;l<this.m_count;++l)if(l!=r&&l!=n&&G(fr,g(ci,this.m_vertices[l],m))<0)return!1}return!0},t.prototype.computeDistanceProxy=function(e){for(var r=0;r<this.m_count;++r)e.m_vertices[r]=this.m_vertices[r];e.m_vertices.length=this.m_count,e.m_count=this.m_count,e.m_radius=this.m_radius},t.TYPE="polygon",t}(Le),kt,yr=fe,nn=Math.sqrt,an=Math.PI,gr=P(0,0),Be=function(s){function t(e,r){var n=this;return n instanceof t?((n=s.call(this)||this).m_type=t.TYPE,n.m_p=c.zero(),n.m_radius=1,typeof e=="object"&&c.isValid(e)?(n.m_p.setVec2(e),typeof r=="number"&&(n.m_radius=r)):typeof e=="number"&&(n.m_radius=e),n):new t(e,r)}return Y(t,s),t.prototype._serialize=function(){return{type:this.m_type,p:this.m_p,radius:this.m_radius}},t._deserialize=function(e){return new t(e.p,e.radius)},t.prototype._reset=function(){},t.prototype.getType=function(){return this.m_type},t.prototype.getRadius=function(){return this.m_radius},t.prototype.getCenter=function(){return this.m_p},t.prototype._clone=function(){var e=new t;return e.m_type=this.m_type,e.m_radius=this.m_radius,e.m_p=this.m_p.clone(),e},t.prototype.getChildCount=function(){return 1},t.prototype.testPoint=function(e,r){return At(r,K(gr,e,this.m_p))<=this.m_radius*this.m_radius},t.prototype.rayCast=function(e,r,n,m){var l=c.add(n.p,L.mulVec2(n.q,this.m_p)),_=c.sub(r.p1,l),A=c.dot(_,_)-this.m_radius*this.m_radius,v=c.sub(r.p2,r.p1),d=c.dot(_,v),y=c.dot(v,v),b=d*d-y*A;if(b<0||y<nt)return!1;var x=-(d+nn(b));return 0<=x&&x<=r.maxFraction*y&&(x/=y,e.fraction=x,e.normal=c.add(_,c.mulNumVec2(x,v)),e.normal.normalize(),!0)},t.prototype.computeAABB=function(e,r,n){var m=K(gr,r,this.m_p);i(e.lowerBound,m.x-this.m_radius,m.y-this.m_radius),i(e.upperBound,m.x+this.m_radius,m.y+this.m_radius)},t.prototype.computeMass=function(e,r){e.mass=r*an*this.m_radius*this.m_radius,o(e.center,this.m_p),e.I=e.mass*(.5*this.m_radius*this.m_radius+tt(this.m_p))},t.prototype.computeDistanceProxy=function(e){e.m_vertices[0]=this.m_p,e.m_vertices.length=1,e.m_count=1,e.m_radius=this.m_radius},t.TYPE="circle",t}(Le),vr=Be,hn=Math.abs,ln=Math.PI,mn={frequencyHz:0,dampingRatio:0},Js=function(s){function t(e,r,n,m,l){var _=this;if(!(_ instanceof t))return new t(e,r,n,m,l);if(n&&m&&"m_type"in m&&"x"in n&&"y"in n){var A=n;n=m,m=A}return e=xt(e,mn),r=(_=s.call(this,e,r,n)||this).m_bodyA,n=_.m_bodyB,_.m_type=t.TYPE,_.m_localAnchorA=c.clone(m?r.getLocalPoint(m):e.localAnchorA||c.zero()),_.m_localAnchorB=c.clone(l?n.getLocalPoint(l):e.localAnchorB||c.zero()),_.m_length=Number.isFinite(e.length)?e.length:c.distance(r.getWorldPoint(_.m_localAnchorA),n.getWorldPoint(_.m_localAnchorB)),_.m_frequencyHz=e.frequencyHz,_.m_dampingRatio=e.dampingRatio,_.m_impulse=0,_.m_gamma=0,_.m_bias=0,_}return Y(t,s),t.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,length:this.m_length,impulse:this.m_impulse,gamma:this.m_gamma,bias:this.m_bias}},t._deserialize=function(e,r,n){return(e=it({},e)).bodyA=n(ht,e.bodyA,r),e.bodyB=n(ht,e.bodyB,r),new t(e)},t.prototype._reset=function(e){e.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(e.anchorA)):e.localAnchorA&&this.m_localAnchorA.setVec2(e.localAnchorA),e.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(e.anchorB)):e.localAnchorB&&this.m_localAnchorB.setVec2(e.localAnchorB),e.length>0?this.m_length=+e.length:e.length<0||(e.anchorA||e.anchorA||e.anchorA||e.anchorA)&&(this.m_length=c.distance(this.m_bodyA.getWorldPoint(this.m_localAnchorA),this.m_bodyB.getWorldPoint(this.m_localAnchorB))),Number.isFinite(e.frequencyHz)&&(this.m_frequencyHz=e.frequencyHz),Number.isFinite(e.dampingRatio)&&(this.m_dampingRatio=e.dampingRatio)},t.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},t.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},t.prototype.setLength=function(e){this.m_length=e},t.prototype.getLength=function(){return this.m_length},t.prototype.setFrequency=function(e){this.m_frequencyHz=e},t.prototype.getFrequency=function(){return this.m_frequencyHz},t.prototype.setDampingRatio=function(e){this.m_dampingRatio=e},t.prototype.getDampingRatio=function(){return this.m_dampingRatio},t.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},t.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},t.prototype.getReactionForce=function(e){return c.mulNumVec2(this.m_impulse,this.m_u).mul(e)},t.prototype.getReactionTorque=function(e){return 0},t.prototype.initVelocityConstraints=function(e){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var r=this.m_bodyA.c_position.c,n=this.m_bodyA.c_position.a,m=this.m_bodyA.c_velocity.v,l=this.m_bodyA.c_velocity.w,_=this.m_bodyB.c_position.c,A=this.m_bodyB.c_position.a,v=this.m_bodyB.c_velocity.v,d=this.m_bodyB.c_velocity.w,y=L.neo(n),b=L.neo(A);this.m_rA=L.mulVec2(y,c.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=L.mulVec2(b,c.sub(this.m_localAnchorB,this.m_localCenterB)),this.m_u=c.sub(c.add(_,this.m_rB),c.add(r,this.m_rA));var x=this.m_u.length();x>W.linearSlop?this.m_u.mul(1/x):this.m_u.setNum(0,0);var B=c.crossVec2Vec2(this.m_rA,this.m_u),w=c.crossVec2Vec2(this.m_rB,this.m_u),M=this.m_invMassA+this.m_invIA*B*B+this.m_invMassB+this.m_invIB*w*w;if(this.m_mass=M!=0?1/M:0,this.m_frequencyHz>0){var V=x-this.m_length,z=2*ln*this.m_frequencyHz,k=2*this.m_mass*this.m_dampingRatio*z,D=this.m_mass*z*z,R=e.dt;this.m_gamma=R*(k+R*D),this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0,this.m_bias=V*R*D*this.m_gamma,M+=this.m_gamma,this.m_mass=M!=0?1/M:0}else this.m_gamma=0,this.m_bias=0;if(e.warmStarting){this.m_impulse*=e.dtRatio;var J=c.mulNumVec2(this.m_impulse,this.m_u);m.subMul(this.m_invMassA,J),l-=this.m_invIA*c.crossVec2Vec2(this.m_rA,J),v.addMul(this.m_invMassB,J),d+=this.m_invIB*c.crossVec2Vec2(this.m_rB,J)}else this.m_impulse=0;this.m_bodyA.c_velocity.v.setVec2(m),this.m_bodyA.c_velocity.w=l,this.m_bodyB.c_velocity.v.setVec2(v),this.m_bodyB.c_velocity.w=d},t.prototype.solveVelocityConstraints=function(e){var r=this.m_bodyA.c_velocity.v,n=this.m_bodyA.c_velocity.w,m=this.m_bodyB.c_velocity.v,l=this.m_bodyB.c_velocity.w,_=c.add(r,c.crossNumVec2(n,this.m_rA)),A=c.add(m,c.crossNumVec2(l,this.m_rB)),v=c.dot(this.m_u,A)-c.dot(this.m_u,_),d=-this.m_mass*(v+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=d;var y=c.mulNumVec2(d,this.m_u);r.subMul(this.m_invMassA,y),n-=this.m_invIA*c.crossVec2Vec2(this.m_rA,y),m.addMul(this.m_invMassB,y),l+=this.m_invIB*c.crossVec2Vec2(this.m_rB,y),this.m_bodyA.c_velocity.v.setVec2(r),this.m_bodyA.c_velocity.w=n,this.m_bodyB.c_velocity.v.setVec2(m),this.m_bodyB.c_velocity.w=l},t.prototype.solvePositionConstraints=function(e){if(this.m_frequencyHz>0)return!0;var r=this.m_bodyA.c_position.c,n=this.m_bodyA.c_position.a,m=this.m_bodyB.c_position.c,l=this.m_bodyB.c_position.a,_=L.neo(n),A=L.neo(l),v=L.mulSub(_,this.m_localAnchorA,this.m_localCenterA),d=L.mulSub(A,this.m_localAnchorB,this.m_localCenterB),y=c.sub(c.add(m,d),c.add(r,v)),b=gt(y.normalize()-this.m_length,-W.maxLinearCorrection,W.maxLinearCorrection),x=-this.m_mass*b,B=c.mulNumVec2(x,y);return r.subMul(this.m_invMassA,B),n-=this.m_invIA*c.crossVec2Vec2(v,B),m.addMul(this.m_invMassB,B),l+=this.m_invIB*c.crossVec2Vec2(d,B),this.m_bodyA.c_position.c.setVec2(r),this.m_bodyA.c_position.a=n,this.m_bodyB.c_position.c.setVec2(m),this.m_bodyB.c_position.a=l,hn(b)<W.linearSlop},t.TYPE="distance-joint",t}(Ot),cn={maxForce:0,maxTorque:0},Ys=function(s){function t(e,r,n,m){var l=this;return l instanceof t?(e=xt(e,cn),r=(l=s.call(this,e,r,n)||this).m_bodyA,n=l.m_bodyB,l.m_type=t.TYPE,l.m_localAnchorA=c.clone(m?r.getLocalPoint(m):e.localAnchorA||c.zero()),l.m_localAnchorB=c.clone(m?n.getLocalPoint(m):e.localAnchorB||c.zero()),l.m_linearImpulse=c.zero(),l.m_angularImpulse=0,l.m_maxForce=e.maxForce,l.m_maxTorque=e.maxTorque,l):new t(e,r,n,m)}return Y(t,s),t.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,maxForce:this.m_maxForce,maxTorque:this.m_maxTorque,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB}},t._deserialize=function(e,r,n){return(e=it({},e)).bodyA=n(ht,e.bodyA,r),e.bodyB=n(ht,e.bodyB,r),new t(e)},t.prototype._reset=function(e){e.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(e.anchorA)):e.localAnchorA&&this.m_localAnchorA.setVec2(e.localAnchorA),e.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(e.anchorB)):e.localAnchorB&&this.m_localAnchorB.setVec2(e.localAnchorB),Number.isFinite(e.maxForce)&&(this.m_maxForce=e.maxForce),Number.isFinite(e.maxTorque)&&(this.m_maxTorque=e.maxTorque)},t.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},t.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},t.prototype.setMaxForce=function(e){this.m_maxForce=e},t.prototype.getMaxForce=function(){return this.m_maxForce},t.prototype.setMaxTorque=function(e){this.m_maxTorque=e},t.prototype.getMaxTorque=function(){return this.m_maxTorque},t.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},t.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},t.prototype.getReactionForce=function(e){return c.mulNumVec2(e,this.m_linearImpulse)},t.prototype.getReactionTorque=function(e){return e*this.m_angularImpulse},t.prototype.initVelocityConstraints=function(e){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var r=this.m_bodyA.c_position.a,n=this.m_bodyA.c_velocity.v,m=this.m_bodyA.c_velocity.w,l=this.m_bodyB.c_position.a,_=this.m_bodyB.c_velocity.v,A=this.m_bodyB.c_velocity.w,v=L.neo(r),d=L.neo(l);this.m_rA=L.mulVec2(v,c.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=L.mulVec2(d,c.sub(this.m_localAnchorB,this.m_localCenterB));var y=this.m_invMassA,b=this.m_invMassB,x=this.m_invIA,B=this.m_invIB,w=new ie;if(w.ex.x=y+b+x*this.m_rA.y*this.m_rA.y+B*this.m_rB.y*this.m_rB.y,w.ex.y=-x*this.m_rA.x*this.m_rA.y-B*this.m_rB.x*this.m_rB.y,w.ey.x=w.ex.y,w.ey.y=y+b+x*this.m_rA.x*this.m_rA.x+B*this.m_rB.x*this.m_rB.x,this.m_linearMass=w.getInverse(),this.m_angularMass=x+B,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),e.warmStarting){this.m_linearImpulse.mul(e.dtRatio),this.m_angularImpulse*=e.dtRatio;var M=c.neo(this.m_linearImpulse.x,this.m_linearImpulse.y);n.subMul(y,M),m-=x*(c.crossVec2Vec2(this.m_rA,M)+this.m_angularImpulse),_.addMul(b,M),A+=B*(c.crossVec2Vec2(this.m_rB,M)+this.m_angularImpulse)}else this.m_linearImpulse.setZero(),this.m_angularImpulse=0;this.m_bodyA.c_velocity.v=n,this.m_bodyA.c_velocity.w=m,this.m_bodyB.c_velocity.v=_,this.m_bodyB.c_velocity.w=A},t.prototype.solveVelocityConstraints=function(e){var r=this.m_bodyA.c_velocity.v,n=this.m_bodyA.c_velocity.w,m=this.m_bodyB.c_velocity.v,l=this.m_bodyB.c_velocity.w,_=this.m_invMassA,A=this.m_invMassB,v=this.m_invIA,d=this.m_invIB,y=e.dt,b=l-n,x=-this.m_angularMass*b,B=this.m_angularImpulse,w=y*this.m_maxTorque;this.m_angularImpulse=gt(this.m_angularImpulse+x,-w,w),n-=v*(x=this.m_angularImpulse-B),l+=d*x,b=c.sub(c.add(m,c.crossNumVec2(l,this.m_rB)),c.add(r,c.crossNumVec2(n,this.m_rA))),x=c.neg(ie.mulVec2(this.m_linearMass,b)),B=this.m_linearImpulse,this.m_linearImpulse.add(x),w=y*this.m_maxForce,this.m_linearImpulse.lengthSquared()>w*w&&(this.m_linearImpulse.normalize(),this.m_linearImpulse.mul(w)),x=c.sub(this.m_linearImpulse,B),r.subMul(_,x),n-=v*c.crossVec2Vec2(this.m_rA,x),m.addMul(A,x),l+=d*c.crossVec2Vec2(this.m_rB,x),this.m_bodyA.c_velocity.v=r,this.m_bodyA.c_velocity.w=n,this.m_bodyB.c_velocity.v=m,this.m_bodyB.c_velocity.w=l},t.prototype.solvePositionConstraints=function(e){return!0},t.TYPE="friction-joint",t}(Ot),Se=function(){function s(t,e,r){typeof t=="object"&&t!==null?(this.ex=ot.clone(t),this.ey=ot.clone(e),this.ez=ot.clone(r)):(this.ex=ot.zero(),this.ey=ot.zero(),this.ez=ot.zero())}return s.prototype.toString=function(){return JSON.stringify(this)},s.isValid=function(t){return t!=null&&ot.isValid(t.ex)&&ot.isValid(t.ey)&&ot.isValid(t.ez)},s.assert=function(t){},s.prototype.setZero=function(){return this.ex.setZero(),this.ey.setZero(),this.ez.setZero(),this},s.prototype.solve33=function(t){var e=this.ey.y*this.ez.z-this.ey.z*this.ez.y,r=this.ey.z*this.ez.x-this.ey.x*this.ez.z,n=this.ey.x*this.ez.y-this.ey.y*this.ez.x,m=this.ex.x*e+this.ex.y*r+this.ex.z*n;m!==0&&(m=1/m);var l=new ot;return e=this.ey.y*this.ez.z-this.ey.z*this.ez.y,r=this.ey.z*this.ez.x-this.ey.x*this.ez.z,n=this.ey.x*this.ez.y-this.ey.y*this.ez.x,l.x=m*(t.x*e+t.y*r+t.z*n),e=t.y*this.ez.z-t.z*this.ez.y,r=t.z*this.ez.x-t.x*this.ez.z,n=t.x*this.ez.y-t.y*this.ez.x,l.y=m*(this.ex.x*e+this.ex.y*r+this.ex.z*n),e=this.ey.y*t.z-this.ey.z*t.y,r=this.ey.z*t.x-this.ey.x*t.z,n=this.ey.x*t.y-this.ey.y*t.x,l.z=m*(this.ex.x*e+this.ex.y*r+this.ex.z*n),l},s.prototype.solve22=function(t){var e=this.ex.x,r=this.ey.x,n=this.ex.y,m=this.ey.y,l=e*m-r*n;l!==0&&(l=1/l);var _=c.zero();return _.x=l*(m*t.x-r*t.y),_.y=l*(e*t.y-n*t.x),_},s.prototype.getInverse22=function(t){var e=this.ex.x,r=this.ey.x,n=this.ex.y,m=this.ey.y,l=e*m-r*n;l!==0&&(l=1/l),t.ex.x=l*m,t.ey.x=-l*r,t.ex.z=0,t.ex.y=-l*n,t.ey.y=l*e,t.ey.z=0,t.ez.x=0,t.ez.y=0,t.ez.z=0},s.prototype.getSymInverse33=function(t){var e=ot.dot(this.ex,ot.cross(this.ey,this.ez));e!==0&&(e=1/e);var r=this.ex.x,n=this.ey.x,m=this.ez.x,l=this.ey.y,_=this.ez.y,A=this.ez.z;t.ex.x=e*(l*A-_*_),t.ex.y=e*(m*_-n*A),t.ex.z=e*(n*_-m*l),t.ey.x=t.ex.y,t.ey.y=e*(r*A-m*m),t.ey.z=e*(m*n-r*_),t.ez.x=t.ex.z,t.ez.y=t.ey.z,t.ez.z=e*(r*l-n*n)},s.mul=function(t,e){if(e&&"z"in e&&"y"in e&&"x"in e){var r=t.ex.x*e.x+t.ey.x*e.y+t.ez.x*e.z,n=t.ex.y*e.x+t.ey.y*e.y+t.ez.y*e.z,m=t.ex.z*e.x+t.ey.z*e.y+t.ez.z*e.z;return new ot(r,n,m)}if(e&&"y"in e&&"x"in e)return r=t.ex.x*e.x+t.ey.x*e.y,n=t.ex.y*e.x+t.ey.y*e.y,c.neo(r,n)},s.mulVec3=function(t,e){var r=t.ex.x*e.x+t.ey.x*e.y+t.ez.x*e.z,n=t.ex.y*e.x+t.ey.y*e.y+t.ez.y*e.z,m=t.ex.z*e.x+t.ey.z*e.y+t.ez.z*e.z;return new ot(r,n,m)},s.mulVec2=function(t,e){var r=t.ex.x*e.x+t.ey.x*e.y,n=t.ex.y*e.x+t.ey.y*e.y;return c.neo(r,n)},s.add=function(t,e){return new s(ot.add(t.ex,e.ex),ot.add(t.ey,e.ey),ot.add(t.ez,e.ez))},s}(),xr=Math.abs;(function(s){s[s.inactiveLimit=0]="inactiveLimit",s[s.atLowerLimit=1]="atLowerLimit",s[s.atUpperLimit=2]="atUpperLimit",s[s.equalLimits=3]="equalLimits"})(kt||(kt={}));var Qt,un=0,_n=0,pn=0,dn=0,fn=!1,yn=!1,Ce=function(s){function t(e,r,n,m){var l,_,A,v,d,y,b=this;return b instanceof t?(e=e??{},r=(b=s.call(this,e,r,n)||this).m_bodyA,n=b.m_bodyB,b.m_mass=new Se,b.m_limitState=kt.inactiveLimit,b.m_type=t.TYPE,c.isValid(m)?b.m_localAnchorA=r.getLocalPoint(m):c.isValid(e.localAnchorA)?b.m_localAnchorA=c.clone(e.localAnchorA):b.m_localAnchorA=c.zero(),c.isValid(m)?b.m_localAnchorB=n.getLocalPoint(m):c.isValid(e.localAnchorB)?b.m_localAnchorB=c.clone(e.localAnchorB):b.m_localAnchorB=c.zero(),Number.isFinite(e.referenceAngle)?b.m_referenceAngle=e.referenceAngle:b.m_referenceAngle=n.getAngle()-r.getAngle(),b.m_impulse=new ot,b.m_motorImpulse=0,b.m_lowerAngle=(l=e.lowerAngle)!==null&&l!==void 0?l:un,b.m_upperAngle=(_=e.upperAngle)!==null&&_!==void 0?_:_n,b.m_maxMotorTorque=(A=e.maxMotorTorque)!==null&&A!==void 0?A:pn,b.m_motorSpeed=(v=e.motorSpeed)!==null&&v!==void 0?v:dn,b.m_enableLimit=(d=e.enableLimit)!==null&&d!==void 0?d:fn,b.m_enableMotor=(y=e.enableMotor)!==null&&y!==void 0?y:yn,b):new t(e,r,n,m)}return Y(t,s),t.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,lowerAngle:this.m_lowerAngle,upperAngle:this.m_upperAngle,maxMotorTorque:this.m_maxMotorTorque,motorSpeed:this.m_motorSpeed,enableLimit:this.m_enableLimit,enableMotor:this.m_enableMotor,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,referenceAngle:this.m_referenceAngle}},t._deserialize=function(e,r,n){return(e=it({},e)).bodyA=n(ht,e.bodyA,r),e.bodyB=n(ht,e.bodyB,r),new t(e)},t.prototype._reset=function(e){e.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(e.anchorA)):e.localAnchorA&&this.m_localAnchorA.setVec2(e.localAnchorA),e.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(e.anchorB)):e.localAnchorB&&this.m_localAnchorB.setVec2(e.localAnchorB),Number.isFinite(e.referenceAngle)&&(this.m_referenceAngle=e.referenceAngle),e.enableLimit!==void 0&&(this.m_enableLimit=e.enableLimit),Number.isFinite(e.lowerAngle)&&(this.m_lowerAngle=e.lowerAngle),Number.isFinite(e.upperAngle)&&(this.m_upperAngle=e.upperAngle),Number.isFinite(e.maxMotorTorque)&&(this.m_maxMotorTorque=e.maxMotorTorque),Number.isFinite(e.motorSpeed)&&(this.m_motorSpeed=e.motorSpeed),e.enableMotor!==void 0&&(this.m_enableMotor=e.enableMotor)},t.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},t.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},t.prototype.getReferenceAngle=function(){return this.m_referenceAngle},t.prototype.getJointAngle=function(){var e=this.m_bodyA;return this.m_bodyB.m_sweep.a-e.m_sweep.a-this.m_referenceAngle},t.prototype.getJointSpeed=function(){var e=this.m_bodyA;return this.m_bodyB.m_angularVelocity-e.m_angularVelocity},t.prototype.isMotorEnabled=function(){return this.m_enableMotor},t.prototype.enableMotor=function(e){e!=this.m_enableMotor&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=e)},t.prototype.getMotorTorque=function(e){return e*this.m_motorImpulse},t.prototype.setMotorSpeed=function(e){e!=this.m_motorSpeed&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=e)},t.prototype.getMotorSpeed=function(){return this.m_motorSpeed},t.prototype.setMaxMotorTorque=function(e){e!=this.m_maxMotorTorque&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorTorque=e)},t.prototype.getMaxMotorTorque=function(){return this.m_maxMotorTorque},t.prototype.isLimitEnabled=function(){return this.m_enableLimit},t.prototype.enableLimit=function(e){e!=this.m_enableLimit&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableLimit=e,this.m_impulse.z=0)},t.prototype.getLowerLimit=function(){return this.m_lowerAngle},t.prototype.getUpperLimit=function(){return this.m_upperAngle},t.prototype.setLimits=function(e,r){e==this.m_lowerAngle&&r==this.m_upperAngle||(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_impulse.z=0,this.m_lowerAngle=e,this.m_upperAngle=r)},t.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},t.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},t.prototype.getReactionForce=function(e){return c.neo(this.m_impulse.x,this.m_impulse.y).mul(e)},t.prototype.getReactionTorque=function(e){return e*this.m_impulse.z},t.prototype.initVelocityConstraints=function(e){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var r=this.m_bodyA.c_position.a,n=this.m_bodyA.c_velocity.v,m=this.m_bodyA.c_velocity.w,l=this.m_bodyB.c_position.a,_=this.m_bodyB.c_velocity.v,A=this.m_bodyB.c_velocity.w,v=L.neo(r),d=L.neo(l);this.m_rA=L.mulVec2(v,c.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=L.mulVec2(d,c.sub(this.m_localAnchorB,this.m_localCenterB));var y=this.m_invMassA,b=this.m_invMassB,x=this.m_invIA,B=this.m_invIB,w=x+B===0;if(this.m_mass.ex.x=y+b+this.m_rA.y*this.m_rA.y*x+this.m_rB.y*this.m_rB.y*B,this.m_mass.ey.x=-this.m_rA.y*this.m_rA.x*x-this.m_rB.y*this.m_rB.x*B,this.m_mass.ez.x=-this.m_rA.y*x-this.m_rB.y*B,this.m_mass.ex.y=this.m_mass.ey.x,this.m_mass.ey.y=y+b+this.m_rA.x*this.m_rA.x*x+this.m_rB.x*this.m_rB.x*B,this.m_mass.ez.y=this.m_rA.x*x+this.m_rB.x*B,this.m_mass.ex.z=this.m_mass.ez.x,this.m_mass.ey.z=this.m_mass.ez.y,this.m_mass.ez.z=x+B,this.m_motorMass=x+B,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),(this.m_enableMotor==0||w)&&(this.m_motorImpulse=0),this.m_enableLimit&&w==0){var M=l-r-this.m_referenceAngle;xr(this.m_upperAngle-this.m_lowerAngle)<2*W.angularSlop?this.m_limitState=kt.equalLimits:M<=this.m_lowerAngle?(this.m_limitState!=kt.atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=kt.atLowerLimit):M>=this.m_upperAngle?(this.m_limitState!=kt.atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=kt.atUpperLimit):(this.m_limitState=kt.inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=kt.inactiveLimit;if(e.warmStarting){this.m_impulse.mul(e.dtRatio),this.m_motorImpulse*=e.dtRatio;var V=c.neo(this.m_impulse.x,this.m_impulse.y);n.subMul(y,V),m-=x*(c.crossVec2Vec2(this.m_rA,V)+this.m_motorImpulse+this.m_impulse.z),_.addMul(b,V),A+=B*(c.crossVec2Vec2(this.m_rB,V)+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.setZero(),this.m_motorImpulse=0;this.m_bodyA.c_velocity.v=n,this.m_bodyA.c_velocity.w=m,this.m_bodyB.c_velocity.v=_,this.m_bodyB.c_velocity.w=A},t.prototype.solveVelocityConstraints=function(e){var r=this.m_bodyA.c_velocity.v,n=this.m_bodyA.c_velocity.w,m=this.m_bodyB.c_velocity.v,l=this.m_bodyB.c_velocity.w,_=this.m_invMassA,A=this.m_invMassB,v=this.m_invIA,d=this.m_invIB,y=v+d===0;if(this.m_enableMotor&&this.m_limitState!=kt.equalLimits&&y==0){var b=l-n-this.m_motorSpeed,x=-this.m_motorMass*b,B=this.m_motorImpulse,w=e.dt*this.m_maxMotorTorque;this.m_motorImpulse=gt(this.m_motorImpulse+x,-w,w),n-=v*(x=this.m_motorImpulse-B),l+=d*x}if(this.m_enableLimit&&this.m_limitState!=kt.inactiveLimit&&y==0){var M=c.zero();M.addCombine(1,m,1,c.crossNumVec2(l,this.m_rB)),M.subCombine(1,r,1,c.crossNumVec2(n,this.m_rA));var V=l-n;if(b=new ot(M.x,M.y,V),x=ot.neg(this.m_mass.solve33(b)),this.m_limitState==kt.equalLimits)this.m_impulse.add(x);else if(this.m_limitState==kt.atLowerLimit)if(this.m_impulse.z+x.z<0){var z=c.combine(-1,M,this.m_impulse.z,c.neo(this.m_mass.ez.x,this.m_mass.ez.y)),k=this.m_mass.solve22(z);x.x=k.x,x.y=k.y,x.z=-this.m_impulse.z,this.m_impulse.x+=k.x,this.m_impulse.y+=k.y,this.m_impulse.z=0}else this.m_impulse.add(x);else this.m_limitState==kt.atUpperLimit&&(this.m_impulse.z+x.z>0?(z=c.combine(-1,M,this.m_impulse.z,c.neo(this.m_mass.ez.x,this.m_mass.ez.y)),k=this.m_mass.solve22(z),x.x=k.x,x.y=k.y,x.z=-this.m_impulse.z,this.m_impulse.x+=k.x,this.m_impulse.y+=k.y,this.m_impulse.z=0):this.m_impulse.add(x));var D=c.neo(x.x,x.y);r.subMul(_,D),n-=v*(c.crossVec2Vec2(this.m_rA,D)+x.z),m.addMul(A,D),l+=d*(c.crossVec2Vec2(this.m_rB,D)+x.z)}else(b=c.zero()).addCombine(1,m,1,c.crossNumVec2(l,this.m_rB)),b.subCombine(1,r,1,c.crossNumVec2(n,this.m_rA)),x=this.m_mass.solve22(c.neg(b)),this.m_impulse.x+=x.x,this.m_impulse.y+=x.y,r.subMul(_,x),n-=v*c.crossVec2Vec2(this.m_rA,x),m.addMul(A,x),l+=d*c.crossVec2Vec2(this.m_rB,x);this.m_bodyA.c_velocity.v=r,this.m_bodyA.c_velocity.w=n,this.m_bodyB.c_velocity.v=m,this.m_bodyB.c_velocity.w=l},t.prototype.solvePositionConstraints=function(e){var r,n=this.m_bodyA.c_position.c,m=this.m_bodyA.c_position.a,l=this.m_bodyB.c_position.c,_=this.m_bodyB.c_position.a,A=L.neo(m),v=L.neo(_),d=0,y=this.m_invIA+this.m_invIB==0;if(this.m_enableLimit&&this.m_limitState!=kt.inactiveLimit&&y==0){var b=_-m-this.m_referenceAngle,x=0;if(this.m_limitState==kt.equalLimits){var B=gt(b-this.m_lowerAngle,-W.maxAngularCorrection,W.maxAngularCorrection);x=-this.m_motorMass*B,d=xr(B)}else this.m_limitState==kt.atLowerLimit?(d=-(B=b-this.m_lowerAngle),B=gt(B+W.angularSlop,-W.maxAngularCorrection,0),x=-this.m_motorMass*B):this.m_limitState==kt.atUpperLimit&&(d=B=b-this.m_upperAngle,B=gt(B-W.angularSlop,0,W.maxAngularCorrection),x=-this.m_motorMass*B);m-=this.m_invIA*x,_+=this.m_invIB*x}A.setAngle(m),v.setAngle(_);var w=L.mulVec2(A,c.sub(this.m_localAnchorA,this.m_localCenterA)),M=L.mulVec2(v,c.sub(this.m_localAnchorB,this.m_localCenterB));(B=c.zero()).addCombine(1,l,1,M),B.subCombine(1,n,1,w),r=B.length();var V=this.m_invMassA,z=this.m_invMassB,k=this.m_invIA,D=this.m_invIB,R=new ie;R.ex.x=V+z+k*w.y*w.y+D*M.y*M.y,R.ex.y=-k*w.x*w.y-D*M.x*M.y,R.ey.x=R.ex.y,R.ey.y=V+z+k*w.x*w.x+D*M.x*M.x;var J=c.neg(R.solve(B));return n.subMul(V,J),m-=k*c.crossVec2Vec2(w,J),l.addMul(z,J),_+=D*c.crossVec2Vec2(M,J),this.m_bodyA.c_position.c.setVec2(n),this.m_bodyA.c_position.a=m,this.m_bodyB.c_position.c.setVec2(l),this.m_bodyB.c_position.a=_,r<=W.linearSlop&&d<=W.angularSlop},t.TYPE="revolute-joint",t}(Ot),ts=Math.abs,br=Math.max,gn=Math.min;(function(s){s[s.inactiveLimit=0]="inactiveLimit",s[s.atLowerLimit=1]="atLowerLimit",s[s.atUpperLimit=2]="atUpperLimit",s[s.equalLimits=3]="equalLimits"})(Qt||(Qt={}));var es,vn={enableLimit:!1,lowerTranslation:0,upperTranslation:0,enableMotor:!1,maxMotorForce:0,motorSpeed:0},Gs=function(s){function t(e,r,n,m,l){var _=this;return _ instanceof t?(e=xt(e,vn),r=(_=s.call(this,e,r,n)||this).m_bodyA,n=_.m_bodyB,_.m_type=t.TYPE,_.m_localAnchorA=c.clone(m?r.getLocalPoint(m):e.localAnchorA||c.zero()),_.m_localAnchorB=c.clone(m?n.getLocalPoint(m):e.localAnchorB||c.zero()),_.m_localXAxisA=c.clone(l?r.getLocalVector(l):e.localAxisA||c.neo(1,0)),_.m_localXAxisA.normalize(),_.m_localYAxisA=c.crossNumVec2(1,_.m_localXAxisA),_.m_referenceAngle=Number.isFinite(e.referenceAngle)?e.referenceAngle:n.getAngle()-r.getAngle(),_.m_impulse=new ot,_.m_motorMass=0,_.m_motorImpulse=0,_.m_lowerTranslation=e.lowerTranslation,_.m_upperTranslation=e.upperTranslation,_.m_maxMotorForce=e.maxMotorForce,_.m_motorSpeed=e.motorSpeed,_.m_enableLimit=e.enableLimit,_.m_enableMotor=e.enableMotor,_.m_limitState=Qt.inactiveLimit,_.m_axis=c.zero(),_.m_perp=c.zero(),_.m_K=new Se,_):new t(e,r,n,m,l)}return Y(t,s),t.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,lowerTranslation:this.m_lowerTranslation,upperTranslation:this.m_upperTranslation,maxMotorForce:this.m_maxMotorForce,motorSpeed:this.m_motorSpeed,enableLimit:this.m_enableLimit,enableMotor:this.m_enableMotor,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,localAxisA:this.m_localXAxisA,referenceAngle:this.m_referenceAngle}},t._deserialize=function(e,r,n){return(e=it({},e)).bodyA=n(ht,e.bodyA,r),e.bodyB=n(ht,e.bodyB,r),e.localAxisA=c.clone(e.localAxisA),new t(e)},t.prototype._reset=function(e){e.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(e.anchorA)):e.localAnchorA&&this.m_localAnchorA.setVec2(e.localAnchorA),e.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(e.anchorB)):e.localAnchorB&&this.m_localAnchorB.setVec2(e.localAnchorB),e.localAxisA&&(this.m_localXAxisA.setVec2(e.localAxisA),this.m_localYAxisA.setVec2(c.crossNumVec2(1,e.localAxisA))),Number.isFinite(e.referenceAngle)&&(this.m_referenceAngle=e.referenceAngle),e.enableLimit!==void 0&&(this.m_enableLimit=!!e.enableLimit),Number.isFinite(e.lowerTranslation)&&(this.m_lowerTranslation=e.lowerTranslation),Number.isFinite(e.upperTranslation)&&(this.m_upperTranslation=e.upperTranslation),e.enableMotor!==void 0&&(this.m_enableMotor=!!e.enableMotor),Number.isFinite(e.maxMotorForce)&&(this.m_maxMotorForce=e.maxMotorForce),Number.isFinite(e.motorSpeed)&&(this.m_motorSpeed=e.motorSpeed)},t.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},t.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},t.prototype.getLocalAxisA=function(){return this.m_localXAxisA},t.prototype.getReferenceAngle=function(){return this.m_referenceAngle},t.prototype.getJointTranslation=function(){var e=this.m_bodyA.getWorldPoint(this.m_localAnchorA),r=this.m_bodyB.getWorldPoint(this.m_localAnchorB),n=c.sub(r,e),m=this.m_bodyA.getWorldVector(this.m_localXAxisA);return c.dot(n,m)},t.prototype.getJointSpeed=function(){var e=this.m_bodyA,r=this.m_bodyB,n=L.mulVec2(e.m_xf.q,c.sub(this.m_localAnchorA,e.m_sweep.localCenter)),m=L.mulVec2(r.m_xf.q,c.sub(this.m_localAnchorB,r.m_sweep.localCenter)),l=c.add(e.m_sweep.c,n),_=c.add(r.m_sweep.c,m),A=c.sub(_,l),v=L.mulVec2(e.m_xf.q,this.m_localXAxisA),d=e.m_linearVelocity,y=r.m_linearVelocity,b=e.m_angularVelocity,x=r.m_angularVelocity;return c.dot(A,c.crossNumVec2(b,v))+c.dot(v,c.sub(c.addCrossNumVec2(y,x,m),c.addCrossNumVec2(d,b,n)))},t.prototype.isLimitEnabled=function(){return this.m_enableLimit},t.prototype.enableLimit=function(e){e!=this.m_enableLimit&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableLimit=e,this.m_impulse.z=0)},t.prototype.getLowerLimit=function(){return this.m_lowerTranslation},t.prototype.getUpperLimit=function(){return this.m_upperTranslation},t.prototype.setLimits=function(e,r){e==this.m_lowerTranslation&&r==this.m_upperTranslation||(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_lowerTranslation=e,this.m_upperTranslation=r,this.m_impulse.z=0)},t.prototype.isMotorEnabled=function(){return this.m_enableMotor},t.prototype.enableMotor=function(e){e!=this.m_enableMotor&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=e)},t.prototype.setMotorSpeed=function(e){e!=this.m_motorSpeed&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=e)},t.prototype.setMaxMotorForce=function(e){e!=this.m_maxMotorForce&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorForce=e)},t.prototype.getMaxMotorForce=function(){return this.m_maxMotorForce},t.prototype.getMotorSpeed=function(){return this.m_motorSpeed},t.prototype.getMotorForce=function(e){return e*this.m_motorImpulse},t.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},t.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},t.prototype.getReactionForce=function(e){return c.combine(this.m_impulse.x,this.m_perp,this.m_motorImpulse+this.m_impulse.z,this.m_axis).mul(e)},t.prototype.getReactionTorque=function(e){return e*this.m_impulse.y},t.prototype.initVelocityConstraints=function(e){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var r=this.m_bodyA.c_position.c,n=this.m_bodyA.c_position.a,m=this.m_bodyA.c_velocity.v,l=this.m_bodyA.c_velocity.w,_=this.m_bodyB.c_position.c,A=this.m_bodyB.c_position.a,v=this.m_bodyB.c_velocity.v,d=this.m_bodyB.c_velocity.w,y=L.neo(n),b=L.neo(A),x=L.mulVec2(y,c.sub(this.m_localAnchorA,this.m_localCenterA)),B=L.mulVec2(b,c.sub(this.m_localAnchorB,this.m_localCenterB)),w=c.zero();w.addCombine(1,_,1,B),w.subCombine(1,r,1,x);var M=this.m_invMassA,V=this.m_invMassB,z=this.m_invIA,k=this.m_invIB;this.m_axis=L.mulVec2(y,this.m_localXAxisA),this.m_a1=c.crossVec2Vec2(c.add(w,x),this.m_axis),this.m_a2=c.crossVec2Vec2(B,this.m_axis),this.m_motorMass=M+V+z*this.m_a1*this.m_a1+k*this.m_a2*this.m_a2,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),this.m_perp=L.mulVec2(y,this.m_localYAxisA),this.m_s1=c.crossVec2Vec2(c.add(w,x),this.m_perp),this.m_s2=c.crossVec2Vec2(B,this.m_perp),c.crossVec2Vec2(x,this.m_perp);var D=M+V+z*this.m_s1*this.m_s1+k*this.m_s2*this.m_s2,R=z*this.m_s1+k*this.m_s2,J=z*this.m_s1*this.m_a1+k*this.m_s2*this.m_a2,O=z+k;O==0&&(O=1);var N=z*this.m_a1+k*this.m_a2,rt=M+V+z*this.m_a1*this.m_a1+k*this.m_a2*this.m_a2;if(this.m_K.ex.set(D,R,J),this.m_K.ey.set(R,O,N),this.m_K.ez.set(J,N,rt),this.m_enableLimit){var et=c.dot(this.m_axis,w);ts(this.m_upperTranslation-this.m_lowerTranslation)<2*W.linearSlop?this.m_limitState=Qt.equalLimits:et<=this.m_lowerTranslation?this.m_limitState!=Qt.atLowerLimit&&(this.m_limitState=Qt.atLowerLimit,this.m_impulse.z=0):et>=this.m_upperTranslation?this.m_limitState!=Qt.atUpperLimit&&(this.m_limitState=Qt.atUpperLimit,this.m_impulse.z=0):(this.m_limitState=Qt.inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=Qt.inactiveLimit,this.m_impulse.z=0;if(this.m_enableMotor==0&&(this.m_motorImpulse=0),e.warmStarting){this.m_impulse.mul(e.dtRatio),this.m_motorImpulse*=e.dtRatio;var st=c.combine(this.m_impulse.x,this.m_perp,this.m_motorImpulse+this.m_impulse.z,this.m_axis),ct=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,at=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;m.subMul(M,st),l-=z*ct,v.addMul(V,st),d+=k*at}else this.m_impulse.setZero(),this.m_motorImpulse=0;this.m_bodyA.c_velocity.v.setVec2(m),this.m_bodyA.c_velocity.w=l,this.m_bodyB.c_velocity.v.setVec2(v),this.m_bodyB.c_velocity.w=d},t.prototype.solveVelocityConstraints=function(e){var r=this.m_bodyA.c_velocity.v,n=this.m_bodyA.c_velocity.w,m=this.m_bodyB.c_velocity.v,l=this.m_bodyB.c_velocity.w,_=this.m_invMassA,A=this.m_invMassB,v=this.m_invIA,d=this.m_invIB;if(this.m_enableMotor&&this.m_limitState!=Qt.equalLimits){var y=c.dot(this.m_axis,c.sub(m,r))+this.m_a2*l-this.m_a1*n,b=this.m_motorMass*(this.m_motorSpeed-y),x=this.m_motorImpulse,B=e.dt*this.m_maxMotorForce;this.m_motorImpulse=gt(this.m_motorImpulse+b,-B,B),b=this.m_motorImpulse-x;var w=c.mulNumVec2(b,this.m_axis),M=b*this.m_a1,V=b*this.m_a2;r.subMul(_,w),n-=v*M,m.addMul(A,w),l+=d*V}var z=c.zero();if(z.x+=c.dot(this.m_perp,m)+this.m_s2*l,z.x-=c.dot(this.m_perp,r)+this.m_s1*n,z.y=l-n,this.m_enableLimit&&this.m_limitState!=Qt.inactiveLimit){var k=0;k+=c.dot(this.m_axis,m)+this.m_a2*l,k-=c.dot(this.m_axis,r)+this.m_a1*n,y=new ot(z.x,z.y,k);var D=ot.clone(this.m_impulse),R=this.m_K.solve33(ot.neg(y));this.m_impulse.add(R),this.m_limitState==Qt.atLowerLimit?this.m_impulse.z=br(this.m_impulse.z,0):this.m_limitState==Qt.atUpperLimit&&(this.m_impulse.z=gn(this.m_impulse.z,0));var J=c.combine(-1,z,-(this.m_impulse.z-D.z),c.neo(this.m_K.ez.x,this.m_K.ez.y)),O=c.add(this.m_K.solve22(J),c.neo(D.x,D.y));this.m_impulse.x=O.x,this.m_impulse.y=O.y,R=ot.sub(this.m_impulse,D),w=c.combine(R.x,this.m_perp,R.z,this.m_axis),M=R.x*this.m_s1+R.y+R.z*this.m_a1,V=R.x*this.m_s2+R.y+R.z*this.m_a2,r.subMul(_,w),n-=v*M,m.addMul(A,w),l+=d*V}else R=this.m_K.solve22(c.neg(z)),this.m_impulse.x+=R.x,this.m_impulse.y+=R.y,w=c.mulNumVec2(R.x,this.m_perp),M=R.x*this.m_s1+R.y,V=R.x*this.m_s2+R.y,r.subMul(_,w),n-=v*M,m.addMul(A,w),l+=d*V;this.m_bodyA.c_velocity.v=r,this.m_bodyA.c_velocity.w=n,this.m_bodyB.c_velocity.v=m,this.m_bodyB.c_velocity.w=l},t.prototype.solvePositionConstraints=function(e){var r=this.m_bodyA.c_position.c,n=this.m_bodyA.c_position.a,m=this.m_bodyB.c_position.c,l=this.m_bodyB.c_position.a,_=L.neo(n),A=L.neo(l),v=this.m_invMassA,d=this.m_invMassB,y=this.m_invIA,b=this.m_invIB,x=L.mulVec2(_,c.sub(this.m_localAnchorA,this.m_localCenterA)),B=L.mulVec2(A,c.sub(this.m_localAnchorB,this.m_localCenterB)),w=c.sub(c.add(m,B),c.add(r,x)),M=L.mulVec2(_,this.m_localXAxisA),V=c.crossVec2Vec2(c.add(w,x),M),z=c.crossVec2Vec2(B,M),k=L.mulVec2(_,this.m_localYAxisA),D=c.crossVec2Vec2(c.add(w,x),k),R=c.crossVec2Vec2(B,k),J=new ot,O=c.zero();O.x=c.dot(k,w),O.y=l-n-this.m_referenceAngle;var N=ts(O.x),rt=ts(O.y),et=W.linearSlop,st=W.maxLinearCorrection,ct=!1,at=0;if(this.m_enableLimit){var dt=c.dot(M,w);ts(this.m_upperTranslation-this.m_lowerTranslation)<2*et?(at=gt(dt,-st,st),N=br(N,ts(dt)),ct=!0):dt<=this.m_lowerTranslation?(at=gt(dt-this.m_lowerTranslation+et,-st,0),N=Math.max(N,this.m_lowerTranslation-dt),ct=!0):dt>=this.m_upperTranslation&&(at=gt(dt-this.m_upperTranslation-et,0,st),N=Math.max(N,dt-this.m_upperTranslation),ct=!0)}if(ct){var Wt=v+d+y*D*D+b*R*R,vt=y*D+b*R,oe=y*D*V+b*R*z;(re=y+b)==0&&(re=1);var Dt=y*V+b*z,yi=v+d+y*V*V+b*z*z;(Jt=new Se).ex.set(Wt,vt,oe),Jt.ey.set(vt,re,Dt),Jt.ez.set(oe,Dt,yi);var ve=new ot;ve.x=O.x,ve.y=O.y,ve.z=at,J=Jt.solve33(ot.neg(ve))}else{var re,Jt;Wt=v+d+y*D*D+b*R*R,vt=y*D+b*R,(re=y+b)==0&&(re=1),(Jt=new ie).ex.setNum(Wt,vt),Jt.ey.setNum(vt,re);var Te=Jt.solve(c.neg(O));J.x=Te.x,J.y=Te.y,J.z=0}var Pe=c.combine(J.x,k,J.z,M),We=J.x*D+J.y+J.z*V,gi=J.x*R+J.y+J.z*z;return r.subMul(v,Pe),n-=y*We,m.addMul(d,Pe),l+=b*gi,this.m_bodyA.c_position.c=r,this.m_bodyA.c_position.a=n,this.m_bodyB.c_position.c=m,this.m_bodyB.c_position.a=l,N<=W.linearSlop&&rt<=W.angularSlop},t.TYPE="prismatic-joint",t}(Ot),xn={ratio:1},Us=function(s){function t(e,r,n,m,l,_){var A,v,d=this;if(!(d instanceof t))return new t(e,r,n,m,l,_);e=xt(e,xn),r=(d=s.call(this,e,r,n)||this).m_bodyA,n=d.m_bodyB,d.m_type=t.TYPE,d.m_joint1=m||e.joint1,d.m_joint2=l||e.joint2,d.m_ratio=Number.isFinite(_)?_:e.ratio,d.m_type1=d.m_joint1.getType(),d.m_type2=d.m_joint2.getType(),d.m_bodyC=d.m_joint1.getBodyA(),d.m_bodyA=d.m_joint1.getBodyB();var y=d.m_bodyA.m_xf,b=d.m_bodyA.m_sweep.a,x=d.m_bodyC.m_xf,B=d.m_bodyC.m_sweep.a;if(d.m_type1===Ce.TYPE){var w=d.m_joint1;d.m_localAnchorC=w.m_localAnchorA,d.m_localAnchorA=w.m_localAnchorB,d.m_referenceAngleA=w.m_referenceAngle,d.m_localAxisC=c.zero(),A=b-B-d.m_referenceAngleA}else{var M=d.m_joint1;d.m_localAnchorC=M.m_localAnchorA,d.m_localAnchorA=M.m_localAnchorB,d.m_referenceAngleA=M.m_referenceAngle,d.m_localAxisC=M.m_localXAxisA;var V=d.m_localAnchorC,z=L.mulTVec2(x.q,c.add(L.mulVec2(y.q,d.m_localAnchorA),c.sub(y.p,x.p)));A=c.dot(z,d.m_localAxisC)-c.dot(V,d.m_localAxisC)}d.m_bodyD=d.m_joint2.getBodyA(),d.m_bodyB=d.m_joint2.getBodyB();var k=d.m_bodyB.m_xf,D=d.m_bodyB.m_sweep.a,R=d.m_bodyD.m_xf,J=d.m_bodyD.m_sweep.a;if(d.m_type2===Ce.TYPE)w=d.m_joint2,d.m_localAnchorD=w.m_localAnchorA,d.m_localAnchorB=w.m_localAnchorB,d.m_referenceAngleB=w.m_referenceAngle,d.m_localAxisD=c.zero(),v=D-J-d.m_referenceAngleB;else{M=d.m_joint2,d.m_localAnchorD=M.m_localAnchorA,d.m_localAnchorB=M.m_localAnchorB,d.m_referenceAngleB=M.m_referenceAngle,d.m_localAxisD=M.m_localXAxisA;var O=d.m_localAnchorD,N=L.mulTVec2(R.q,c.add(L.mulVec2(k.q,d.m_localAnchorB),c.sub(k.p,R.p)));v=c.dot(N,d.m_localAxisD)-c.dot(O,d.m_localAxisD)}return d.m_constant=A+d.m_ratio*v,d.m_impulse=0,d}return Y(t,s),t.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,joint1:this.m_joint1,joint2:this.m_joint2,ratio:this.m_ratio}},t._deserialize=function(e,r,n){return(e=it({},e)).bodyA=n(ht,e.bodyA,r),e.bodyB=n(ht,e.bodyB,r),e.joint1=n(Ot,e.joint1,r),e.joint2=n(Ot,e.joint2,r),new t(e)},t.prototype._reset=function(e){Number.isFinite(e.ratio)&&(this.m_ratio=e.ratio)},t.prototype.getJoint1=function(){return this.m_joint1},t.prototype.getJoint2=function(){return this.m_joint2},t.prototype.setRatio=function(e){this.m_ratio=e},t.prototype.getRatio=function(){return this.m_ratio},t.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},t.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},t.prototype.getReactionForce=function(e){return c.mulNumVec2(this.m_impulse,this.m_JvAC).mul(e)},t.prototype.getReactionTorque=function(e){return e*(this.m_impulse*this.m_JwA)},t.prototype.initVelocityConstraints=function(e){this.m_lcA=this.m_bodyA.m_sweep.localCenter,this.m_lcB=this.m_bodyB.m_sweep.localCenter,this.m_lcC=this.m_bodyC.m_sweep.localCenter,this.m_lcD=this.m_bodyD.m_sweep.localCenter,this.m_mA=this.m_bodyA.m_invMass,this.m_mB=this.m_bodyB.m_invMass,this.m_mC=this.m_bodyC.m_invMass,this.m_mD=this.m_bodyD.m_invMass,this.m_iA=this.m_bodyA.m_invI,this.m_iB=this.m_bodyB.m_invI,this.m_iC=this.m_bodyC.m_invI,this.m_iD=this.m_bodyD.m_invI;var r=this.m_bodyA.c_position.a,n=this.m_bodyA.c_velocity.v,m=this.m_bodyA.c_velocity.w,l=this.m_bodyB.c_position.a,_=this.m_bodyB.c_velocity.v,A=this.m_bodyB.c_velocity.w,v=this.m_bodyC.c_position.a,d=this.m_bodyC.c_velocity.v,y=this.m_bodyC.c_velocity.w,b=this.m_bodyD.c_position.a,x=this.m_bodyD.c_velocity.v,B=this.m_bodyD.c_velocity.w,w=L.neo(r),M=L.neo(l),V=L.neo(v),z=L.neo(b);if(this.m_mass=0,this.m_type1==Ce.TYPE)this.m_JvAC=c.zero(),this.m_JwA=1,this.m_JwC=1,this.m_mass+=this.m_iA+this.m_iC;else{var k=L.mulVec2(V,this.m_localAxisC),D=L.mulSub(V,this.m_localAnchorC,this.m_lcC),R=L.mulSub(w,this.m_localAnchorA,this.m_lcA);this.m_JvAC=k,this.m_JwC=c.crossVec2Vec2(D,k),this.m_JwA=c.crossVec2Vec2(R,k),this.m_mass+=this.m_mC+this.m_mA+this.m_iC*this.m_JwC*this.m_JwC+this.m_iA*this.m_JwA*this.m_JwA}if(this.m_type2==Ce.TYPE)this.m_JvBD=c.zero(),this.m_JwB=this.m_ratio,this.m_JwD=this.m_ratio,this.m_mass+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD);else{k=L.mulVec2(z,this.m_localAxisD);var J=L.mulSub(z,this.m_localAnchorD,this.m_lcD),O=L.mulSub(M,this.m_localAnchorB,this.m_lcB);this.m_JvBD=c.mulNumVec2(this.m_ratio,k),this.m_JwD=this.m_ratio*c.crossVec2Vec2(J,k),this.m_JwB=this.m_ratio*c.crossVec2Vec2(O,k),this.m_mass+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*this.m_JwD*this.m_JwD+this.m_iB*this.m_JwB*this.m_JwB}this.m_mass=this.m_mass>0?1/this.m_mass:0,e.warmStarting?(n.addMul(this.m_mA*this.m_impulse,this.m_JvAC),m+=this.m_iA*this.m_impulse*this.m_JwA,_.addMul(this.m_mB*this.m_impulse,this.m_JvBD),A+=this.m_iB*this.m_impulse*this.m_JwB,d.subMul(this.m_mC*this.m_impulse,this.m_JvAC),y-=this.m_iC*this.m_impulse*this.m_JwC,x.subMul(this.m_mD*this.m_impulse,this.m_JvBD),B-=this.m_iD*this.m_impulse*this.m_JwD):this.m_impulse=0,this.m_bodyA.c_velocity.v.setVec2(n),this.m_bodyA.c_velocity.w=m,this.m_bodyB.c_velocity.v.setVec2(_),this.m_bodyB.c_velocity.w=A,this.m_bodyC.c_velocity.v.setVec2(d),this.m_bodyC.c_velocity.w=y,this.m_bodyD.c_velocity.v.setVec2(x),this.m_bodyD.c_velocity.w=B},t.prototype.solveVelocityConstraints=function(e){var r=this.m_bodyA.c_velocity.v,n=this.m_bodyA.c_velocity.w,m=this.m_bodyB.c_velocity.v,l=this.m_bodyB.c_velocity.w,_=this.m_bodyC.c_velocity.v,A=this.m_bodyC.c_velocity.w,v=this.m_bodyD.c_velocity.v,d=this.m_bodyD.c_velocity.w,y=c.dot(this.m_JvAC,r)-c.dot(this.m_JvAC,_)+c.dot(this.m_JvBD,m)-c.dot(this.m_JvBD,v);y+=this.m_JwA*n-this.m_JwC*A+(this.m_JwB*l-this.m_JwD*d);var b=-this.m_mass*y;this.m_impulse+=b,r.addMul(this.m_mA*b,this.m_JvAC),n+=this.m_iA*b*this.m_JwA,m.addMul(this.m_mB*b,this.m_JvBD),l+=this.m_iB*b*this.m_JwB,_.subMul(this.m_mC*b,this.m_JvAC),A-=this.m_iC*b*this.m_JwC,v.subMul(this.m_mD*b,this.m_JvBD),d-=this.m_iD*b*this.m_JwD,this.m_bodyA.c_velocity.v.setVec2(r),this.m_bodyA.c_velocity.w=n,this.m_bodyB.c_velocity.v.setVec2(m),this.m_bodyB.c_velocity.w=l,this.m_bodyC.c_velocity.v.setVec2(_),this.m_bodyC.c_velocity.w=A,this.m_bodyD.c_velocity.v.setVec2(v),this.m_bodyD.c_velocity.w=d},t.prototype.solvePositionConstraints=function(e){var r,n,m,l,_,A,v,d,y=this.m_bodyA.c_position.c,b=this.m_bodyA.c_position.a,x=this.m_bodyB.c_position.c,B=this.m_bodyB.c_position.a,w=this.m_bodyC.c_position.c,M=this.m_bodyC.c_position.a,V=this.m_bodyD.c_position.c,z=this.m_bodyD.c_position.a,k=L.neo(b),D=L.neo(B),R=L.neo(M),J=L.neo(z),O=0;if(this.m_type1==Ce.TYPE)m=c.zero(),_=1,v=1,O+=this.m_iA+this.m_iC,r=b-M-this.m_referenceAngleA;else{var N=L.mulVec2(R,this.m_localAxisC),rt=L.mulSub(R,this.m_localAnchorC,this.m_lcC),et=L.mulSub(k,this.m_localAnchorA,this.m_lcA);m=N,v=c.crossVec2Vec2(rt,N),_=c.crossVec2Vec2(et,N),O+=this.m_mC+this.m_mA+this.m_iC*v*v+this.m_iA*_*_;var st=c.sub(this.m_localAnchorC,this.m_lcC),ct=L.mulTVec2(R,c.add(et,c.sub(y,w)));r=c.dot(c.sub(ct,st),this.m_localAxisC)}if(this.m_type2==Ce.TYPE)l=c.zero(),A=this.m_ratio,d=this.m_ratio,O+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD),n=B-z-this.m_referenceAngleB;else{N=L.mulVec2(J,this.m_localAxisD);var at=L.mulSub(J,this.m_localAnchorD,this.m_lcD),dt=L.mulSub(D,this.m_localAnchorB,this.m_lcB);l=c.mulNumVec2(this.m_ratio,N),d=this.m_ratio*c.crossVec2Vec2(at,N),A=this.m_ratio*c.crossVec2Vec2(dt,N),O+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*d*d+this.m_iB*A*A;var Wt=c.sub(this.m_localAnchorD,this.m_lcD),vt=L.mulTVec2(J,c.add(dt,c.sub(x,V)));n=c.dot(vt,this.m_localAxisD)-c.dot(Wt,this.m_localAxisD)}var oe=r+this.m_ratio*n-this.m_constant,Dt=0;return O>0&&(Dt=-oe/O),y.addMul(this.m_mA*Dt,m),b+=this.m_iA*Dt*_,x.addMul(this.m_mB*Dt,l),B+=this.m_iB*Dt*A,w.subMul(this.m_mC*Dt,m),M-=this.m_iC*Dt*v,V.subMul(this.m_mD*Dt,l),z-=this.m_iD*Dt*d,this.m_bodyA.c_position.c.setVec2(y),this.m_bodyA.c_position.a=b,this.m_bodyB.c_position.c.setVec2(x),this.m_bodyB.c_position.a=B,this.m_bodyC.c_position.c.setVec2(w),this.m_bodyC.c_position.a=M,this.m_bodyD.c_position.c.setVec2(V),this.m_bodyD.c_position.a=z,0<W.linearSlop},t.TYPE="gear-joint",t}(Ot),bn={maxForce:1,maxTorque:1,correctionFactor:.3},Hs=function(s){function t(e,r,n){var m=this;return m instanceof t?(e=xt(e,bn),r=(m=s.call(this,e,r,n)||this).m_bodyA,n=m.m_bodyB,m.m_type=t.TYPE,m.m_linearOffset=c.isValid(e.linearOffset)?c.clone(e.linearOffset):r.getLocalPoint(n.getPosition()),m.m_angularOffset=Number.isFinite(e.angularOffset)?e.angularOffset:n.getAngle()-r.getAngle(),m.m_linearImpulse=c.zero(),m.m_angularImpulse=0,m.m_maxForce=e.maxForce,m.m_maxTorque=e.maxTorque,m.m_correctionFactor=e.correctionFactor,m):new t(e,r,n)}return Y(t,s),t.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,maxForce:this.m_maxForce,maxTorque:this.m_maxTorque,correctionFactor:this.m_correctionFactor,linearOffset:this.m_linearOffset,angularOffset:this.m_angularOffset}},t._deserialize=function(e,r,n){return(e=it({},e)).bodyA=n(ht,e.bodyA,r),e.bodyB=n(ht,e.bodyB,r),new t(e)},t.prototype._reset=function(e){Number.isFinite(e.angularOffset)&&(this.m_angularOffset=e.angularOffset),Number.isFinite(e.maxForce)&&(this.m_maxForce=e.maxForce),Number.isFinite(e.maxTorque)&&(this.m_maxTorque=e.maxTorque),Number.isFinite(e.correctionFactor)&&(this.m_correctionFactor=e.correctionFactor),c.isValid(e.linearOffset)&&this.m_linearOffset.set(e.linearOffset)},t.prototype.setMaxForce=function(e){this.m_maxForce=e},t.prototype.getMaxForce=function(){return this.m_maxForce},t.prototype.setMaxTorque=function(e){this.m_maxTorque=e},t.prototype.getMaxTorque=function(){return this.m_maxTorque},t.prototype.setCorrectionFactor=function(e){this.m_correctionFactor=e},t.prototype.getCorrectionFactor=function(){return this.m_correctionFactor},t.prototype.setLinearOffset=function(e){e.x==this.m_linearOffset.x&&e.y==this.m_linearOffset.y||(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_linearOffset.set(e))},t.prototype.getLinearOffset=function(){return this.m_linearOffset},t.prototype.setAngularOffset=function(e){e!=this.m_angularOffset&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_angularOffset=e)},t.prototype.getAngularOffset=function(){return this.m_angularOffset},t.prototype.getAnchorA=function(){return this.m_bodyA.getPosition()},t.prototype.getAnchorB=function(){return this.m_bodyB.getPosition()},t.prototype.getReactionForce=function(e){return c.mulNumVec2(e,this.m_linearImpulse)},t.prototype.getReactionTorque=function(e){return e*this.m_angularImpulse},t.prototype.initVelocityConstraints=function(e){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var r=this.m_bodyA.c_position.c,n=this.m_bodyA.c_position.a,m=this.m_bodyA.c_velocity.v,l=this.m_bodyA.c_velocity.w,_=this.m_bodyB.c_position.c,A=this.m_bodyB.c_position.a,v=this.m_bodyB.c_velocity.v,d=this.m_bodyB.c_velocity.w,y=L.neo(n),b=L.neo(A);this.m_rA=L.mulVec2(y,c.sub(this.m_linearOffset,this.m_localCenterA)),this.m_rB=L.mulVec2(b,c.neg(this.m_localCenterB));var x=this.m_invMassA,B=this.m_invMassB,w=this.m_invIA,M=this.m_invIB,V=new ie;if(V.ex.x=x+B+w*this.m_rA.y*this.m_rA.y+M*this.m_rB.y*this.m_rB.y,V.ex.y=-w*this.m_rA.x*this.m_rA.y-M*this.m_rB.x*this.m_rB.y,V.ey.x=V.ex.y,V.ey.y=x+B+w*this.m_rA.x*this.m_rA.x+M*this.m_rB.x*this.m_rB.x,this.m_linearMass=V.getInverse(),this.m_angularMass=w+M,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),this.m_linearError=c.zero(),this.m_linearError.addCombine(1,_,1,this.m_rB),this.m_linearError.subCombine(1,r,1,this.m_rA),this.m_angularError=A-n-this.m_angularOffset,e.warmStarting){this.m_linearImpulse.mul(e.dtRatio),this.m_angularImpulse*=e.dtRatio;var z=c.neo(this.m_linearImpulse.x,this.m_linearImpulse.y);m.subMul(x,z),l-=w*(c.crossVec2Vec2(this.m_rA,z)+this.m_angularImpulse),v.addMul(B,z),d+=M*(c.crossVec2Vec2(this.m_rB,z)+this.m_angularImpulse)}else this.m_linearImpulse.setZero(),this.m_angularImpulse=0;this.m_bodyA.c_velocity.v=m,this.m_bodyA.c_velocity.w=l,this.m_bodyB.c_velocity.v=v,this.m_bodyB.c_velocity.w=d},t.prototype.solveVelocityConstraints=function(e){var r=this.m_bodyA.c_velocity.v,n=this.m_bodyA.c_velocity.w,m=this.m_bodyB.c_velocity.v,l=this.m_bodyB.c_velocity.w,_=this.m_invMassA,A=this.m_invMassB,v=this.m_invIA,d=this.m_invIB,y=e.dt,b=e.inv_dt,x=l-n+b*this.m_correctionFactor*this.m_angularError,B=-this.m_angularMass*x,w=this.m_angularImpulse,M=y*this.m_maxTorque;this.m_angularImpulse=gt(this.m_angularImpulse+B,-M,M),n-=v*(B=this.m_angularImpulse-w),l+=d*B,(x=c.zero()).addCombine(1,m,1,c.crossNumVec2(l,this.m_rB)),x.subCombine(1,r,1,c.crossNumVec2(n,this.m_rA)),x.addMul(b*this.m_correctionFactor,this.m_linearError),B=c.neg(ie.mulVec2(this.m_linearMass,x)),w=c.clone(this.m_linearImpulse),this.m_linearImpulse.add(B),M=y*this.m_maxForce,this.m_linearImpulse.clamp(M),B=c.sub(this.m_linearImpulse,w),r.subMul(_,B),n-=v*c.crossVec2Vec2(this.m_rA,B),m.addMul(A,B),l+=d*c.crossVec2Vec2(this.m_rB,B),this.m_bodyA.c_velocity.v=r,this.m_bodyA.c_velocity.w=n,this.m_bodyB.c_velocity.v=m,this.m_bodyB.c_velocity.w=l},t.prototype.solvePositionConstraints=function(e){return!0},t.TYPE="motor-joint",t}(Ot),An=Math.PI,wn={maxForce:0,frequencyHz:5,dampingRatio:.7},Ks=function(s){function t(e,r,n,m){var l=this;return l instanceof t?(e=xt(e,wn),r=(l=s.call(this,e,r,n)||this).m_bodyA,n=l.m_bodyB,l.m_type=t.TYPE,c.isValid(m)?l.m_targetA=c.clone(m):c.isValid(e.target)?l.m_targetA=c.clone(e.target):l.m_targetA=c.zero(),l.m_localAnchorB=Nt.mulTVec2(n.getTransform(),l.m_targetA),l.m_maxForce=e.maxForce,l.m_impulse=c.zero(),l.m_frequencyHz=e.frequencyHz,l.m_dampingRatio=e.dampingRatio,l.m_beta=0,l.m_gamma=0,l.m_rB=c.zero(),l.m_localCenterB=c.zero(),l.m_invMassB=0,l.m_invIB=0,l.m_mass=new ie,l.m_C=c.zero(),l):new t(e,r,n,m)}return Y(t,s),t.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,target:this.m_targetA,maxForce:this.m_maxForce,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,_localAnchorB:this.m_localAnchorB}},t._deserialize=function(e,r,n){(e=it({},e)).bodyA=n(ht,e.bodyA,r),e.bodyB=n(ht,e.bodyB,r),e.target=c.clone(e.target);var m=new t(e);return e._localAnchorB&&(m.m_localAnchorB=e._localAnchorB),m},t.prototype._reset=function(e){Number.isFinite(e.maxForce)&&(this.m_maxForce=e.maxForce),Number.isFinite(e.frequencyHz)&&(this.m_frequencyHz=e.frequencyHz),Number.isFinite(e.dampingRatio)&&(this.m_dampingRatio=e.dampingRatio)},t.prototype.setTarget=function(e){c.areEqual(e,this.m_targetA)||(this.m_bodyB.setAwake(!0),this.m_targetA.set(e))},t.prototype.getTarget=function(){return this.m_targetA},t.prototype.setMaxForce=function(e){this.m_maxForce=e},t.prototype.getMaxForce=function(){return this.m_maxForce},t.prototype.setFrequency=function(e){this.m_frequencyHz=e},t.prototype.getFrequency=function(){return this.m_frequencyHz},t.prototype.setDampingRatio=function(e){this.m_dampingRatio=e},t.prototype.getDampingRatio=function(){return this.m_dampingRatio},t.prototype.getAnchorA=function(){return c.clone(this.m_targetA)},t.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},t.prototype.getReactionForce=function(e){return c.mulNumVec2(e,this.m_impulse)},t.prototype.getReactionTorque=function(e){return 0*e},t.prototype.shiftOrigin=function(e){this.m_targetA.sub(e)},t.prototype.initVelocityConstraints=function(e){this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIB=this.m_bodyB.m_invI;var r=this.m_bodyB.c_position,n=this.m_bodyB.c_velocity,m=r.c,l=r.a,_=n.v,A=n.w,v=L.neo(l),d=this.m_bodyB.getMass(),y=2*An*this.m_frequencyHz,b=2*d*this.m_dampingRatio*y,x=d*(y*y),B=e.dt;this.m_gamma=B*(b+B*x),this.m_gamma!=0&&(this.m_gamma=1/this.m_gamma),this.m_beta=B*x*this.m_gamma,this.m_rB=L.mulVec2(v,c.sub(this.m_localAnchorB,this.m_localCenterB));var w=new ie;w.ex.x=this.m_invMassB+this.m_invIB*this.m_rB.y*this.m_rB.y+this.m_gamma,w.ex.y=-this.m_invIB*this.m_rB.x*this.m_rB.y,w.ey.x=w.ex.y,w.ey.y=this.m_invMassB+this.m_invIB*this.m_rB.x*this.m_rB.x+this.m_gamma,this.m_mass=w.getInverse(),this.m_C.setVec2(m),this.m_C.addCombine(1,this.m_rB,-1,this.m_targetA),this.m_C.mul(this.m_beta),A*=.98,e.warmStarting?(this.m_impulse.mul(e.dtRatio),_.addMul(this.m_invMassB,this.m_impulse),A+=this.m_invIB*c.crossVec2Vec2(this.m_rB,this.m_impulse)):this.m_impulse.setZero(),n.v.setVec2(_),n.w=A},t.prototype.solveVelocityConstraints=function(e){var r=this.m_bodyB.c_velocity,n=c.clone(r.v),m=r.w,l=c.crossNumVec2(m,this.m_rB);l.add(n),l.addCombine(1,this.m_C,this.m_gamma,this.m_impulse),l.neg();var _=ie.mulVec2(this.m_mass,l),A=c.clone(this.m_impulse);this.m_impulse.add(_);var v=e.dt*this.m_maxForce;this.m_impulse.clamp(v),_=c.sub(this.m_impulse,A),n.addMul(this.m_invMassB,_),m+=this.m_invIB*c.crossVec2Vec2(this.m_rB,_),r.v.setVec2(n),r.w=m},t.prototype.solvePositionConstraints=function(e){return!0},t.TYPE="mouse-joint",t}(Ot),Bn=Math.abs,Sn={collideConnected:!0},Xs=function(s){function t(e,r,n,m,l,_,A,v){var d=this;return d instanceof t?(e=xt(e,Sn),r=(d=s.call(this,e,r,n)||this).m_bodyA,n=d.m_bodyB,d.m_type=t.TYPE,d.m_groundAnchorA=c.clone(m||e.groundAnchorA||c.neo(-1,1)),d.m_groundAnchorB=c.clone(l||e.groundAnchorB||c.neo(1,1)),d.m_localAnchorA=c.clone(_?r.getLocalPoint(_):e.localAnchorA||c.neo(-1,0)),d.m_localAnchorB=c.clone(A?n.getLocalPoint(A):e.localAnchorB||c.neo(1,0)),d.m_lengthA=Number.isFinite(e.lengthA)?e.lengthA:c.distance(_,m),d.m_lengthB=Number.isFinite(e.lengthB)?e.lengthB:c.distance(A,l),d.m_ratio=Number.isFinite(v)?v:e.ratio,d.m_constant=d.m_lengthA+d.m_ratio*d.m_lengthB,d.m_impulse=0,d):new t(e,r,n,m,l,_,A,v)}return Y(t,s),t.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,groundAnchorA:this.m_groundAnchorA,groundAnchorB:this.m_groundAnchorB,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,lengthA:this.m_lengthA,lengthB:this.m_lengthB,ratio:this.m_ratio}},t._deserialize=function(e,r,n){return(e=it({},e)).bodyA=n(ht,e.bodyA,r),e.bodyB=n(ht,e.bodyB,r),new t(e)},t.prototype._reset=function(e){c.isValid(e.groundAnchorA)&&this.m_groundAnchorA.set(e.groundAnchorA),c.isValid(e.groundAnchorB)&&this.m_groundAnchorB.set(e.groundAnchorB),c.isValid(e.localAnchorA)?this.m_localAnchorA.set(e.localAnchorA):c.isValid(e.anchorA)&&this.m_localAnchorA.set(this.m_bodyA.getLocalPoint(e.anchorA)),c.isValid(e.localAnchorB)?this.m_localAnchorB.set(e.localAnchorB):c.isValid(e.anchorB)&&this.m_localAnchorB.set(this.m_bodyB.getLocalPoint(e.anchorB)),Number.isFinite(e.lengthA)&&(this.m_lengthA=e.lengthA),Number.isFinite(e.lengthB)&&(this.m_lengthB=e.lengthB),Number.isFinite(e.ratio)&&(this.m_ratio=e.ratio)},t.prototype.getGroundAnchorA=function(){return this.m_groundAnchorA},t.prototype.getGroundAnchorB=function(){return this.m_groundAnchorB},t.prototype.getLengthA=function(){return this.m_lengthA},t.prototype.getLengthB=function(){return this.m_lengthB},t.prototype.getRatio=function(){return this.m_ratio},t.prototype.getCurrentLengthA=function(){var e=this.m_bodyA.getWorldPoint(this.m_localAnchorA),r=this.m_groundAnchorA;return c.distance(e,r)},t.prototype.getCurrentLengthB=function(){var e=this.m_bodyB.getWorldPoint(this.m_localAnchorB),r=this.m_groundAnchorB;return c.distance(e,r)},t.prototype.shiftOrigin=function(e){this.m_groundAnchorA.sub(e),this.m_groundAnchorB.sub(e)},t.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},t.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},t.prototype.getReactionForce=function(e){return c.mulNumVec2(this.m_impulse,this.m_uB).mul(e)},t.prototype.getReactionTorque=function(e){return 0},t.prototype.initVelocityConstraints=function(e){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var r=this.m_bodyA.c_position.c,n=this.m_bodyA.c_position.a,m=this.m_bodyA.c_velocity.v,l=this.m_bodyA.c_velocity.w,_=this.m_bodyB.c_position.c,A=this.m_bodyB.c_position.a,v=this.m_bodyB.c_velocity.v,d=this.m_bodyB.c_velocity.w,y=L.neo(n),b=L.neo(A);this.m_rA=L.mulVec2(y,c.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=L.mulVec2(b,c.sub(this.m_localAnchorB,this.m_localCenterB)),this.m_uA=c.sub(c.add(r,this.m_rA),this.m_groundAnchorA),this.m_uB=c.sub(c.add(_,this.m_rB),this.m_groundAnchorB);var x=this.m_uA.length(),B=this.m_uB.length();x>10*W.linearSlop?this.m_uA.mul(1/x):this.m_uA.setZero(),B>10*W.linearSlop?this.m_uB.mul(1/B):this.m_uB.setZero();var w=c.crossVec2Vec2(this.m_rA,this.m_uA),M=c.crossVec2Vec2(this.m_rB,this.m_uB),V=this.m_invMassA+this.m_invIA*w*w,z=this.m_invMassB+this.m_invIB*M*M;if(this.m_mass=V+this.m_ratio*this.m_ratio*z,this.m_mass>0&&(this.m_mass=1/this.m_mass),e.warmStarting){this.m_impulse*=e.dtRatio;var k=c.mulNumVec2(-this.m_impulse,this.m_uA),D=c.mulNumVec2(-this.m_ratio*this.m_impulse,this.m_uB);m.addMul(this.m_invMassA,k),l+=this.m_invIA*c.crossVec2Vec2(this.m_rA,k),v.addMul(this.m_invMassB,D),d+=this.m_invIB*c.crossVec2Vec2(this.m_rB,D)}else this.m_impulse=0;this.m_bodyA.c_velocity.v=m,this.m_bodyA.c_velocity.w=l,this.m_bodyB.c_velocity.v=v,this.m_bodyB.c_velocity.w=d},t.prototype.solveVelocityConstraints=function(e){var r=this.m_bodyA.c_velocity.v,n=this.m_bodyA.c_velocity.w,m=this.m_bodyB.c_velocity.v,l=this.m_bodyB.c_velocity.w,_=c.add(r,c.crossNumVec2(n,this.m_rA)),A=c.add(m,c.crossNumVec2(l,this.m_rB)),v=-c.dot(this.m_uA,_)-this.m_ratio*c.dot(this.m_uB,A),d=-this.m_mass*v;this.m_impulse+=d;var y=c.mulNumVec2(-d,this.m_uA),b=c.mulNumVec2(-this.m_ratio*d,this.m_uB);r.addMul(this.m_invMassA,y),n+=this.m_invIA*c.crossVec2Vec2(this.m_rA,y),m.addMul(this.m_invMassB,b),l+=this.m_invIB*c.crossVec2Vec2(this.m_rB,b),this.m_bodyA.c_velocity.v=r,this.m_bodyA.c_velocity.w=n,this.m_bodyB.c_velocity.v=m,this.m_bodyB.c_velocity.w=l},t.prototype.solvePositionConstraints=function(e){var r=this.m_bodyA.c_position.c,n=this.m_bodyA.c_position.a,m=this.m_bodyB.c_position.c,l=this.m_bodyB.c_position.a,_=L.neo(n),A=L.neo(l),v=L.mulVec2(_,c.sub(this.m_localAnchorA,this.m_localCenterA)),d=L.mulVec2(A,c.sub(this.m_localAnchorB,this.m_localCenterB)),y=c.sub(c.add(r,this.m_rA),this.m_groundAnchorA),b=c.sub(c.add(m,this.m_rB),this.m_groundAnchorB),x=y.length(),B=b.length();x>10*W.linearSlop?y.mul(1/x):y.setZero(),B>10*W.linearSlop?b.mul(1/B):b.setZero();var w=c.crossVec2Vec2(v,y),M=c.crossVec2Vec2(d,b),V=this.m_invMassA+this.m_invIA*w*w,z=this.m_invMassB+this.m_invIB*M*M,k=V+this.m_ratio*this.m_ratio*z;k>0&&(k=1/k);var D=this.m_constant-x-this.m_ratio*B,R=Bn(D),J=-k*D,O=c.mulNumVec2(-J,y),N=c.mulNumVec2(-this.m_ratio*J,b);return r.addMul(this.m_invMassA,O),n+=this.m_invIA*c.crossVec2Vec2(v,O),m.addMul(this.m_invMassB,N),l+=this.m_invIB*c.crossVec2Vec2(d,N),this.m_bodyA.c_position.c=r,this.m_bodyA.c_position.a=n,this.m_bodyB.c_position.c=m,this.m_bodyB.c_position.a=l,R<W.linearSlop},t.TYPE="pulley-joint",t}(Ot),Cn=Math.min;(function(s){s[s.inactiveLimit=0]="inactiveLimit",s[s.atLowerLimit=1]="atLowerLimit",s[s.atUpperLimit=2]="atUpperLimit",s[s.equalLimits=3]="equalLimits"})(es||(es={}));var jt,Mn={maxLength:0},Zs=function(s){function t(e,r,n,m){var l=this;return l instanceof t?(e=xt(e,Mn),r=(l=s.call(this,e,r,n)||this).m_bodyA,n=l.m_bodyB,l.m_type=t.TYPE,l.m_localAnchorA=c.clone(m?r.getLocalPoint(m):e.localAnchorA||c.neo(-1,0)),l.m_localAnchorB=c.clone(m?n.getLocalPoint(m):e.localAnchorB||c.neo(1,0)),l.m_maxLength=e.maxLength,l.m_mass=0,l.m_impulse=0,l.m_length=0,l.m_state=es.inactiveLimit,l):new t(e,r,n,m)}return Y(t,s),t.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,maxLength:this.m_maxLength}},t._deserialize=function(e,r,n){return(e=it({},e)).bodyA=n(ht,e.bodyA,r),e.bodyB=n(ht,e.bodyB,r),new t(e)},t.prototype._reset=function(e){Number.isFinite(e.maxLength)&&(this.m_maxLength=e.maxLength)},t.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},t.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},t.prototype.setMaxLength=function(e){this.m_maxLength=e},t.prototype.getMaxLength=function(){return this.m_maxLength},t.prototype.getLimitState=function(){return this.m_state},t.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},t.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},t.prototype.getReactionForce=function(e){return c.mulNumVec2(this.m_impulse,this.m_u).mul(e)},t.prototype.getReactionTorque=function(e){return 0},t.prototype.initVelocityConstraints=function(e){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var r=this.m_bodyA.c_position.c,n=this.m_bodyA.c_position.a,m=this.m_bodyA.c_velocity.v,l=this.m_bodyA.c_velocity.w,_=this.m_bodyB.c_position.c,A=this.m_bodyB.c_position.a,v=this.m_bodyB.c_velocity.v,d=this.m_bodyB.c_velocity.w,y=L.neo(n),b=L.neo(A);this.m_rA=L.mulSub(y,this.m_localAnchorA,this.m_localCenterA),this.m_rB=L.mulSub(b,this.m_localAnchorB,this.m_localCenterB),this.m_u=c.zero(),this.m_u.addCombine(1,_,1,this.m_rB),this.m_u.subCombine(1,r,1,this.m_rA),this.m_length=this.m_u.length();var x=this.m_length-this.m_maxLength;if(this.m_state=x>0?es.atUpperLimit:es.inactiveLimit,!(this.m_length>W.linearSlop))return this.m_u.setZero(),this.m_mass=0,void(this.m_impulse=0);this.m_u.mul(1/this.m_length);var B=c.crossVec2Vec2(this.m_rA,this.m_u),w=c.crossVec2Vec2(this.m_rB,this.m_u),M=this.m_invMassA+this.m_invIA*B*B+this.m_invMassB+this.m_invIB*w*w;if(this.m_mass=M!=0?1/M:0,e.warmStarting){this.m_impulse*=e.dtRatio;var V=c.mulNumVec2(this.m_impulse,this.m_u);m.subMul(this.m_invMassA,V),l-=this.m_invIA*c.crossVec2Vec2(this.m_rA,V),v.addMul(this.m_invMassB,V),d+=this.m_invIB*c.crossVec2Vec2(this.m_rB,V)}else this.m_impulse=0;this.m_bodyA.c_velocity.v.setVec2(m),this.m_bodyA.c_velocity.w=l,this.m_bodyB.c_velocity.v.setVec2(v),this.m_bodyB.c_velocity.w=d},t.prototype.solveVelocityConstraints=function(e){var r=this.m_bodyA.c_velocity.v,n=this.m_bodyA.c_velocity.w,m=this.m_bodyB.c_velocity.v,l=this.m_bodyB.c_velocity.w,_=c.addCrossNumVec2(r,n,this.m_rA),A=c.addCrossNumVec2(m,l,this.m_rB),v=this.m_length-this.m_maxLength,d=c.dot(this.m_u,c.sub(A,_));v<0&&(d+=e.inv_dt*v);var y=-this.m_mass*d,b=this.m_impulse;this.m_impulse=Cn(0,this.m_impulse+y),y=this.m_impulse-b;var x=c.mulNumVec2(y,this.m_u);r.subMul(this.m_invMassA,x),n-=this.m_invIA*c.crossVec2Vec2(this.m_rA,x),m.addMul(this.m_invMassB,x),l+=this.m_invIB*c.crossVec2Vec2(this.m_rB,x),this.m_bodyA.c_velocity.v=r,this.m_bodyA.c_velocity.w=n,this.m_bodyB.c_velocity.v=m,this.m_bodyB.c_velocity.w=l},t.prototype.solvePositionConstraints=function(e){var r=this.m_bodyA.c_position.c,n=this.m_bodyA.c_position.a,m=this.m_bodyB.c_position.c,l=this.m_bodyB.c_position.a,_=L.neo(n),A=L.neo(l),v=L.mulSub(_,this.m_localAnchorA,this.m_localCenterA),d=L.mulSub(A,this.m_localAnchorB,this.m_localCenterB),y=c.zero();y.addCombine(1,m,1,d),y.subCombine(1,r,1,v);var b=y.normalize(),x=b-this.m_maxLength;x=gt(x,0,W.maxLinearCorrection);var B=-this.m_mass*x,w=c.mulNumVec2(B,y);return r.subMul(this.m_invMassA,w),n-=this.m_invIA*c.crossVec2Vec2(v,w),m.addMul(this.m_invMassB,w),l+=this.m_invIB*c.crossVec2Vec2(d,w),this.m_bodyA.c_position.c.setVec2(r),this.m_bodyA.c_position.a=n,this.m_bodyB.c_position.c.setVec2(m),this.m_bodyB.c_position.a=l,b-this.m_maxLength<W.linearSlop},t.TYPE="rope-joint",t}(Ot),Vn=Math.abs,In=Math.PI,Tn={frequencyHz:0,dampingRatio:0},Qs=function(s){function t(e,r,n,m){var l=this;return l instanceof t?(e=xt(e,Tn),r=(l=s.call(this,e,r,n)||this).m_bodyA,n=l.m_bodyB,l.m_type=t.TYPE,l.m_localAnchorA=c.clone(m?r.getLocalPoint(m):e.localAnchorA||c.zero()),l.m_localAnchorB=c.clone(m?n.getLocalPoint(m):e.localAnchorB||c.zero()),l.m_referenceAngle=Number.isFinite(e.referenceAngle)?e.referenceAngle:n.getAngle()-r.getAngle(),l.m_frequencyHz=e.frequencyHz,l.m_dampingRatio=e.dampingRatio,l.m_impulse=new ot,l.m_bias=0,l.m_gamma=0,l.m_rA,l.m_rB,l.m_localCenterA,l.m_localCenterB,l.m_invMassA,l.m_invMassB,l.m_invIA,l.m_invIB,l.m_mass=new Se,l):new t(e,r,n,m)}return Y(t,s),t.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,referenceAngle:this.m_referenceAngle}},t._deserialize=function(e,r,n){return(e=it({},e)).bodyA=n(ht,e.bodyA,r),e.bodyB=n(ht,e.bodyB,r),new t(e)},t.prototype._reset=function(e){e.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(e.anchorA)):e.localAnchorA&&this.m_localAnchorA.setVec2(e.localAnchorA),e.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(e.anchorB)):e.localAnchorB&&this.m_localAnchorB.setVec2(e.localAnchorB),Number.isFinite(e.frequencyHz)&&(this.m_frequencyHz=e.frequencyHz),Number.isFinite(e.dampingRatio)&&(this.m_dampingRatio=e.dampingRatio)},t.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},t.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},t.prototype.getReferenceAngle=function(){return this.m_referenceAngle},t.prototype.setFrequency=function(e){this.m_frequencyHz=e},t.prototype.getFrequency=function(){return this.m_frequencyHz},t.prototype.setDampingRatio=function(e){this.m_dampingRatio=e},t.prototype.getDampingRatio=function(){return this.m_dampingRatio},t.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},t.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},t.prototype.getReactionForce=function(e){return c.neo(this.m_impulse.x,this.m_impulse.y).mul(e)},t.prototype.getReactionTorque=function(e){return e*this.m_impulse.z},t.prototype.initVelocityConstraints=function(e){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var r=this.m_bodyA.c_position.a,n=this.m_bodyA.c_velocity.v,m=this.m_bodyA.c_velocity.w,l=this.m_bodyB.c_position.a,_=this.m_bodyB.c_velocity.v,A=this.m_bodyB.c_velocity.w,v=L.neo(r),d=L.neo(l);this.m_rA=L.mulVec2(v,c.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=L.mulVec2(d,c.sub(this.m_localAnchorB,this.m_localCenterB));var y=this.m_invMassA,b=this.m_invMassB,x=this.m_invIA,B=this.m_invIB,w=new Se;if(w.ex.x=y+b+this.m_rA.y*this.m_rA.y*x+this.m_rB.y*this.m_rB.y*B,w.ey.x=-this.m_rA.y*this.m_rA.x*x-this.m_rB.y*this.m_rB.x*B,w.ez.x=-this.m_rA.y*x-this.m_rB.y*B,w.ex.y=w.ey.x,w.ey.y=y+b+this.m_rA.x*this.m_rA.x*x+this.m_rB.x*this.m_rB.x*B,w.ez.y=this.m_rA.x*x+this.m_rB.x*B,w.ex.z=w.ez.x,w.ey.z=w.ez.y,w.ez.z=x+B,this.m_frequencyHz>0){w.getInverse22(this.m_mass);var M=x+B,V=M>0?1/M:0,z=l-r-this.m_referenceAngle,k=2*In*this.m_frequencyHz,D=2*V*this.m_dampingRatio*k,R=V*k*k,J=e.dt;this.m_gamma=J*(D+J*R),this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0,this.m_bias=z*J*R*this.m_gamma,M+=this.m_gamma,this.m_mass.ez.z=M!=0?1/M:0}else w.ez.z==0?(w.getInverse22(this.m_mass),this.m_gamma=0,this.m_bias=0):(w.getSymInverse33(this.m_mass),this.m_gamma=0,this.m_bias=0);if(e.warmStarting){this.m_impulse.mul(e.dtRatio);var O=c.neo(this.m_impulse.x,this.m_impulse.y);n.subMul(y,O),m-=x*(c.crossVec2Vec2(this.m_rA,O)+this.m_impulse.z),_.addMul(b,O),A+=B*(c.crossVec2Vec2(this.m_rB,O)+this.m_impulse.z)}else this.m_impulse.setZero();this.m_bodyA.c_velocity.v=n,this.m_bodyA.c_velocity.w=m,this.m_bodyB.c_velocity.v=_,this.m_bodyB.c_velocity.w=A},t.prototype.solveVelocityConstraints=function(e){var r=this.m_bodyA.c_velocity.v,n=this.m_bodyA.c_velocity.w,m=this.m_bodyB.c_velocity.v,l=this.m_bodyB.c_velocity.w,_=this.m_invMassA,A=this.m_invMassB,v=this.m_invIA,d=this.m_invIB;if(this.m_frequencyHz>0){var y=l-n,b=-this.m_mass.ez.z*(y+this.m_bias+this.m_gamma*this.m_impulse.z);this.m_impulse.z+=b,n-=v*b,l+=d*b,(w=c.zero()).addCombine(1,m,1,c.crossNumVec2(l,this.m_rB)),w.subCombine(1,r,1,c.crossNumVec2(n,this.m_rA));var x=c.neg(Se.mulVec2(this.m_mass,w));this.m_impulse.x+=x.x,this.m_impulse.y+=x.y;var B=c.clone(x);r.subMul(_,B),n-=v*c.crossVec2Vec2(this.m_rA,B),m.addMul(A,B),l+=d*c.crossVec2Vec2(this.m_rB,B)}else{var w;(w=c.zero()).addCombine(1,m,1,c.crossNumVec2(l,this.m_rB)),w.subCombine(1,r,1,c.crossNumVec2(n,this.m_rA)),y=l-n;var M=new ot(w.x,w.y,y),V=ot.neg(Se.mulVec3(this.m_mass,M));this.m_impulse.add(V),B=c.neo(V.x,V.y),r.subMul(_,B),n-=v*(c.crossVec2Vec2(this.m_rA,B)+V.z),m.addMul(A,B),l+=d*(c.crossVec2Vec2(this.m_rB,B)+V.z)}this.m_bodyA.c_velocity.v=r,this.m_bodyA.c_velocity.w=n,this.m_bodyB.c_velocity.v=m,this.m_bodyB.c_velocity.w=l},t.prototype.solvePositionConstraints=function(e){var r,n,m=this.m_bodyA.c_position.c,l=this.m_bodyA.c_position.a,_=this.m_bodyB.c_position.c,A=this.m_bodyB.c_position.a,v=L.neo(l),d=L.neo(A),y=this.m_invMassA,b=this.m_invMassB,x=this.m_invIA,B=this.m_invIB,w=L.mulVec2(v,c.sub(this.m_localAnchorA,this.m_localCenterA)),M=L.mulVec2(d,c.sub(this.m_localAnchorB,this.m_localCenterB)),V=new Se;if(V.ex.x=y+b+w.y*w.y*x+M.y*M.y*B,V.ey.x=-w.y*w.x*x-M.y*M.x*B,V.ez.x=-w.y*x-M.y*B,V.ex.y=V.ey.x,V.ey.y=y+b+w.x*w.x*x+M.x*M.x*B,V.ez.y=w.x*x+M.x*B,V.ex.z=V.ez.x,V.ey.z=V.ez.y,V.ez.z=x+B,this.m_frequencyHz>0){(k=c.zero()).addCombine(1,_,1,M),k.subCombine(1,m,1,w),r=k.length(),n=0;var z=c.neg(V.solve22(k));m.subMul(y,z),l-=x*c.crossVec2Vec2(w,z),_.addMul(b,z),A+=B*c.crossVec2Vec2(M,z)}else{var k;(k=c.zero()).addCombine(1,_,1,M),k.subCombine(1,m,1,w);var D=A-l-this.m_referenceAngle;r=k.length(),n=Vn(D);var R=new ot(k.x,k.y,D),J=new ot;if(V.ez.z>0)J=ot.neg(V.solve33(R));else{var O=c.neg(V.solve22(k));J.set(O.x,O.y,0)}z=c.neo(J.x,J.y),m.subMul(y,z),l-=x*(c.crossVec2Vec2(w,z)+J.z),_.addMul(b,z),A+=B*(c.crossVec2Vec2(M,z)+J.z)}return this.m_bodyA.c_position.c=m,this.m_bodyA.c_position.a=l,this.m_bodyB.c_position.c=_,this.m_bodyB.c_position.a=A,r<=W.linearSlop&&n<=W.angularSlop},t.TYPE="weld-joint",t}(Ot),Pn=Math.abs,zn=Math.PI,Fn={enableMotor:!1,maxMotorTorque:0,motorSpeed:0,frequencyHz:2,dampingRatio:.7},$s=function(s){function t(e,r,n,m,l){var _=this;return _ instanceof t?(e=xt(e,Fn),r=(_=s.call(this,e,r,n)||this).m_bodyA,n=_.m_bodyB,_.m_ax=c.zero(),_.m_ay=c.zero(),_.m_type=t.TYPE,_.m_localAnchorA=c.clone(m?r.getLocalPoint(m):e.localAnchorA||c.zero()),_.m_localAnchorB=c.clone(m?n.getLocalPoint(m):e.localAnchorB||c.zero()),c.isValid(l)?_.m_localXAxisA=r.getLocalVector(l):c.isValid(e.localAxisA)?_.m_localXAxisA=c.clone(e.localAxisA):c.isValid(e.localAxis)?_.m_localXAxisA=c.clone(e.localAxis):_.m_localXAxisA=c.neo(1,0),_.m_localYAxisA=c.crossNumVec2(1,_.m_localXAxisA),_.m_mass=0,_.m_impulse=0,_.m_motorMass=0,_.m_motorImpulse=0,_.m_springMass=0,_.m_springImpulse=0,_.m_maxMotorTorque=e.maxMotorTorque,_.m_motorSpeed=e.motorSpeed,_.m_enableMotor=e.enableMotor,_.m_frequencyHz=e.frequencyHz,_.m_dampingRatio=e.dampingRatio,_.m_bias=0,_.m_gamma=0,_):new t(e,r,n,m,l)}return Y(t,s),t.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,enableMotor:this.m_enableMotor,maxMotorTorque:this.m_maxMotorTorque,motorSpeed:this.m_motorSpeed,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,localAxisA:this.m_localXAxisA}},t._deserialize=function(e,r,n){return(e=it({},e)).bodyA=n(ht,e.bodyA,r),e.bodyB=n(ht,e.bodyB,r),new t(e)},t.prototype._reset=function(e){e.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(e.anchorA)):e.localAnchorA&&this.m_localAnchorA.setVec2(e.localAnchorA),e.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(e.anchorB)):e.localAnchorB&&this.m_localAnchorB.setVec2(e.localAnchorB),e.localAxisA&&(this.m_localXAxisA.setVec2(e.localAxisA),this.m_localYAxisA.setVec2(c.crossNumVec2(1,e.localAxisA))),e.enableMotor!==void 0&&(this.m_enableMotor=e.enableMotor),Number.isFinite(e.maxMotorTorque)&&(this.m_maxMotorTorque=e.maxMotorTorque),Number.isFinite(e.motorSpeed)&&(this.m_motorSpeed=e.motorSpeed),Number.isFinite(e.frequencyHz)&&(this.m_frequencyHz=e.frequencyHz),Number.isFinite(e.dampingRatio)&&(this.m_dampingRatio=e.dampingRatio)},t.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},t.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},t.prototype.getLocalAxisA=function(){return this.m_localXAxisA},t.prototype.getJointTranslation=function(){var e=this.m_bodyA,r=this.m_bodyB,n=e.getWorldPoint(this.m_localAnchorA),m=r.getWorldPoint(this.m_localAnchorB),l=c.sub(m,n),_=e.getWorldVector(this.m_localXAxisA);return c.dot(l,_)},t.prototype.getJointSpeed=function(){var e=this.m_bodyA.m_angularVelocity;return this.m_bodyB.m_angularVelocity-e},t.prototype.isMotorEnabled=function(){return this.m_enableMotor},t.prototype.enableMotor=function(e){e!=this.m_enableMotor&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=e)},t.prototype.setMotorSpeed=function(e){e!=this.m_motorSpeed&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=e)},t.prototype.getMotorSpeed=function(){return this.m_motorSpeed},t.prototype.setMaxMotorTorque=function(e){e!=this.m_maxMotorTorque&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorTorque=e)},t.prototype.getMaxMotorTorque=function(){return this.m_maxMotorTorque},t.prototype.getMotorTorque=function(e){return e*this.m_motorImpulse},t.prototype.setSpringFrequencyHz=function(e){this.m_frequencyHz=e},t.prototype.getSpringFrequencyHz=function(){return this.m_frequencyHz},t.prototype.setSpringDampingRatio=function(e){this.m_dampingRatio=e},t.prototype.getSpringDampingRatio=function(){return this.m_dampingRatio},t.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},t.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},t.prototype.getReactionForce=function(e){return c.combine(this.m_impulse,this.m_ay,this.m_springImpulse,this.m_ax).mul(e)},t.prototype.getReactionTorque=function(e){return e*this.m_motorImpulse},t.prototype.initVelocityConstraints=function(e){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var r=this.m_invMassA,n=this.m_invMassB,m=this.m_invIA,l=this.m_invIB,_=this.m_bodyA.c_position.c,A=this.m_bodyA.c_position.a,v=this.m_bodyA.c_velocity.v,d=this.m_bodyA.c_velocity.w,y=this.m_bodyB.c_position.c,b=this.m_bodyB.c_position.a,x=this.m_bodyB.c_velocity.v,B=this.m_bodyB.c_velocity.w,w=L.neo(A),M=L.neo(b),V=L.mulVec2(w,c.sub(this.m_localAnchorA,this.m_localCenterA)),z=L.mulVec2(M,c.sub(this.m_localAnchorB,this.m_localCenterB)),k=c.zero();if(k.addCombine(1,y,1,z),k.subCombine(1,_,1,V),this.m_ay=L.mulVec2(w,this.m_localYAxisA),this.m_sAy=c.crossVec2Vec2(c.add(k,V),this.m_ay),this.m_sBy=c.crossVec2Vec2(z,this.m_ay),this.m_mass=r+n+m*this.m_sAy*this.m_sAy+l*this.m_sBy*this.m_sBy,this.m_mass>0&&(this.m_mass=1/this.m_mass),this.m_springMass=0,this.m_bias=0,this.m_gamma=0,this.m_frequencyHz>0){this.m_ax=L.mulVec2(w,this.m_localXAxisA),this.m_sAx=c.crossVec2Vec2(c.add(k,V),this.m_ax),this.m_sBx=c.crossVec2Vec2(z,this.m_ax);var D=r+n+m*this.m_sAx*this.m_sAx+l*this.m_sBx*this.m_sBx;if(D>0){this.m_springMass=1/D;var R=c.dot(k,this.m_ax),J=2*zn*this.m_frequencyHz,O=2*this.m_springMass*this.m_dampingRatio*J,N=this.m_springMass*J*J,rt=e.dt;this.m_gamma=rt*(O+rt*N),this.m_gamma>0&&(this.m_gamma=1/this.m_gamma),this.m_bias=R*rt*N*this.m_gamma,this.m_springMass=D+this.m_gamma,this.m_springMass>0&&(this.m_springMass=1/this.m_springMass)}}else this.m_springImpulse=0;if(this.m_enableMotor?(this.m_motorMass=m+l,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass)):(this.m_motorMass=0,this.m_motorImpulse=0),e.warmStarting){this.m_impulse*=e.dtRatio,this.m_springImpulse*=e.dtRatio,this.m_motorImpulse*=e.dtRatio;var et=c.combine(this.m_impulse,this.m_ay,this.m_springImpulse,this.m_ax),st=this.m_impulse*this.m_sAy+this.m_springImpulse*this.m_sAx+this.m_motorImpulse,ct=this.m_impulse*this.m_sBy+this.m_springImpulse*this.m_sBx+this.m_motorImpulse;v.subMul(this.m_invMassA,et),d-=this.m_invIA*st,x.addMul(this.m_invMassB,et),B+=this.m_invIB*ct}else this.m_impulse=0,this.m_springImpulse=0,this.m_motorImpulse=0;this.m_bodyA.c_velocity.v.setVec2(v),this.m_bodyA.c_velocity.w=d,this.m_bodyB.c_velocity.v.setVec2(x),this.m_bodyB.c_velocity.w=B},t.prototype.solveVelocityConstraints=function(e){var r=this.m_invMassA,n=this.m_invMassB,m=this.m_invIA,l=this.m_invIB,_=this.m_bodyA.c_velocity.v,A=this.m_bodyA.c_velocity.w,v=this.m_bodyB.c_velocity.v,d=this.m_bodyB.c_velocity.w,y=c.dot(this.m_ax,v)-c.dot(this.m_ax,_)+this.m_sBx*d-this.m_sAx*A,b=-this.m_springMass*(y+this.m_bias+this.m_gamma*this.m_springImpulse);this.m_springImpulse+=b;var x=c.mulNumVec2(b,this.m_ax),B=b*this.m_sAx,w=b*this.m_sBx;_.subMul(r,x),A-=m*B,v.addMul(n,x),y=(d+=l*w)-A-this.m_motorSpeed,b=-this.m_motorMass*y;var M=this.m_motorImpulse,V=e.dt*this.m_maxMotorTorque;this.m_motorImpulse=gt(this.m_motorImpulse+b,-V,V),A-=m*(b=this.m_motorImpulse-M),d+=l*b,y=c.dot(this.m_ay,v)-c.dot(this.m_ay,_)+this.m_sBy*d-this.m_sAy*A,b=-this.m_mass*y,this.m_impulse+=b,x=c.mulNumVec2(b,this.m_ay),B=b*this.m_sAy,w=b*this.m_sBy,_.subMul(r,x),A-=m*B,v.addMul(n,x),d+=l*w,this.m_bodyA.c_velocity.v.setVec2(_),this.m_bodyA.c_velocity.w=A,this.m_bodyB.c_velocity.v.setVec2(v),this.m_bodyB.c_velocity.w=d},t.prototype.solvePositionConstraints=function(e){var r=this.m_bodyA.c_position.c,n=this.m_bodyA.c_position.a,m=this.m_bodyB.c_position.c,l=this.m_bodyB.c_position.a,_=L.neo(n),A=L.neo(l),v=L.mulVec2(_,c.sub(this.m_localAnchorA,this.m_localCenterA)),d=L.mulVec2(A,c.sub(this.m_localAnchorB,this.m_localCenterB)),y=c.zero();y.addCombine(1,m,1,d),y.subCombine(1,r,1,v);var b=L.mulVec2(_,this.m_localYAxisA),x=c.crossVec2Vec2(c.add(y,v),b),B=c.crossVec2Vec2(d,b),w=c.dot(y,b),M=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_sAy*this.m_sAy+this.m_invIB*this.m_sBy*this.m_sBy,V=M!=0?-w/M:0,z=c.mulNumVec2(V,b),k=V*x,D=V*B;return r.subMul(this.m_invMassA,z),n-=this.m_invIA*k,m.addMul(this.m_invMassB,z),l+=this.m_invIB*D,this.m_bodyA.c_position.c.setVec2(r),this.m_bodyA.c_position.a=n,this.m_bodyB.c_position.c.setVec2(m),this.m_bodyB.c_position.a=l,Pn(w)<=W.linearSlop},t.TYPE="wheel-joint",t}(Ot),Ln=0,Ar={World:Li,Body:ht,Joint:Ot,Fixture:wi,Shape:Le},wr={Vec2:c,Vec3:ot,World:Li,Body:ht,Joint:Ot,Fixture:wi,Shape:Le},kn=((jt={})[ht.STATIC]=ht,jt[ht.DYNAMIC]=ht,jt[ht.KINEMATIC]=ht,jt[mi.TYPE]=mi,jt[fe.TYPE]=fe,jt[de.TYPE]=de,jt[Be.TYPE]=Be,jt[Js.TYPE]=Js,jt[Ys.TYPE]=Ys,jt[Us.TYPE]=Us,jt[Hs.TYPE]=Hs,jt[Ks.TYPE]=Ks,jt[Gs.TYPE]=Gs,jt[Xs.TYPE]=Xs,jt[Ce.TYPE]=Ce,jt[Zs.TYPE]=Zs,jt[Qs.TYPE]=Qs,jt[$s.TYPE]=$s,jt),jn={rootClass:Li,preSerialize:function(s){return s},postSerialize:function(s,t){return s},preDeserialize:function(s){return s},postDeserialize:function(s,t){return s}},is=function(s){var t=this;this.toJson=function(e){var r=t.options.preSerialize,n=t.options.postSerialize,m=[],l=[e],_={};function A(y,b){if(y.__sid=y.__sid||++Ln,!_[y.__sid]){l.push(y);var x={refIndex:m.length+l.length,refType:b};_[y.__sid]=x}return _[y.__sid]}function v(y,b){if(b===void 0&&(b=!1),typeof y!="object"||y===null)return y;if(typeof y._serialize=="function"){if(!b){for(var x in Ar)if(y instanceof Ar[x])return A(y,x)}y=function(M){var V=(M=r(M))._serialize();return n(V,M)}(y)}if(Array.isArray(y)){for(var B=[],w=0;w<y.length;w++)B[w]=v(y[w]);y=B}else{for(var w in B={},y)y.hasOwnProperty(w)&&(B[w]=v(y[w]));y=B}return y}for(;l.length;){var d=v(l.shift(),!0);m.push(d)}return m},this.fromJson=function(e){var r=t.options.preDeserialize,n=t.options.postDeserialize,m=t.options.rootClass,l={};function _(v,d,y){if(v&&v._deserialize||(v=kn[d.type]),v&&v._deserialize){d=r(d);var b=(0,v._deserialize)(d,y,A);return b=n(b,d)}}function A(v,d,y){if(!d.refIndex||!d.refType)return _(v,d,y);var b=d;wr[b.refType]&&(v=wr[b.refType]);var x=b.refIndex;if(!l[x]){var B=_(v,e[x],y);l[x]=B}return l[x]}return _(m,e[0],null)},this.options=it(it({},jn),s)},Br=new is({rootClass:Li});is.fromJson=Br.fromJson,is.toJson=Br.toJson;var Vo=function(){function s(){this.width=80,this.height=60,this.x=0,this.y=-10,this.scaleY=-1,this.hz=60,this.speed=1,this.background="#222222",this.activeKeys={},this.step=function(t,e){},this.keydown=function(t,e){},this.keyup=function(t,e){},this.statusText="",this.statusMap={}}return s.mount=function(t){throw new Error("Not implemented")},s.start=function(t){var e=s.mount();return e.start(t),e},s.prototype.status=function(t,e){if(e!==void 0){var r=t,n=e;typeof n!="function"&&typeof n!="object"&&(this.statusMap[r]=n)}else if(t&&typeof t=="object")for(var m in t){var l=t[m];typeof l!="function"&&typeof l!="object"&&(this.statusMap[m]=l)}else typeof t=="string"&&(this.statusText=t);var _=this.statusText||"";for(var A in this.statusMap){var v=this.statusMap[A];typeof v!="function"&&(_+=(_&&`
`)+A+": "+v)}this._status(_)},s.prototype.info=function(t){this._info(t)},s.prototype.color=function(t,e,r){return"rgb("+(t=256*t|0)+", "+(e=256*e|0)+", "+(r=256*r|0)+")"},s}();function Sr(s,t){var e,r;typeof s=="function"?(e=s,r=t):typeof t=="function"?(e=t,r=s):r=s??t;var n=Vo.mount(r);if(!e)return n;var m=e(n)||n.world;n.start(m)}var Io=function(s){function t(e,r,n,m){var l=this;return l instanceof t?((l=s.call(this)||this)._setAsBox(e,r,n,m),l):new t(e,r,n,m)}return Y(t,s),t.TYPE="polygon",t}(fe),Cr=Io;ce.addType(Be.TYPE,Be.TYPE,function(s,t,e,r,n,m,l){To(s,e.getShape(),t,m.getShape(),n)});var Mr=P(0,0),Vr=P(0,0),To=function(s,t,e,r,n){s.pointCount=0,K(Mr,e,t.m_p),K(Vr,n,r.m_p);var m=At(Vr,Mr),l=t.m_radius+r.m_radius;m>l*l||(s.type=S.ManifoldType.e_circles,o(s.localPoint,t.m_p),h(s.localNormal),s.pointCount=1,o(s.points[0].localPoint,r.m_p),s.points[0].id.setFeatures(0,S.ContactFeatureType.e_vertex,0,S.ContactFeatureType.e_vertex))};ce.addType(de.TYPE,Be.TYPE,function(s,t,e,r,n,m,l){var _=e.getShape(),A=m.getShape();to(s,_,t,A,n)}),ce.addType(mi.TYPE,Be.TYPE,function(s,t,e,r,n,m,l){var _=e.getShape(),A=new de;_.getChildEdge(A,r);var v=A,d=m.getShape();to(s,v,t,d,n)});var _i=P(0,0),Po=P(0,0),zo=P(0,0),Ee=P(0,0),pi=P(0,0),ji=P(0,0),to=function(s,t,e,r,n){s.pointCount=0,Do(Ee,n,e,r.m_p);var m=t.m_vertex1,l=t.m_vertex2;g(_i,l,m);var _=j(_i,l)-j(_i,Ee),A=j(_i,Ee)-j(_i,m),v=t.m_radius+r.m_radius;if(A<=0){if(o(pi,m),At(Ee,m)>v*v)return;if(t.m_hasVertex0){var d=t.m_vertex0,y=m;if(g(Po,y,d),j(Po,y)-j(Po,Ee)>0)return}return s.type=S.ManifoldType.e_circles,h(s.localNormal),o(s.localPoint,pi),s.pointCount=1,o(s.points[0].localPoint,r.m_p),void s.points[0].id.setFeatures(0,S.ContactFeatureType.e_vertex,0,S.ContactFeatureType.e_vertex)}if(_<=0){if(o(pi,l),At(Ee,pi)>v*v)return;if(t.m_hasVertex3){var b=t.m_vertex3,x=l;if(g(zo,b,x),j(zo,Ee)-j(zo,x)>0)return}return s.type=S.ManifoldType.e_circles,h(s.localNormal),o(s.localPoint,pi),s.pointCount=1,o(s.points[0].localPoint,r.m_p),void s.points[0].id.setFeatures(1,S.ContactFeatureType.e_vertex,0,S.ContactFeatureType.e_vertex)}var B=tt(_i);E(pi,_/B,m,A/B,l),At(Ee,pi)>v*v||($(ji,1,_i),j(ji,Ee)-j(ji,m)<0&&u(ji),F(ji),s.type=S.ManifoldType.e_faceA,o(s.localNormal,ji),o(s.localPoint,m),s.pointCount=1,o(s.points[0].localPoint,r.m_p),s.points[0].id.setFeatures(0,S.ContactFeatureType.e_face,0,S.ContactFeatureType.e_vertex))},eo=[new Yt,new Yt],io=[new Yt,new Yt],di=[new Yt,new Yt],so=P(0,0),Ir=P(0,0),Fo=P(0,0),Lo=_t(0,0,0),fi=P(0,0),qi=P(0,0),oo=P(0,0),Tr=P(0,0),Pr=P(0,0),Xe=P(0,0),ko=P(0,0),zr=P(0,0);function Fr(s,t,e,r,n){var m=s.m_count,l=e.m_count,_=s.m_normals,A=s.m_vertices,v=e.m_vertices;No(Lo,r,t);for(var d=0,y=-1/0,b=0;b<m;++b){St(Fo,Lo.q,_[b]),K(Ir,Lo,A[b]);for(var x=1/0,B=0;B<l;++B){var w=j(Fo,v[B])-j(Fo,Ir);w<x&&(x=w)}x>y&&(y=x,d=b)}n.maxSeparation=y,n.bestIndex=d}ce.addType(fe.TYPE,fe.TYPE,function(s,t,e,r,n,m,l){ro(s,e.getShape(),t,m.getShape(),n)});var Oi={maxSeparation:0,bestIndex:0},ro=function(s,t,e,r,n){s.pointCount=0;var m=t.m_radius+r.m_radius;Fr(t,e,r,n,Oi);var l=Oi.bestIndex,_=Oi.maxSeparation;if(!(_>m)){Fr(r,n,t,e,Oi);var A=Oi.bestIndex,v=Oi.maxSeparation;if(!(v>m)){var d,y,b,x,B,w;v>_+.1*W.linearSlop?(d=r,y=t,b=n,x=e,B=A,s.type=S.ManifoldType.e_faceB,w=!0):(d=t,y=r,b=e,x=n,B=l,s.type=S.ManifoldType.e_faceA,w=!1),eo[0].recycle(),eo[1].recycle(),function(et,st,ct,at,dt,Wt){var vt=st.m_normals,oe=dt.m_count,Dt=dt.m_vertices,yi=dt.m_normals;(function(gi,vi,xi,bi){var ze=vi.c*bi.x+vi.s*bi.y,Dr=-vi.s*bi.x+vi.c*bi.y,Rn=xi.c*ze-xi.s*Dr,En=xi.s*ze+xi.c*Dr;gi.x=Rn,gi.y=En})(zr,Wt.q,ct.q,vt[at]);for(var ve=0,re=1/0,Jt=0;Jt<oe;++Jt){var Te=j(zr,yi[Jt]);Te<re&&(re=Te,ve=Jt)}var Pe=ve,We=Pe+1<oe?Pe+1:0;K(et[0].v,Wt,Dt[Pe]),et[0].id.setFeatures(at,S.ContactFeatureType.e_face,Pe,S.ContactFeatureType.e_vertex),K(et[1].v,Wt,Dt[We]),et[1].id.setFeatures(at,S.ContactFeatureType.e_face,We,S.ContactFeatureType.e_vertex)}(eo,d,b,B,y,x);var M=d.m_count,V=d.m_vertices,z=B,k=B+1<M?B+1:0;o(fi,V[z]),o(qi,V[k]),g(oo,qi,fi),F(oo),U(Tr,oo,1),E(Pr,.5,fi,.5,qi),St(Xe,b.q,oo),U(ko,Xe,1),K(fi,b,fi),K(qi,b,qi);var D=j(ko,fi),R=-j(Xe,fi)+m,J=j(Xe,qi)+m;if(io[0].recycle(),io[1].recycle(),di[0].recycle(),di[1].recycle(),i(so,-Xe.x,-Xe.y),!(ni(io,eo,so,R,z)<2)&&(i(so,Xe.x,Xe.y),!(ni(di,io,so,J,k)<2))){o(s.localNormal,Tr),o(s.localPoint,Pr);for(var O=0,N=0;N<di.length;++N)if(j(ko,di[N].v)-D<=m){var rt=s.points[O];ii(rt.localPoint,x,di[N].v),rt.id.set(di[N].id),w&&rt.id.swapFeatures(),++O}s.pointCount=O}}}};ce.addType(fe.TYPE,Be.TYPE,function(s,t,e,r,n,m,l){qo(s,e.getShape(),t,m.getShape(),n)});var ye=P(0,0),jo=P(0,0),qo=function(s,t,e,r,n){s.pointCount=0,Do(ye,n,e,r.m_p);for(var m=0,l=-1/0,_=t.m_radius+r.m_radius,A=t.m_count,v=t.m_vertices,d=t.m_normals,y=0;y<A;++y){var b=j(d[y],ye)-j(d[y],v[y]);if(b>_)return;b>l&&(l=b,m=y)}var x=m,B=x+1<A?x+1:0,w=v[x],M=v[B];if(l<nt)return s.pointCount=1,s.type=S.ManifoldType.e_faceA,o(s.localNormal,d[m]),E(s.localPoint,.5,w,.5,M),o(s.points[0].localPoint,r.m_p),void s.points[0].id.setFeatures(0,S.ContactFeatureType.e_vertex,0,S.ContactFeatureType.e_vertex);var V=j(ye,M)-j(ye,w)-j(w,M)+j(w,w),z=j(ye,w)-j(ye,M)-j(M,w)+j(M,M);if(V<=0){if(At(ye,w)>_*_)return;s.pointCount=1,s.type=S.ManifoldType.e_faceA,g(s.localNormal,ye,w),F(s.localNormal),o(s.localPoint,w),o(s.points[0].localPoint,r.m_p),s.points[0].id.setFeatures(0,S.ContactFeatureType.e_vertex,0,S.ContactFeatureType.e_vertex)}else if(z<=0){if(At(ye,M)>_*_)return;s.pointCount=1,s.type=S.ManifoldType.e_faceA,g(s.localNormal,ye,M),F(s.localNormal),o(s.localPoint,M),o(s.points[0].localPoint,r.m_p),s.points[0].id.setFeatures(0,S.ContactFeatureType.e_vertex,0,S.ContactFeatureType.e_vertex)}else{if(E(jo,.5,w,.5,M),j(ye,d[x])-j(jo,d[x])>_)return;s.pointCount=1,s.type=S.ManifoldType.e_faceA,o(s.localNormal,d[x]),o(s.localPoint,jo),o(s.points[0].localPoint,r.m_p),s.points[0].id.setFeatures(0,S.ContactFeatureType.e_vertex,0,S.ContactFeatureType.e_vertex)}},qn=Math.min;ce.addType(de.TYPE,fe.TYPE,function(s,t,e,r,n,m,l){ho(s,e.getShape(),t,m.getShape(),n)}),ce.addType(mi.TYPE,fe.TYPE,function(s,t,e,r,n,m,l){e.getShape().getChildEdge(kr,r),ho(s,kr,t,m.getShape(),n)});var ue,Lr,kr=new de;(function(s){s[s.e_unknown=-1]="e_unknown",s[s.e_edgeA=1]="e_edgeA",s[s.e_edgeB=2]="e_edgeB"})(ue||(ue={})),function(s){s[s.e_isolated=0]="e_isolated",s[s.e_concave=1]="e_concave",s[s.e_convex=2]="e_convex"}(Lr||(Lr={}));var jr=function(){},On=function(){this.vertices=[],this.normals=[],this.count=0;for(var s=0;s<W.maxPolygonVertices;s++)this.vertices.push(P(0,0)),this.normals.push(P(0,0))},Dn=function(){function s(){this.v1=P(0,0),this.v2=P(0,0),this.normal=P(0,0),this.sideNormal1=P(0,0),this.sideNormal2=P(0,0)}return s.prototype.recycle=function(){h(this.v1),h(this.v2),h(this.normal),h(this.sideNormal1),h(this.sideNormal2)},s}(),no=[new Yt,new Yt],Ze=[new Yt,new Yt],ge=[new Yt,new Yt],Me=new jr,Gt=new jr,qt=new On,Q=new Dn,ao=P(0,0),ss=P(0,0),Di=P(0,0),os=P(0,0),rs=_t(0,0,0),pt=P(0,0),Ve=P(0,0),Z=P(0,0),Ie=P(0,0),zt=P(0,0),Ft=P(0,0),qr=P(0,0),Qe=P(0,0),ho=function(s,t,e,r,n){No(rs,e,n),K(ao,rs,r.m_centroid);var m=t.m_vertex0,l=t.m_vertex1,_=t.m_vertex2,A=t.m_vertex3,v=t.m_hasVertex0,d=t.m_hasVertex3;g(Di,_,l),F(Di),i(Z,Di.y,-Di.x);var y,b=j(Z,ao)-j(Z,l),x=0,B=0,w=!1,M=!1;h(Ve),h(Ie),v&&(g(ss,l,m),F(ss),i(Ve,ss.y,-ss.x),w=G(ss,Di)>=0,x=c.dot(Ve,ao)-c.dot(Ve,m)),d&&(g(os,A,_),F(os),i(Ie,os.y,-os.x),M=c.crossVec2Vec2(Di,os)>0,B=c.dot(Ie,ao)-c.dot(Ie,_)),h(pt),h(zt),h(Ft),v&&d?w&&M?(y=x>=0||b>=0||B>=0)?(o(pt,Z),o(zt,Ve),o(Ft,Ie)):(C(pt,-1,Z),C(zt,-1,Z),C(Ft,-1,Z)):w?(y=x>=0||b>=0&&B>=0)?(o(pt,Z),o(zt,Ve),o(Ft,Z)):(C(pt,-1,Z),C(zt,-1,Ie),C(Ft,-1,Z)):M?(y=B>=0||x>=0&&b>=0)?(o(pt,Z),o(zt,Z),o(Ft,Ie)):(C(pt,-1,Z),C(zt,-1,Z),C(Ft,-1,Ve)):(y=x>=0&&b>=0&&B>=0)?(o(pt,Z),o(zt,Z),o(Ft,Z)):(C(pt,-1,Z),C(zt,-1,Ie),C(Ft,-1,Ve)):v?w?(y=x>=0||b>=0)?(o(pt,Z),o(zt,Ve),C(Ft,-1,Z)):(C(pt,-1,Z),o(zt,Z),C(Ft,-1,Z)):(y=x>=0&&b>=0)?(o(pt,Z),o(zt,Z),C(Ft,-1,Z)):(C(pt,-1,Z),o(zt,Z),C(Ft,-1,Ve)):d?M?(y=b>=0||B>=0)?(o(pt,Z),C(zt,-1,Z),o(Ft,Ie)):(C(pt,-1,Z),C(zt,-1,Z),o(Ft,Z)):(y=b>=0&&B>=0)?(o(pt,Z),C(zt,-1,Z),o(Ft,Z)):(C(pt,-1,Z),C(zt,-1,Ie),o(Ft,Z)):(y=b>=0)?(o(pt,Z),C(zt,-1,Z),C(Ft,-1,Z)):(C(pt,-1,Z),o(zt,Z),o(Ft,Z)),qt.count=r.m_count;for(var V=0;V<r.m_count;++V)K(qt.vertices[V],rs,r.m_vertices[V]),St(qt.normals[V],rs.q,r.m_normals[V]);var z=r.m_radius+t.m_radius;for(s.pointCount=0,Me.type=ue.e_edgeA,Me.index=y?0:1,Me.separation=1/0,V=0;V<qt.count;++V){var k=qt.vertices[V];(D=j(pt,k)-j(pt,l))<Me.separation&&(Me.separation=D)}if(Me.type!=ue.e_unknown&&!(Me.separation>z)){for(Gt.type=ue.e_unknown,Gt.index=-1,Gt.separation=-1/0,i(qr,-pt.y,pt.x),V=0;V<qt.count;++V){C(Qe,-1,qt.normals[V]);var D,R=j(Qe,qt.vertices[V])-j(Qe,l),J=j(Qe,qt.vertices[V])-j(Qe,_);if((D=qn(R,J))>z){Gt.type=ue.e_edgeB,Gt.index=V,Gt.separation=D;break}if(j(Qe,qr)>=0){if(j(Qe,pt)-j(Ft,pt)<-W.angularSlop)continue}else if(j(Qe,pt)-j(zt,pt)<-W.angularSlop)continue;D>Gt.separation&&(Gt.type=ue.e_edgeB,Gt.index=V,Gt.separation=D)}if(!(Gt.type!=ue.e_unknown&&Gt.separation>z)){var O;if(O=Gt.type==ue.e_unknown?Me:Gt.separation>.98*Me.separation+.001?Gt:Me,ge[0].recycle(),ge[1].recycle(),O.type==ue.e_edgeA){s.type=S.ManifoldType.e_faceA;var N=0,rt=j(pt,qt.normals[0]);for(V=1;V<qt.count;++V){var et=j(pt,qt.normals[V]);et<rt&&(rt=et,N=V)}var st=N,ct=st+1<qt.count?st+1:0;o(ge[0].v,qt.vertices[st]),ge[0].id.setFeatures(0,S.ContactFeatureType.e_face,st,S.ContactFeatureType.e_vertex),o(ge[1].v,qt.vertices[ct]),ge[1].id.setFeatures(0,S.ContactFeatureType.e_face,ct,S.ContactFeatureType.e_vertex),y?(Q.i1=0,Q.i2=1,o(Q.v1,l),o(Q.v2,_),o(Q.normal,Z)):(Q.i1=1,Q.i2=0,o(Q.v1,_),o(Q.v2,l),C(Q.normal,-1,Z))}else s.type=S.ManifoldType.e_faceB,o(ge[0].v,l),ge[0].id.setFeatures(0,S.ContactFeatureType.e_vertex,O.index,S.ContactFeatureType.e_face),o(ge[1].v,_),ge[1].id.setFeatures(0,S.ContactFeatureType.e_vertex,O.index,S.ContactFeatureType.e_face),Q.i1=O.index,Q.i2=Q.i1+1<qt.count?Q.i1+1:0,o(Q.v1,qt.vertices[Q.i1]),o(Q.v2,qt.vertices[Q.i2]),o(Q.normal,qt.normals[Q.i1]);if(i(Q.sideNormal1,Q.normal.y,-Q.normal.x),i(Q.sideNormal2,-Q.sideNormal1.x,-Q.sideNormal1.y),Q.sideOffset1=j(Q.sideNormal1,Q.v1),Q.sideOffset2=j(Q.sideNormal2,Q.v2),no[0].recycle(),no[1].recycle(),Ze[0].recycle(),Ze[1].recycle(),!(ni(no,ge,Q.sideNormal1,Q.sideOffset1,Q.i1)<W.maxManifoldPoints)&&!(ni(Ze,no,Q.sideNormal2,Q.sideOffset2,Q.i2)<W.maxManifoldPoints)){O.type==ue.e_edgeA?(o(s.localNormal,Q.normal),o(s.localPoint,Q.v1)):(o(s.localNormal,r.m_normals[Q.i1]),o(s.localPoint,r.m_vertices[Q.i1]));var at=0;for(V=0;V<W.maxManifoldPoints;++V)if(j(Q.normal,Ze[V].v)-j(Q.normal,Q.v1)<=z){var dt=s.points[at];O.type==ue.e_edgeA?(ii(dt.localPoint,rs,Ze[V].v),dt.id.set(Ze[V].id)):(o(dt.localPoint,Ze[V].v),dt.id.set(Ze[V].id),dt.id.swapFeatures()),++at}s.pointCount=at}}}},Or={CollidePolygons:ro,Settings:W,Sweep:Fe,Manifold:Zi,Distance:xe,TimeOfImpact:Ci,DynamicTree:Ai,stats:ft},Nn=Object.freeze({__proto__:null,Math:ne,Serializer:is,Testbed:Vo,testbed:Sr,Vec2:c,Vec3:ot,Mat22:ie,Mat33:Se,Transform:Nt,Rot:L,AABB:bt,Shape:Le,FixtureProxy:cs,Fixture:wi,Body:ht,ContactEdge:qs,mixFriction:Os,mixRestitution:Ds,VelocityConstraintPoint:Ns,Contact:ce,JointEdge:ds,Joint:Ot,World:Li,CircleShape:Be,Circle:vr,EdgeShape:de,Edge:cr,PolygonShape:fe,Polygon:yr,ChainShape:mi,Chain:pr,BoxShape:Io,Box:Cr,CollideCircles:To,CollideEdgeCircle:to,CollidePolygons:ro,CollidePolygonCircle:qo,CollideEdgePolygon:ho,DistanceJoint:Js,FrictionJoint:Ys,GearJoint:Us,MotorJoint:Hs,MouseJoint:Ks,PrismaticJoint:Gs,PulleyJoint:Xs,RevoluteJoint:Ce,RopeJoint:Zs,WeldJoint:Qs,WheelJoint:$s,Settings:X,SettingsInternal:W,Sweep:Fe,get ManifoldType(){return S.ManifoldType},get ContactFeatureType(){return S.ContactFeatureType},get PointState(){return S.PointState},ClipVertex:Yt,Manifold:Zi,ManifoldPoint:Fs,ContactID:Ls,WorldManifold:ks,getPointStates:Bo,clipSegmentToLine:ni,DistanceInput:Yi,DistanceOutput:Gi,SimplexCache:Ui,Distance:xe,DistanceProxy:ke,testOverlap:As,ShapeCastInput:$o,ShapeCastOutput:tr,ShapeCast:er,TOIInput:Bs,get TOIOutputState(){return S.TOIOutputState},TOIOutput:Ss,TimeOfImpact:Ci,TreeNode:Ht,DynamicTree:Ai,stats:ft,internal:Or});S.AABB=bt,S.Body=ht,S.Box=Cr,S.BoxShape=Io,S.Chain=pr,S.ChainShape=mi,S.Circle=vr,S.CircleShape=Be,S.ClipVertex=Yt,S.CollideCircles=To,S.CollideEdgeCircle=to,S.CollideEdgePolygon=ho,S.CollidePolygonCircle=qo,S.CollidePolygons=ro,S.Contact=ce,S.ContactEdge=qs,S.ContactID=Ls,S.Distance=xe,S.DistanceInput=Yi,S.DistanceJoint=Js,S.DistanceOutput=Gi,S.DistanceProxy=ke,S.DynamicTree=Ai,S.Edge=cr,S.EdgeShape=de,S.Fixture=wi,S.FixtureProxy=cs,S.FrictionJoint=Ys,S.GearJoint=Us,S.Joint=Ot,S.JointEdge=ds,S.Manifold=Zi,S.ManifoldPoint=Fs,S.Mat22=ie,S.Mat33=Se,S.Math=ne,S.MotorJoint=Hs,S.MouseJoint=Ks,S.Polygon=yr,S.PolygonShape=fe,S.PrismaticJoint=Gs,S.PulleyJoint=Xs,S.RevoluteJoint=Ce,S.RopeJoint=Zs,S.Rot=L,S.Serializer=is,S.Settings=X,S.SettingsInternal=W,S.Shape=Le,S.ShapeCast=er,S.ShapeCastInput=$o,S.ShapeCastOutput=tr,S.SimplexCache=Ui,S.Sweep=Fe,S.TOIInput=Bs,S.TOIOutput=Ss,S.Testbed=Vo,S.TimeOfImpact=Ci,S.Transform=Nt,S.TreeNode=Ht,S.Vec2=c,S.Vec3=ot,S.VelocityConstraintPoint=Ns,S.WeldJoint=Qs,S.WheelJoint=$s,S.World=Li,S.WorldManifold=ks,S.clipSegmentToLine=ni,S.default=Nn,S.getPointStates=Bo,S.internal=Or,S.mixFriction=Os,S.mixRestitution=Ds,S.stats=ft,S.testOverlap=As,S.testbed=Sr,Object.defineProperty(S,"__esModule",{value:!0})})})(Oo,Oo.exports);/**
 * p5play
 * @version 3.22
 * @author quinton-ashley
 * @license AGPL-3.0
 */if(typeof planck!="object")if(typeof process=="object")Rr.planck=Oo.exports;else throw"planck.js must be loaded before p5play";p5.prototype.registerMethod("init",function(){const a=this,S=planck;if(typeof process!="object"&&window._p5play_gtagged!=!1){let i=document.createElement("script");i.src="https://www.googletagmanager.com/gtag/js?id=G-EHXNCTSYLK",i.async=!0,document.head.append(i),window._p5play_gtagged=!0,i.onload=()=>{window.dataLayer??=[],window.gtag=function(){dataLayer.push(arguments)},gtag("js",new Date),gtag("config","G-EHXNCTSYLK"),gtag("event","p5play_v3_22")}}a.angleMode("degrees");const lt=(i,o,h)=>new S.Vec2(i*h/a.world.meterSize,o*h/a.world.meterSize),Y=(i,o)=>i*o/a.world.meterSize,it=(i,o,h)=>new S.Vec2(i/h*a.world.meterSize,o/h*a.world.meterSize),xt=(i,o)=>i/o*a.world.meterSize,Ct=i=>Math.abs(i)<=S.Settings.linearSlop,nt=(i,o)=>Math.abs(i-Math.round(i))<=(o||S.Settings.linearSlop)?Math.round(i):i,Je=(i,o)=>{let h=a._angleMode=="degrees"?360:a.TWO_PI,u=(i-o)%h,p=(h-Math.abs(u))*-Math.sign(u);return(Math.abs(u)<Math.abs(p)?u:p)||0},Mt={_collisions:["_collides","_colliding","_collided"],_overlappers:["_overlaps","_overlapping","_overlapped"]};this.P5Play=class{constructor(){if(this.sprites={},this.groups={},this.groupsCreated=0,this.spritesCreated=0,this.spritesDrawn=0,this.images={},this.disableImages=!1,this.palettes=[],this.friendlyRounding=!0,this.targetVersion=0,this.os={},this.context="web",window.matchMedia?this.hasMouse=!window.matchMedia("(any-hover: none)").matches:this.hasMouse=!0,this.standardizeKeyboard=!1,typeof navigator=="object"){let i=navigator.userAgent.indexOf("iPhone OS");if(i>-1){let o=navigator.userAgent.substring(i+10,i+12);this.os.platform="iOS",this.os.version=o}else{let o=navigator.userAgentData?.platform;!o&&navigator.platform&&(o=navigator.platform.slice(3),o=="Mac"?o="macOS":o=="Win"?o="Windows":o=="Lin"&&(o="Linux")),this.os.platform=o}}this.renderStats=!1,this._renderStats={x:10,y:20,font:"monospace"},this._fps=60,this._fpsArr=[60],this._collides={},this._colliding={},this._collided={},this._overlaps={},this._overlapping={},this._overlapped={}}onImageLoad(){}},this.p5play=new a.P5Play,delete a.P5Play;const gt=console.log;this.log=console.log,this.Sprite=class{constructor(i,o,h,u,p){this._isSprite=!0,this.idNum;let f=[...arguments],g,I;if(f[0]!==void 0&&f[0]._isGroup&&(g=f[0],f=f.slice(1)),f[0]!==void 0&&(typeof f[0]=="string"||f[0]instanceof a.SpriteAnimation||f[0]instanceof p5.Image)&&(I=f[0],f=f.slice(1)),f.length==1&&typeof f[0]=="number")throw new ut("Sprite",0,[f[0]]);if(!Array.isArray(f[0]))i=f[0],o=f[1],h=f[2],u=f[3],p=f[4];else if(i=void 0,o=void 0,h=f[0],u=void 0,p=f[1],Array.isArray(p))throw new ut("Sprite",1,[`[[${h}], [${u}]]`]);typeof h=="string"&&(p=h,h=void 0),typeof u=="string"&&(Ri(u)?p=u:h=Ei(h,u),u=void 0),this.idNum=a.p5play.spritesCreated,this._uid=1e3+this.idNum,a.p5play.sprites[this._uid]=this,a.p5play.spritesCreated++,this.groups=[],this.animations=new a.SpriteAnimations,this.joints=[],this.joints.removeAll=()=>{for(let F of this.joints)F.remove()},this.watch,this.mod={},this._removed=!1,this._life=2147483647,this._visible=!0,this._pixelPerfect=!1,this._aniChangeCount=0,this._draw=()=>this.__draw(),this._hasOverlap={},this._collisions={},this._overlappers={},g??=a.allSprites,this._tile="",this.tileSize=g.tileSize||1;let C=this;this._position={x:0,y:0},this._pos=a.createVector.call(a),Object.defineProperty(this._pos,"x",{get(){if(!C.body)return C._position.x;let F=C.body.getPosition().x/C.tileSize*a.world.meterSize;return a.p5play.friendlyRounding?nt(F):F},set(F){if(C.body){let U=new S.Vec2(F*C.tileSize/a.world.meterSize,C.body.getPosition().y);C.body.setPosition(U)}C._position.x=F}}),Object.defineProperty(this._pos,"y",{get(){if(!C.body)return C._position.y;let F=C.body.getPosition().y/C.tileSize*a.world.meterSize;return a.p5play.friendlyRounding?nt(F):F},set(F){if(C.body){let U=new S.Vec2(C.body.getPosition().x,F*C.tileSize/a.world.meterSize);C.body.setPosition(U)}C._position.y=F}}),this._canvasPos=a.createVector.call(a),Object.defineProperty(this._canvasPos,"x",{get(){let F=C._pos.x-a.camera.x;return a.canvas.renderer=="2d"&&(F+=a.canvas.hw/a.camera._zoom),F}}),Object.defineProperty(this._canvasPos,"y",{get(){let F=C._pos.y-a.camera.y;return a.canvas.renderer=="2d"&&(F+=a.canvas.hh/a.camera._zoom),F}}),this._velocity={x:0,y:0},this._direction=0,this._vel=a.createVector.call(a),Object.defineProperties(this._vel,{x:{get(){let F;return C.body?F=C.body.getLinearVelocity().x:F=C._velocity.x,F/=C.tileSize,a.p5play.friendlyRounding?nt(F):F},set(F){F*=C.tileSize,C.body?C.body.setLinearVelocity(new S.Vec2(F,C.body.getLinearVelocity().y)):C._velocity.x=F,(F||this.y)&&(C._direction=this.heading())}},y:{get(){let F;return C.body?F=C.body.getLinearVelocity().y:F=C._velocity.y,F/=C.tileSize,a.p5play.friendlyRounding?nt(F):F},set(F){F*=C.tileSize,C.body?C.body.setLinearVelocity(new S.Vec2(C.body.getLinearVelocity().x,F)):C._velocity.y=F,(F||this.x)&&(C._direction=this.heading())}}}),this._mirror={_x:1,_y:1,get x(){return this._x<0},set x(F){C.watch&&(C.mod[20]=!0),this._x=F?-1:1},get y(){return this._y<0},set y(F){C.watch&&(C.mod[20]=!0),this._y=F?-1:1}},this._heading="right",this._layer=g._layer,this._layer??=a.allSprites._getTopLayer()+1,g.dynamic&&(p??="dynamic"),g.kinematic&&(p??="kinematic"),g.static&&(p??="static"),p??=g.collider,(!p||typeof p!="string")&&(p="dynamic"),this.collider=p,i??=g.x,i===void 0&&(a.canvas?.renderer=="2d"?i=a.canvas.hw/this.tileSize:i=0,h&&(this._vertexMode=!0)),o??=g.y,o===void 0&&(a.canvas?.renderer=="2d"?o=a.canvas.hh/this.tileSize:o=0);let T=!1;if(h===void 0&&(h=g.w||g.width||g.d||g.diameter||g.v||g.vertices,!u&&!g.d&&!g.diameter&&(u=g.h||g.height,T=!0)),typeof i=="function"&&(i=i(g.length)),typeof o=="function"&&(o=o(g.length)),typeof h=="function"&&(h=h(g.length)),typeof u=="function"&&(u=u(g.length)),this.x=i,this.y=o,!g._isAllSpritesGroup&&!I){for(let F in g.animations){I=F;break}I||(I=g._img,typeof I=="function"&&(I=I(g.length)),I&&(this._img=!0))}for(let F=g;F;F=a.p5play.groups[F.parent])this.groups.push(F);if(this.groups.reverse(),I){let F=this.tileSize;this._img||I instanceof p5.Image?(typeof I!="string"?this.image=I:this.image=new a.EmojiImage(I,h),!h&&(this._img.w!=1||this._img.h!=1)&&(h=this._img.w/F,u??=this._img.h/F)):(typeof I=="string"?this._changeAni(I):this._ani=I.clone(),!h&&(this._ani.w!=1||this._ani.h!=1)&&(h=this._ani.w/F,u??=this._ani.h/F))}if(this.groups=[],this.mouse=new a._SpriteMouse,this._rotation=0,this._rotationSpeed=0,this._bearing=0,this._scale=new ne,Object.defineProperty(this._scale,"x",{get(){return this._x},set(F){if(F==this._x)return;C.watch&&(C.mod[26]=!0);let U=Math.abs(F/this._x);C._w*=U,C._hw*=U,C._resizeColliders({x:U,y:1}),this._x=F,this._avg=(this._x+this._y)*.5}}),Object.defineProperty(this._scale,"y",{get(){return this._y},set(F){if(F==this._y)return;C.watch&&(C.mod[26]=!0);let U=Math.abs(F/this._y);C._h&&(this._h*=U,this._hh*=U),C._resizeColliders({x:1,y:U}),this._y=F,this._avg=(this._x+this._y)*.5}}),this._offset={_x:0,_y:0,get x(){return this._x},set x(F){F!=this._x&&(C.watch&&(C.mod[21]=!0),C._offsetCenterBy(F-this._x,0))},get y(){return this._y},set y(F){F!=this._y&&(C.watch&&(C.mod[21]=!0),C._offsetCenterBy(0,F-this._y))}},this._massUndef=!0,h===void 0&&(this._dimensionsUndef=!0,this._widthUndef=!0,h=this.tileSize>1?1:50,u===void 0&&(this._heightUndef=!0)),T&&(u??=this.tileSize>1?1:50),this._shape=g.shape,this.__collider!=3)this._vertexMode?this.addCollider(h):this.addCollider(0,0,h,u),this.shape=this._shape;else{if(this.w=h,Array.isArray(h))throw new Error('Cannot set the collider type of a sprite with a polygon or chain shape to "none". To achieve the same effect, use .overlaps(allSprites) to have your sprite overlap with the allSprites group.');h!==void 0&&u===void 0?this.shape="circle":(this.shape="box",this.h=u)}this.prevPos={x:i,y:o},this.prevRotation=0,this._dest={x:i,y:o},this._destIdx=0,this._debug=!1,this.text,g._isAllSpritesGroup||a.allSprites.push(this),g.push(this);let q=g.vel.x||0,E=g.vel.y||0;typeof q=="function"&&(q=q(g.length-1)),typeof E=="function"&&(E=E(g.length-1)),this.vel.x=q,this.vel.y=E;let H=["ani","collider","x","y","w","h","d","diameter","dynamic","height","kinematic","static","vel","width"];for(let F of a.Sprite.propsAll){if(H.includes(F))continue;let U=g[F];U!==void 0&&(typeof U=="function"&&Ni(U)&&(U=U(g.length-1)),typeof U=="object"?U instanceof p5.Color?this[F]=a.color(...U.levels):this[F]=Object.assign({},U):this[F]=U)}H=["add","animation","animations","autoCull","contains","GroupSprite","Group","idNum","length","mod","mouse","p","parent","Sprite","Subgroup","subgroups","velocity"];for(let F=0;F<this.groups.length;F++){let U=this.groups[F],$=Object.keys(U);for(let G of $){if(!isNaN(G)||G[0]=="_"||H.includes(G)||a.Sprite.propsAll.includes(G))continue;let j=U[G];j!==void 0&&(typeof j=="function"&&Ni(j)&&(j=j(U.length-1)),typeof j=="object"?this[G]=Object.assign({},j):this[G]=j)}}this.color??=a.color(Math.round(a.random(30,245)),Math.round(a.random(30,245)),Math.round(a.random(30,245))),this._textFill??=a.color(0),this._textSize??=this.tileSize==1?a.canvas?a.textSize():12:.8}addCollider(i,o,h,u){if(this._removed){console.error("Can't add colliders to a sprite that was removed.");return}this.__collider==3&&(this._collider="dynamic",this.__collider=0);let p={};p.shape=this._parseShape(...arguments),p.shape.m_type=="chain"&&(p.density=0,p.restitution=0),p.density??=this.density||5,p.friction??=this.friction||.5,p.restitution??=this.bounciness||.2,this.body?this.body.m_gravityScale||=1:(this.body=a.world.createBody({position:lt(this.x,this.y,this.tileSize),type:this.collider}),this.body.sprite=this);let f=new S.Vec2(this.body.getLocalCenter());this.body.createFixture(p),this.watch&&(this.mod[19]=!0),this.body.setMassData({mass:this.body.getMass(),center:f,I:this.body.getInertia()})}addSensor(i,o,h,u){if(this._removed){console.error("Can't add sensors to a sprite that was removed.");return}let p=this._parseShape(...arguments);this.body||(this.body=a.world.createBody({position:lt(this.x,this.y,this.tileSize),type:"dynamic",gravityScale:0}),this.body.sprite=this,this.mass=0,this._massUndef=!0,this.rotation=this._rotation,this.vel=this._velocity),this.body.createFixture({shape:p,isSensor:!0}),this._sortFixtures(),this._hasSensors=!0}_parseShape(i,o,h,u){let p=[...arguments],f,g;p.length==0?(i=0,o=0,h=this._w,u=this._h):p.length<=2&&(i=0,o=0,h=p[0],u=p[1],this._vertexMode=!0);let I;Array.isArray(h)||typeof u=="string"?(isNaN(h)||(h=Number(h)),typeof h!="number"&&Array.isArray(h[0])&&(this._originMode??="start"),typeof u=="string"?(f=Ei(h,u),u=void 0):f=h):(h!==void 0&&u===void 0?g="circle":g="box",h??=this.tileSize>1?1:50,u??=h,I=lt(h-.08,u-.08,this.tileSize));let C;if(g=="box")C=S.Box(I.x/2,I.y/2,lt(i,o,this.tileSize),0);else if(g=="circle")C=S.Circle(lt(i,o,this.tileSize),I.x/2);else if(f){let U=function(){q.x<E.x&&(E.x=q.x),q.y<E.y&&(E.y=q.y),q.x>H.x&&(H.x=q.x),q.y>H.y&&(H.y=q.y)},T=[{x:0,y:0}],q={x:0,y:0},E={x:0,y:0},H={x:0,y:0},F=Array.isArray(f[0]),$,G;if(F){this._vertexMode&&($=f[0][0],G=f[0][1],!this.fixture||!this._relativeOrigin?(this.x=$,this.y=G):($=this.x-this._relativeOrigin.x,G=this.y-this._relativeOrigin.y,T.pop()));for(let tt=0;tt<f.length;tt++){if(this._vertexMode){if(tt==0&&!this.fixture)continue;q.x=f[tt][0]-$,q.y=f[tt][1]-G}else q.x+=f[tt][0],q.y+=f[tt][1];T.push({x:q.x,y:q.y}),U()}}else{let tt=1;f.length%2&&(tt=f[f.length-1]);let Vt=tt>0?1:-1;tt=Math.abs(tt);let At=0;for(let St=0;St<tt;St++){for(let Lt=0;Lt<f.length-1;Lt+=2){let _t=f[Lt];At+=f[Lt+1],q.x+=_t*a.cos(At),q.y+=_t*a.sin(At),T.push({x:q.x,y:q.y}),U()}At*=Vt}}let j=!1;if(Ct(Math.abs(T[0].x)-Math.abs(T[T.length-1].x))&&Ct(Math.abs(T[0].y)-Math.abs(T[T.length-1].y))?(this._shape!="chain"?g="polygon":g="chain",this._originMode="center",this._isConvexPoly(T.slice(0,-1))&&(j=!0)):g="chain",h=H.x-E.x,u=H.y-E.y,this._originMode=="start")for(let tt=0;tt<T.length;tt++)T[tt]=lt(T[tt].x,T[tt].y,this.tileSize);else{let tt=0,Vt=0,At=0,St=0,Lt=T.length;(g=="polygon"||j)&&Lt--;for(let _t=0;_t<Lt;_t++)At+=T[_t].x,St+=T[_t].y;tt=At/Lt,Vt=St/Lt,this.fixture||(this._relativeOrigin={x:tt,y:Vt}),this._vertexMode&&F&&(this.fixture?(tt=this._relativeOrigin.x,Vt=this._relativeOrigin.y):(this.x+=tt,this.y+=Vt));for(let _t=0;_t<T.length;_t++){let te=T[_t];T[_t]=lt(te.x+i-tt,te.y+o-Vt,this.tileSize)}}(!j||T.length-1>S.Settings.maxPolygonVertices||this._shape=="chain")&&(g="chain"),g=="polygon"?C=S.Polygon(T):g=="chain"&&(C=S.Chain(T,!1))}if(this.shape??=g,!this.fixtureList)this._w=h,this._hw=h*.5,this.__shape!=1&&(this._h=u,this._hh=u*.5);else{this._extents??={t:this.hh,b:this.hh,l:this._hw,r:this._hw};let T=this._extents,q=i-h*.5,E=i+h*.5,H=o-u*.5,F=o+u*.5;q<T.l&&(T.l=q),E>T.r&&(T.r=E),H<T.t&&(T.t=H),F>T.b&&(T.b=F),this._totalWidth=T.r-T.l,this._totalHeight=T.b-T.t;let U=Math.abs;this._largestExtent=Math.max(U(T.l),U(T.r),U(T.t),U(T.b))}return C}removeColliders(){!this.body||(this._removeContacts(0),this._removeFixtures(0))}removeSensors(){!this.body||(this._removeContacts(1),this._removeFixtures(1),this._hasSensors=!1)}_removeFixtures(i){let o;for(let h=this.fixtureList;h;h=h.getNext())if(i===void 0||h.m_isSensor==i){let u=h.m_next;h.destroyProxies(a.world.m_broadPhase),o?o.m_next=u:this.body.m_fixtureList=u}else o=h}_removeContacts(i){if(!this.body)return;let o=this.body.m_contactList;for(;o;){let h=o.contact;o=o.next,(i===void 0||h.m_fixtureA.m_isSensor==i)&&a.world.destroyContact(h)}}_offsetCenterBy(i,o){if(!i&&!o||(this._offset._x+=i,this._offset._y+=o,!this.body))return;let h=lt(i,o,this.tileSize);this.__offsetCenterBy(h.x,h.y)}__offsetCenterBy(i,o){for(let h=this.body.m_fixtureList;h;h=h.m_next){let u=h.m_shape;if(u.m_type!="circle"){let p=u.m_vertices;for(let f of p)f.x+=i,f.y+=o}else u.m_p.x+=i,u.m_p.y+=o}}_cloneBodyProps(){let i={},o=["bounciness","density","drag","friction","heading","isSuperFast","rotation","rotationDrag","rotationLock","rotationSpeed","scale","vel","x","y"];(!this._massUndef||!this._dimensionsUndef)&&o.push("mass");for(let h of o)typeof this[h]=="object"?i[h]=Object.assign({},this[h]):i[h]=this[h];return i}get animation(){return this._ani}set animation(i){this.changeAni(i)}get ani(){return this._ani}set ani(i){this.changeAni(i)}get anis(){return this.animations}get autoDraw(){return this._autoDraw}set autoDraw(i){this._autoDraw=i}get allowSleeping(){return this.body?.isSleepingAllowed()}set allowSleeping(i){this.watch&&(this.mod[5]=!0),this.body&&this.body.setSleepingAllowed(i)}get autoUpdate(){return this._autoUpdate}set autoUpdate(i){this._autoUpdate=i}get bounciness(){if(!!this.fixture)return this.fixture.getRestitution()}set bounciness(i){this.watch&&(this.mod[7]=!0);for(let o=this.fixtureList;o;o=o.getNext())o.setRestitution(i)}get collider(){return this._collider}set collider(i){if(i==this._collider)return;i=i.toLowerCase();let o=i[0];if(o=="d"&&(i="dynamic"),o=="s"&&(i="static"),o=="k"&&(i="kinematic"),o=="n"&&(i="none"),i==this._collider)return;if(i=="none"&&(this._shape=="chain"||this._shape=="polygon")){console.error('Cannot set the collider type of a polygon or chain collider to "none". To achieve the same effect, use .overlaps(allSprites) to have your sprite overlap with the allSprites group.');return}if(this._removed)throw new Error("Cannot change the collider type of a sprite that was removed.");let h=this.__collider;this._collider=i,this.__collider=["d","s","k","n"].indexOf(o),this.watch&&(this.mod[8]=!0),h!==void 0&&(this.__collider!=3?(this.body&&this.body.setType(i),h==3&&(this.addCollider(),this.x=this._position.x,this.y=this._position.y,this.vel.x=this._velocity.x,this.vel.y=this._velocity.y,this.rotation=this._rotation,this.rotationSpeed=this._rotationSpeed)):(this.removeColliders(),this.fixture?.m_isSensor?this.body.m_gravityScale=0:(this._position.x=this.x,this._position.y=this.y,this._velocity.x=this.vel.x,this._velocity.y=this.vel.y,this._rotation=this.rotation,this._rotationSpeed=this.rotationSpeed,a.world.destroyBody(this.body),this.body=null)))}_parseColor(i){return i instanceof p5.Color?i:typeof i!="object"?i.length==1?a.colorPal(i):a.color(i):a.color(...i.levels)}get color(){return this._color}set color(i){this.watch&&(this.mod[9]=!0),this._color=this._parseColor(i)}get colour(){return this._color}set colour(i){this.color=i}get fill(){return this._color}set fill(i){this.color=i}get fillColor(){return this._color}set fillColor(i){this.color=i}get stroke(){return this._stroke}set stroke(i){this.watch&&(this.mod[29]=!0),this._stroke=this._parseColor(i)}get strokeColor(){return this._stroke}set strokeColor(i){this.stroke=i}get strokeWeight(){return this._strokeWeight}set strokeWeight(i){this.watch&&(this.mod[30]=!0),this._strokeWeight=i}get textColor(){return this._textFill}set textColor(i){this.watch&&(this.mod[32]=!0),this._textFill=this._parseColor(i)}get textColour(){return this._textFill}set textColour(i){this.textColor=i}get textFill(){return this._textFill}set textFill(i){this.textColor=i}get textSize(){return this._textSize}set textSize(i){this.watch&&(this.mod[33]=!0),this._textSize=i}get textStroke(){return this._textStroke}set textStroke(i){this.watch&&(this.mod[34]=!0),this._textStroke=this._parseColor(i)}get textStrokeWeight(){return this._textStrokeWeight}set textStrokeWeight(i){this.watch&&(this.mod[35]=!0),this._textStrokeWeight=i}get tile(){return this._tile}set tile(i){this.watch&&(this.mod[36]=!0),this._tile=i}get tileSize(){return this._tileSize}set tileSize(i){this.watch&&(this.mod[37]=!0),this._tileSize=i}get bearing(){return this._bearing}set bearing(i){this.watch&&(this.mod[6]=!0),this._bearing=i}get debug(){return this._debug}set debug(i){this.watch&&(this.mod[10]=!0),this._debug=i}get density(){if(!!this.fixture)return this.fixture.getDensity()}set density(i){this.watch&&(this.mod[11]=!0);for(let o=this.fixtureList;o;o=o.getNext())o.setDensity(i)}_getDirectionAngle(i){i=i.toLowerCase().replaceAll(/[ _-]/g,"");let h={up:-90,down:90,left:180,right:0,upright:-45,rightup:-45,upleft:-135,leftup:-135,downright:45,rightdown:45,downleft:135,leftdown:135,forward:this.rotation,backward:this.rotation+180}[i];return a._angleMode=="radians"&&(h=a.radians(h)),h}get direction(){return this.vel.x!==0||this.vel.y!==0?a.atan2(this.vel.y,this.vel.x):this._isTurtleSprite?this.rotation:this._direction}set direction(i){this.watch&&(this.mod[12]=!0),typeof i=="string"&&(this._heading=i,i=this._getDirectionAngle(i)),this._direction=i,this._isTurtleSprite&&(this.rotation=i);let o=this.speed;this.vel.x=a.cos(i)*o,this.vel.y=a.sin(i)*o}get drag(){return this.body?.getLinearDamping()}set drag(i){this.watch&&(this.mod[13]=!0),this.body&&this.body.setLinearDamping(i)}get draw(){return this._display}set draw(i){this._userDefinedDraw=!0,this._draw=i}get dynamic(){return this.body?.isDynamic()}set dynamic(i){i?this.collider="dynamic":this.collider="kinematic"}get fixture(){return this.fixtureList}get fixtureList(){return this.body?this.body.m_fixtureList:null}get friction(){if(!!this.fixture)return this.fixture.getFriction()}set friction(i){this.watch&&(this.mod[14]=!0);for(let o=this.fixtureList;o;o=o.getNext())o.setFriction(i)}get heading(){return this._heading}set heading(i){this.direction=i}get img(){return this._img||this._ani?.frameImage}set img(i){this.image=i}get image(){return this._img||this._ani?.frameImage}set image(i){typeof i=="string"&&(i.includes(".")?i=a.loadImage(i):i=new a.EmojiImage(i,this.w)),this._img=this._extendImage(i)}_extendImage(i){return i.offset??={x:0,y:0},i._scale??={x:1,y:1},i.scale||Object.defineProperty(i,"scale",{get:()=>i._scale,set:o=>{typeof o=="number"&&(o={x:o,y:o}),i._scale=o}}),i}get isMoving(){return this.vel.x!=0||this.vel.y!=0}get isSuperFast(){return this.body?.isBullet()}set isSuperFast(i){this.watch&&(this.mod[16]=!0),this.body&&this.body.setBullet(i)}get kinematic(){return this.body?.isKinematic()}set kinematic(i){i?this.collider="kinematic":this.collider="dynamic"}get layer(){return this._layer}set layer(i){this.watch&&(this.mod[17]=!0),this._layer=i}get life(){return this._life}set life(i){this.watch&&(this.mod[18]=!0),this._life=i}get mass(){return this.body?.getMass()}set mass(i){if(!this.body)return;this.watch&&(this.mod[19]=!0);const o=new S.Vec2(this.body.getLocalCenter()),h={I:0,center:o,mass:0};this.body.getMassData(h),h.mass=i>0?i:1e-8,this.body.setMassData(h),delete this._massUndef}resetMass(){if(!this.body)return;let i=new S.Vec2(this.body.getLocalCenter());this.watch&&(this.mod[19]=!0),this.body.resetMassData(),this.body.setMassData({mass:this.body.getMass(),center:i,I:this.body.getInertia()})}resetCenterOfMass(){this.watch&&(this.mod[19]=!0),this.body.resetMassData();let{x:i,y:o}=this.body.getLocalCenter();if(i==0&&o==0)return;this.__offsetCenterBy(-i,-o),this.body.resetMassData();let h=this.body.getPosition();this.body.setPosition({x:h.x+i,y:h.y+o})}get mirror(){return this._mirror}set mirror(i){this.watch&&(this.mod[20]=!0),i.x!==void 0&&(this._mirror.x=i.x),i.y!==void 0&&(this._mirror.y=i.y)}get offset(){return this._offset}set offset(i){i.x??=this._offset._x,i.y??=this._offset._y,!(i.x==this._offset._x&&i.y==this._offset._y)&&(this.watch&&(this.mod[21]=!0),this._offsetCenterBy(i.x-this._offset._x,i.y-this._offset._y))}get opacity(){return this._opacity??1}set opacity(i){this.watch&&(this.mod[41]=!0),this._opacity=i}get previousPosition(){return this.prevPos}set previousPosition(i){this.prevPos=i}get previousRotation(){return this.prevRotation}set previousRotation(i){this.prevRotation=i}get pixelPerfect(){return this._pixelPerfect}set pixelPerfect(i){this.watch&&(this.mod[22]=!0),this._pixelPerfect=i}get removed(){return this._removed}set removed(i){!i||this._removed||(this.watch&&(this.mod[23]=!0),this._removed=!0,this._remove())}get rotation(){if(!this.body)return this._rotation||0;let i=this.body.getAngle();return a._angleMode=="degrees"&&(i=a.degrees(i)),a.p5play.friendlyRounding?nt(i,S.Settings.angularSlop):i}set rotation(i){this.body?(a._angleMode=="degrees"&&(i=a.radians(i%360)),this.body.setAngle(i),this.body.synchronizeTransform()):this._rotation=i}get rotationDrag(){return this.body?.getAngularDamping()}set rotationDrag(i){!this.body||(this.watch&&(this.mod[24]=!0),this.body.setAngularDamping(i))}get rotationLock(){return this.body?.isFixedRotation()}set rotationLock(i){if(!this.body)return;this.watch&&(this.mod[25]=!0);let o=this.mass;this.body.setFixedRotation(i),this.mass=o}get rotationSpeed(){if(this.body){let i=this.body.getAngularVelocity()/60;return a._angleMode=="degrees"?a.degrees(i):i}return this._rotationSpeed}set rotationSpeed(i){this.body?(i*=60,a._angleMode=="degrees"&&(i=a.radians(i)),this.body.setAngularVelocity(i)):this._rotationSpeed=i}get scale(){return this._scale}set scale(i){if(i==0&&(i=.01),typeof i=="number"?i={x:i,y:i}:(i.x??=this._scale._x,i.y??=this._scale._y),i.x==this._scale._x&&i.y==this._scale._y)return;this.watch&&(this.mod[26]=!0);let o={x:Math.abs(i.x/this._scale._x),y:Math.abs(i.y/this._scale._y)};this._w*=o.x,this._hw*=o.x,this._h&&(this._h*=o.y,this._hh*=o.y),this._resizeColliders(o),this._scale._x=i.x,this._scale._y=i.y,this._scale._avg=i.x}get sleeping(){if(this.body)return!this.body.isAwake()}set sleeping(i){!this.body||(this.watch&&(this.mod[28]=!0),this.body.setAwake(!i))}get speed(){return a.createVector(this.vel.x,this.vel.y).mag()}set speed(i){let o=this.direction;this.vel.x=a.cos(o)*i,this.vel.y=a.sin(o)*i}get static(){return this.body?.isStatic()}set static(i){i?this.collider="static":this.collider="dynamic"}get tint(){return this._tint}set tint(i){this.watch&&(this.mod[42]=!0),this._tint=this._parseColor(i)}get tintColor(){return this._tint}set tintColor(i){this.tint=i}set vertices(i){if(this.__collider==3)throw new Error('Cannot set vertices of a sprite with collider type of "none".');this.watch&&(this.mod[27]=!0),this._removeFixtures(),this._originMode="start",this.addCollider(i),this._hasSensors&&this.addDefaultSensors()}get vertices(){return this._getVertices()}_getVertices(i){let h=this.fixture.getShape(),u=[...h.m_vertices];h.m_type=="polygon"&&u.unshift(u.at(-1));let p=this.x,f=this.y;for(let g=0;g<u.length;g++){let I=[u[g].x/this.tileSize*a.world.meterSize+p,u[g].y/this.tileSize*a.world.meterSize+f];a.p5play.friendlyRounding&&(I[0]=nt(I[0]),I[1]=nt(I[1])),i?u[g]=I:u[g]=a.createVector(I[0],I[1])}return u}get visible(){return this._visible}set visible(i){this.watch&&(this.mod[39]=!0),this._visible=i}get x(){return this._pos.x}set x(i){this._pos.x=i}get y(){return this._pos.y}set y(i){this._pos.y=i}get pos(){return this._pos}set pos(i){if(this.body){let o=new S.Vec2(i.x*this.tileSize/a.world.meterSize,i.y*this.tileSize/a.world.meterSize);this.body.setPosition(o)}this._position.x=i.x,this._position.y=i.y}get position(){return this._pos}set position(i){this.pos=i}get canvasPos(){return this._canvasPos}get w(){return this._w}set w(i){if(i<0&&(i=.01),i==this._w)return;this.watch&&(this.mod[40]=!0);let o=i/this._w;this._w=i,this._hw=i*.5,this._resizeColliders({x:o,y:1}),delete this._widthUndef,delete this._dimensionsUndef}get hw(){return this._hw}set hw(i){throw new ut("Sprite.hw")}get width(){return this._w}set width(i){this.w=i}get halfWidth(){return this.hw}set halfWidth(i){throw new ut("Sprite.hw")}get h(){return this._h||this._w}set h(i){if(i<0&&(i=.01),this.__shape==1){this.w=i;return}if(i==this._h)return;this.watch&&(this.mod[15]=!0);let o=i/this._h;this._h=i,this._hh=i*.5,this._resizeColliders({x:1,y:o}),delete this._heightUndef,delete this._dimensionsUndef}get hh(){return this._hh||this._hw}set hh(i){throw new ut("Sprite.hh")}get height(){return this.h}set height(i){this.h=i}get halfHeight(){return this.hh}set halfHeight(i){throw new ut("Sprite.hh")}get d(){return this._w}set d(i){i<0&&(i=.01);let o=this.__shape!=1;if(!(!o&&this._w==i)){if(this.watch&&(this.mod[40]=!0),!o){let h=i/this._w;this._resizeColliders({x:h,y:h})}this._w=i,this._hw=i*.5,o&&(this.shape="circle")}}get diameter(){return this._w}set diameter(i){this.d=i}get r(){return this._hw}set r(i){this.d=i*2}get radius(){return this._hw}set radius(i){this.d=i*2}_resizeColliders(i){if(!!this.body){for(let o=this.fixtureList;o;o=o.getNext()){if(o.m_isSensor)continue;let h=o.m_shape;if(h.m_type=="circle")i.x!=1?h.m_radius*=i.x:h.m_radius*=i.y;else for(let u of h.m_vertices)u.x*=i.x,u.y*=i.y}(this._widthUndef||this._heightUndef)&&this.resetMass(),this.body.synchronizeFixtures()}}_isConvexPoly(i){t:for(let o=0;o<2;o++){o==1&&(i=i.reverse());for(let h=0;h<i.length;++h){const u=h,p=h<i.length-1?u+1:0,f=i[u],g=S.Vec2.sub(i[p],f);for(let I=0;I<i.length;++I){if(I==u||I==p)continue;const C=S.Vec2.sub(i[I],f);if(S.Vec2.cross(g,C)<0){if(o==0)continue t;return!1}}}break}return!0}get shape(){return this._shape}set shape(i){if(i==this._shape)return;let o=a.Sprite.shapeTypes.indexOf(i);if(o==-1)throw new Error('Invalid shape type: "'+i+`"
The valid shape types are: "`+a.Sprite.shapeTypes.join('", "')+'"');if(this.__collider==3&&o>=2){console.error('Cannot set the collider shape to chain or polygon if the sprite has a collider type of "none". To achieve the same effect, use .overlaps(allSprites) to have your sprite overlap with the allSprites group.');return}let h=this.__shape;if(this.__shape=o,this._shape=i,this.watch&&(this.mod[27]=!0),h===void 0)return;this.__shape==0?(this._h=this._w,this._hh=this._hw):(this._h=void 0,this._hh=void 0);let u;if(h!=1&&this.__shape!=1&&(u=this._getVertices(!0)),this._removeFixtures(),this.__collider!=3)if(u)this._originMode??="center",this.addCollider(u);else if(h==1){let g=this._w*Math.sin(Math.PI/12);this.addCollider(0,0,[g,-30,12])}else this.addCollider();this._hasSensors&&this.addDefaultSensors();let p=this._offset._x,f=this._offset._y;!p&&!f||(this._offset._x=0,this._offset._y=0,this._offsetCenterBy(p,f))}get update(){return this._update}set update(i){this._customUpdate=i}get vel(){return this._vel}set vel(i){this.vel.x=i.x,this.vel.y=i.y}get velocity(){return this._vel}set velocity(i){this.vel=i}get gravityScale(){return this.body?.getGravityScale()}set gravityScale(i){!this.body||(this.watch&&(this.mod[42]=!0),this.body.setGravityScale(i))}_update(){this._ani?.update&&this._ani.update();for(let i in this.mouse)this.mouse[i]==-1&&(this.mouse[i]=0);this._customUpdate&&this._customUpdate(),this.autoUpdate&&(this.autoUpdate=null)}_step(){this.life-=a.world.timeScale,this._life!=2147483647&&this._life<=0&&this.remove(),!this.body&&!this._removed&&(this.rotation+=this._rotationSpeed,this.x+=this.vel.x,this.y+=this.vel.y),this.watch&&(this.x!=this.prevX&&(this.mod[0]=this.mod[2]=!0),this.y!=this.prevY&&(this.mod[1]=this.mod[2]=!0),this.rotation!=this.prevRotation&&(this.mod[3]=this.mod[4]=!0)),!(!this.body&&!this._removed)&&this.__step()}__step(){let i=this,o;for(let h in Mt)for(let u in this[h]){if(u>=1e3){if(i._isGroup||i._uid>=u)continue;o=a.p5play.sprites[u]}else{if(i._isGroup&&i._uid>=u)continue;o=a.p5play.groups[u]}let p=i[h][u]+1;if(!o||p==0||p==-2){delete i[h][u],o&&delete o[h][i._uid];continue}this[h][u]=p,o[h][i._uid]=p}}___step(){let i=this,o,h,u,p,f=!0;for(let g in Mt){for(let I in this[g]){if(I>=1e3){if(i._isGroup||i._uid>=I)continue;o=a.p5play.sprites[I]}else{if(i._isGroup&&i._uid>=I)continue;o=a.p5play.groups[I]}if(i._isGroup||o?._isGroup||(u=i._hasOverlap[o._uid]??o._hasOverlap[i._uid],f&&u!==!1||!f&&u!==!0))continue;let C=i[g][I];for(let T=0;T<3;T++){if(T==0&&C!=1&&C!=-3||T==1&&C==-1||T==2&&C>=1)continue;h=Mt[g][T];let q=a.p5play[h][i._uid];if(q){p=q[o._uid],p&&p.call(i,i,o,C);for(let H of o.groups)p=q[H._uid],p&&p.call(i,i,o,C)}let E=a.p5play[h][o._uid];if(E){p=E[i._uid],p&&p.call(o,o,i,C);for(let H of i.groups)p=E[H._uid],p&&(!q||p!=q[H._uid])&&p.call(o,o,i,C)}}}f=!1}if(this._removed&&Object.keys(this._collisions).length==0&&Object.keys(this._overlappers).length==0){this._isSprite?delete a.p5play.sprites[this._uid]:a.p5play.targetVersion>=16&&delete a.p5play.groups[this._uid];for(let g in Mt)for(let I of Mt[g])delete a.p5play[I][this._uid]}}__draw(){if(!a.p5play.disableImages){if(this._ani)this._ani.draw(this._offset._x,this._offset._y,0,this._scale._x,this._scale._y);else if(this._img){let i=this._img,o=this._scale._x!=1||this._scale._y!=1||i.scale.x!=1||i.scale.y!=1;o&&(a.push(),a.scale(this._scale._x*i.scale.x,this._scale._y*i.scale.y)),a.image(i,this._offset._x+i.offset.x,this._offset._y+i.offset.y),o&&a.pop()}}if(!(this._ani||this._img)||this.debug||a.p5play.disableImages)if(this.debug&&(a.noFill(),a.stroke(0,255,0),a.line(0,-2,0,2),a.line(-2,0,2,0)),this.__collider!=3){!this.debug&&this._strokeWeight!==0?this.__shape==2?a.stroke(this.stroke||this.color):this._stroke&&a.stroke(this._stroke):a.noStroke();for(let i=this.fixtureList;i;i=i.getNext()){if(this.debug)i.m_isSensor?a.stroke(255,255,0):a.stroke(0,255,0);else if(i.m_isSensor)continue;this._drawFixture(i)}}else this._strokeWeight!==0&&a.stroke(this._stroke||120),this.__shape==0?a.rect(this._offset._x,this._offset._y,this.w*this.tileSize,this.h*this.tileSize):this.__shape==1&&a.circle(this._offset._x,this._offset._y,this.d*this.tileSize);this.text!==void 0&&(a.textAlign(a.CENTER,a.CENTER),a.fill(this._textFill),this._textStrokeWeight&&a.strokeWeight(this._textStrokeWeight),this._textStroke?a.stroke(this._textStroke):a.noStroke(),a.textSize(this.textSize*this.tileSize),a.text(this.text,0,0))}_display(){let i=this.x*this.tileSize+a.world.origin.x,o=this.y*this.tileSize+a.world.origin.y;if(!this._userDefinedDraw){let h;if(this._totalWidth?h=Math.max(this._totalWidth,this._totalHeight):h=this._h!==void 0?Math.max(this._w,this._h):this._w,this.ani&&!a.p5play.disableImages&&(h=Math.max(h,this.ani.w,this.ani.h)),this.shape!="chain"&&a.camera.isActive&&(i+h<a.camera.bound.min.x||i-h>a.camera.bound.max.x||o+h<a.camera.bound.min.y||o-h>a.camera.bound.max.y)){this._visible=null;return}}if(this._visible=!0,a.p5play.spritesDrawn++,!this._pixelPerfect)i=nt(i),o=nt(o);else{let h,u;this.ani&&this.ani.length&&!a.p5play.disableImages?(h=this.ani[this.ani._frame].w,u=this.ani[this.ani._frame].h):(h=this._w,u=this._h),h%2==0?i=Math.round(i):i=Math.round(i-.5)+.5,u%2==0?o=Math.round(o):o=Math.round(o-.5)+.5}for(let h of this.joints){if(!h.visible){h.visible??=!0;continue}this._uid==h.spriteA._uid?(!h.spriteB._visible||this.layer<=h.spriteB.layer)&&h._display():(!h.spriteA._visible||this.layer<h.spriteA.layer)&&h._display()}this._opacity!=0&&(a.push(),a.imageMode("center"),a.rectMode("center"),a.ellipseMode("center"),a.translate(i,o),this.rotation&&a.rotate(this.rotation),(this._mirror._x!=1||this._mirror._y!=1)&&a.scale(this._mirror._x,this._mirror._y),a.fill(this.color),this._strokeWeight!==void 0&&a.strokeWeight(this._strokeWeight),this._opacity&&(a.ctx.globalAlpha=this._opacity),this._tint&&a.tint(this._tint),this._draw(),a.pop(),this._cameraActiveWhenDrawn=a.camera.isActive,this.autoDraw&&(this.autoDraw=null))}_drawFixture(i){const o=i.m_shape;if(o.m_type=="polygon"||o.m_type=="chain"){if(o.m_type=="chain"){if(a._strokeWeight==0)return;a.push(),a.noFill()}let h=o.m_vertices;a.beginShape();for(let u=0;u<h.length;u++)a.vertex(h[u].x*a.world.meterSize,h[u].y*a.world.meterSize);o.m_type!="chain"?a.endShape("close"):(a.endShape(),a.pop())}else if(o.m_type=="circle"){const h=o.m_radius*2*a.world.meterSize;a.ellipse(o.m_p.x*a.world.meterSize,o.m_p.y*a.world.meterSize,h,h)}else o.m_type=="edge"&&a.line(o.m_vertex1.x*a.world.meterSize,o.m_vertex1.y*a.world.meterSize,o.m_vertex2.x*a.world.meterSize,o.m_vertex2.y*a.world.meterSize)}_args2Vec(i,o){return Array.isArray(i)?{x:i[0],y:i[1]}:(typeof i=="object"&&(o=i.y,i=i.x),{x:i||0,y:o||0})}_parseForceArgs(){let i=arguments;typeof i[0]=="number"&&(i.length==1||typeof i[1]!="number")?(i[3]=i[2],i[2]=i[1],i[1]=a.sin(this._bearing)*i[0],i[0]=a.cos(this._bearing)*i[0]):i.length==2&&typeof i[1]!="number"&&(i[2]=i[1],i[1]=void 0);let o={};return o.forceVector=new S.Vec2(this._args2Vec(i[0],i[1])),i[2]!==void 0&&(o.poa=this._args2Vec(i[2],i[3]),o.poa=lt(o.poa.x,o.poa.y,this.tileSize)),o}applyForce(i,o,h,u){if(!this.body)return;if(location.host=="game.thegamebox.ca")return this.applyForceScaled(...arguments);let{forceVector:p,poa:f}=this._parseForceArgs(...arguments);f?this.body.applyForce(p,f):this.body.applyForceToCenter(p)}applyForceScaled(){if(!this.body)return;let{forceVector:i,poa:o}=this._parseForceArgs(...arguments);i.mul(this.mass),o?this.body.applyForce(i,o):this.body.applyForceToCenter(i)}attractTo(i,o,h,u,p){if(!this.body||this.__collider!=0)throw new Error("attractTo can only be used on sprites with dynamic colliders");if(typeof i!="number"){let q=i;if(!q||q==a.mouse&&!a.mouse.isActive)return;h=o,o=q.y,i=q.x}if(this.x==i&&this.y==o)return;let f=o-this.y,g=i-this.x,I=Math.sqrt(f*f+g*g),C=h/I,T=new S.Vec2(g*C,f*C);this.body.applyForceToCenter(T)}repelFrom(i,o,h,u,p){if(!this.body||this.__collider!=0)throw new Error("repelFrom can only be used on sprites with dynamic colliders");if(typeof i!="number"){let f=i;if(!f||f==a.mouse&&!a.mouse.isActive)return;h=o,o=f.y,i=f.x}this.attractTo(i,o,-h,u,p)}applyTorque(i){!this.body||this.body.applyTorque(i)}moveTowards(i,o,h){if(i!==void 0){if(typeof i!="number"&&i!==null){let u=i;if(u==a.mouse&&!a.mouse.isActive)return;if(!u||u.x===void 0||u.y===void 0)throw"sprite.moveTowards/moveAway ERROR: movement destination not defined.";h=o,o=u.y,i=u.x}if(h??=.1,i!=null){let u=i-this.x;Ct(u)?this.vel.x=0:this.vel.x=u*h*this.tileSize}if(o!=null){let u=o-this.y;Ct(u)?this.vel.y=0:this.vel.y=u*h*this.tileSize}}}moveAway(i,o,h){this.moveTowards(...arguments),this.vel.x*=-1,this.vel.y*=-1}move(i,o,h){if(!i)return Promise.resolve(!1);let u=isNaN(arguments[0]);u&&(i=1,o=arguments[0],h=arguments[1]),typeof o=="string"&&(u=!0,this._heading=o,o=this._getDirectionAngle(o)),o??=this.direction;let p=a.cos(o)*i,f=a.sin(o)*i;return this.tileSize!=1&&(u||o%90==0)&&i%.5==0?(p=Math.round((this.x+Math.round(p))*2)/2,f=Math.round((this.y+Math.round(f))*2)/2):(p+=this.x,f+=this.y,o%45==0&&(p=nt(p),f=nt(f))),this.moveTo(p,f,h)}moveTo(i,o,h){if(typeof i!="number"&&i){let U=i;if(U==a.mouse&&!a.mouse.isActive)return;if(!U||U.x===void 0||U.y===void 0)throw"sprite.moveTo ERROR: destination not defined.";h=o,o=U.y,i=U.x}if(i!=null&&i!=this.x?(this._dest.x=i,i=!0):(this._dest.x=this.x,i=!1),o!=null&&o!=this.y?(this._dest.y=o,o=!0):(this._dest.y=this.y,o=!1),this._destIdx++,!i&&!o)return Promise.resolve(!0);if(h??=this.speed||(this.tileSize<=1?1:.1),h<=0)return console.warn("sprite.move: speed should be a positive number"),Promise.resolve(!1);let u=this._dest.y-this.y,p=this._dest.x-this.x,f=Math.sqrt(u*u+p*p),g=h/f;this.vel.x=p*g,this.vel.y=u*g;let I=this.direction<0?this.direction+360:this.direction,C=I-.1,T=I+.1,q=a.world.velocityThreshold;q=Math.min(q,h*.1);let E=h*.51,H=i&&o,F=this._destIdx;return(async()=>{let U,$;do{if(await a.sleep(),F!=this._destIdx)return!1;let G=this.direction<0?this.direction+360:this.direction;if(H&&(G<=C||G>=T)||Math.abs(this.vel.x)<=q&&Math.abs(this.vel.y)<=q)return!1;i&&(this.vel.x>0?U=this._dest.x-this.x:U=this.x-this._dest.x),o&&(this.vel.y>0?$=this._dest.y-this.y:$=this.y-this._dest.y)}while(i&&U>E||o&&$>E);return this.x=this._dest.x,this.y=this._dest.y,this.vel.x=0,this.vel.y=0,!0})()}rotateTowards(i,o){if(this.__collider==1)throw new ut(0);let h=arguments,u,p,f;typeof h[0]!="number"?(u=h[0].x,p=h[0].y,o=h[1],f=h[2]):arguments.length>2&&(u=h[0],p=h[1],o=h[2],f=h[3]),u!==void 0?i=this.angleToFace(u,p,f):i-=this.rotation,o??=.1,this.rotationSpeed=i*o}angleTo(i,o){if(typeof i=="object"){let h=i;if(h==a.mouse&&!a.mouse.isActive)return 0;if(h.x===void 0||h.y===void 0)return console.error("sprite.angleTo ERROR: rotation destination not defined, object given with no x or y properties"),0;o=h.y,i=h.x}return a.atan2(o-this.y,i-this.x)}rotationToFace(i,o,h){return typeof i=="object"&&(h=o,o=i.y,i=i.x),Math.abs(i-this.x)<.01&&Math.abs(o-this.y)<.01?0:this.angleTo(i,o)+(h||0)}angleToFace(i,o,h){let u=this.rotationToFace(i,o,h);return Je(u,this.rotation)}rotateTo(i,o,h){if(this.__collider==1)throw new ut(0);let u=arguments;if(typeof u[0]!="number"?i=this.rotationToFace(u[0].x,u[0].y,h):u.length>2&&(h=u[3],o=u[2],i=this.rotationToFace(u[0],u[1],h)),i==this.rotation)return;let p=a._angleMode=="degrees"?360:a.TWO_PI;return i=(i-this.rotation)%p,i<0&&o>0&&(i+=p),i>0&&o<0&&(i-=p),o??=this.rotationSpeed||Math.sign(i),this.rotate(i,o)}rotateMinTo(i,o,h){if(this.__collider==1)throw new ut(0);let u=arguments;if(typeof u[0]!="number"?i=this.rotationToFace(u[0].x,u[0].y,h):u.length>2&&(h=u[3],o=u[2],i=this.rotationToFace(u[0],u[1],h)),i!=this.rotation)return i=Je(i,this.rotation),o??=this.rotationSpeed||Math.sign(i),o=Math.abs(o)*Math.sign(i),this.rotate(i,o)}rotate(i,o){if(this.__collider==1)throw new ut(0);if(isNaN(i))throw new ut(1,[i]);if(i==0)return;o??=this.rotationSpeed||1;let h=i>0&&o>0;h||(i=-Math.abs(i),o=-Math.abs(o)),this.rotationSpeed=o;let u=Math.abs(o),p=this.rotation+i;this._rotateIdx??=0,this._rotateIdx++;let f=this._rotateIdx;return(async()=>{let g=.01;do{let I=Math.abs(p-this.rotation);if(u>I&&(this.rotationSpeed=I*Math.sign(o)),await a.sleep(),this._rotateIdx!=f||h&&this.rotationSpeed<g||!h&&this.rotationSpeed>-g)return!1}while((h&&p>this.rotation||!h&&p<this.rotation)&&g<Math.abs(p-this.rotation));return this.rotationSpeed=0,this.rotation=p,!0})()}addAni(){if(a.p5play.disableImages){this._ani=new a.SpriteAnimation;return}let i=[...arguments],o,h;return i[0]instanceof a.SpriteAnimation?(h=i[0],h._addedToSpriteOrGroup&&(h=h.clone()),o=h.name||"default",h.name=o):i[1]instanceof a.SpriteAnimation?(o=i[0],h=i[1],h._addedToSpriteOrGroup&&(h=h.clone()),h.name=o):(h=new a.SpriteAnimation(this,...i),o=h.name),this.animations[o]=h,this._ani=h,h._addedToSpriteOrGroup=!0,this._dimensionsUndef&&(h.w!=1||h.h!=1)&&(this.w=h.w,this.h=h.h),h}addImage(){return this.addAni(...arguments)}addAnis(){let i=arguments,o;i.length==1?o=i[0]:(this.spriteSheet=i[0],o=i[1]);for(let h in o){let u=o[h];this.addAni(h,u)}}addImages(){return this.addAnis(...arguments)}async changeAni(i){if(a.p5play.disableImages)return;if(arguments.length>1)i=[...arguments];else if(i instanceof a.SpriteAnimation){if(i==this._ani)return;i=[i]}else if(!Array.isArray(i)){if(i==this._ani?.name)return;i=[i]}this._aniChangeCount++;let o,h;for(let p=0;p<i.length;p++){let f=i[p];(f instanceof a.SpriteAnimation||f instanceof p5.Image||typeof f=="string"&&f.length!=1&&f.includes("."))&&(f=this.addAni(f),i[p]=f),typeof f=="string"&&(f={name:f},i[p]=f),f.name.length>1&&(f.name[0]=="!"&&(f.name=f.name.slice(1),f.start=-1,f.end=0),(f.name[0]=="<"||f.name[0]==">")&&(f.name=f.name.slice(1),f.flipX=!0),f.name[0]=="^"&&(f.name=f.name.slice(1),f.flipY=!0),f.name=="**"&&(o=!0,i=i.slice(0,-1)),f.name==";;"&&(h=!0,i=i.slice(0,-1)))}let u=this._aniChangeCount;do for(let p=0;p<i.length;p++){let f=i[p];!f.start&&i.length>1&&(f.start=0),await this._playSequencedAni(f)}while(o&&u==this._aniChangeCount);i.length!=1&&h&&this._ani.stop()}_playSequencedAni(i){return new Promise(o=>{let{name:h,start:u,end:p,flipX:f,flipY:g}=i;this._changeAni(h),f&&(this._ani.scale.x=-this._ani.scale.x),g&&(this._ani.scale.y=-this._ani.scale.y),u<0&&(u=this._ani.length+u),u!==void 0&&(this._ani._frame=u),p!==void 0?this._ani.goToFrame(p):this._ani._frame==this._ani.lastFrame&&o(),this._ani._onComplete=this._ani._onChange=()=>{f&&(this._ani.scale.x=-this._ani.scale.x),g&&(this._ani.scale.y=-this._ani.scale.y),this._ani._onComplete=this._ani._onChange=null,o()}})}changeAnimation(){return this.changeAni(...arguments)}_changeAni(i){this._ani?._onChange&&this._ani._onChange(),this._ani?.onChange&&this._ani.onChange();let o=this.animations[i];if(!o){for(let h=this.groups.length-1;h>=0;h--)if(o=this.groups[h].animations[i],o){o=o.clone();break}}if(!o)throw a.noLoop(),new ut("Sprite.changeAnimation",[i]);this._ani=o,this._ani.name=i,this.resetAnimationsOnChange&&(this._ani._frame=0)}remove(){this.removed=!0}_remove(){this.body&&a.world.destroyBody(this.body),this.body=null;for(let i of this.groups)i.remove(this)}toString(){return"s"+this.idNum}_setContactCB(i,o,h,u){let p;h==0?p=Mt._collisions[u]:p=Mt._overlappers[u];let f=a.p5play[p],g=f[this._uid]??={};g[i._uid]!=o&&(g[i._uid]=o,g=f[i._uid],!(!g||!g[this._uid])&&(delete g[this._uid],Object.keys(g).length==0&&delete f[i._uid]))}_validateCollideParams(i,o){if(!i)throw new ut("Sprite.collide",2);if(!i._isSprite&&!i._isGroup)throw new ut("Sprite.collide",0,[i]);if(o&&typeof o!="function")throw new ut("Sprite.collide",1,[o])}_ensureCollide(i,o,h){if(this._hasOverlap[i._uid]!==!1&&(this._hasOverlap[i._uid]=!1),i._hasOverlap[this._uid]!==!1&&(i._hasOverlap[this._uid]=!1,i._isGroup))for(let u of i)u._hasOverlap[this._uid]=!1,this._hasOverlap[u._uid]=!1}collide(i,o){return this.collides(i,o)}collides(i,o){return this._validateCollideParams(i,o),this._ensureCollide(i),o&&this._setContactCB(i,o,0,0),this._collisions[i._uid]==1||this._collisions[i._uid]<=-3}colliding(i,o){this._validateCollideParams(i,o),this._ensureCollide(i),o&&this._setContactCB(i,o,0,1);let h=this._collisions[i._uid];return h<=-3?1:h>0?h:0}collided(i,o){return this._validateCollideParams(i,o),this._ensureCollide(i),o&&this._setContactCB(i,o,0,2),this._collisions[i._uid]<=-1}_validateOverlapParams(i,o){if(!i)throw new ut("Sprite.overlap",2);if(!i._isSprite&&!i._isGroup)throw new ut("Sprite.overlap",0,[i]);if(o&&typeof o!="function")throw new ut("Sprite.overlap",1,[o])}_ensureOverlap(i){if(this._hasSensors||this.addDefaultSensors(),!i._hasSensors)if(i._isSprite)i.addDefaultSensors();else{for(let o of i)o._hasSensors||o.addDefaultSensors();i._hasSensors=!0}if(this._hasOverlap[i._uid]||(this._removeContactsWith(i),this._hasOverlap[i._uid]=!0),!i._hasOverlap[this._uid]&&(i._removeContactsWith(this),i._hasOverlap[this._uid]=!0,i._isGroup))for(let o of i)o._hasOverlap[this._uid]=!0,this._hasOverlap[o._uid]=!0}overlap(i,o){return this.overlaps(i,o)}overlaps(i,o){return this._validateOverlapParams(i,o),this._ensureOverlap(i),o&&this._setContactCB(i,o,1,0),this._overlappers[i._uid]==1||this._overlappers[i._uid]<=-3}overlapping(i,o){this._validateOverlapParams(i,o),this._ensureOverlap(i),o&&this._setContactCB(i,o,1,1);let h=this._overlappers[i._uid];return h<=-3?1:h>0?h:0}overlapped(i,o){return this._validateOverlapParams(i,o),this._ensureOverlap(i),o&&this._setContactCB(i,o,1,2),this._overlappers[i._uid]<=-1}_removeContactsWith(i){if(i._isGroup)for(let o of i)this._removeContactsWith(o);else this.__removeContactsWith(i)}__removeContactsWith(i){if(!!this.body)for(let o=this.body.getContactList();o;o=o.next){let h=o.contact;(h.m_fixtureA.m_body.sprite._uid==i._uid||h.m_fixtureB.m_body.sprite._uid==i._uid)&&a.world.destroyContact(h)}}_sortFixtures(){let i=null,o=null,h,u;for(let p=this.fixtureList;p;p=p.getNext())p.m_isSensor?(o?o.m_next=p:o=p,u=p):(i?i.m_next=p:i=p,h=p);o&&(u.m_next=null),i&&(h.m_next=o),this.body.m_fixtureList=i||o}addDefaultSensors(){if(this._hasSensors)return;let i;if(this.body&&this.fixtureList){for(let o=this.fixtureList;o;o=o.getNext())o.m_isSensor||(i=o.m_shape,this.body.createFixture({shape:i,isSensor:!0}));this._sortFixtures()}else this.addSensor();this._hasSensors=!0}distanceTo(i){return a.dist(this.x,this.y,i.x,i.y)}},a.Sprite.propTypes={x:"Float64",y:"Float64",vel:"Vec2",rotation:"number",rotationSpeed:"number",allowSleeping:"boolean",bearing:"number",bounciness:"number",collider:"Uint8",color:"color",debug:"boolean",density:"number",direction:"number",drag:"number",friction:"number",h:"number",isSuperFast:"boolean",layer:"number",life:"Int32",mass:"number",mirror:"Vec2_boolean",offset:"Vec2",pixelPerfect:"boolean",removed:"boolean",rotationDrag:"number",rotationLock:"boolean",scale:"Vec2",shape:"Uint8",sleeping:"boolean",stroke:"color",strokeWeight:"number",text:"string",textColor:"color",textSize:"number",textStroke:"color",textStrokeWeight:"number",tile:"string",tileSize:"number",tint:"color",visible:"boolean",w:"number",opacity:"number",gravityScale:"number"},a.Sprite.props=Object.keys(a.Sprite.propTypes),a.Sprite.propsAll=a.Sprite.props.concat(["autoDraw","autoUpdate","d","diameter","dynamic","fill","height","heading","kinematic","resetAnimationsOnChange","speed","spriteSheet","static","width"]),a.Sprite.colliderTypes=["d","s","k","n"],a.Sprite.shapeTypes=["box","circle","chain","polygon"],a.Turtle=function(i){if(a.allSprites.tileSize>1)throw new Error("Turtle can't be used when allSprites.tileSize is greater than 1.");i??=25;let o=new a.Sprite(i,i,[[i,i*.4],[-i,i*.4],[0,-i*.8]]);o.color="green",o._isTurtleSprite=!0,o._prevPos={x:o.x,y:o.y};let h=o.move;return o.move=function(){return this._prevPos.x=this.x,this._prevPos.y=this.y,h.call(this,...arguments)},o},this.SpriteAnimation=class extends Array{constructor(){super();let i=[...arguments];this.name="default";let o;if(typeof i[0]=="object"&&(i[0]._isSprite||i[0]._isGroup)&&(o=i[0],i=i.slice(1),this._addedToSpriteOrGroup=!0),o??=a.allSprites,typeof i[0]=="string"&&(i[0].length==1||!i[0].includes("."))&&(this.name=i[0],i=i.slice(1)),this._frame=0,this._cycles=0,this.targetFrame=-1,this.offset={x:o.anis.offset.x??0,y:o.anis.offset.y??0},this._frameDelay=o.anis.frameDelay||4,this.demoMode=o.anis.demoMode??!1,this.playing=!0,this.visible=!0,this.looping=o.anis.looping??!0,this.endOnFirstFrame=o.anis.endOnFirstFrame??!1,this.frameChanged=!1,this.onComplete=this.onChange=null,this._onComplete=this._onChange=null,this.rotation=o.anis.rotation??0,this._scale=new ne,!(i.length==0||typeof i[0]=="number")){if(o.animations[this.name]=this,o._ani=this,Array.isArray(i[0])&&typeof i[0][0]=="string"&&(i=[...i[0]]),i.length==2&&typeof i[0]=="string"&&(typeof i[1]=="string"||typeof i[1]=="number")){let h=i[0],u,p;isNaN(i[1])?u=i[1]:p=Number(i[1]);let f=0,g=0;for(let T=h.length-5;T>=0&&!isNaN(h.charAt(T));T--)f++;if(u)for(let T=u.length-5;T>=0&&!isNaN(u.charAt(T));T--)g++;let I=h.slice(0,-4-f),C;if(u&&(C=u.slice(0,-4-g)),u&&I!=C)this.push(a.loadImage(h)),this.push(a.loadImage(u));else{let T=parseInt(h.slice(-4-f,-4),10);if(p??=parseInt(u.slice(-4-g,-4),10),p<T){let E=p;p=T,T=E}let q;if(!u||f==g)for(let E=T;E<=p;E++)q=I+a.nf(E,f)+".png",this.push(a.loadImage(q));else for(let E=T;E<=p;E++)q=I+E+".png",this.push(a.loadImage(q))}}else if(typeof i.at(-1)!="string"&&!(i.at(-1)instanceof p5.Image)){let f=function(){Array.isArray(u)&&(u.length==4?u={pos:u.slice(0,2),size:u.slice(2)}:u={pos:u});let{w:g,h:I,width:C,height:T,size:q,row:E,col:H,line:F,x:U,y:$,pos:G,frames:j,frameCount:tt,frameDelay:Vt,frameSize:At,delay:St,rotation:Lt}=u;At??=q||o.anis.frameSize,St&&(p.frameDelay=St),Vt&&(p.frameDelay=Vt),Lt&&(p.rotation=Lt),j&&Array.isArray(j)?tt=j.length:tt??=j||1,g??=C||o.anis.w,I??=T||o.anis.h,U??=H||0,$??=F||E||0,G&&(U=G[0],$=G[1]),typeof At=="number"?g=I=At:At&&(g=At[0],I=At[1]);let _t=o.tileSize;if(!g||!I?!o._dimensionsUndef&&o.w&&o.h?(g??=o.w*_t,I??=o.h*_t):_t!=1?(g??=_t,I??=_t):tt?(g??=p.spriteSheet.width/tt,I??=p.spriteSheet.height):p.spriteSheet.width<p.spriteSheet.height?g=I=p.spriteSheet.width:g=I=p.spriteSheet.height:(g*=_t,I*=_t),Array.isArray(j)){let te=Math.round(p.spriteSheet.width/g);for(let K of j)if(typeof K=="number")$=Math.floor(K/te)*I,U=K%te*g,p.push({x:U,y:$,w:g,h:I});else{let ii;K.length==2?(U=K[0]*g,$=K[1]*I,ii={x:U,y:$,w:g,h:I}):ii={x:K[0],y:K[1],w:K[2],h:K[3]},p.push(ii)}}else{(_t!=1||G||F!==void 0||E!==void 0||H!==void 0)&&(U*=g,$*=I);for(let te=0;te<tt;te++)p.push({x:U,y:$,w:g,h:I}),U+=g,U>=p.spriteSheet.width&&(U=0,$+=I,$>=p.spriteSheet.height&&($=0))}},h=o.spriteSheet,u;if(i[0]instanceof p5.Image||typeof i[0]=="string"){if(i.length>=3)throw new ut("SpriteAnimation",1);h=i[0],u=i[1]}else u=i[0];let p=this;if(h instanceof p5.Image&&h.width!=1&&h.height!=1)this.spriteSheet=h,f();else{let g;typeof h=="string"?g=h:g=h.url,a._incrementPreload(),this.spriteSheet=a.loadImage(g,()=>{f(),a._decrementPreload()}),typeof h=="string"&&(o.spriteSheet=this.spriteSheet)}}else for(let h=0;h<i.length;h++)i[h]instanceof p5.Image?this.push(i[h]):this.push(a.loadImage(i[h]));this.length==1&&(this.playing=!1)}}get frame(){return this._frame}set frame(i){if(i<0||i>=this.length)throw new ut("SpriteAnimation.frame",[i,this.length]);this._frame=i,this._cycles=0}get frameDelay(){return this._frameDelay}set frameDelay(i){i<=0&&(i=1),this._frameDelay=i}get scale(){return this._scale}set scale(i){typeof i=="number"&&(i={x:i,y:i}),this._scale._x=i.x,this._scale._y=i.y,this._scale._avg=i.x}clone(){this.length||console.error(`The animation named "${this.name}" must be loaded before it can be properly copied. Sprites need their own copy of a group's animation. Try loading the animation in the preload function and creating new group sprites in the setup function.`);let i=new a.SpriteAnimation;i.spriteSheet=this.spriteSheet;for(let o=0;o<this.length;o++)i.push(this[o]);return i.name=this.name,i.offset.x=this.offset.x,i.offset.y=this.offset.y,i.frameDelay=this.frameDelay,i.playing=this.playing,i.looping=this.looping,i.rotation=this.rotation,i}draw(i,o,h,u,p){if(this.x=i||0,this.y=o||0,!this.visible)return;u??=1,p??=1,a.push(),a.imageMode("center"),a.translate(this.x,this.y),a.rotate(h||this.rotation),a.scale(u*this._scale._x,p*this._scale._y);let f=this[this._frame];if(f!==void 0)if(this.spriteSheet){let{x:g,y:I,w:C,h:T}=f;this.demoMode?a.image(this.spriteSheet,this.offset.x,this.offset.y,this.spriteSheet.w,this.spriteSheet.h,g-this.spriteSheet.w/2+C/2,I-this.spriteSheet.h/2+T/2):a.image(this.spriteSheet,this.offset.x,this.offset.y,C,T,g,I,C,T)}else a.image(f,this.offset.x,this.offset.y);else console.warn('p5play: "'+this.name+'" animation not loaded yet or frame '+this._frame+" does not exist. Load this animation in the preload function if you need to use it at the start of your program.");a.pop()}update(){if(!!this.playing)if(this._cycles++,this._cycles%this.frameDelay==0){if(this._cycles=0,this.frameChanged=!0,(this.targetFrame==-1&&this._frame==this.lastFrame||this._frame==this.targetFrame)&&(this.endOnFirstFrame&&(this._frame=0),this.looping?this.targetFrame=-1:this.playing=!1,this._onComplete&&this._onComplete(),this.onComplete&&this.onComplete(),!this.looping))return;this.targetFrame>this._frame&&this.targetFrame!==-1?this._frame++:this.targetFrame<this._frame&&this.targetFrame!==-1?this._frame--:this.targetFrame===this._frame&&this.targetFrame!==-1?this.playing=!1:this.looping?this._frame>=this.lastFrame?this._frame=0:this._frame++:this._frame<this.lastFrame&&this._frame++}else this.frameChanged=!1}play(i){return this.playing=!0,i!==void 0&&this._frame!=i&&(this._frame=i,this._cycles=0),this.targetFrame=-1,new Promise(o=>{this._onComplete=()=>{this._onComplete=null,o()}})}pause(i){this.playing=!1,i&&(this._frame=i)}stop(i){this.playing=!1,i&&(this._frame=i)}rewind(){return this.looping=!1,this.goToFrame(0)}loop(){this.looping=!0,this.playing=!0}noLoop(){this.looping=!1}nextFrame(){this._frame<this.length-1?this._frame=this._frame+1:this.looping&&(this._frame=0),this.targetFrame=-1,this.playing=!1,this._cycles=0}previousFrame(){this._frame>0?this._frame=this._frame-1:this.looping&&(this._frame=this.length-1),this.targetFrame=-1,this.playing=!1,this._cycles=0}goToFrame(i){if(!(i<0||i>=this.length))return this.targetFrame=i,this._cycles=0,this.targetFrame!==this._frame&&(this.playing=!0),new Promise(o=>{this._onComplete=()=>{this._onComplete=null,o()}})}get lastFrame(){return this.length-1}get frameImage(){let i=this._frame,o=this[i];if(o instanceof p5.Image)return o;let{x:h,y:u,w:p,h:f}=o,g=a.createImage(p,f);return g.copy(this.spriteSheet,this.offset.x,this.offset.y,p,f,h,u,p,f),g}get w(){return this.width}get width(){let i=this[this._frame];return i instanceof p5.Image?i.width:i?i.w:1}get h(){return this.height}get height(){let i=this[this._frame];return i instanceof p5.Image?i.height:i?i.h:1}},a.SpriteAnimation.props=["demoMode","endOnFirstFrame","frameDelay","frameSize","looping","offset","rotation","scale"],this.SpriteAnimations=class{#t={};constructor(){let i=this,o=[...a.SpriteAnimation.props],h=["offset","scale"];for(let u of o)Object.defineProperty(this,u,{get(){return i.#t[u]},set(p){i.#t[u]=p;for(let f in i){let g=i[f];g instanceof SpriteAnimation&&(g[u]=p)}}});for(let u of h){this.#t[u]={_x:0,_y:0};for(let p of["x","y"])Object.defineProperty(this.#t[u],p,{get(){return i.#t[u]["_"+p]},set(f){i.#t[u]["_"+p]=f;for(let g in i){let I=i[g];I instanceof SpriteAnimation&&(I[u][p]=f)}}})}}},this.Group=class extends Array{constructor(...i){let o;if(i[0]instanceof a.Group&&(o=i[0],i=i.slice(1)),super(...i),typeof i[0]=="number")return;for(let p of this)if(!(p instanceof a.Sprite))throw new Error("A group can only contain sprites");if(this._isGroup=!0,this.x,this.y,this.vel,this.rotation,this.rotationSpeed,this.autoDraw,this.allowSleeping,this.autoUpdate,this.bounciness,this.collider,this.color,this.debug,this.density,this.direction,this.drag,this.friction,this.h,this.isSuperFast,this.layer,this.life,this.mass,this.mirror,this.offset,this.pixelPerfect,this.removed,this.rotationDrag,this.rotationLock,this.scale,this.shape,this.sleeping,this.stroke,this.strokeWeight,this.text,this.textColor,this.tile,this.tileSize,this.visible,this.w,this.bearing,this.d,this.diameter,this.dynamic,this.height,this.heading,this.kinematic,this.resetAnimationsOnChange,this.speed,this.static,this.width,this.idNum,a.p5play.groupsCreated<999)this.idNum=a.p5play.groupsCreated;else{for(let p=1;p<a.p5play.groups.length;p++)if(!a.p5play.groups[p]?.removed){this.idNum=p;break}if(!this.idNum){console.warn("ERROR: Surpassed the limit of 999 groups in memory. Use less groups or delete groups from the p5play.groups array to recycle ids.");for(let p=1;p<a.p5play.groups.length;p++)if(!a.p5play.groups[p].length){this.idNum=p;break}this.idNum??=1}}if(this._uid=this.idNum,a.p5play.groups[this._uid]=this,a.p5play.groupsCreated++,a.allSprites||(this._isAllSpritesGroup=!0),this.subgroups=[],o instanceof a.Group){o.subgroups.push(this);let p=o;do p=a.p5play.groups[p.parent],p.subgroups.push(this);while(!p._isAllSpritesGroup);this.parent=o._uid}else this._isAllSpritesGroup||(a.allSprites.subgroups.push(this),this.parent=0);this.animations=new a.SpriteAnimations,this._hasOverlap={},this._collisions={},this._overlappers={};let h=this;this.Sprite=class extends a.Sprite{constructor(){super(h,...arguments)}},this.GroupSprite=this.Sprite,this.Group=class extends a.Group{constructor(){super(h,...arguments)}},this.Subgroup=this.Group,this.mouse={presses:null,pressing:null,pressed:null,holds:null,holding:null,held:null,released:null,hovers:null,hovering:null,hovered:null};for(let p in this.mouse)this.mouse[p]=function(f){for(let g of h)if(g.mouse[p](f))return!0;return!1};for(let p of a.Sprite.propsAll)p=="ani"||p=="velocity"||Object.defineProperty(this,p,{get(){let f=h["_"+p];if(f===void 0&&!h._isAllSpritesGroup){let g=a.p5play.groups[h.parent];g&&(f=g[p])}return f},set(f){h["_"+p]=f;for(let g of h.subgroups)g["_"+p]=f;for(let g=0;g<h.length;g++){let I=h[g],C=f;typeof f=="function"&&(C=f(g)),I[p]=C}}});let u=["mirror","offset","scale","vel"];for(let p of u){p="_"+p,p!="vel"?this[p]={}:this[p]=new a.Vector,this[p]._x=0,this[p]._y=0;for(let f of["x","y"])Object.defineProperty(this[p],f,{get(){let g=h[p]["_"+f];if(h.length-1,g===void 0&&!h._isAllSpritesGroup){let I=a.p5play.groups[h.parent];I&&(g=I[p][f],I.length-1)}return g},set(g){h[p]["_"+f]=g;for(let I=0;I<h.length;I++){let C=h[I],T=g;typeof g=="function"&&(T=g(I)),C[p][f]=T}}})}this._isAllSpritesGroup&&(this.autoCull=!0,this.tileSize=1,this.autoDraw=!0,this.autoUpdate=!0),this.add=this.push,this.contains=this.includes}_getTopLayer(){if(this.length==0||this.length==1&&this[0]._layer===void 0)return 0;let i=this[0]._layer;for(let o of this)o._layer>i&&(i=o._layer);return i}get ani(){return this._ani}set ani(i){this.addAni(i);for(let o of this)o.changeAni(i)}get animation(){return this._ani}set animation(i){this.ani=i}get anis(){return this.animations}get img(){return this._img}set img(i){this.image=i}get image(){return this._img}set image(i){if(typeof i=="function"){this._img=i;return}typeof i=="string"&&(i.includes(".")?i=a.loadImage(i):i=new a.EmojiImage(i,this.w||this.width||this.d||this.diameter)),this._img=a.Sprite.prototype._extendImage(i)}get amount(){return this.length}set amount(i){let o=i-this.length,h=o>0;o=Math.abs(o);for(let u=0;u<o;u++)h?new this.Sprite:this[this.length-1].remove()}get velocity(){return this.vel}set velocity(i){this.vel=i}_resetCentroid(){let i=0,o=0;for(let h of this)i+=h.x,o+=h.y;return this.centroid={x:i/this.length,y:o/this.length},this.centroid}_resetDistancesFromCentroid(){for(let i of this)i.distCentroid={x:i.x-this.centroid.x,y:i.y-this.centroid.y}}_validateCollideParams(i,o){if(o&&typeof o!="function")throw new ut("Group.collide",1,[o]);if(!i)throw new ut("Group.collide",2);if(!i._isGroup&&!i._isSprite)throw new ut("Group.collide",0,[i])}_setContactCB(i,o,h,u){if(i._isSprite){let I=function(C,T,q){return o.call(T,T,C,q)};i._setContactCB(this,I,h,u);return}let p;h==0?p=Mt._collisions[u]:p=Mt._overlappers[u];let f=a.p5play[p],g=f[this._uid]??={};if(g[i._uid]!=o){g[i._uid]=o;for(let I of this){let C=f[I._uid]??={};C[i._uid]=o}if(this._uid!=i._uid&&(g=f[i._uid],!(!g||!g[this._uid]))){this._uid!=i._uid&&delete g[this._uid];for(let I of i)g=f[I._uid],!(!g||!g[this._uid])&&(delete g[this._uid],Object.keys(g).length==0&&delete f[I._uid]);Object.keys(g).length==0&&delete f[i._uid]}}}_ensureCollide(i){if(this._hasOverlap[i._uid]!==!1){this._hasOverlap[i._uid]=!1;for(let o of this)if(o._hasOverlap[i._uid]=!1,i._hasOverlap[o._uid]=!1,this._uid==i._uid)for(let h of i)o._hasOverlap[h._uid]=!1,h._hasOverlap[o._uid]=!1}if(i._hasOverlap[this._uid]!==!1&&(i._hasOverlap[this._uid]=!1,i._isGroup))for(let o of i){o._hasOverlap[this._uid]=!1,this._hasOverlap[o._uid]=!1;for(let h of this)o._hasOverlap[h._uid]=!1,h._hasOverlap[o._uid]=!1}}collide(i,o){return this.collides(i,o)}collides(i,o){return this._validateCollideParams(i,o),this._ensureCollide(i),o&&this._setContactCB(i,o,0,0),this._collisions[i._uid]==1||this._collisions[i._uid]<=-3}colliding(i,o){this._validateCollideParams(i,o),this._ensureCollide(i),o&&this._setContactCB(i,o,0,1);let h=this._collisions[i._uid];return h<=-3?1:h>0?h:0}collided(i,o){return this._validateCollideParams(i,o),this._ensureCollide(i),o&&this._setContactCB(i,o,0,2),this._collisions[i._uid]<=-1}_validateOverlapParams(i,o){if(o&&typeof o!="function")throw new ut("Group.overlap",1,[o]);if(!i)throw new ut("Group.overlap",2);if(!i._isGroup&&!i._isSprite)throw new ut("Group.overlap",0,[i])}_ensureOverlap(i){if(!this._hasSensors){for(let o of this)o._hasSensors||o.addDefaultSensors();this._hasSensors=!0}if(!i._hasSensors)if(i._isSprite)i.addDefaultSensors();else{for(let o of i)o._hasSensors||o.addDefaultSensors();i._hasSensors=!0}if(this._hasOverlap[i._uid]!=!0){this._removeContactsWith(i),this._hasOverlap[i._uid]=!0;for(let o of this)if(o._hasOverlap[i._uid]=!0,i._hasOverlap[o._uid]=!0,this._uid==i._uid)for(let h of i)o._hasOverlap[h._uid]=!0,h._hasOverlap[o._uid]=!0}if(i._hasOverlap[this._uid]!=!0&&(i._removeContactsWith(this),i._hasOverlap[this._uid]=!0,i._isGroup))for(let o of i){o._hasOverlap[this._uid]=!0,this._hasOverlap[o._uid]=!0;for(let h of this)o._hasOverlap[h._uid]=!0,h._hasOverlap[o._uid]=!0}}overlap(i,o){return this.overlaps(i,o)}overlaps(i,o){return this._validateOverlapParams(i,o),this._ensureOverlap(i),o&&this._setContactCB(i,o,1,0),this._overlappers[i._uid]==1||this._overlappers[i._uid]<=-3}overlapping(i,o){this._validateOverlapParams(i,o),this._ensureOverlap(i),o&&this._setContactCB(i,o,1,1);let h=this._overlappers[i._uid];return h<=-3?1:h>0?h:0}overlapped(i,o){return this._validateOverlapParams(i,o),this._ensureOverlap(i),o&&this._setContactCB(i,o,1,2),this._overlappers[i._uid]<=-1}_removeContactsWith(i){for(let o of this)o._removeContactsWith(i)}applyForce(){for(let i of this)i.applyForce(...arguments)}applyForceScaled(){for(let i of this)i.applyForceScaled(...arguments)}attractTo(){for(let i of this)i.attractTo(...arguments)}applyTorque(){for(let i of this)i.applyTorque(...arguments)}move(i,o,h){let u=[];for(let p of this)u.push(p.move(i,o,h));return Promise.all(u)}moveTo(i,o,h){if(typeof i!="number"){let f=i;if(f==a.mouse&&!a.mouse.isActive)return;h=o,o=f.y,i=f.x}let u=this._resetCentroid(),p=[];for(let f of this){let g={x:f.x-u.x+i,y:f.y-u.y+o};p.push(f.moveTo(g.x,g.y,h))}return Promise.all(p)}moveTowards(i,o,h){if(typeof i!="number"){let u=i;if(u==a.mouse&&!a.mouse.isActive)return;h=o,o=u.y,i=u.x}if(!(i===void 0&&o===void 0)){this._resetCentroid();for(let u of this){u.distCentroid===void 0&&this._resetDistancesFromCentroid();let p={x:u.distCentroid.x+i,y:u.distCentroid.y+o};u.moveTowards(p.x,p.y,h)}}}moveAway(i,o,h){if(typeof i!="number"){let u=i;if(u==a.mouse&&!a.mouse.isActive)return;h=o,o=u.y,i=u.x}if(!(i===void 0&&o===void 0)){this._resetCentroid();for(let u of this){u.distCentroid===void 0&&this._resetDistancesFromCentroid();let p={x:u.distCentroid.x+i,y:u.distCentroid.y+o};u.moveAway(p.x,p.y,h)}}}push(...i){this.removed&&(console.warn("Adding a sprite to a group that was removed. Use `group.removeAll()` to remove all of a group's sprites without removing the group itself. Restoring the group in p5play's memory."),a.p5play.groups[this._uid]=this,this.removed=!1);for(let o of i){if(!(o instanceof a.Sprite))throw new Error("You can only add sprites to a group, not "+typeof o);if(o.removed){console.error("Can't add a removed sprite to a group");continue}let h;for(let u in this._hasOverlap){let p=this._hasOverlap[u];p&&!o._hasSensors&&o.addDefaultSensors(),u>=1e3?h=a.p5play.sprites[u]:h=a.p5play.groups[u],!(!h||h.removed)&&(p?h._ensureOverlap(o):h._ensureCollide(o))}for(let u in Mt){let p=Mt[u];for(let f of p){let g=a.p5play[f],I=g[this._uid];if(!I)continue;let C=g[o._uid]??={};for(let T in I)C[T]=I[T]}}super.push(o),this.parent&&a.p5play.groups[this.parent].push(o),o.groups.push(this)}return this.length}size(){return this.length}toString(){return"g"+this.idNum}cull(i,o,h,u,p){if(h===void 0){let H=i;p=o,i=o=h=u=H}if(isNaN(i)||isNaN(o)||isNaN(h)||isNaN(u))throw new TypeError("The culling boundary must be defined with numbers");if(p&&typeof p!="function")throw new TypeError("The callback to group.cull must be a function");let f=a.camera.x-a.canvas.hw/a.camera.zoom,g=a.camera.y-a.canvas.hh/a.camera.zoom,I=-h+f,C=-i+g,T=a.width+u+f,q=a.height+o+g,E=0;for(let H=0;H<this.length;H++){let F=this[H];F.shape!="chain"&&(F.x<I||F.y<C||F.x>T||F.y>q)&&(E++,p?p(F,E):F.remove(),F.removed&&H--)}return E}remove(i){if(i===void 0){this.removeAll(),this._isAllSpritesGroup||(this.removed=!0);return}let o;if(typeof i=="number"?i>=0?o=i:o=this.length+i:o=this.indexOf(i),o==-1)return;let h=this[o];return this.splice(o,1),h}splice(i,o){let h=super.splice(i,o);if(!h)return;let u=[];for(let p of h){if(p.removed)continue;let f=this._uid;do{u.push(f);let g=p.groups.findIndex(C=>C._uid==f);f=p.groups.splice(g,1)[0].parent}while(f)}for(let p of u){let f=a.p5play.groups[p];for(let g in Mt)for(let I in f[g]){if(f[g][I]==0)continue;let C;I>=1e3?C=a.p5play.sprites[I]:C=a.p5play.groups[I];let T=!1;for(let q of f)if(q[g][C._uid]>0){T=!0;break}T||(f[g][C._uid]=-2,C[g][f._uid]=-2)}}return h}pop(){return this.remove(this.length-1)}shift(){return this.remove(0)}unshift(){return console.error("unshift is not supported for groups"),this.length}removeAll(){for(;this.length>0;)this.at(-1).remove()}_step(){this.__step()}draw(){let i=[...this];i.sort((o,h)=>o._layer-h._layer);for(let o=0;o<i.length;o++){let h=i[o];h._visible!==!1&&(!a.p5play._inPostDraw||h.autoDraw)&&h.draw()}this._autoDraw&&(this._autoDraw=null)}update(){for(let i of this)(!a.p5play._inPostDraw||this.autoUpdate)&&i.update();this._autoUpdate&&(this._autoUpdate=null)}},a.Group.prototype.addAni=a.Group.prototype.addAnimation=a.Group.prototype.addImg=a.Group.prototype.addImage=a.Sprite.prototype.addAnimation=a.Sprite.prototype.addImg=a.Sprite.prototype.addAni,a.Group.prototype.addAnis=a.Group.prototype.addAnimations=a.Group.prototype.addImgs=a.Group.prototype.addImages=a.Sprite.prototype.addAnimations=a.Sprite.prototype.addImgs=a.Sprite.prototype.addAnis,a.Group.prototype.__step=a.Sprite.prototype.__step,a.Group.prototype.___step=a.Sprite.prototype.___step,this.World=class extends planck.World{constructor(){super(new S.Vec2(0,0),!0),this.mod={},this.origin={x:0,y:0},this.contacts=[],this.on("begin-contact",this._beginContact),this.on("end-contact",this._endContact);let i=this;this._gravity={get x(){return i.m_gravity.x},set x(o){if(o=Math.round(o||0),o!=i.m_gravity.x){i.mod[0]=!0;for(let h of a.allSprites)h.sleeping=!1;i.m_gravity.x=o}},get y(){return i.m_gravity.y},set y(o){if(o=Math.round(o||0),o!=i.m_gravity.y){i.mod[0]=!0;for(let h of a.allSprites)h.sleeping=!1;i.m_gravity.y=o}}},this._timeScale=1,this._updateTimeStep(),this.velocityIterations=8,this.positionIterations=3,this.velocityThreshold=.19,this.physicsTime=0,this.meterSize=60,this.mouseTracking??=!0,this.mouseSprite=null,this.mouseSprites=[],this.autoStep=!0,window.Event&&(this.steppedEvent=new window.Event("p5play_worldStepped"))}get gravity(){return this._gravity}set gravity(i){this._gravity.x=i.x,this._gravity.y=i.y}get timeScale(){return this._timeScale}set timeScale(i){if(i<0||i>2)return console.error("world.timeScale must be between 0 and 2");this._timeScale!=i&&(this._timeScale=i,this._updateTimeStep())}_updateTimeStep(){this._timeStep=1/(a._targetFrameRate||60)*this._timeScale}get velocityThreshold(){return S.Settings.velocityThreshold}set velocityThreshold(i){S.Settings.velocityThreshold=i}step(i,o,h){for(let f of a.allSprites)f.prevPos.x=f.x,f.prevPos.y=f.y,f.prevRotation=f.rotation;super.step(i||this._timeStep,o||this.velocityIterations,h||this.positionIterations),this.physicsTime+=i||this._timeStep;let u=Object.values(a.p5play.sprites),p=Object.values(a.p5play.groups);for(let f of u)f._step();for(let f of p)f._step();for(let f of u)f.___step();for(let f of p)f.___step();a.canvas.dispatchEvent&&a.canvas.dispatchEvent(this.steppedEvent),this.autoStep&&(this.autoStep=null)}get realTime(){return a.millis()/1e3}getSpritesAt(i,o,h,u){u??=!0;const p=new S.Vec2(i/a.world.meterSize,o/a.world.meterSize),f=new S.AABB;f.lowerBound=new S.Vec2(p.x-.001,p.y-.001),f.upperBound=new S.Vec2(p.x+.001,p.y+.001);let g=[];if(this.queryAABB(f,C=>(C.getShape().testPoint(C.getBody().getTransform(),p)&&g.push(C),!0)),g.length==0)return[];h??=a.allSprites;let I=[];for(let C of g){const T=C.m_body.sprite;T._cameraActiveWhenDrawn==u&&(I.find(q=>q._uid==T._uid)||I.push(T))}return I.sort((C,T)=>(C._layer-T._layer)*-1),I}getSpriteAt(i,o,h){return this.getSpritesAt(i,o,h)[0]}getMouseSprites(){let i=this.getSpritesAt(a.mouse.x,a.mouse.y);if(a.camera._wasOff){let o=this.getSpritesAt(a.mouse.canvasPos.x,a.mouse.canvasPos.y,a.allSprites,!1);o.length&&(i=[...o,...i])}return i}_beginContact(i){let o=i.m_fixtureA,h=i.m_fixtureB,u="_collisions";o.m_isSensor&&(u="_overlappers"),o=o.m_body.sprite,h=h.m_body.sprite,o[u][h._uid]=0,h[u][o._uid]=0;for(let p of h.groups)(!o[u][p._uid]||o[u][p._uid]<0)&&(o[u][p._uid]=0,p[u][o._uid]=0);for(let p of o.groups){(!h[u][p._uid]||h[u][p._uid]<0)&&(h[u][p._uid]=0,p[u][h._uid]=0);for(let f of h.groups)(!p[u][f._uid]||p[u][f._uid]<0)&&(p[u][f._uid]=0,f[u][p._uid]=0)}}_endContact(i){let o=i.m_fixtureA,h=i.m_fixtureB,u="_collisions";o.m_isSensor&&(u="_overlappers"),o=o.m_body.sprite,h=h.m_body.sprite,o[u][h._uid]=o[u][h._uid]!=0?-2:-4,h[u][o._uid]=h[u][o._uid]!=0?-2:-4;for(let p of h.groups){let f=!1;for(let g of p)if(g[u][o._uid]>=0){f=!0;break}f||(p[u][o._uid]=p[u][o._uid]!=0?-2:-4,o[u][p._uid]=o[u][p._uid]!=0?-2:-4)}for(let p of o.groups){let f=!1;for(let g of p)if(g[u][h._uid]>=0){f=!0;break}if(!f){p[u][h._uid]=p[u][h._uid]!=0?-2:-4,h[u][p._uid]=h[u][p._uid]!=0?-2:-4;for(let g of h.groups)p[u][g._uid]=p[u][g._uid]!=0?-2:-4,g[u][p._uid]=g[u][p._uid]!=0?-2:-4}}}_findContact(i,o,h){let u=o[i][h._uid];if(u)return u;for(let p of h.groups)if(u=o[i][p._uid],u)return u;for(let p of o.groups){if(u=p[i][h._uid],u)return u;for(let f of h.groups)if(p._uid==f._uid&&(u=p[i][f._uid],u))return u}return!1}get allowSleeping(){return this.getAllowSleeping()}set allowSleeping(i){this.setAllowSleeping(i)}rayCast(i,o,h){return this.rayCastAll(i,o,h,()=>!0)[0]}rayCastAll(i,o,h,u){let p=a.allSprites.tileSize,f=lt(i.x,i.y,p),g;if(typeof arguments[1]=="number")g=lt(i.x+h*a.cos(o),i.y+h*a.sin(o),p);else{let q=arguments[1];u??=arguments[2],g=lt(q.x,q.y,p)}let I=[],C=1;super.rayCast(f,g,function(q,E,H,F){let U=q.getBody().sprite,$=u&&u(U);return I.push({sprite:U,fraction:F}),$?(F<C&&(C=F),F):1}),I.sort((q,E)=>q.fraction-E.fraction);let T=[];for(let q of I)q.fraction<=C&&T.push(q.sprite);return T}},this.Camera=class{constructor(){this._pos=a.createVector.call(a),this.__pos={x:0,y:0,rounded:{}},this.isActive=!1,this.bound={min:{x:0,y:0},max:{x:0,y:0}},this._zoomIdx=-1,this._zoom=1,this._destIdx=0}get pos(){return this._pos}set pos(i){this.x=i.x,this.y=i.y}get position(){return this._pos}set position(i){this.x=i.x,this.y=i.y}_calcBoundsX(i){let o=a.canvas.hw/this._zoom;this.bound.min.x=i-o,this.bound.max.x=i+o}_calcBoundsY(i){let o=a.canvas.hh/this._zoom;this.bound.min.y=i-o,this.bound.max.y=i+o}get x(){return this._pos.x}set x(i){if(i===void 0||isNaN(i))return;this._pos.x=i;let o=-i;a.canvas.renderer=="2d"&&(o+=a.canvas.hw/this._zoom),this.__pos.x=o,a.allSprites.pixelPerfect&&(this.__pos.rounded.x=Math.round(o)),this._calcBoundsX(i)}get y(){return this._pos.y}set y(i){if(i===void 0||isNaN(i))return;this._pos.y=i;let o=-i;a.canvas.renderer=="2d"&&(o+=a.canvas.hh/this._zoom),this.__pos.y=o,a.allSprites.pixelPerfect&&(this.__pos.rounded.y=Math.round(o)),this._calcBoundsY(i)}moveTo(i,o,h){if(i===void 0)return;if(isNaN(i)&&(h=o,o=i.y,i=i.x),h??=1,h<=0)return console.warn("camera.moveTo: speed should be a positive number"),Promise.resolve(!1);let u=o-this.y,p=i-this.x,f=Math.sqrt(u*u+p*p),g=h/f,I=p*g,C=u*g;this._destIdx++;let T=this._destIdx,q=Math.ceil(f/h);return(async()=>{for(let E=0;E<q;E++)if(this.x+=I,this.y+=C,await a.sleep(),T!=this._destIdx)return!1;return this.x=i,this.y=o,!0})()}get zoom(){return this._zoom}set zoom(i){if(i===void 0||isNaN(i))return;this._zoom=i;let o=-this._pos.x;a.canvas.renderer=="2d"&&(o+=a.canvas.hw/i);let h=-this._pos.y;a.canvas.renderer=="2d"&&(h+=a.canvas.hh/i),this.__pos.x=o,this.__pos.y=h,a.allSprites.pixelPerfect&&(this.__pos.rounded.x=Math.round(o),this.__pos.rounded.y=Math.round(h)),this._calcBoundsX(this._pos.x),this._calcBoundsY(this._pos.y)}zoomTo(i,o){if(i==this._zoom)return Promise.resolve(!0);o??=.1;let h=Math.abs(i-this._zoom),u=Math.round(h/o);i<this.zoom&&(o=-o),this._zoomIdx++;let p=this._zoomIdx;return(async()=>{for(let f=0;f<u;f++){if(p!=this._zoomIdx)return!1;this.zoom+=o,await a.sleep()}return this.zoom=i,!0})()}on(){this.isActive||(a.push(),a.scale(this._zoom),a.allSprites.pixelPerfect?(this.__pos.rounded.x??=Math.round(this.__pos.x),this.__pos.rounded.y??=Math.round(this.__pos.y),a.translate(this.__pos.rounded.x,this.__pos.rounded.y)):a.translate(this.__pos.x,this.__pos.y),this.isActive=!0)}off(){this.isActive&&(a.pop(),this.isActive=!1,this._wasOff=!0)}},S.Fixture.prototype.shouldCollide=function(i){let o=this,h=i;return o.m_isSensor&&h.m_isSensor?!0:!(o.m_isSensor||h.m_isSensor||(o=o.m_body.sprite,h=h.m_body.sprite,o._hasOverlap[h._uid]??h._hasOverlap[o._uid]))},this.Tiles=class{constructor(i,o,h,u,p){typeof i=="string"&&(i[0]==`
`&&(i=i.slice(1)),i=i.replaceAll("	","  "),i=i.split(`
`)),o??=0,h??=0,u??=1,p??=1;let f=new a.Group;for(let g=0;g<i.length;g++)for(let I=0;I<i[g].length;I++){let C=i[g][I];if(C==" "||C==".")continue;let T,q,E=Object.values(a.p5play.groups);for(q of E)if(T=q.animations[C],T)break;if(T){f.push(new q.Sprite(T,o+I*u,h+g*p));continue}let H=!1;for(q of E)if(q.tile==C){H=!0;break}if(H){f.push(new q.Sprite(o+I*u,h+g*p));continue}let F;for(F of a.allSprites)if(F.tile==C){H=!0;break}if(H){F.x=o+I*u,F.y=h+g*p;continue}throw"Tile not found: "+C}return f}},this.createTiles=function(i,o,h,u,p){return new a.Tiles(i,o,h,u,p)},this.Joint=class{constructor(i,o,h){if(!i?._isSprite||!o?._isSprite)throw new Error("The Joint constructor requires two sprites as input.");if(i.body||i.addDefaultSensors(),o.body||o.addDefaultSensors(),this.spriteA=i,this.spriteB=o,h??="glue",this.type=h,h=="glue"){let g=S.WeldJoint({},i.body,o.body,i.body.getWorldCenter());this._createJoint(g)}let u=this;if(h!="glue"&&h!="slider"&&h!="rope")for(let g of["A","B"]){if(g=="A"&&h=="wheel")continue;const I="_offset"+g;this[I]=a.createVector.call(a);for(let C of["x","y"])Object.defineProperty(this[I],C,{get(){let T=u._j["m_localAnchor"+g][C]/u["sprite"+g].tileSize*a.world.meterSize;return a.p5play.friendlyRounding?nt(T):T},set(T){if(u._j["m_localAnchor"+g][C]=T/a.world.meterSize*u["sprite"+g].tileSize,u.type=="distance"||u.type=="rope")u._j.m_length=S.Vec2.distance(u._j.m_bodyA.getWorldPoint(u._j.m_localAnchorA),u._j.m_bodyB.getWorldPoint(u._j.m_localAnchorB));else if(u.type=="hinge"||u.type=="wheel"){let q;g=="A"?q="B":q="A",u._j["m_localAnchor"+q][C]=u._j["m_body"+q].getLocalPoint(u._j["m_body"+g].getWorldPoint(u._j["m_localAnchor"+g]))[C]}}})}let p=[];(h=="distance"||h=="glue"||h=="rope")&&p.push("enableMotor","maxPower","motorSpeed","power","speed"),h=="rope"&&p.push("damping","springiness");let f={};for(let g of p)f[g]={value:null,enumerable:!1};Object.defineProperties(this,f),this.visible=!0,i.joints.push(this),o.joints.push(this)}_createJoint(i){this._j=a.world.createJoint(i)}_display(){this._draw(this.spriteA.x,this.spriteA.y,this.spriteB.x,this.spriteB.y),this.visible=null}_draw(i,o,h,u){u?a.line(i,o,h,u):a.point(i,o)}get draw(){return this._display}set draw(i){this._draw=i}get offsetA(){return this._offsetA}set offsetA(i){this._offsetA.x=i.x,this._offsetA.y=i.y}get offsetB(){return this._offsetB}set offsetB(i){this._offsetB.x=i.x,this._offsetB.y=i.y}get springiness(){return this._springiness}set springiness(i){if(i>0&&(i<.1?i=a.map(i,0,.1,30,4):i<.5?i=a.map(i,.1,.5,4,2.5):i<.8?i=a.map(i,.5,.8,2.5,1):i<.9?i=a.map(i,.8,.9,1,.5):i=a.map(i,.9,1,.5,.2)),this._springiness=i,this.type!="wheel"){this._j.setFrequency(i);return}this._j.setSpringFrequencyHz(i)}get damping(){return this.type!="wheel"?this._j.getDampingRatio():this._j.getSpringDampingRatio()}set damping(i){if(this.type!="wheel"){this._j.setDampingRatio(i);return}this._j.setSpringDampingRatio(i)}get speed(){return this._j.getJointSpeed()}set speed(i){this._j.isMotorEnabled()||this._j.enableMotor(!0),this._j.setMotorSpeed(i)}get motorSpeed(){return this._j.getMotorSpeed()}get enableMotor(){return this._j.isMotorEnabled()}set enableMotor(i){this._j.enableMotor(i)}get maxPower(){return this._j.getMaxMotorTorque()}set maxPower(i){!this._j.isMotorEnabled()&&i&&this._j.enableMotor(!0),this._j.setMaxMotorTorque(i),i||this._j.enableMotor(!1)}get power(){return this._j.getMotorTorque()}get collideConnected(){return this._j.getCollideConnected()}set collideConnected(i){this._j.m_collideConnected=i}get reactionForce(){return this._j.getReactionForce(a.world._timeStep)}get reactionTorque(){return this._j.getReactionTorque(a.world._timeStep)}remove(){this._removed||(this.spriteA.joints.splice(this.spriteA.joints.indexOf(this),1),this.spriteB.joints.splice(this.spriteB.joints.indexOf(this),1),a.world.destroyJoint(this._j),this._removed=!0)}},this.GlueJoint=class extends a.Joint{constructor(i,o){super(...arguments,"glue")}},this.DistanceJoint=class extends a.Joint{constructor(i,o){super(...arguments,"distance");let h=S.DistanceJoint({},i.body,o.body,i.body.getWorldCenter(),o.body.getWorldCenter());this._createJoint(h)}_display(){let i,o;(this.offsetA.x||this.offsetA.y)&&(i=this.spriteA.body.getWorldPoint(this._j.m_localAnchorA),i=it(i.x,i.y,this.spriteA.tileSize)),(this.offsetB.x||this.offsetB.y)&&(o=this.spriteB.body.getWorldPoint(this._j.m_localAnchorB),o=it(o.x,o.y,this.spriteB.tileSize)),this._draw(i?i.x:this.spriteA.x,i?i.y:this.spriteA.y,o?o.x:this.spriteB.x,o?o.y:this.spriteB.y),this.visible=null}},this.WheelJoint=class extends a.Joint{constructor(i,o){super(...arguments,"wheel");let h=S.WheelJoint({maxMotorTorque:1e3,frequencyHz:4,dampingRatio:.7},i.body,o.body,o.body.getWorldCenter(),new S.Vec2(0,1));this._createJoint(h),this._angle=a._angleMode=="degrees"?90:1.5707963267948966}_display(){let i=this.spriteA.x,o=this.spriteA.y,h,u;if(!this.offsetB.x&&!this.offsetB.y)h=this.spriteB.x,u=this.spriteB.y;else{let C=this.spriteB.body.getWorldPoint(this._j.m_localAnchorB);C=it(C.x,C.y,this.spriteB.tileSize),h=C.x,u=C.y}let p=a.tan(this.spriteA.rotation),f=a.tan(this._angle+this.spriteA.rotation),g=(u-o+p*i-f*h)/(p-f),I=p*(g-i)+o;this._draw(g,I,h,u),this.visible=null}get angle(){return this._angle}set angle(i){i!=this._angle&&(this._angle=i,this._j.m_localXAxisA=new S.Vec2(a.cos(i),a.sin(i)),this._j.m_localXAxisA.normalize(),this._j.m_localYAxisA=S.Vec2.crossNumVec2(1,this._j.m_localXAxisA))}},this.HingeJoint=class extends a.Joint{constructor(i,o){super(...arguments,"hinge");let h=S.RevoluteJoint({},i.body,o.body,i.body.getWorldCenter());this._createJoint(h)}_display(){const i=this.offsetA.x,o=this.offsetA.y,h=this.spriteA.rotation,u=i*a.cos(h)-o*a.sin(h),p=i*a.sin(h)+o*a.cos(h);this._draw(this.spriteA.x+u,this.spriteA.y+p),this.visible=null}get range(){return this.upperLimit-this.lowerLimit}set range(i){i/=2,this.upperLimit=i,this.lowerLimit=-i}get lowerLimit(){let i=this._j.getLowerLimit();return a._angleMode=="radians"?i:a.degrees(i)}set lowerLimit(i){this._j.isLimitEnabled()||this._j.enableLimit(!0),this.spriteA.body.setAwake(!0),this.spriteB.body.setAwake(!0),a._angleMode=="degrees"&&(i=a.radians(i)),this._j.m_lowerAngle=i}get upperLimit(){let i=this._j.getUpperLimit();return a._angleMode=="radians"?i:a.degrees(i)}set upperLimit(i){this._j.isLimitEnabled()||this._j.enableLimit(!0),this.spriteA.body.setAwake(!0),this.spriteB.body.setAwake(!0),a._angleMode=="degrees"&&(i=a.radians(i)),this._j.m_upperAngle=i}get angle(){let i=this._j.getJointAngle();return a._angleMode=="radians"?i:a.radians(i)}},a.RevoluteJoint=a.HingeJoint,this.SliderJoint=class extends a.Joint{constructor(i,o){super(...arguments,"slider");let h=S.PrismaticJoint({lowerTranslation:-1,upperTranslation:1,enableLimit:!0,maxMotorForce:50,motorSpeed:0,enableMotor:!0},i.body,o.body,i.body.getWorldCenter(),new S.Vec2(1,0));this._createJoint(h),this._angle=0}get angle(){return this._angle}set angle(i){i!=this._angle&&(this._angle=i,this._j.m_localXAxisA=new S.Vec2(a.cos(i),a.sin(i)),this._j.m_localXAxisA.normalize(),this._j.m_localYAxisA=S.Vec2.crossNumVec2(1,this._j.m_localXAxisA))}get range(){return this.upperLimit-this.lowerLimit}set range(i){i/=2,this.upperLimit=i,this.lowerLimit=-i}get lowerLimit(){return this._j.getLowerLimit()/this.spriteA.tileSize*a.world.meterSize}set lowerLimit(i){this._j.isLimitEnabled()||this._j.enableLimit(!0),i=i*this.spriteA.tileSize/a.world.meterSize,this._j.setLimits(i,this._j.getUpperLimit())}get upperLimit(){return this._j.getUpperLimit()/this.spriteA.tileSize*a.world.meterSize}set upperLimit(i){this._j.isLimitEnabled()||this._j.enableLimit(!0),i=i*this.spriteA.tileSize/a.world.meterSize,this._j.setLimits(this._j.getLowerLimit(),i)}},a.PrismaticJoint=a.SliderJoint,this.RopeJoint=class extends a.Joint{constructor(i,o){super(...arguments,"rope");let h=S.RopeJoint({maxLength:1},i.body,o.body,i.body.getWorldCenter());this._createJoint(h),this._j.m_localAnchorB.x=0,this._j.m_localAnchorB.y=0}get maxLength(){return xt(this._j.getMaxLength(),this.spriteA.tileSize)}set maxLength(i){this._j.setMaxLength(Y(i,this.spriteA.tileSize))}};class ne{constructor(){let o=this;Object.defineProperties(this,{x:{get(){return o._x},set(h){h!=o._x&&(o._x=h,o._avg=(o._x+o._y)*.5)},configurable:!0,enumerable:!0},y:{get(){return o._y},set(h){h!=o._y&&(o._y=h,o._avg=(o._x+o._y)*.5)},configurable:!0,enumerable:!0},_x:{value:1,enumerable:!1,writable:!0},_y:{value:1,enumerable:!1,writable:!0},_avg:{value:1,enumerable:!1,writable:!0}})}valueOf(){return this._avg}}(function(){let i=new Float32Array(1),o=new Int32Array(i.buffer);return function(u){i[0]=u;let p=o[0],f=p>>16&32768,g=p>>12&2047,I=p>>23&255;return I<103?f:I>142?(f|=31744,f|=(I==255?0:1)&&p&8388607,f):I<113?(g|=2048,f|=(g>>114-I)+(g>>113-I&1),f):(f|=I-112<<10|g>>1,f+=g&1,f)}})();function Ni(i){return!/^(?:(?:\/\*[^(?:\*\/)]*\*\/\s*)|(?:\/\/[^\r\n]*))*\s*(?:(?:(?:async\s(?:(?:\/\*[^(?:\*\/)]*\*\/\s*)|(?:\/\/[^\r\n]*))*\s*)?function|class)(?:\s|(?:(?:\/\*[^(?:\*\/)]*\*\/\s*)|(?:\/\/[^\r\n]*))*)|(?:[_$\w][\w0-9_$]*\s*(?:\/\*[^(?:\*\/)]*\*\/\s*)*\s*\()|(?:\[\s*(?:\/\*[^(?:\*\/)]*\*\/\s*)*\s*(?:(?:['][^']+['])|(?:["][^"]+["]))\s*(?:\/\*[^(?:\*\/)]*\*\/\s*)*\s*\]\())/.test(i.toString())}function Ri(i){if(i=="d"||i=="s"||i=="k"||i=="n")return!0;let o=i.slice(0,2);return o=="dy"||o=="st"||o=="ki"||o=="no"}function Ei(i,o){let h=i,u=o.toLowerCase();if(u=="triangle"?h=[h,-120,3]:u=="square"?h=[h,-90,4]:u=="pentagon"?h=[h,-72,5]:u=="hexagon"?h=[h,-60,6]:u=="septagon"?h=[h,-51.4285714286,7]:u=="octagon"?h=[h,-45,8]:u=="enneagon"?h=[h,-40,9]:u=="decagon"?h=[h,-36,10]:u=="hendecagon"?h=[h,-32.7272727273,11]:u=="dodecagon"&&(h=[h,-30,12]),h==i)throw new Error("Invalid, not a regular polygon: "+o);return h}a.p5play.palettes=[{a:"aqua",b:"black",c:"crimson",d:"darkviolet",e:"peachpuff",f:"olive",g:"green",h:"hotpink",i:"indigo",j:"navy",k:"khaki",l:"lime",m:"magenta",n:"brown",o:"orange",p:"pink",q:"turquoise",r:"red",s:"skyblue",t:"tan",u:"blue",v:"violet",w:"white",x:"gold",y:"yellow",z:"gray"}],this.colorPal=(i,o)=>{if(i instanceof p5.Color)return i;typeof o=="number"&&(o=a.p5play.palettes[o]),o??=a.p5play.palettes[0];let h=o[i];return h?a.color(h):a.color(0,0,0,0)},this.EmojiImage=function(i,o){a.push(),a.textSize(o);let h=a.createTextImage(i);if(h.trim)h=h.trim();else{let u=h.drawingContext,p=h._pixelDensity||1,g=u.getImageData(0,0,h.width*p,h.height*p).data,I=h.width,C=0,T=h.height,q=0;for(let E=0;E<h.height*p;E++)for(let H=0;H<h.width*p;H++){let F=(E*h.width*p+H)*4;g[F+3]!==0&&(H<I&&(I=H),H>C&&(C=H),E<T&&(T=E),E>q&&(q=E))}T=Math.floor(T/p),q=Math.floor(q/p),I=Math.floor(I/p),C=Math.floor(C/p),h=h.get(I,T,C-I+1,q-T+1)}return a.pop(),h.url=i,h},this.spriteArt=(i,o,h)=>{o??=1,typeof h=="number"&&(h=a.p5play.palettes[h]),h??=a.p5play.palettes[0];let u=i;typeof i=="string"&&(i=i.trim(),i=i.replace(/\r*\n\t+/g,`
`),i=i.replace(/\s+$/g,""),u=i.split(`
`));let p=0;for(let I of u)I.length>p&&(p=I.length);let f=u.length,g=a.createImage(p*o,f*o);g.loadPixels();for(let I=0;I<u.length;I++)for(let C=0;C<u[I].length;C++)for(let T=0;T<o;T++)for(let q=0;q<o;q++){let E=this.colorPal(u[I][C],h);g.set(C*o+T,I*o+q,E)}return g.updatePixels(),g.w=g.width,g.h=g.height,a.p5play.onImageLoad(g),g},this.createSprite=function(){return new a.Sprite(...arguments)},this.createGroup=function(){return new a.Group(...arguments)},this.loadAnimation=this.loadAni=function(){return new a.SpriteAnimation(...arguments)},this.animation=function(i,o,h,u,p,f){i.visible&&i.update(),i.draw(o,h,u,p,f)},this.delay=i=>i?new Promise(o=>{setTimeout(o,i)}):new Promise(requestAnimationFrame),this.sleep=i=>i?a.delay(i):new Promise(o=>{if(a.canvas.dispatchEvent){let h=function(){a.canvas.removeEventListener("p5play_worldStepped",h),o()};a.canvas.addEventListener("p5play_worldStepped",h)}else setTimeout(o,a.world._timeStep*1e3)}),this.play=i=>{if(!i?.play)throw new Error("Tried to play your sound but it wasn't a sound object.");return new Promise(o=>{i.play(),i.onended(()=>o())})};async function ns(){if(document.getElementById("p5play-intro"))return;a._incrementPreload();let i=document.createElement("div");i.id="p5play-intro",i.style="position: absolute; width: 100%; height: 100%; top: 0; left: 0; z-index: 1000; background-color: black;";let o=document.createElement("img");o.style="position: absolute; top: 50%; left: 50%; width: 80vmin; height: 40vmin; margin-left: -40vmin; margin-top: -20vmin; z-index: 1001; opacity: 1; scale: 1; transition: scale 1.5s, opacity 0.4s ease-in-out;",o.onerror=()=>{o.style.imageRendering="pixelated",o.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAABACAYAAADS1n9/AAABbGlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAACiRfZC/S0JhGIWfm4VgNkQNDg13igYr0SCXBjWQIkisQG26Xn+C2sfVCKMtWkPoP8igOWgoIgxaGhqCqCGitqamgpaSL+69hS51lvfhcDgcXujxaEKUeoFypWbEo2E1kUypzhcUFCxpelWEYrEFk39vlxT4uLezt+Nm12u7uRvciV6Wj88XNx88k/wvVyZb1YEvwKcLowaKF4ht1ITJW8CwkUimQGmYnLf5wOS0zSdWZjkeAeUaUPWClgHlFfCmu/x8F5dL6/rPMnO9O1tZWTJ7gBFmKVJFUEKjjkqMwB/5KSsfYQ1BHYMieQrUUAkhrIYsKnNU0JnAi4ofH3785p/tuo+7n/95O972M8y0pJRnHW++BUfT4DrteGNBGOyHq1OhGZplOYCeXA7eDmEgCUM34Fqt5gJ+e707DH1PUr6PgnMP2g0pP/elbDfB8QgXlW8Y/mq9pjC8gwAABSxJREFUeJztnb9y2zAMxulcpnbNntfJ3D5n97xO966Z3aNP9NHgBxAgQVmO8bvLNZZIiCI+gH8kpyl4bk7P3gErOJ/PZ0+zp9NpmZ9CAM54O7+wSgQhAEdWOb+wQgSvzZHAj5+/50x9/WkOeRMZwIkm+medXyAi8M4CL82R4KkIATjQRL8nJJN4XysEsAKv9L8DIYAnJyaBk8CUTDLA51/bbP7jHWSQRZPByADeTDp/tM4ozT4AVHSwO1kEMBMY/dTLFNcMcN5oSgTHYHBi2fPrS4qo98Mh/a+C8/ErdyJYw8cbb/bzH/ncGQY8aOYAnpThZ4XGerZdrn209fxIe6rVQw52Oif4NquAfF+d+Y6NSeej9C9F/714WAHkyP5uoxcSCBKSic5WMhwCciTlcnUaRSmVRlw5x0UiVx6VqW1Ru1zbaHl6TXS9Efae3GmuNzpXYDMA7VT6OxKE9nhPKNy1ZlHbEdL/qPNRdHsy2i5WAIk41yt6emM1Jw5OcL12eg4VR1rWmRCGAVEAGjhncseLQ7SOebZV6t4TxWEBcFHHOayO7PoHUcpy/y5FSP+jWJ06KoKRDAUngZxDUXrVlOsdR0jX8vjsxaqI1dilG0ciWdjgHcN4GqgERdcR1/VayjwgBFDzQG/yJEaASKgSIYBnAgg8BKAARRWKvkcjDwMhgAKIjkcACREJlgOuAu5K7Qgwaz0KeQaOOn9vTCsBwLwApMiZdOBROpnj3u2bdX5aPQfwaOBuDIr1HveYryldl30wBO4RZ4AS1aXCbFr2skezTa5b2+7Z7Z2nNjZKh3Jja3HGHtlAcnwyOj+/HIIFUACd0TizbhzTQU1ddAzYg+WYY5d0TM5dXql6A2VzO7n0jUS6kTtXuseVQ4Im01icXxgfApgOuvy8pevPjD3VuRrhRpu29trG2GI7eWPFkKCJerZdzH2UV8NUAsiqR8pnG5YdJjjNZA+8aYvqIq6dQqNfC9N5YofvDNuO3HbQ/tNG+dwVQOmwS8QAg/kY26lABF17Aqq65DgSlSkzMR2ZpM53hmsve32mvehLIvIcoFyIaUB9vhZB3bBmbJ6cLJkfrb4PRj+FmSAeCsbxiXF+0mSAG5WhDtjSfT32S3TtUb6wsMS6Qkd4TtKQoI62b0FTPkW3EQQ6G908KgcB5aA9BKir4WFf59q4ZNneF0eYZ/4SUxtB4lg88rVoLnqEa7CAOqz9J0Y9Caw/N44FnX0zYQPHRXsI4RqQ0Zk/B1iNUB5RYKohgN4svNG8GiApCpbr2QN2uHN08nmBGSK4ttyLkd1D1TBgxGUV4F1OOk/PSWUTENsRqJ3ovo1M5gHo+4A13/YPRd4sS2c7V/m1795WMJvZlNvIUv1RTtzXw2mqncXbnsSSqCJwIuCua3GetX4zBBj+ntDlBCeCYGNg2Vo7UXIeR6nv9fSPE0EIoAdwfs095xis85NeAC/SyWDSCQLXJ6cT9T2Ajo+MQOhkgWTMBMh55iecPSxDQHBLEwCG7WfJkd13CYS6mvpXrJPAoKURQdILATnSkrKbjTJLugc7piGAQWZEkDS7dMIj5utWulQf2SNIzk8hgD6zIoBQRy36n0U0k/sQgAIogjT/Z9saHO1pV3YhACUuImCcNWRPsGVZ1ocAjEAh9JwmOAsyaG9kPycEMAAUQWIcp3CWt71gB84SP34JJ7Gzm0I1A/a0hGomsTigF6VWZ3pEfQjAAY3jLM7yticRAnAEOW7GUd72ECEAZ2qneTjL294NKaX/gKttC9Kft4MAAAAASUVORK5CYII="};let h=window._p5play_intro_image;h==""||h?.includes("made_with_p5play")?((h.includes("bit.")||h.includes("pixel"))&&(o.style.imageRendering="pixelated"),o.src=h):o.src="https://p5play.org/assets/made_with_p5play.webp",await new Promise(u=>o.onload=u),i.append(o),document.body.append(i),await a.delay(),o.offsetHeight,o.style.scale=1.2,await a.delay(1100),o.style.opacity=0,await a.delay(400),i.style.display="none",i.remove(),document.getElementById("p5play-intro")?.remove(),a._decrementPreload()}if(window.location){let i=location.hostname;switch(i){case"":case"127.0.0.1":case"localhost":case"p5play.org":case"editor.p5js.org":case"codepen.io":case"codera.app":case"aug4th.com":case"cdpn.io":case"glitch.com":case"replit.com":case"stackblitz.com":case"jsfiddle.net":case"aijs.io":case"preview-aijs.web.app":case"quinton-ashley.github.io":break;default:if(/^[\d\.]+$/.test(i)||i.endsWith("stackblitz.io")||i.endsWith("glitch.me")||i.endsWith("replit.dev")||i.endsWith("codehs.com")||i.endsWith("openprocessing.org")||location.origin.endsWith("preview.p5js.org"))break;ns()}}let c=p5.disableFriendlyErrors;p5.disableFriendlyErrors=!0;const Ut=a.createCanvas;this.createCanvas=function(){let i=[...arguments],o,h,u;if(typeof i[0]=="string")if(i[0].includes(":")){let g=i[0].split(":"),I=Number(g[0]),C=Number(g[1]),T=window.innerWidth,q=window.innerWidth*(C/I);q>window.innerHeight&&(T=window.innerHeight*(I/C),q=window.innerHeight),i[0]=Math.round(T),i.splice(1,0,Math.round(q)),o="fullscreen"}else i=[0,0,...i];if(i[0]||(i[0]=window.innerWidth,i[1]=window.innerHeight,o="fullscreen"),typeof i[2]=="string"){let g=i[2].toLowerCase().split(" ");g[0]=="pixelated"?(h="pixelated",g[1]?(o="centered",u=Number(g[1].slice(1))):o="fullscreen",i.splice(2,1)):g[0]=="fullscreen"&&(o="fullscreen",i.splice(2,1))}let p=Ut.call(a,...i);a.ctx=a.drawingContext;let f=p.canvas||p;return f.renderer=p.GL?"webgl":"2d",f.tabIndex=0,f.w=i[0],f.h=i[1],f.addEventListener&&(f.addEventListener("keydown",function(g){(g.key==" "||g.key=="/"||g.key=="ArrowUp"||g.key=="ArrowDown"||g.key=="ArrowLeft"||g.key=="ArrowRight")&&g.preventDefault()}),f.addEventListener("mouseover",()=>{this.mouse.isOnCanvas=!0,this.mouse.isActive=!0}),f.addEventListener("mouseleave",()=>{this.mouse.isOnCanvas=!1}),f.addEventListener("touchstart",g=>g.preventDefault()),f.addEventListener("contextmenu",g=>g.preventDefault())),f.save??=a.saveCanvas.bind(a),f.resize??=a.resizeCanvas.bind(a),f.hw=f.w*.5,f.hh=f.h*.5,f.mouse={x:a.mouseX,y:a.mouseY},f.renderer=="2d"?(a.camera.x=f.hw,a.camera.y=f.hh):(a.camera.x=0,a.camera.y=0,a._textCache=!1,a.p5play._renderStats={x:-f.hw+10,y:-f.hh+20}),c||(p5.disableFriendlyErrors=!1),a.displayMode(o,h,u),p},this.Canvas=class{constructor(i,o,h,u){this.w,this.width,this.h,this.height,this.hw,this.hh,this.mouse}resize(){}save(){}},this.canvas=a.canvas,a.Canvas=function(){return a.createCanvas(...arguments).canvas};const $t=a.resizeCanvas;this.resizeCanvas=(i,o)=>{i??=window.innerWidth,o??=window.innerHeight,$t.call(a,i,o);let h=a.canvas;h.w=h.width/a.pixelDensity(),h.h=h.height/a.pixelDensity(),h.hw=h.w*.5,h.hh=h.h*.5,h.fullscreen&&(h.w/h.h>window.innerWidth/window.innerHeight?(h.style.width="100%!important",h.style.height="auto!important"):(h.style.width="auto!important",h.style.height="100%!important")),h.renderer=="2d"?(a.camera.x=h.hw,a.camera.y=h.hh):(a.camera.x=0,a.camera.y=0)};const bt=a.frameRate;this.frameRate=function(i){let o=bt.call(a,i);return i&&a.world._updateTimeStep(),o};const ti=a.background;this.background=function(){let i=arguments;i.length==1&&i[0]?.length==1?ti.call(a,a.colorPal(i[0])):ti.call(a,...i)};const X=a.fill;this.fill=function(){let i=arguments;i.length==1&&i[0]?.length==1?X.call(a,a.colorPal(i[0])):X.call(a,...i)};const W=a.stroke;this.stroke=function(){let i=arguments;i.length==1&&i[0]?.length==1?W.call(a,a.colorPal(i[0])):W.call(a,...i)};const ei=a.loadImage;this.loadImage=this.loadImg=function(){if(a.p5play.disableImages)return a._decrementPreload(),{w:16,width:16,h:16,height:16,pixels:[]};let i=arguments,o=i[0],h=a.p5play.images[o],u;if(typeof i[i.length-1]=="function"&&(u=i[i.length-1]),h)return h.width==1&&h.height==1||!h.pixels.length?u?(h.cbs.push(u),h.calls++):a._decrementPreload():(u&&u(),a._decrementPreload()),h;const p=f=>{f.w||(Object.defineProperty(f,"w",{get:function(){return this.width}}),Object.defineProperty(f,"h",{get:function(){return this.height}}));for(let g of f.cbs)g(f);for(let g=1;g<f.calls;g++)a._decrementPreload();f.cbs=[],a.p5play.onImageLoad(h)};return h=ei.call(a,o,p),h.cbs=[],h.calls=1,u&&h.cbs.push(u),h.url=o,a.p5play.images[o]=h,h};const as=a.image;a.image=function(){a.p5play.disableImages||as.call(a,...arguments)},a.displayMode||(document.head.insertAdjacentHTML("beforeend",`<style>
html, body {
	margin: 0;
	padding: 0;
}
.p5Canvas {
	outline: none;
	-webkit-touch-callout: none;
	-webkit-text-size-adjust: none;
	-webkit-user-select: none;
	overscroll-behavior: none;
}
.p5-pixelated {
	image-rendering: pixelated;
	font-smooth: never;
	-webkit-font-smoothing: none;
}
.p5-centered,
.p5-maxed,
.p5-fullscreen {
  display: flex;
	align-items: center;
	justify-content: center;
}
main.p5-centered,
main.p5-maxed,
.p5-fullscreen {
	height: 100vh;
}
main {
	overscroll-behavior: none;
}
</style>`),a._adjustDisplay=()=>{let i=a.canvas,o=i.style,h=i.parentElement;!o||!h||!i.displayMode||(i.renderQuality=="pixelated"&&(i.classList.add("p5-pixelated"),a.pixelDensity(1),a.noSmooth&&a.noSmooth(),a.textFont&&a.textFont("monospace")),i.displayMode=="normal"?(h.classList.remove("p5-centered","p5-maxed","p5-fullscreen"),o.width=i.w*i.displayScale+"px",o.height=i.h*i.displayScale+"px"):(h.classList.add("p5-"+i.displayMode),h=h.getBoundingClientRect(),i.w/i.h>h.width/h.height?(i.displayMode=="centered"?(o.width=i.w*i.displayScale+"px",o.maxWidth="100%"):o.width="100%",o.height="auto",o.maxHeight=""):(o.width="auto",o.maxWidth="",i.displayMode=="centered"?(o.height=i.h*i.displayScale+"px",o.maxHeight="100%"):o.height="100%")))},a.displayMode=(i="normal",o="default",h=1)=>{let u=a.canvas;typeof h=="string"&&(h=parseFloat(h.slice(1))),Object.assign(u,{displayMode:i,renderQuality:o,displayScale:h}),a._adjustDisplay()});let Et=!1;if(typeof a._textCache!="object")try{Et=Number(p5.VERSION.replaceAll(".",""))>=190}catch{}if(Et){a._textCache=!0,a._TimedCache=class extends Map{constructor(){super(),this.maxSize=500}set(o,h){h.lastAccessed=Date.now(),super.set(o,h),this.size>this.maxSize&&this.gc()}get(o){const h=super.get(o);return h&&(h.lastAccessed=Date.now()),h}gc(){let o=1/0,h,u=0;for(const[p,f]of this.entries())f.lastAccessed<o&&(o=f.lastAccessed,h=u),u++;u=h;for(const p of this.keys()){if(u==0){h=p;break}u--}this.delete(h)}},a._tic=new a._TimedCache,a.textCache=(o,h)=>(h&&(a._tic.maxSize=h),o!==void 0&&(a._textCache=o),a._textCache),a._genTextImageKey=(o,h,u)=>{const p=a._renderer;let f=p._textFont;return typeof f!="string"&&(f=f.font.names.fullName,f=f[Object.keys(f)[0]]),o.slice(0,200)+(p._textStyle||"normal")+p._textSize+f+(p._doFill?a.ctx.fillStyle:"")+"_"+(p._doStroke&&p._strokeSet?a.ctx.lineWidth+a.ctx.strokeStyle+"_":"")+(h||"")+(u?"x"+u:"")},a.createTextImage=(o,h,u)=>{let p=a._textCache;a._textCache=!0,a._genTextImage=!0,a.text(o,0,0,h,u),a._genTextImage=!1;let f=a._genTextImageKey(o,h,u);return a._textCache=p,a._tic.get(f)};const i=a.text;a.text=(o,h,u,p,f)=>{if(o===void 0)return;o=o.toString();const g=a._renderer;if(!g._doFill&&!g._doStroke)return;let I=a.ctx,C=a._genTextImage;if(!C&&a._textCache){let Vt=I.getTransform();C=Vt.b!=0||Vt.c!=0}if(!C)return i.call(a,o,h,u,p,f);let T,q,E,H,F,U,$;if(E=a._genTextImageKey(o,p,f),q=a._tic.get(E),q&&!a._genTextImage){a.textImage(q,h,u);return}let G=a.createGraphics.call(a,1,1);G.textFont(a.textFont()),a.textStyle()&&G.textStyle(a.textStyle()),G.textSize(a.textSize()),T=G.canvas.getContext("2d");let j=o.split(`
`);H=0,F=g._textLeading*j.length;let tt=T.measureText(" ");U=tt.fontBoundingBoxAscent,$=tt.fontBoundingBoxDescent,f??=F+$,G.resizeCanvas(Math.ceil(G.textWidth(o)),Math.ceil(f)),G.fill(I.fillStyle),g._doStroke?(G.stroke(I.strokeStyle),G.strokeWeight(I.lineWidth)):G.noStroke();for(let Vt=0;Vt<j.length&&(G.text(j[Vt],H,F),F+=g._textLeading,!(F>f));Vt++);q=G.get(),q._ascent=U,q._descent=$,a._tic.set(E,q),a._genTextImage||a.textImage(q,h,u)},a.textImage=(o,h,u)=>{let p=a._renderer._imageMode;a.imageMode.call(a,"corner");const f=a.canvas.getContext("2d");f.textAlign=="center"?h-=o.width*.5:f.textAlign=="right"&&(h-=o.width);let g;f.textBaseline=="alphabetic"?u-=a._renderer._textLeading:g=a._renderer._textLeading-a._renderer._textSize,f.textBaseline=="middle"?u-=o._descent+o._ascent*.5+g:f.textBaseline=="bottom"?u-=o._ascent+o._descent+g:f.textBaseline=="top"&&(u-=o._descent+g),a.image.call(a,o,h,u),a.imageMode.call(a,p)}}let Ht={generic:["Ah! I found an error","Oh no! Something went wrong","Oof! Something went wrong","Houston, we have a problem","Whoops, having trouble here"],Sprite:{constructor:{base:"Sorry I'm unable to make a new Sprite",0:"What is $0 for? If you're trying to specify the x position of the sprite, please specify the y position as well.",1:`If you're trying to specify points for a chain Sprite, please use an array of position arrays.
$0`,2:"Invalid input parameters: $0"},hw:{0:"I can't change the halfWidth of a Sprite directly, change the sprite's width instead."},hh:{1:"I can't change the halfHeight of a Sprite directly, change the sprite's height instead."},rotate:{0:"Can't use this function on a sprite with a static collider, try changing the sprite's collider type to kinematic.",1:`Can't use "$0" for the angle of rotation, it must be a number.`},rotateTo:{},rotateTowards:{},changeAnimation:`I can't find any animation named "$0".`,collide:{0:"I can't make that sprite collide with $0. Sprites can only collide with another sprite or a group.",1:"The collision callback has to be a function.",2:"You're trying to check for an collision with a sprite or group that doesn't exist!"},overlap:{0:"I can't make that sprite overlap with $0. Sprites can only overlap with another sprite or a group.",1:"The overlap callback has to be a function.",2:"You're trying to check for an overlap with a sprite or group that doesn't exist!"}},SpriteAnimation:{constructor:{base:"Hey so, I tried to make a new SpriteAnimation but couldn't",1:"The name of the animation must be the first input parameter."},frame:"Index $0 out of bounds. That means there is no frame $0 in this animation. It only has $1 frames!"},Group:{constructor:{base:"Hmm awkward! Well it seems I can't make that new Group you wanted"}}};Ht.Group.collide=Ht.Sprite.collide,Ht.Group.overlap=Ht.Sprite.overlap,Ht.Sprite.rotateTo[0]=Ht.Sprite.rotateTowards[0]=Ht.Sprite.rotate[0];class ut extends Error{constructor(o,h,u){super(),typeof o!="string"&&(u=h,h=o,o=this.stack.match(/\n\s*at ([^\(]*)/)[1],o=o.slice(0,-1)),typeof h!="number"&&(u=h,h=void 0),o.slice(0,3)=="new"&&(o=o.slice(4)),o=o.split(".");let p=o[0];o=o[1]||"constructor";let f=this.stack.match(/\/([^p\/][^5][^\/:]*:[^\/:]+):/);f&&(f=f[1].split(":"),f=" in "+f[0]+" at line "+f[1]),f=" using "+p+"."+o+". ",u=u||[];let g=Ht[p][o],I;g.base?I=g.base+f:I=Ht.generic[Math.floor(Math.random()*Ht.generic.length)]+f,h!==void 0&&(g=g[h]),g=g.replace(/\$([0-9]+)/g,(C,T)=>u[T]),I+=g,p5._friendlyError(I,o)}}this.allSprites=new a.Group,this.world=new a.World,this.camera=new a.Camera,this.InputDevice=class{constructor(){this.holdThreshold=12,this._default=0}_ac(i){return i}presses(i){return i??=this._default,this[i]===void 0&&(i=this._ac(i)),this[i]==1||this[i]==-3}pressing(i){return i??=this._default,this[i]===void 0&&(i=this._ac(i)),this[i]==-3?1:this[i]>0?this[i]:0}pressed(i){return this.released(i)}holds(i){return i??=this._default,this[i]===void 0&&(i=this._ac(i)),this[i]==this.holdThreshold}holding(i){return i??=this._default,this[i]===void 0&&(i=this._ac(i)),this[i]>=this.holdThreshold?this[i]:0}held(i){return i??=this._default,this[i]===void 0&&(i=this._ac(i)),this[i]==-2}released(i){return i??=this._default,this[i]===void 0&&(i=this._ac(i)),this[i]<=-1}releases(i){return this.released(i)}},this._Mouse=class extends a.InputDevice{constructor(){super(),this._default="left";let i=this;this._pos=a.createVector.call(a),Object.defineProperty(this._pos,"x",{get(){return i.x},set(o){i.x=o}}),Object.defineProperty(this._pos,"y",{get(){return i.y},set(o){i.y=o}}),this.x=0,this.y=0,this.canvasPos={},this.left=0,this.center=0,this.right=0,this.drag={left:0,center:0,right:0},this._dragFrame={left:!1,center:!1,right:!1},this.isOnCanvas=!1,this.isActive=!1,this._visible=!0,this._cursor="default"}_ac(i){return i=i.toLowerCase(),i.slice(0,4)=="left"?i="left":i.slice(0,5)=="right"?i="right":i.slice(0,6)=="middle"&&(i="center"),i}_update(){a.mouse.canvasPos.x=a.mouseX,a.mouse.canvasPos.y=a.mouseY,a.camera.x==a.canvas.hw&&a.camera.y==a.canvas.hh&&a.camera.zoom==1?(this.x=a.mouseX,this.y=a.mouseY):(this.x=(a.mouseX-a.canvas.hw)/a.camera.zoom+a.camera.x,this.y=(a.mouseY-a.canvas.hh)/a.camera.zoom+a.camera.y)}get pos(){return this._pos}get position(){return this._pos}get cursor(){return a.canvas.style.cursor}set cursor(i){i!=this._cursor&&(a.cursor(i),this._cursor=i)}get visible(){return this._visible}set visible(i){this._visible=i,i?a.canvas.style.cursor="default":a.canvas.style.cursor="none"}drags(i){return i??=this._default,this.drag[i]==1}dragging(i){return i??=this._default,this.drag[i]>0?this.drag[i]:0}dragged(i){return i??=this._default,this.drag[i]<=-1}},this.mouse=new a._Mouse,this._SpriteMouse=class extends a._Mouse{constructor(){super(),delete this.canvasPos,this.hover=0}hovers(){return this.hover==1}hovering(){return this.hover>0?this.hover:0}hovered(){return this.hover<=-1}};const Ai=function(i){if(a.mouse.isActive=!0,a.mouse[i]++,a.world.mouseSprites.length){let o=a.world.mouseSprite?.mouse;o&&(o[i]=0,o.hover=0,o.drag[i]=0),ms=a.world.mouseSprites[0],a.world.mouseSprite=ms,o=ms.mouse,o[i]=1,o.hover<=0&&(o.hover=1)}},lo=a._onmousedown;a._onmousedown=function(i){if(!a._setupDone)return;let o="left";i.button===1?o="center":i.button===2&&(o="right"),Ai.call(a,o),lo.call(a,i)};const mo=function(i){let o=a.mouse;o[i]>0&&(o._dragFrame[i]=!0)},co=a._onmousemove;a._onmousemove=function(i){if(!a._setupDone)return;let o="left";i.button===1?o="center":i.button===2&&(o="right"),mo.call(a,o),co.call(a,i)};const uo=function(i){let o=a.mouse;o[i]>=o.holdThreshold?o[i]=-2:o[i]>1?o[i]=-1:o[i]=-3,o.drag[i]>0&&(o.drag[i]=-1);let h=a.world.mouseSprite?.mouse;!h||(h.hover>1?(h[i]>=a.mouse.holdThreshold?h[i]=-2:h[i]>1?h[i]=-1:h[i]=-3,h.drag[i]>0&&(h.drag[i]=-1)):(h[i]=0,h.drag[i]=0))},hs=a._onmouseup;if(a._onmouseup=function(i){if(!a._setupDone)return;let o="left";i.button===1?o="center":i.button===2&&(o="right"),uo.call(a,o),hs.call(a,i)},this._Touch=class extends a.InputDevice{constructor(i){super(),this.x,this.y,this.id=i.identifier,this._default="duration",this.holdThreshold=a.touches.holdThreshold,this.duration=1,this.drag=0,this._dragFrame=!1,this.canvasPos={},this._update(i)}_update(i){let o=a.canvas;const h=o.getBoundingClientRect(),u=o.scrollWidth/o.w||1,p=o.scrollHeight/o.h||1,f=this.canvasPos.x=(i.clientX-h.left)/u,g=this.canvasPos.y=(i.clientY-h.top)/p;a.camera.x==o.hw&&a.camera.y==o.hh&&a.camera.zoom==1?(this.x=f,this.y=g):(this.x=(f-o.hw)/a.camera.zoom+a.camera.x,this.y=(g-o.hh)/a.camera.zoom+a.camera.y),this.force=i.force}},this.touches=[],a.touches.holdThreshold=12,a._ontouchstart=function(i){if(!!a._setupDone){a.getAudioContext&&a.getAudioContext()?.state=="suspended"&&a.userStartAudio();for(let o of i.changedTouches)a.touches.push(new a._Touch(o)),a.touches.length==1&&(a.mouseX=a.touches[0].x,a.mouseY=a.touches[0].y,a.mouse._update(),a.world.mouseSprites=a.world.getMouseSprites(),a._onmousedown(i));a.touchStarted&&!a.touchStarted(i)&&i.preventDefault()}},a._ontouchmove=function(i){if(!!a._setupDone){for(let o of i.changedTouches){let h=a.touches.find(u=>u.id==o.identifier);h._update(o),h._dragFrame=!0,h.id==a.touches[0].id&&(a.mouseX=a.touches[0].x,a.mouseY=a.touches[0].y,a.mouse._update(),a._onmousemove(i))}a.touchMoved&&!a.touchMoved(i)&&i.preventDefault()}},a._ontouchend=function(i){if(!!a._setupDone){for(let o of i.changedTouches){let h=a.touches.find(u=>u.id==o.identifier);h._update(o),h.duration>=h.holdThreshold?h.duration=-2:h.duration>1?h.duration=-1:h.duration=-3,h.drag>0&&(h.drag=-1),h.id==a.touches[0].id&&(a.mouseX=a.touches[0].x,a.mouseY=a.touches[0].y,a.mouse._update(),a._onmouseup(i))}a.touchEnded&&!a.touchEnded(i)&&i.preventDefault()}},this._Keyboard=class extends a.InputDevice{constructor(){super(),this._default=" ",this.alt=0,this.arrowUp=0,this.arrowDown=0,this.arrowLeft=0,this.arrowRight=0,this.backspace=0,this.capsLock=0,this.control=0,this.enter=0,this.meta=0,this.shift=0,this.tab=0;let i=this._simpleKeyControls={arrowUp:"up",arrowDown:"down",arrowLeft:"left",arrowRight:"right"};i.w=i.W="up",i.s=i.S="down",i.a=i.A="left",i.d=i.D="right",i.i=i.I="up2",i.k=i.K="down2",i.j=i.J="left2",i.l=i.L="right2"}get visible(){return this._inp==document.activeElement}set visible(i){this._inp||(this._inp=Object.assign(document.createElement("input"),{type:"text",style:"position: fixed; height: 0; padding: 0; border: none; opacity: 0.0001; pointer-events: none;"}),document.body.appendChild(this._inp)),this._visible=i,i?this._inp.focus():this._inp.blur()}_ac(i){if(i.length!=1){if(!isNaN(i)){if(i==38)return"arrowUp";if(i==40)return"arrowDown";if(i==37)return"arrowLeft";if(i==39)return"arrowRight";if(i>=10)throw new Error("Use key names with the keyboard input functions, not keyCode numbers!");return i}i=i.replaceAll(/[ _-]/g,"")}if(i=i.toLowerCase(),i.length!=1){if(i=="arrowup")return"arrowUp";if(i=="arrowdown")return"arrowDown";if(i=="arrowleft")return"arrowLeft";if(i=="arrowright")return"arrowRight";if(i=="capslock")return"capsLock"}return i}_pre(i){(!this[i]||this[i]<0)&&(this[i]=1)}_rel(i){this[i]>=this.holdThreshold?this[i]=-2:this[i]>1?this[i]=-1:this[i]=-3}get cmd(){return this.meta}get command(){return this.meta}get ctrl(){return this.control}get space(){return this[" "]}get spacebar(){return this[" "]}get opt(){return this.alt}get option(){return this.alt}get win(){return this.meta}get windows(){return this.meta}},this.kb=new a._Keyboard,this.keyboard=a.kb,typeof navigator=="object"&&navigator.keyboard){const i=navigator.keyboard;window==window.top?i.getLayoutMap().then(o=>{o.get("KeyW")!="w"&&(a.p5play.standardizeKeyboard=!0)}):a.p5play.standardizeKeyboard=!0}else a.p5play.standardizeKeyboard=!0;function Wi(i){let o=i.code;return o.length==4&&o.slice(0,3)=="Key"?o[3].toLowerCase():i.key}const Ji=a._onkeydown;a._onkeydown=function(i){let o=i.key;if(this.p5play.standardizeKeyboard&&(o=Wi(i)),o.length>1)o=o[0].toLowerCase()+o.slice(1);else{let u=o.toLowerCase(),p=o.toUpperCase();u!=p&&(o!=p?this.kb._pre(p):this.kb._pre(u))}this.kb._pre(o);let h=this.kb._simpleKeyControls[o];h&&this.kb._pre(h),Ji.call(this,i)};const P=a._onkeyup;a._onkeyup=function(i){let o=i.key;if(this.p5play.standardizeKeyboard&&(o=Wi(i)),o.length>1)o=o[0].toLowerCase()+o.slice(1);else{let u=o.toLowerCase(),p=o.toUpperCase();u!=p&&(o!=p?this.kb._rel(p):this.kb._rel(u))}this.kb._rel(o);let h=this.kb._simpleKeyControls[o];if(h&&this.kb._rel(h),i.shiftKey){let u=o.toLowerCase();this.kb[u]>0&&this.kb._rel(u)}P.call(this,i)},this.Contro=class extends a.InputDevice{constructor(i){super(),this._default="a",this.connected=!0,this.a=0,this.b=0,this.x=0,this.y=0,this.l=0,this.r=0,this.lt=0,this.rt=0,this.select=0,this.start=0,this.lsb=0,this.rsb=0,this.up=0,this.down=0,this.left=0,this.right=0,this.leftStick={x:0,y:0},this.rightStick={x:0,y:0},this.leftTrigger=0,this.rightTrigger=0,this.buttonMapping={a:0,b:1,x:2,y:3,l:4,r:5,lt:6,rt:7,select:8,start:9,lsb:10,rsb:11,up:12,down:13,left:14,right:15},this.axeMapping={leftStick:{x:0,y:1},rightStick:{x:2,y:3},leftTrigger:4,rightTrigger:5},this.isMock=!1,typeof i!="string"?(this.gamepad=i,this.id=i.id):(this.gamepad={},this.id=i,this.isMock=!0),this._axeTriggers=this.gamepad.axes&&this.gamepad.axes[this.axeMapping.leftTrigger]!==void 0,this.hasAnalogTriggers=this._axeTriggers||void 0,this.id.includes("GuliKit")&&(this.buttonMapping.a=1,this.buttonMapping.b=0,this.buttonMapping.x=3,this.buttonMapping.y=2)}_ac(i){return i=i.toLowerCase(),i=="lb"?i="l":i=="rb"?i="r":i=="leftstickbutton"?i="lsb":i=="rightstickbutton"&&(i="rsb"),i}_update(){if(this.isMock||(this.gamepad=navigator.getGamepads()[this.gamepad.index],!this.gamepad?.connected))return;let i=this.gamepad;for(let o in this.buttonMapping){let h=this.buttonMapping[o],u=i.buttons[h];!u||(u.pressed?this[o]++:this[o]=this[o]>0?-1:0)}return this.leftStick.x=i.axes[this.axeMapping.leftStick.x],this.leftStick.y=i.axes[this.axeMapping.leftStick.y],this.rightStick.x=i.axes[this.axeMapping.rightStick.x],this.rightStick.y=i.axes[this.axeMapping.rightStick.y],this._axeTriggers?(this.leftTrigger=i.axes[this.axeMapping.leftTrigger],this.rightTrigger=i.axes[this.axeMapping.rightTrigger]):(this.leftTrigger=i.buttons[this.buttonMapping.lt].value,this.rightTrigger=i.buttons[this.buttonMapping.rt].value,this.hasAnalogTriggers===void 0&&(this.leftTrigger||this.rightTrigger)&&(this.hasAnalogTriggers=!Number.isInteger(this.leftTrigger)||!Number.isInteger(this.rightTrigger))),!0}_reset(){for(let i in this.buttonMapping)this[i]=0;this.leftStick.x=0,this.leftStick.y=0,this.rightStick.x=0,this.rightStick.y=0,this.leftTrigger=0,this.rightTrigger=0}get ls(){return this.leftStick}get rs(){return this.rightStick}get lb(){return this.l}get rb(){return this.r}get leftStickButton(){return this.lsb}get rightStickButton(){return this.rsb}},this._Contros=class extends Array{constructor(){super();let i=this;if(window&&(window.addEventListener("gamepadconnected",h=>{i._onConnect(h.gamepad)}),window.addEventListener("gamepaddisconnected",h=>{i._onDisconnect(h.gamepad)})),typeof navigator!="object"||!navigator.getGamepads)return;let o=navigator.getGamepads();for(let h of o)h&&this._onConnect(h)}swap(i,o){let h=this[i];this[i]=this[o],this[o]=h,(i==0||o==0)&&(a.contro=this[0],!a._q5&&a._isGlobal&&(window.contro=this[0]))}remove(i){this[i]=null}onConnect(i){return!0}onDisconnect(i){return!1}_onConnect(i){if(!!i){for(let o=0;o<this.length;o++)if(this[o].gamepad?.index===i.index){this[o].connected=!0,gt("contros["+o+"] reconnected: "+i.id);return}if(gt(i),this.onConnect(i)){let o=new a.Contro(i),h=0;for(let u=0;u<this.length;u++)if(!this[u]){h=u;break}gt("contros["+h+"] connected: "+i.id),this[h]=o,h==0&&(a.contro=o,!a._q5&&a._isGlobal&&(window.contro=o))}}}_onDisconnect(i){if(!!i){for(let o=0;o<this.length;o++)if(this[o].gamepad?.index===i.index){this[o].connected=!1,gt("contros["+o+"] disconnected: "+i.id),this.onDisconnect(i)?this.remove(o):this[o]._reset();return}}}_update(){for(let i of this)i.connected&&i._update()}},this.contros=new a._Contros,this.controllers=a.contros,this.contro=new a.Contro("mock0"),this.getFPS??=()=>a.p5play._fps,this.renderStats=(i,o)=>{console.error("p5play: renderStats() function is deprecated. Use `p5play.renderStats = true` instead.")}});p5.prototype.registerMethod("pre",function(){const a=this;a._q5||(a.p5play._preDrawFrameTime=performance.now()),a.p5play.spritesDrawn=0,a.mouse._update(),a.contros._update()});p5.prototype.registerMethod("post",function(){const a=this;if(a.p5play._inPostDraw=!0,a.allSprites.autoCull&&a.allSprites.cull(1e4),a.allSprites._autoDraw&&(a.camera.on(),a.allSprites.draw(),a.camera.off()),a.allSprites._autoDraw??=!0,a.p5play.renderStats){let Y=a.p5play._renderStats;if(Y.fontSize||(a.allSprites.tileSize==1||a.allSprites.tileSize>16?Y.fontSize=16:Y.fontSize=10,Y.gap=Y.fontSize*1.25,a._q5||console.warn("renderStats() produces inaccurate FPS approximations because deltaTime is calculated incorrectly in p5.js. Even if your game runs at a solid 60hz display rate, the fps calculations shown may be lower. Use q5.js (visit https://q5js.org) or your browser's performance testing tools for accurate results.")),!a.p5play._fpsAvg||a.frameCount%20===0){let Ct=0,nt=a.p5play._fpsArr.length;for(let gt=0;gt<nt;gt++)Ct+=a.p5play._fpsArr[gt];Ct=Math.round(Ct/nt);let Je=Math.min(...a.p5play._fpsArr);a.p5play._fpsAvg=Ct,a.p5play._fpsMin=Je,a.p5play._fpsMax=Math.max(...a.p5play._fpsArr),a.p5play._fpsArr=[];let Mt;Je>55?Mt=a.color(30,255,30):Je>25?Mt=a.color(255,100,30):Mt=a.color(255,30,30),a.p5play._statsColor=Mt}a.p5play._fpsArr.push(a.getFPS()),a.push(),a.fill(0,0,0,128),a.rect(Y.x-5,Y.y-Y.fontSize,Y.fontSize*8.5,Y.gap*5+5),a.fill(a.p5play._statsColor),a.textAlign("left"),a.textSize(Y.fontSize),Y.font&&a.textFont(Y.font);let it=Y.x,xt=Y.y;a.text("sprites: "+a.p5play.spritesDrawn,it,xt),a.text("display: "+Math.round(a.frameRate())+"hz",it,xt+Y.gap),a.text("fps avg: "+a.p5play._fpsAvg,it,xt+Y.gap*2),a.text("fps min: "+a.p5play._fpsMin,it,xt+Y.gap*3),a.text("fps max: "+a.p5play._fpsMax,it,xt+Y.gap*4),a.pop(),Y.show=!1}a.world.autoStep&&a.world.timeScale>0&&a.world.step(),a.world.autoStep??=!0,a.allSprites._autoUpdate&&a.allSprites.update(),a.allSprites._autoUpdate??=!0;for(let Y of a.allSprites)Y.autoDraw??=!0,Y.autoUpdate??=!0;for(let Y in a.kb)Y!="holdThreshold"&&(a.kb[Y]<0?a.kb[Y]=0:a.kb[Y]>0&&a.kb[Y]++);for(let Y=0;Y<a.touches.length;Y++){let it=a.touches[Y];it.duration++,it._dragFrame?(it.drag++,it._dragFrame=!1):it.drag<0&&(it.drag=0),it.duration<=0&&(a.touches.splice(Y,1),Y--)}let S=a.mouse,lt=a.world.mouseSprite?.mouse;for(let Y of["left","center","right"])S[Y]<0?S[Y]=0:S[Y]>0&&S[Y]++,lt?.hover&&(lt[Y]=S[Y]),S._dragFrame[Y]?(S.drag[Y]++,lt&&(lt.drag[Y]=S.drag[Y]),S._dragFrame[Y]=!1):S.drag[Y]<0&&(S.drag[Y]=0,lt&&(lt.drag[Y]=0));if(a.world.mouseTracking&&a.mouse.isActive){let Y=a.world.getMouseSprites();for(let Ct=0;Ct<Y.length;Ct++){let nt=Y[Ct];Ct==0?nt.mouse.hover++:nt.mouse.hover>0?nt.mouse.hover=-1:nt.mouse.hover<0&&(nt.mouse.hover=0)}S.left<=0&&S.center<=0&&S.right<=0&&(a.world.mouseSprite=null);let it=a.world.mouseSprite,xt=S.drag.left>0||S.drag.center>0||S.drag.right>0;for(let Ct of a.world.mouseSprites)if(!Y.includes(Ct)){let nt=Ct.mouse;nt.hover>0&&(nt.hover=-1,nt.left=nt.center=nt.right=0),!xt&&Ct==it&&(a.world.mouseSprite=it=null)}it&&(Y.includes(it)||Y.push(it),lt.x=it.x-S.x,lt.y=it.y-S.y),a.world.mouseSprites=Y}a.camera.off(),a._q5||(a.p5play._postDrawFrameTime=performance.now(),a.p5play._fps=Math.round(1e3/(a.p5play._postDrawFrameTime-a.p5play._preDrawFrameTime))||1),a.p5play._inPostDraw=!1});var Yn=Wn({__proto__:null,default:Nr},[Nr]);export{Yn as p};
